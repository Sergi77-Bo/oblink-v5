--- FILE: theme/functions.php ---
<?php
// Function file for OBLINK Theme - V60 RESTORE (Pre-Messaging) - STABLE

// Auto-installation des fichiers SEO à l'activation du thème
require_once get_template_directory() . '/inc/theme-activation.php';

/**
 * Determine current user view mode (RBAC)
 * Roles: 'visitor', 'student', 'freelance', 'recruiter'
 */
function oblink_get_user_role()
{
    if (!is_user_logged_in()) {
        return 'visitor';
    }

    $user = wp_get_current_user();

    // Admin is Recruiter for demo purposes, or explicit 'recruiter' role
    if (current_user_can('manage_options') || in_array('recruiter', (array) $user->roles)) {
        return 'recruiter';
    }

    // Check for explicit "Expert" mode in user meta
    $role_mode = get_user_meta($user->ID, 'role_mode', true);
    if ($role_mode === 'expert') {
        return 'freelance';
    }

    // Default for logged in users
    return 'student';
}

function oblink_scripts()
{
    // 1. Charger Tailwind CSS (CDN)
    wp_enqueue_script('tailwindcss', 'https://cdn.tailwindcss.com', array(), '3.4.0', false);

    // 2. Config Tailwind (Injected inline)
    $tailwind_config = "
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'oblink-orange': '#FF6600',
                        'oblink-blue': '#0099FF', 
                        'oblink-violet': '#9A48D0',
                        'oblink-gray': '#303030',
                    },
                    fontFamily: {
                        'display': ['Overpass', 'sans-serif'], 
                        'body': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    ";
    wp_add_inline_script('tailwindcss', $tailwind_config);

    // 3. Styles
    wp_enqueue_style('fontawesome', 'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css');
    wp_enqueue_style('google-fonts', 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Overpass:wght@400;600;700;800;900&display=swap');
    wp_enqueue_style('oblink-style', get_stylesheet_uri());

    // 4. Custom App JS
    wp_enqueue_script('oblink-app', get_template_directory_uri() . '/js/app.js', array(), '1.1', true);
}
add_action('wp_enqueue_scripts', 'oblink_scripts');

// -- SUPABASE INTEGRATION --
function oblink_enqueue_supabase()
{
    // 1. Supabase SDK (CDN)
    wp_enqueue_script('supabase-js', 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js', [], '2.0.0', false);

    // 2. Init Script
    wp_enqueue_script('oblink-supabase-init', get_template_directory_uri() . '/js/supabase-config.js', ['supabase-js'], '1.0', true);

    // 3. Inject Credentials
    wp_localize_script('oblink-supabase-init', 'oblink_vars', [
        'ajax_url' => admin_url('admin-ajax.php'),
        'nonce' => wp_create_nonce('oblink_nonce'),
        'supabase_url' => 'https://kqpjohxtzyprqvhijjet.supabase.co',
        'supabase_key' => 'sb_publishable_bkZHMMqGz23jmskNgqx7BA_aKHQdCQU',
        'home_url' => home_url()
    ]);
}
add_action('wp_enqueue_scripts', 'oblink_enqueue_supabase');

// -- EMBED SUPPORT (YouTube, etc.) --
add_theme_support('automatic-feed-links');
add_theme_support('title-tag');
add_theme_support('post-thumbnails');

// Enable oEmbed for YouTube and other providers
add_filter('oembed_discovery_links', '__return_true');

// Wrap embeds in responsive container
function oblink_embed_html($html, $url)
{
    if (strpos($url, 'youtube.com') !== false || strpos($url, 'youtu.be') !== false) {
        return '<div class="video-container" style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;margin:2rem 0;"><div style="position:absolute;top:0;left:0;width:100%;height:100%;">' . $html . '</div></div>';
    }
    return '<div class="embed-container" style="margin:2rem 0;">' . $html . '</div>';
}
add_filter('embed_oembed_html', 'oblink_embed_html', 10, 2);


// -- Email System (Gardé pour l'instant) --
require_once get_template_directory() . '/inc/emails.php'; // On pourra le migrer sur Supabase Edge Functions plus tard

// -- Messaging System --
require_once get_template_directory() . '/inc/messaging.php';

// -- Simulator Email --
require_once get_template_directory() . '/inc/simulator-email.php';

add_action('wp_ajax_save_simulator_lead', 'handle_simulator_lead');
add_action('wp_ajax_nopriv_save_simulator_lead', 'handle_simulator_lead');

// AJAX Handler for Contact Form
add_action('wp_ajax_send_contact_form', 'handle_contact_form');
add_action('wp_ajax_nopriv_send_contact_form', 'handle_contact_form');

function handle_contact_form()
{
    // Validate nonce (optional but recommended)
    // if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'oblink_nonce')) {
    //     wp_send_json_error(['message' => 'Invalid nonce']);
    //     return;
    // }

    // Sanitize inputs
    $name = sanitize_text_field($_POST['name'] ?? '');
    $email = sanitize_email($_POST['email'] ?? '');
    $subject = sanitize_text_field($_POST['subject'] ?? '');
    $message = sanitize_textarea_field($_POST['message'] ?? '');

    // Validate required fields
    if (empty($name) || empty($email) || empty($subject) || empty($message)) {
        wp_send_json_error(['message' => 'Tous les champs sont requis']);
        return;
    }

    // Validate email format
    if (!is_email($email)) {
        wp_send_json_error(['message' => 'Email invalide']);
        return;
    }

    // Prepare email
    $to = 'contact@oblink.fr';
    $email_subject = '[OBLINK Contact] ' . $subject;

    // Build email body
    $email_body = "Nouveau message de contact OBLINK\n\n";
    $email_body .= "Nom: $name\n";
    $email_body .= "Email: $email\n";
    $email_body .= "Sujet: $subject\n\n";
    $email_body .= "Message:\n$message\n\n";
    $email_body .= "---\n";
    $email_body .= "Envoyé depuis: " . home_url('/contact') . "\n";
    $email_body .= "Date: " . current_time('d/m/Y H:i');

    // Email headers
    $headers = [
        'Content-Type: text/plain; charset=UTF-8',
        'From: OBLINK Contact <noreply@oblink.fr>',
        'Reply-To: ' . $name . ' <' . $email . '>',
    ];

    // Send email
    $email_sent = wp_mail($to, $email_subject, $email_body, $headers);

    if ($email_sent) {
        // Optional: Save to database or Supabase for tracking
        // error_log("Contact form submitted by: $name ($email)");

        wp_send_json_success([
            'message' => 'Message envoyé avec succès'
        ]);
    } else {
        error_log("Contact form email failed for: $email");
        wp_send_json_error([
            'message' => 'Erreur lors de l\'envoi. Veuillez réessayer ou nous contacter directement à contact@oblink.fr'
        ]);
    }
}


function handle_simulator_lead()
{
    $email = sanitize_email($_POST['email']);
    $mode = sanitize_text_field($_POST['mode']);
    $data = json_decode(stripslashes($_POST['data']), true);
    $results = json_decode(stripslashes($_POST['results']), true);

    if (!is_email($email)) {
        wp_send_json_error(['message' => 'Invalid email']);
        return;
    }

    // TODO: Sauvegarder dans Supabase
    // Pour l'instant, on log juste
    error_log("Simulator Lead: $email | Mode: $mode");

    // Envoyer l'email
    $params = $data;
    $params['mode'] = $mode;

    $email_sent = send_simulator_email($email, $results, $mode, $params);

    if ($email_sent) {
        wp_send_json_success(['message' => 'Email sent successfully']);
    } else {
        wp_send_json_error(['message' => 'Failed to send email']);
    }
}

// -- DEPRECATED WP DB SYSTEMS (Removed for Supabase) --
// User Registration via WP DB -> REMOVED
// Admin Columns -> REMOVED

// -- REDIRECTIONS: DEFERRED (Also causes issues) --
?>--- FILE: theme/page-admin-dashboard.php ---
<?php
/**
 * Template Name: Admin Dashboard
 * 
 * A Real-time BI Dashboard for OBLINK Académie.
 * Tracks: Cache Hit Ratio (Margin), Conversion (Sales), Quarantine (Quality).
 */

// Basic Security (In prod, use strict role check)
// if (!current_user_can('manage_options')) { wp_redirect(home_url()); exit; }

get_header();

// 1. Fetch Stats from JSON (Mocking a DB query)
$stats_file = get_template_directory() . '/../academie/stats.json';
$quarantine_file = get_template_directory() . '/../academie/questions_quarantine.json';

$stats = ['global' => ['cache_hits' => 0, 'api_calls' => 0]];
$quarantine_count = 0;

if (file_exists($stats_file)) {
    $stats = json_decode(file_get_contents($stats_file), true);
}
if (file_exists($quarantine_file)) {
    $q_data = json_decode(file_get_contents($quarantine_file), true);
    $quarantine_count = count($q_data);
}

// 2. Calculate KPIs
$total_requests = ($stats['global']['cache_hits'] ?? 0) + ($stats['global']['api_calls'] ?? 0);
$cache_hit_ratio = $total_requests > 0 ? round(($stats['global']['cache_hits'] / $total_requests) * 100, 1) : 0;

// Conversion Mock (Simulated logic for demo)
$unique_visitors = 1250; // Analytics API
$sales_count = 58;
$conversion_rate = round(($sales_count / $unique_visitors) * 100, 1);

// Quarantine Rate
// Assuming we track 'total_generated' roughly equal to api_calls over time (simplified)
$total_generated = $stats['global']['api_calls'] ?? 1;
$quarantine_rate = round(($quarantine_count / max($total_generated, 1)) * 100, 1);

?>

<div class="pt-32 pb-20 bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-10 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-black text-gray-900 mb-2">Pilotage Académie</h1>
                <p class="text-gray-500">Business Intelligence & Santé de l'IA</p>
            </div>
            <div class="text-right">
                <span class="block text-sm text-gray-400">Revenus (Mois en cours)</span>
                <span class="block text-3xl font-bold text-green-600">1 682,00 €</span>
            </div>
        </div>

        <!-- KPI Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">

            <!-- KPI 1: Marge Technique (Cache Hit) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $cache_hit_ratio > 85 ? 'border-green-500' : 'border-yellow-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-server text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Marge Technique</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $cache_hit_ratio; ?>%
                    </span>
                    <span class="text-sm text-gray-500">Cache Hit Ratio</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    <?php if ($cache_hit_ratio > 85): ?>
                        <span class="text-green-600 font-bold"><i class="fas fa-check"></i> Excellent.</span> Coûts API
                        minimes.
                    <?php else: ?>
                        <span class="text-yellow-600 font-bold"><i class="fas fa-exclamation-triangle"></i>
                            Attention.</span> L'IA travaille trop.
                    <?php endif; ?>
                </p>
            </div>

            <!-- KPI 2: Conversion (Tunnel) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $conversion_rate >= 4 ? 'border-green-500' : 'border-red-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-funnel-dollar text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Efficacité Vente</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $conversion_rate; ?>%
                    </span>
                    <span class="text-sm text-gray-500">CVR (Sim -> Achat)</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    Basé sur
                    <?php echo $sales_count; ?> ventes pour
                    <?php echo $unique_visitors; ?> visiteurs.
                    <?php if ($conversion_rate < 3): ?>
                        <br><a href="#" class="text-oblink-orange font-bold hover:underline">Optimiser le Hook</a>
                    <?php endif; ?>
                </p>
            </div>

            <!-- KPI 3: Santé Produit (Quarantine) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $quarantine_rate < 2 ? 'border-green-500' : 'border-red-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-heartbeat text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Qualité IA</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $quarantine_rate; ?>%
                    </span>
                    <span class="text-sm text-gray-500">Taux de Rejet</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    <?php echo $quarantine_count; ?> questions en quarantaine.
                    <?php if ($quarantine_rate > 5): ?>
                        <span class="block mt-1 text-red-600 font-bold animate-pulse">ALERTE CRITIQUE : Vérifier
                            Prompt.</span>
                    <?php endif; ?>
                </p>
            </div>
        </div>

        <!-- Actions Rapides -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-8 rounded-2xl shadow-sm">
                <h3 class="font-bold text-lg mb-4">Actions Techniques</h3>
                <div class="space-y-3">
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Lancer le nettoyage du cache</span>
                        <i class="fas fa-broom text-gray-400 group-hover:text-oblink-orange"></i>
                    </button>
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Voir les questions en quarantaine</span>
                        <i class="fas fa-file-medical-alt text-gray-400 group-hover:text-red-500"></i>
                    </button>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-sm">
                <h3 class="font-bold text-lg mb-4">Actions Commerciales</h3>
                <div class="space-y-3">
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Envoyer Promo "J-30 Examen"</span>
                        <i class="fas fa-paper-plane text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Configurer Stripe (En attente)</span>
                        <i class="fas fa-cog text-gray-400 group-hover:text-gray-600"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<?php get_footer(); ?>--- FILE: theme/api-chat.php ---
<?php
// Simple API wrapper for support_agent.py
// Usage: POST to this file with JSON body: { "question": "..." }

header('Content-Type: application/json');

// Check method
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    echo json_encode(['error' => 'Method Not Allowed']);
    exit;
}

// Get Input
$input = json_decode(file_get_contents('php://input'), true);
$question = $input['question'] ?? '';

if (empty($question)) {
    http_response_code(400);
    echo json_encode(['error' => 'Question required']);
    exit;
}

// Security: Basic sanitization (escapeshellarg handles the shell safety)
$safe_question = escapeshellarg($question);

// Path to python script (Adjust relative path if needed)
// Assuming this file is in /theme/ and script is in /academie/
// But for "webapp 5", structure is:
// /Users/sergiosandoval/Downloads/webapp 5/theme/api-chat.php
// /Users/sergiosandoval/Downloads/webapp 5/academie/support_agent.py
// So we need to go up one level then into academie.

$script_path = dirname(__DIR__) . '/academie/support_agent.py';

if (!file_exists($script_path)) {
    echo json_encode(['error' => 'Agent configuration error (Script not found)']);
    exit;
}

// Execute Python Script
// Note: This requires 'python3' to be in the path and allow execution.
// For shared hosting, this might be restricted.
$command = "python3 " . escapeshellarg($script_path) . " " . $safe_question;
$output = shell_exec($command);

if ($output === null) {
    echo json_encode(['error' => 'Agent silent failure']);
} else {
    // Return output directly (assuming script prints text only)
    echo json_encode(['response' => trim($output)]);
}
?>--- FILE: theme/page-guide-creation-entreprise.php ---
<?php
/*
Template Name: Guide Création Entreprise
*/

include 'header-inc.php';
?>

<style>
    .sticky-toc {
        position: sticky;
        top: 100px;
    }
</style>

<!-- Hero -->
<section class="bg-gradient-to-br from-oblink-blue/10 to-oblink-violet/10 pt-32 pb-16">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="inline-flex items-center px-4 py-2 bg-white rounded-full shadow-sm mb-6">
            <i class="fas fa-rocket text-oblink-orange mr-2"></i>
            <span class="text-sm font-semibold text-oblink-gray">GUIDE COMPLET</span>
        </div>
        <h1 class="text-5xl font-bold mb-6 text-oblink-gray" style="font-family: 'Montserrat', sans-serif;">
            Guide de Création d'Entreprise<br />
            <span class="text-oblink-orange">pour Opticiens Freelances</span>
        </h1>
        <p class="text-xl text-oblink-gray/70 max-w-3xl mx-auto">
            Tout ce que vous devez savoir pour devenir opticien indépendant : statut juridique, démarches
            administratives,
            comptabilité, assurances et accompagnement
        </p>
    </div>
</section>

<!-- Content -->
<div class="max-w-7xl mx-auto px-4 py-16">
    <div class="grid lg:grid-cols-4 gap-8">
        <!-- Table of Contents (Sticky) -->
        <aside class="lg:col-span-1">
            <nav class="sticky-toc bg-white border-2 border-oblink-beige rounded-xl p-6">
                <h2 class="font-bold text-oblink-gray mb-4 flex items-center">
                    <i class="fas fa-list text-oblink-orange mr-2"></i>
                    Sommaire
                </h2>
                <ul class="space-y-2 text-sm">
                    <li><a href="#introduction"
                            class="text-oblink-gray hover:text-oblink-orange transition">Introduction</a></li>
                    <li><a href="#statut-juridique" class="text-oblink-gray hover:text-oblink-orange transition">1.
                            Statut juridique</a></li>
                    <li><a href="#demarches" class="text-oblink-gray hover:text-oblink-orange transition">2. Démarches
                            administratives</a></li>
                    <li><a href="#comptabilite" class="text-oblink-gray hover:text-oblink-orange transition">3.
                            Comptabilité & Fiscalité</a></li>
                    <li><a href="#assurances" class="text-oblink-gray hover:text-oblink-orange transition">4. Assurances
                            obligatoires</a></li>
                    <li><a href="#tarification" class="text-oblink-gray hover:text-oblink-orange transition">5.
                            Tarification</a></li>
                    <li><a href="#facturation" class="text-oblink-gray hover:text-oblink-orange transition">6.
                            Facturation</a></li>
                    <li><a href="#developpement" class="text-oblink-gray hover:text-oblink-orange transition">7.
                            Développement</a></li>
                    <li><a href="#accompagnement" class="text-oblink-gray hover:text-oblink-orange transition">8.
                            Accompagnement OBLINK</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="lg:col-span-3">
            <!-- Introduction -->
            <section id="introduction" class="mb-16">
                <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet text-white p-8 rounded-2xl mb-8">
                    <h2 class="text-3xl font-bold mb-4" style="font-family: 'Montserrat', sans-serif;">
                        <i class="fas fa-info-circle mr-2"></i>
                        Bienvenue dans votre parcours entrepreneurial
                    </h2>
                    <p class="text-lg opacity-90">
                        Ce guide complet vous accompagne pas à pas dans la création de votre activité d'opticien
                        indépendant.
                        De la sélection du statut juridique jusqu'à la gestion quotidienne, découvrez toutes les étapes
                        et les meilleures pratiques pour réussir votre lancement.
                    </p>
                </div>
            </section>

            <!-- 1. Statut Juridique -->
            <section id="statut-juridique" class="mb-16 scroll-mt-24">
                <h2 class="text-4xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
                    <span class="text-oblink-orange">1.</span> Choisir son statut juridique
                </h2>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-xl mb-8">
                    <h3 class="font-bold text-yellow-800 mb-2 flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>
                        Point clé
                    </h3>
                    <p class="text-yellow-700">
                        Le choix du statut juridique est la première décision stratégique. Il détermine votre protection
                        sociale,
                        votre fiscalité et votre responsabilité.
                    </p>
                </div>

                <!-- Auto-entrepreneur -->
                <div
                    class="bg-white border-2 border-oblink-beige rounded-xl p-8 mb-6 hover:border-oblink-orange transition">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-oblink-gray mb-2">
                                <i class="fas fa-user text-oblink-blue mr-2"></i>
                                Auto-entrepreneur (Micro-entreprise)
                            </h3>
                            <p class="text-oblink-gray/70">Le statut le plus simple pour débuter</p>
                        </div>
                        <span class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                            <i class="fas fa-star mr-1"></i>Recommandé débutants
                        </span>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-bold text-green-600 mb-3 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>Avantages
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Création rapide et gratuite</li>
                                <li>Comptabilité simplifiée</li>
                                <li>Pas de TVA jusqu'à 600€</li>
                                <li>Charges sociales proportionnelles au CA</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-red-500 mb-3 flex items-center">
                                <i class="fas fa-times-circle mr-2"></i>Limites
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Plafond de CA (77 700€ / an)</li>
                                <li>Pas de déduction des charges réelles</li>
                                <li>Responsabilité illimitée (sauf EIRL)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- EURL / SASU -->
                <div
                    class="bg-white border-2 border-oblink-beige rounded-xl p-8 mb-6 hover:border-oblink-orange transition">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-oblink-gray mb-2">
                                <i class="fas fa-building text-oblink-violet mr-2"></i>
                                Société (EURL / SASU)
                            </h3>
                            <p class="text-oblink-gray/70">Pour les projets ambitieux</p>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-green-600 mb-3 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>Avantages
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Pas de plafond de chiffre d'affaires</li>
                                <li>Déduction des charges réelles</li>
                                <li>Responsabilité limitée aux apports</li>
                                <li>Crédibilité auprès des banques</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-red-500 mb-3 flex items-center">
                                <i class="fas fa-times-circle mr-2"></i>Limites
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Formalités de création plus lourdes</li>
                                <li>Comptabilité complexe obligatoire</li>
                                <li>Coûts de gestion plus élevés</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Tarification -->
            <section id="tarification" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">5. Définir votre stratégie de tarification
                </h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    La tarification est l'un des aspects les plus délicats de l'indépendance. Plusieurs facteurs entrent
                    en jeu :
                </p>

                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="border-2 border-oblink-beige rounded-xl p-6">
                        <h3 class="font-bold text-oblink-gray mb-3 flex items-center">
                            <i class="fas fa-map-marker-alt text-oblink-orange mr-2"></i>
                            Localisation géographique
                        </h3>
                        <p class="text-oblink-gray/70">
                            Île-de-France : 35-45€/h<br>
                            Grandes métropoles : 30-40€/h<br>
                            Villes moyennes : 25-35€/h
                        </p>
                    </div>
                    <div class="border-2 border-oblink-beige rounded-xl p-6">
                        <h3 class="font-bold text-oblink-gray mb-3 flex items-center">
                            <i class="fas fa-star text-oblink-blue mr-2"></i>
                            Niveau d'expérience
                        </h3>
                        <p class="text-oblink-gray/70">
                            Junior (0-3 ans) : 25-30€/h<br>
                            Confirmé (3-10 ans) : 30-40€/h<br>
                            Expert (10+ ans) : 40-50€/h
                        </p>
                    </div>
                </div>
            </section>

            <!-- 3. Assurances -->
            <section id="assurances" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">4. Sécuriser votre activité avec les bonnes
                    assurances</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    L'assurance Responsabilité Civile Professionnelle (RC Pro) est <strong>obligatoire</strong> pour les
                    opticiens.
                    Elle couvre les dommages causés à vos clients dans l'exercice de votre activité.
                </p>

                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6 mb-8">
                    <h3 class="font-bold text-red-800 mb-3 flex items-center text-xl">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Attention : RC Pro obligatoire !
                    </h3>
                    <p class="text-red-700 mb-4">
                        Sans assurance RC Pro, vous ne pouvez légalement pas exercer. Le coût moyen varie entre 300€ et
                        600€/an
                        selon votre chiffre d'affaires et vos spécialités.
                    </p>
                    <a href="#"
                        class="inline-block px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                        Comparer les assurances RC Pro
                    </a>
                </div>
            </section>

            <!-- 4. Réseau -->
            <section id="developpement" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">7. Construire votre réseau professionnel</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    Le réseau est votre meilleur atout pour trouver des missions régulières. Voici comment le développer
                    efficacement :
                </p>

                <ul class="space-y-3 mb-8">
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Inscrivez-vous sur des plateformes spécialisées</strong>
                            <p class="text-oblink-gray/70">OBLINK, RemplacementOptique.fr, JobOptique.com</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Participez aux salons professionnels</strong>
                            <p class="text-oblink-gray/70">Silmo, Optique Paris, congrès de l'AOF</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Rejoignez des groupes LinkedIn</strong>
                            <p class="text-oblink-gray/70">Groupes d'opticiens, réseaux de freelances</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Contactez directement les magasins</strong>
                            <p class="text-oblink-gray/70">Email de présentation, visite de courtoisie</p>
                        </div>
                    </li>
                </ul>
            </section>

            <!-- 5. Gestion Quotidienne -->
            <section id="accompagnement" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">5. Gérer votre activité au quotidien</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    La réussite de votre activité dépend aussi de votre organisation administrative et comptable :
                </p>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-file-invoice text-4xl text-oblink-orange mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Facturation</h3>
                        <p class="text-sm text-oblink-gray/70">Utilisez des outils conformes à la facturation
                            électronique obligatoire</p>
                    </div>
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-calculator text-4xl text-oblink-blue mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Comptabilité</h3>
                        <p class="text-sm text-oblink-gray/70">Suivez vos revenus et charges, préparez vos déclarations
                        </p>
                    </div>
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-calendar-check text-4xl text-oblink-violet mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Planning</h3>
                        <p class="text-sm text-oblink-gray/70">Gérez vos missions, disponibilités et prospection</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet text-white p-8 rounded-2xl mt-12">
                    <h3 class="text-2xl font-bold mb-4">Prêt à vous lancer ?</h3>
                    <p class="text-lg mb-6 opacity-90">
                        Rejoignez OBLINK et accédez immédiatement à des centaines de missions partout en France,
                        avec un accompagnement complet pour réussir votre indépendance.
                    </p>
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="inline-block px-8 py-4 bg-white text-oblink-orange rounded-lg font-semibold hover:bg-gray-100 transition shadow-lg">
                        Créer mon profil gratuitement <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </section>

        </main>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-blog.php ---
<?php
/**
 * Template Name: Blog
 */

include 'header-inc.php';
?>

<div class="container mx-auto px-4 py-8 pt-32 min-h-screen">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4 font-display text-oblink-gray">Le Blog <span
                class="text-oblink-orange">OBLINK</span></h1>
        <p class="text-lg text-gray-500">Conseils, guides pratiques et actualités pour les opticiens indépendants et les
            entreprises d'optique</p>
    </div>

    <!-- FILTRES PAR CATÉGORIE -->
    <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button class="category-filter active px-6 py-2.5 rounded-full font-bold transition-all duration-300"
            data-category="all">
            Tous
        </button>
        <?php
        $categories = get_categories(array(
            'orderby' => 'name',
            'order' => 'ASC',
            'hide_empty' => true,
        ));

        foreach ($categories as $category):
            if ($category->slug !== 'non-classe'):
                ?>
                <button class="category-filter px-6 py-2.5 rounded-full font-bold transition-all duration-300"
                    data-category="<?php echo esc_attr($category->slug); ?>">
                    <?php echo esc_html($category->name); ?>
                </button>
                <?php
            endif;
        endforeach;
        ?>
    </div>

    <style>
        .category-filter {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
        }

        .category-filter:hover {
            border-color: #FF6600;
            color: #FF6600;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.2);
        }

        .category-filter.active {
            background: #FF6600;
            color: white;
            border-color: #FF6600;
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
        }

        .article-card {
            transition: opacity 0.3s, transform 0.3s;
        }

        .article-card.hidden {
            display: none;
        }
    </style>

    <?php if (have_posts()): ?>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="articles-grid">
            <?php
            // Custom query to pagination work correctly on a static page used as blog
            $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
            $args = array(
                'post_type' => 'post',
                'posts_per_page' => 9,
                'paged' => $paged
            );
            $the_query = new WP_Query($args);

            if ($the_query->have_posts()):
                while ($the_query->have_posts()):
                    $the_query->the_post();

                    // Get post categories
                    $post_categories = get_the_category();
                    $category_slugs = array();
                    if ($post_categories) {
                        foreach ($post_categories as $cat) {
                            $category_slugs[] = $cat->slug;
                        }
                    }
                    $categories_data = implode(' ', $category_slugs);
                    ?>
                    <article id="post-<?php the_ID(); ?>"
                        class="article-card <?php echo implode(' ', array_map(function ($slug) {
                            return 'cat-' . $slug;
                        }, $category_slugs)); ?> bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-gray-100 flex flex-col h-full"
                        data-categories="<?php echo esc_attr($categories_data); ?>">
                        <?php if (has_post_thumbnail()): ?>
                            <a href="<?php the_permalink(); ?>" class="block overflow-hidden relative h-56">
                                <?php the_post_thumbnail('medium_large', ['class' => 'w-full h-full object-cover transform hover:scale-105 transition-transform duration-500']); ?>
                            </a>
                        <?php else: ?>
                            <a href="<?php the_permalink(); ?>"
                                class="block overflow-hidden relative h-56 bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-image text-gray-300 text-4xl"></i>
                            </a>
                        <?php endif; ?>

                        <div class="p-6 flex-1 flex flex-col">
                            <div class="mb-3 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-oblink-orange">
                                <?php
                                $categories = get_the_category();
                                if (!empty($categories)) {
                                    echo esc_html($categories[0]->name);
                                } else {
                                    echo 'Article';
                                }
                                ?>
                            </div>

                            <h2 class="text-xl font-bold mb-3 font-display leading-tight">
                                <a href="<?php the_permalink(); ?>"
                                    class="text-oblink-gray hover:text-oblink-blue transition-colors">
                                    <?php the_title(); ?>
                                </a>
                            </h2>

                            <div class="text-gray-600 mb-4 text-sm flex-1 line-clamp-3">
                                <?php the_excerpt(); ?>
                            </div>

                            <div class="mt-auto flex items-center justify-between pt-4 border-t border-gray-100">
                                <div class="text-xs text-gray-400">
                                    <i class="far fa-calendar-alt mr-1"></i> <?php echo get_the_date(); ?>
                                </div>
                                <a href="<?php the_permalink(); ?>"
                                    class="text-sm font-bold text-oblink-blue hover:text-oblink-violet transition-colors flex items-center gap-1">
                                    Lire <i class="fas fa-arrow-right text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                    <?php
                endwhile;

                // Pagination
                echo '<div class="mt-12 col-span-full">';
                echo '<style>
                    .pagination {
                        display: flex;
                        justify-content: center;
                        gap: 8px;
                        align-items: center;
                    }
                    .pagination a,
                    .pagination span {
                        display: inline-block;
                        padding: 10px 16px;
                        background: white;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        color: #4b5563;
                        font-weight: 600;
                        text-decoration: none;
                        transition: all 0.3s ease;
                    }
                    .pagination a:hover {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .current {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .dots {
                        border: none;
                        background: transparent;
                        color: #9ca3af;
                    }
                </style>';
                echo '<div class="pagination">';
                echo paginate_links(array(
                    'total' => $the_query->max_num_pages,
                    'current' => $paged,
                    'prev_text' => 'Précédent',
                    'next_text' => 'Suivant',
                    'mid_size' => 2,
                    'type' => 'plain',
                ));
                echo '</div>';
                echo '</div>';

                wp_reset_postdata();
            else:
                ?>
                <div class="col-span-full text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-300">
                    <i class="far fa-newspaper text-4xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-400">Aucun article publié pour le moment.</h3>
                    <p class="text-gray-400 mt-2">Revenez bientôt pour découvrir nos actualités.</p>
                </div>
                <?php
            endif;
            ?>
        </div>
    <?php endif; ?>
</div>

<script>
    // Système de filtrage des articles par catégorie
    document.addEventListener('DOMContentLoaded', function () {
        const filterButtons = document.querySelectorAll('.category-filter');
        const articles = document.querySelectorAll('.article-card');

        filterButtons.forEach(button => {
            button.addEventListener('click', function () {
                const selectedCategory = this.dataset.category;

                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // Filter articles
                articles.forEach(article => {
                    if (selectedCategory === 'all') {
                        article.classList.remove('hidden');
                    } else {
                        const articleCategories = article.dataset.categories.split(' ');
                        if (articleCategories.includes(selectedCategory)) {
                            article.classList.remove('hidden');
                        } else {
                            article.classList.add('hidden');
                        }
                    }
                });
            });
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-abonnements.php ---
<?php
/*
Template Name: Page Abonnements
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">
                Des tarifs simples et <span class="text-oblink-blue">transparents</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Que vous soyez Opticien ou Magasin, choisissez la formule adaptée à vos besoins. Sans engagement,
                annulable à tout moment.
            </p>

            <!-- Toggle Switch (Visual Only for now) -->
            <div class="flex justify-center mt-10">
                <div class="bg-white p-1 rounded-xl border border-gray-200 inline-flex shadow-sm">
                    <button
                        class="px-6 py-2 rounded-lg bg-oblink-gray text-white font-bold text-sm shadow-md transition">Pour
                        Magasins</button>
                    <button
                        class="px-6 py-2 rounded-lg text-gray-500 font-bold text-sm hover:bg-gray-50 transition">Pour
                        Opticiens</button>
                </div>
            </div>
        </div>

        <!-- Pricing Cards -->
        <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto items-center">

            <!-- Plan Découverte -->
            <div
                class="bg-white rounded-3xl p-8 border border-gray-100 shadow-xl hover:shadow-2xl transition hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-gray-50 rounded-bl-full -mr-16 -mt-16 z-0"></div>

                <h3 class="text-2xl font-bold text-oblink-gray mb-2 relative z-10">Découverte</h3>
                <p class="text-gray-400 text-sm mb-6 relative z-10">Pour tester la plateforme.</p>

                <div class="flex items-baseline mb-8 relative z-10">
                    <span class="text-5xl font-black text-oblink-gray">0€</span>
                </div>

                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="block w-full py-3 bg-gray-100 text-oblink-gray font-bold text-center rounded-xl hover:bg-gray-200 transition mb-8">
                    Commencer
                </a>

                <ul class="space-y-4 text-sm text-gray-600 relative z-10">
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>1 Offre d'emploi active</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>Visibilité standard</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>Commission standard (15%)</span>
                    </li>
                    <li class="flex items-center gap-3 text-gray-400">
                        <i class="fas fa-times"></i>
                        <span class="line-through">Accès CV-thèque</span>
                    </li>
                    <li class="flex items-center gap-3 text-gray-400">
                        <i class="fas fa-times"></i>
                        <span class="line-through">Support prioritaire</span>
                    </li>
                </ul>
            </div>

            <!-- Plan Premium (Featured) -->
            <div
                class="bg-oblink-gray text-white rounded-3xl p-8 border border-oblink-gray shadow-2xl relative transform md:scale-110 z-10">
                <div
                    class="absolute top-0 right-0 bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-bl-xl uppercase tracking-wider">
                    Populaire</div>

                <h3 class="text-2xl font-bold mb-2">Premium</h3>
                <p class="text-white/60 text-sm mb-6">Pour les recrutements réguliers.</p>

                <div class="flex items-baseline mb-8">
                    <span class="text-6xl font-black text-white">49€</span>
                    <span class="text-white/60 ml-2">/mois</span>
                </div>

                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="block w-full py-4 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold text-center rounded-xl hover:shadow-lg transition hover:scale-105 mb-8">
                    Choisir Premium
                </a>

                <ul class="space-y-4 text-sm text-gray-300">
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span class="font-bold text-white">Offres Illimitées</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span class="font-bold text-white">Accès complet CV-thèque</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Commission réduite (10%)</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Badge "Recruteur Vérifié"</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Support dédié 7j/7</span>
                    </li>
                </ul>
            </div>

            <!-- Plan Corporate -->
            <div
                class="bg-white rounded-3xl p-8 border border-gray-100 shadow-xl hover:shadow-2xl transition hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-32 h-32 bg-oblink-blue/5 rounded-br-full -ml-16 -mt-16 z-0"></div>

                <h3 class="text-2xl font-bold text-oblink-gray mb-2 relative z-10">Corporate</h3>
                <p class="text-gray-400 text-sm mb-6 relative z-10">Pour les réseaux > 5 magasins.</p>

                <div class="flex items-baseline mb-8 relative z-10">
                    <span class="text-4xl font-black text-oblink-gray">Sur Mesure</span>
                </div>

                <a href="<?php echo home_url('/contact'); ?>"
                    class="block w-full py-3 bg-white border-2 border-oblink-gray text-oblink-gray font-bold text-center rounded-xl hover:bg-oblink-gray hover:text-white transition mb-8">
                    Contactez-nous
                </a>

                <ul class="space-y-4 text-sm text-gray-600 relative z-10">
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Compte Multi-utilisateurs</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Facturation centralisée</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>API de connexion RH</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Account Manager dédié</span>
                    </li>
                </ul>
            </div>

        </div>

    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-contactologie.php ---
<?php
/*
Template Name: Calculateur Contactologie
*/
include 'header-inc.php';

// -----------------------------------------------------------------------------
// 1. DATA SOURCE (V40 Style + Expanded)
// -----------------------------------------------------------------------------
$lenses_db = [
    // === ALCON ===
    ['make' => 'Alcon', 'name' => 'Dailies Total 1', 'type' => 'daily', 'h2o' => '33%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Confort ultime. Matériau à gradient d\'eau (>80% surf).'],
    ['make' => 'Alcon', 'name' => 'Precision 1', 'type' => 'daily', 'h2o' => '51%', 'modality' => 'daily', 'bc' => [8.3, 8.7], 'toric' => true, 'multifocal' => false, 'dry_eye' => false, 'desc' => 'Excellent rapport qualité/prix.'],
    ['make' => 'Alcon', 'name' => 'Dailies AquaComfort Plus', 'type' => 'daily', 'h2o' => '69%', 'modality' => 'daily', 'bc' => [8.7], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'Entrée de gamme hydrogel.'],
    ['make' => 'Alcon', 'name' => 'Air Optix Plus HydraGlyde', 'type' => 'monthly', 'h2o' => '33%', 'modality' => 'monthly', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Résiste aux dépôts.'],

    // === JOHNSON & JOHNSON ===
    ['make' => 'J&J', 'name' => 'Acuvue Oasys 1-Day', 'type' => 'daily', 'h2o' => '38%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => false, 'dry_eye' => true, 'desc' => 'Technologie HydraLuxe. Top écrans.'],
    ['make' => 'J&J', 'name' => 'Acuvue Moist 1-Day', 'type' => 'daily', 'h2o' => '58%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'L\'entrée de gamme multifocale historique.'],
    ['make' => 'J&J', 'name' => 'Acuvue Oasys', 'type' => 'biweekly', 'h2o' => '38%', 'modality' => 'biweekly', 'bc' => [8.4, 8.8], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Le standard mondial.'],

    // === COOPERVISION ===
    ['make' => 'Cooper', 'name' => 'MyDay', 'type' => 'daily', 'h2o' => '54%', 'modality' => 'daily', 'bc' => [8.4], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'Smart Silicone. Très souple.'],
    ['make' => 'Cooper', 'name' => 'Biofinity', 'type' => 'monthly', 'h2o' => '48%', 'modality' => 'monthly', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'La référence absolue. Gamme XR dispo.'],
    ['make' => 'Cooper', 'name' => 'Clariti 1 Day', 'type' => 'daily', 'h2o' => '56%', 'modality' => 'daily', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'SiHy abordable.'],

    // === BAUSCH ===
    ['make' => 'B&L', 'name' => 'Biotrue ONEday', 'type' => 'daily', 'h2o' => '78%', 'modality' => 'daily', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Bio-inspirée. 78% d\'eau.'],
    ['make' => 'B&L', 'name' => 'Ultra', 'type' => 'monthly', 'h2o' => '46%', 'modality' => 'monthly', 'bc' => [8.5], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'MoistureSeal Technology.'],
];


// -----------------------------------------------------------------------------
// 2. OPTICAL ENGINE (Expert Mode)
// -----------------------------------------------------------------------------
function calculate_vertex($pwr)
{
    if (abs($pwr) < 4.00)
        return $pwr;
    return $pwr / (1 - (0.012 * $pwr)); // Precision calc
}

function process_eye_expert($sphere, $cyl, $axe, $add, $k1, $k2, $modality, $dry, $db)
{
    if ($sphere === '')
        return null;

    $S = floatval($sphere);
    $C = floatval($cyl);
    $A = intval($axe);
    $Add = floatval($add);
    $K1 = floatval($k1);
    $K2 = floatval($k2);

    // --- 1. DESIGN TYPE ---
    $is_multifocal = ($Add >= 0.75);
    $is_toric = (abs($C) >= 0.75);

    $design_label = 'Sphérique';
    if ($is_toric)
        $design_label = 'Torique';
    if ($is_multifocal)
        $design_label = ($is_toric ? 'Torique ' : '') . 'Multifocale';

    // --- 2. POWER CALCULATION ---
    $final_sphere = 0;
    $final_cyl = 0;

    if ($is_toric) {
        // FULL TORIC CALCULATION (Vertex on both meridians)
        $M1 = $S; // First meridian power
        $M2 = $S + $C; // Second meridian power

        $M1_v = calculate_vertex($M1);
        $M2_v = calculate_vertex($M2);

        $final_sphere = round($M1_v * 4) / 4; // Round to 0.25
        $final_cyl = round(($M2_v - $M1_v) * 4) / 4; // Cyl is diff
    } else {
        // SPHERICAL EQUIVALENT (Low Astigmatism)
        // Rule: Sphere + (Cyl / 2) -> Then Vertex
        $SE = $S + ($C / 2);
        $final_sphere = round(calculate_vertex($SE) * 4) / 4;
        $final_cyl = 0;
    }

    // --- 3. BC CALCULATION ---
    $bc_target = 8.6;
    if ($K1 && $K2) {
        $avg_k = ($K1 + $K2) / 2;
        $bc_target = round($avg_k + 0.8, 1);
    }

    // --- 4. FILTERING ---
    $picks = [];
    foreach ($db as $lens) {
        if ($lens['modality'] !== $modality)
            continue;

        // STRICT CAPABILITY CHECK
        if ($is_toric && !$lens['toric'])
            continue;
        if ($is_multifocal && !$lens['multifocal'])
            continue;

        // BC FIT
        $fit = false;
        foreach ($lens['bc'] as $b) {
            if (abs($b - $bc_target) <= 0.35)
                $fit = true;
        }
        if (!$fit)
            continue;

        // Scoring
        $score = 10;
        if ($dry && $lens['dry_eye'])
            $score += 20;
        $lens['score'] = $score;
        $picks[] = $lens;
    }

    usort($picks, function ($a, $b) {
        return $b['score'] <=> $a['score'];
    });

    return [
        'pwr_display' => ($final_sphere > 0 ? '+' : '') . number_format($final_sphere, 2),
        'cyl_display' => $is_toric ? number_format($final_cyl, 2) : null,
        'axe_display' => $is_toric ? $A : null,
        'is_se' => (!$is_toric && abs($C) > 0), // Flag: Is Spherical Equivalent used?
        'bc' => $bc_target,
        'design' => $design_label,
        'picks' => $picks
    ];
}

$od_res = null;
$og_res = null;
$posted = false;

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $posted = true;
    $dry = isset($_POST['dry_eye']);
    $mod = $_POST['modality'];

    // Check if COPY G to D is active (or user clicked "Identique") 
    // Handled by JS on frontend to fill values, but backend processes what it receives.

    $od_res = process_eye_expert($_POST['od_s'], $_POST['od_c'], $_POST['od_a'], $_POST['od_add'], $_POST['od_k1'], $_POST['od_k2'], $mod, $dry, $lenses_db);
    $og_res = process_eye_expert($_POST['og_s'], $_POST['og_c'], $_POST['og_a'], $_POST['og_add'], $_POST['og_k1'], $_POST['og_k2'], $mod, $dry, $lenses_db);
}
?>

<div class="min-h-screen bg-gray-50 pt-28 pb-20">
    <div class="max-w-[1400px] mx-auto px-4">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-3xl font-black font-display text-oblink-gray">
                Calculateur <span class="text-oblink-orange">Lentilles Pro</span>
            </h1>
        </div>

        <!-- FORMULAIRE STYLE OPTIEXPERT -->
        <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100 mb-12 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-oblink-blue to-oblink-orange"></div>

            <form method="POST" action="">
                <!-- CONTROLS TOP -->
                <div class="mb-8 border-b border-gray-100 pb-6 space-y-4">
                    <div class="flex flex-wrap gap-4 items-center">
                        <label
                            class="flex items-center gap-2 cursor-pointer bg-gray-50 px-4 py-2 rounded-lg border border-gray-200 hover:border-oblink-orange transition">
                            <input type="checkbox" name="dry_eye"
                                class="text-oblink-orange focus:ring-oblink-orange rounded" <?php echo isset($_POST['dry_eye']) ? 'checked' : ''; ?>>
                            <span class="font-bold text-gray-700">Sécheresse Oculaire</span>
                        </label>
                        <select name="modality"
                            class="px-4 py-2 bg-gray-50 rounded-lg font-bold border border-gray-200 outline-none focus:border-oblink-orange">
                            <option value="daily" <?php echo ($_POST['modality'] ?? '') === 'daily' ? 'selected' : ''; ?>>
                                Journalières (Daily)</option>
                            <option value="monthly" <?php echo ($_POST['modality'] ?? '') === 'monthly' ? 'selected' : ''; ?>>Mensuelles (Monthly)</option>
                            <option value="biweekly" <?php echo ($_POST['modality'] ?? '') === 'biweekly' ? 'selected' : ''; ?>>Bi-mensuelles</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="w-full md:w-auto bg-oblink-gray text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition transform hover:-translate-y-0.5">
                        Calculer l'équipement
                    </button>
                </div>

                <div class="grid lg:grid-cols-2 gap-16 relative">
                    <!-- SEPARATOR LINE -->
                    <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px bg-gray-100 -ml-px"></div>

                    <!-- OD COL -->
                    <div>
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-10 h-10 rounded-full bg-oblink-blue text-white flex items-center justify-center font-bold text-lg shadow-md shadow-blue-200">
                                D</div>
                            <h3 class="text-xl font-bold text-oblink-blue">Œil Droit</h3>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Sphère</label>
                                    <input type="number" step="0.25" placeholder="-2.00" name="od_s"
                                        value="<?php echo $_POST['od_s'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Cylindre</label>
                                    <input type="number" step="0.25" placeholder="-0.75" name="od_c"
                                        value="<?php echo $_POST['od_c'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Axe °</label>
                                    <input type="number" placeholder="180" name="od_a"
                                        value="<?php echo $_POST['od_a'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-1 border-r border-gray-100 pr-4">
                                    <label
                                        class="text-xs font-bold text-oblink-blue uppercase mb-1 block">Addition</label>
                                    <input type="number" step="0.25" placeholder="+2.00" name="od_add"
                                        value="<?php echo $_POST['od_add'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-blue-50/50 border border-blue-100 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K1
                                        (Plat)</label>
                                    <input type="number" step="0.01" placeholder="7.80" name="od_k1"
                                        value="<?php echo $_POST['od_k1'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K2
                                        (Cambré)</label>
                                    <input type="number" step="0.01" placeholder="7.60" name="od_k2"
                                        value="<?php echo $_POST['od_k2'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OG COL -->
                    <div>
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-oblink-orange text-white flex items-center justify-center font-bold text-lg shadow-md shadow-orange-200">
                                    G</div>
                                <h3 class="text-xl font-bold text-oblink-orange">Œil Gauche</h3>
                            </div>
                            <label
                                class="flex items-center gap-2 cursor-pointer text-sm text-gray-500 hover:text-oblink-orange">
                                <input type="checkbox" id="copy_od"
                                    class="rounded text-oblink-orange focus:ring-oblink-orange" onclick="copyODtoOG()">
                                Copier OD
                            </label>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Sphère</label>
                                    <input type="number" step="0.25" placeholder="-2.00" name="og_s" id="og_s"
                                        value="<?php echo $_POST['og_s'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Cylindre</label>
                                    <input type="number" step="0.25" placeholder="-0.75" name="og_c" id="og_c"
                                        value="<?php echo $_POST['og_c'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Axe °</label>
                                    <input type="number" placeholder="180" name="og_a" id="og_a"
                                        value="<?php echo $_POST['og_a'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-1 border-r border-gray-100 pr-4">
                                    <label
                                        class="text-xs font-bold text-oblink-orange uppercase mb-1 block">Addition</label>
                                    <input type="number" step="0.25" placeholder="+2.00" name="og_add" id="og_add"
                                        value="<?php echo $_POST['og_add'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-orange-50/50 border border-orange-100 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K1
                                        (Plat)</label>
                                    <input type="number" step="0.01" placeholder="7.80" name="og_k1" id="og_k1"
                                        value="<?php echo $_POST['og_k1'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K2
                                        (Cambré)</label>
                                    <input type="number" step="0.01" placeholder="7.60" name="og_k2" id="og_k2"
                                        value="<?php echo $_POST['og_k2'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <?php if ($posted): ?>
            <div class="grid lg:grid-cols-2 gap-8">

                <!-- RESULT OD -->
                <?php if ($od_res): ?>
                    <div>
                        <div
                            class="bg-oblink-blue/10 rounded-t-2xl p-4 border-b border-oblink-blue/20 flex justify-between items-center">
                            <h3 class="font-black text-oblink-blue text-lg">LENTILLES DROITES (OD)</h3>
                            <div class="flex flex-col items-end">
                                <span class="text-2xl font-mono font-bold text-oblink-blue leading-none">
                                    <?php echo $od_res['pwr_display']; ?>
                                    <?php if ($od_res['cyl_display'])
                                        echo '<span class="text-lg text-gray-600">(' . $od_res['cyl_display'] . ')</span> ' . $od_res['axe_display'] . '°'; ?>
                                </span>
                                <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 mt-1">
                                    BC: <?php echo $od_res['bc']; ?> • <?php echo $od_res['design']; ?>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white rounded-b-2xl shadow-lg border border-gray-100 p-6 space-y-4">
                            <?php if ($od_res['is_se']): ?>
                                <div class="p-3 bg-yellow-50 text-yellow-800 text-xs rounded-lg mb-4 flex gap-2">
                                    <i class="fas fa-info-circle mt-0.5"></i>
                                    <div>Astigmatisme faible (<0.75). La puissance a été convertie en <b>Équivalent Sphérique</b>
                                            (Sph + Cyl/2) pour optimiser la vision.</div>
                                </div>
                            <?php endif; ?>

                            <?php foreach ($od_res['picks'] as $p): ?>
                                <div
                                    class="flex items-start gap-4 p-4 border border-gray-100 rounded-xl hover:shadow-md transition group bg-white">
                                    <div
                                        class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center font-bold text-gray-300 text-xl group-hover:bg-oblink-blue group-hover:text-white transition">
                                        <?php echo substr($p['make'], 0, 1); ?>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800 text-lg"><?php echo $p['name']; ?></h4>
                                        <p class="text-sm text-gray-500 mb-2"><?php echo $p['make']; ?> • <?php echo $p['h2o']; ?>
                                            H2O</p>
                                        <p class="text-xs text-oblink-blue italic bg-blue-50 inline-block px-2 py-1 rounded">
                                            <?php echo $p['desc']; ?>
                                        </p>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endif; ?>

                <!-- RESULT OG -->
                <?php if ($og_res): ?>
                    <div>
                        <div
                            class="bg-oblink-orange/10 rounded-t-2xl p-4 border-b border-oblink-orange/20 flex justify-between items-center">
                            <h3 class="font-black text-oblink-orange text-lg">LENTILLES GAUCHES (OG)</h3>
                            <div class="flex flex-col items-end">
                                <span class="text-2xl font-mono font-bold text-oblink-orange leading-none">
                                    <?php echo $og_res['pwr_display']; ?>
                                    <?php if ($og_res['cyl_display'])
                                        echo '<span class="text-lg text-gray-600">(' . $og_res['cyl_display'] . ')</span> ' . $og_res['axe_display'] . '°'; ?>
                                </span>
                                <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 mt-1">
                                    BC: <?php echo $og_res['bc']; ?> • <?php echo $og_res['design']; ?>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white rounded-b-2xl shadow-lg border border-gray-100 p-6 space-y-4">
                            <?php if ($og_res['is_se']): ?>
                                <div class="p-3 bg-yellow-50 text-yellow-800 text-xs rounded-lg mb-4 flex gap-2">
                                    <i class="fas fa-info-circle mt-0.5"></i>
                                    <div>Astigmatisme faible (<0.75). La puissance a été convertie en <b>Équivalent Sphérique</b>
                                            (Sph + Cyl/2) pour optimiser la vision.</div>
                                </div>
                            <?php endif; ?>

                            <?php foreach ($og_res['picks'] as $p): ?>
                                <div
                                    class="flex items-start gap-4 p-4 border border-gray-100 rounded-xl hover:shadow-md transition group bg-white">
                                    <div
                                        class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center font-bold text-gray-300 text-xl group-hover:bg-oblink-orange group-hover:text-white transition">
                                        <?php echo substr($p['make'], 0, 1); ?>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800 text-lg"><?php echo $p['name']; ?></h4>
                                        <p class="text-sm text-gray-500 mb-2"><?php echo $p['make']; ?> • <?php echo $p['h2o']; ?>
                                            H2O</p>
                                        <p class="text-xs text-oblink-orange italic bg-orange-50 inline-block px-2 py-1 rounded">
                                            <?php echo $p['desc']; ?>
                                        </p>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endif; ?>

            </div>
        <?php endif; ?>
    </div>
</div>

<script>
    function copyODtoOG() {
        if (document.getElementById('copy_od').checked) {
            document.getElementById('og_s').value = document.getElementsByName('od_s')[0].value;
            document.getElementById('og_c').value = document.getElementsByName('od_c')[0].value;
            document.getElementById('og_a').value = document.getElementsByName('od_a')[0].value;
            document.getElementById('og_add').value = document.getElementsByName('od_add')[0].value;
            document.getElementById('og_k1').value = document.getElementsByName('od_k1')[0].value;
            document.getElementById('og_k2').value = document.getElementsByName('od_k2')[0].value;
        }
    }

    // Mobile Accordion Toggle
    const toggleBtn = document.getElementById('toggle-calculator');
    const calcFields = document.getElementById('calculator-fields');
    const toggleIcon = document.getElementById('toggle-icon');

    if (toggleBtn) {
        toggleBtn.addEventListener('click', function () {
            calcFields.classList.toggle('hidden');
            calcFields.classList.toggle('grid');
            toggleIcon.classList.toggle('rotate-180');

            if (calcFields.classList.contains('hidden')) {
                toggleBtn.querySelector('span').textContent = 'Afficher les champs de saisie';
            } else {
                toggleBtn.querySelector('span').textContent = 'Masquer les champs de saisie';
            }
        });
    }
   });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/404.php ---
<?php
/**
 * Template Name: 404 Error Page
 */
include 'header-inc.php';
?>

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">

        <!-- 404 Illustration -->
        <div class="mb-8">
            <div class="inline-flex items-center justify-center w-32 h-32 rounded-full bg-oblink-blue/10 mb-6">
                <svg class="w-16 h-16 text-oblink-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>

            <h1 class="text-6xl md:text-8xl font-bold font-display text-oblink-blue mb-4">404</h1>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4">Page non trouvée</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">
                Désolé, la page que vous recherchez n'existe pas ou a été déplacée.
                Utilisez les liens ci-dessous pour continuer votre navigation.
            </p>
        </div>

        <!-- Quick Navigation Cards -->
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto mb-12">

            <!-- Home -->
            <a href="<?php echo home_url('/'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-oblink-blue transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-oblink-blue/10 flex items-center justify-center mb-4 mx-auto group-hover:bg-oblink-blue/20 transition">
                    <i class="fas fa-home text-oblink-blue text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Accueil</h3>
                <p class="text-sm text-gray-500">Retour à l'accueil</p>
            </a>

            <!-- Job Offers -->
            <a href="<?php echo home_url('/emploi-opticien'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-oblink-orange transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-oblink-orange/10 flex items-center justify-center mb-4 mx-auto group-hover:bg-oblink-orange/20 transition">
                    <i class="fas fa-briefcase text-oblink-orange text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Offres d'Emploi</h3>
                <p class="text-sm text-gray-500">Voir les missions</p>
            </a>

            <!-- Blog -->
            <a href="<?php echo home_url('/blog'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-purple-500 transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center mb-4 mx-auto group-hover:bg-purple-200 transition">
                    <i class="fas fa-newspaper text-purple-600 text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Blog</h3>
                <p class="text-sm text-gray-500">Actualités & conseils</p>
            </a>

            <!-- Contact -->
            <a href="<?php echo home_url('/contact'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-green-500 transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center mb-4 mx-auto group-hover:bg-green-200 transition">
                    <i class="fas fa-envelope text-green-600 text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Contact</h3>
                <p class="text-sm text-gray-500">Besoin d'aide ?</p>
            </a>
        </div>

        <!-- Search Bar (Optional) -->
        <div class="max-w-xl mx-auto">
            <div class="bg-white rounded-full shadow-sm border border-gray-200 p-2 flex items-center gap-3">
                <i class="fas fa-search text-gray-400 ml-4"></i>
                <input type="text" id="search-404" placeholder="Rechercher sur OBLINK..."
                    class="flex-1 px-2 py-2 text-gray-900 placeholder-gray-400 focus:outline-none" />
                <button onclick="performSearch()"
                    class="px-6 py-2 bg-oblink-blue text-white font-semibold rounded-full hover:bg-oblink-blue/90 transition">
                    Rechercher
                </button>
            </div>
        </div>

        <!-- Back Button -->
        <div class="mt-12">
            <button onclick="history.back()"
                class="inline-flex items-center gap-2 text-oblink-blue hover:text-oblink-blue/80 font-semibold transition">
                <i class="fas fa-arrow-left"></i>
                <span>Retour à la page précédente</span>
            </button>
        </div>
    </div>
</div>

<script>
    function performSearch() {
        const searchInput = document.getElementById('search-404');
        const query = searchInput.value.trim();

        if (query) {
            // Redirect to blog search or homepage with query
            window.location.href = '<?php echo home_url('/blog'); ?>?s=' + encodeURIComponent(query);
        }
    }

    // Allow Enter key to search
    document.getElementById('search-404')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/inc/user-registration.php ---
<?php
// OBLINK - User Registration AJAX Handlers
// Handles Opticien registration via AJAX

// Register AJAX actions
add_action('wp_ajax_nopriv_oblink_register_opticien', 'oblink_register_opticien_handler');
add_action('wp_ajax_oblink_register_opticien', 'oblink_register_opticien_handler');

function oblink_register_opticien_handler()
{
    // Sanitize inputs
    $first_name = sanitize_text_field($_POST['first_name']);
    $last_name = sanitize_text_field($_POST['last_name']);
    $email = sanitize_email($_POST['email']);
    $password = $_POST['password'];
    $diploma = sanitize_text_field($_POST['diploma']);
    $experience = sanitize_text_field($_POST['experience']);
    $city = sanitize_text_field($_POST['city']);

    // Validation
    if (empty($email) || empty($password)) {
        wp_send_json_error(['message' => 'Email et mot de passe requis.']);
        return;
    }

    if (email_exists($email)) {
        wp_send_json_error(['message' => 'Cet email est déjà utilisé.']);
        return;
    }

    if (strlen($password) < 8) {
        wp_send_json_error(['message' => 'Le mot de passe doit contenir au moins 8 caractères.']);
        return;
    }

    // Create User
    $username = sanitize_user(strtolower($first_name . '.' . $last_name . rand(100, 999)));
    $user_id = wp_create_user($username, $password, $email);

    if (is_wp_error($user_id)) {
        wp_send_json_error(['message' => $user_id->get_error_message()]);
        return;
    }

    // Update User Profile
    wp_update_user([
        'ID' => $user_id,
        'first_name' => $first_name,
        'last_name' => $last_name,
        'display_name' => $first_name . ' ' . $last_name,
        'role' => 'subscriber'
    ]);

    // Save User Meta (OBLINK specific)
    update_user_meta($user_id, 'oblink_user_type', 'opticien');
    update_user_meta($user_id, 'oblink_diploma', $diploma);
    update_user_meta($user_id, 'oblink_experience', $experience);
    update_user_meta($user_id, 'oblink_city', $city);
    update_user_meta($user_id, 'oblink_status', 'pending'); // pending, verified, premium
    update_user_meta($user_id, 'oblink_registered_at', current_time('mysql'));

    // Auto-login the user
    wp_set_current_user($user_id);
    wp_set_auth_cookie($user_id, true);

    // Send Welcome Email (if email system is active)
    if (function_exists('oblink_send_mail')) {
        oblink_send_mail($email, 'Bienvenue sur OBLINK !', 'welcome-opticien', [
            'first_name' => $first_name
        ]);
    }

    // Success response
    wp_send_json_success([
        'message' => 'Compte créé avec succès !',
        'user_id' => $user_id,
        'redirect' => home_url('/dashboard-opticien')
    ]);
}
?>--- FILE: theme/inc/admin-columns.php ---
<?php
// OBLINK - Admin Columns Customization
// Adds custom columns to the Users list in WP Admin for better visibility

// 1. ADD COLUMNS
function oblink_add_user_columns($columns)
{
    // Remove "Posts" column (not useful for users)
    unset($columns['posts']);

    // Add new columns
    $columns['oblink_type'] = 'Type';
    $columns['oblink_info'] = 'Infos Pro';
    $columns['oblink_status'] = 'Statut';

    return $columns;
}
add_filter('manage_users_columns', 'oblink_add_user_columns');

// 2. FILL COLUMNS
function oblink_fill_user_columns($value, $column_name, $user_id)
{
    $type = get_user_meta($user_id, 'oblink_user_type', true);

    if ($column_name === 'oblink_type') {
        if ($type === 'opticien') {
            return '<span style="background:#0099FF; color:white; padding:3px 8px; border-radius:4px; font-weight:bold; font-size:11px;">Opticien</span>';
        } elseif ($type === 'entreprise') {
            return '<span style="background:#9A48D0; color:white; padding:3px 8px; border-radius:4px; font-weight:bold; font-size:11px;">Entreprise</span>';
        } else {
            return '<span style="color:#999;">-</span>';
        }
    }

    if ($column_name === 'oblink_info') {
        if ($type === 'opticien') {
            $diploma = get_user_meta($user_id, 'oblink_diploma', true);
            $exp = get_user_meta($user_id, 'oblink_experience', true);
            $city = get_user_meta($user_id, 'oblink_city', true);
            return "<strong>$diploma</strong><br><small>$exp</small><br><small>$city</small>";
        } elseif ($type === 'entreprise') {
            $company = get_user_meta($user_id, 'company_name', true);
            $siret = get_user_meta($user_id, 'siret', true);
            return "<strong>$company</strong><br><small>SIRET: $siret</small>";
        }
    }

    if ($column_name === 'oblink_status') {
        $status = get_user_meta($user_id, 'oblink_status', true);
        if ($status === 'verified') {
            return '<span style="color:green; font-weight:bold;">Vérifié ✅</span>';
        } elseif ($status === 'premium') {
            return '<span style="color:orange; font-weight:bold;">PREMIUM ⭐️</span>';
        } elseif ($status === 'pending') {
            return '<span style="color:gray;">En attente ⏳</span>';
        } else {
            return '-';
        }
    }

    return $value;
}
add_filter('manage_users_custom_column', 'oblink_fill_user_columns', 10, 3);
?>--- FILE: theme/inc/messaging.php ---
<?php
/**
 * OBLINK Messaging System
 * Ultra-light sql based messaging.
 */

// 1. Create DataBase Table on Theme Activation (or check on init)
function oblink_install_messages_table()
{
    global $wpdb;
    $table_name = $wpdb->prefix . 'oblink_messages';

    // Check if table exists
    if ($wpdb->get_var("SHOW TABLES LIKE '$table_name'") != $table_name) {
        $charset_collate = $wpdb->get_charset_collate();

        $sql = "CREATE TABLE $table_name (
            id mediumint(9) NOT NULL AUTO_INCREMENT,
            time datetime DEFAULT '0000-00-00 00:00:00' NOT NULL,
            sender_id bigint(20) NOT NULL,
            receiver_id bigint(20) NOT NULL,
            subject tinytext NOT NULL,
            message text NOT NULL,
            is_read tinyint(1) DEFAULT 0 NOT NULL,
            conversation_id varchar(50) NOT NULL, 
            PRIMARY KEY  (id)
        ) $charset_collate;";

        require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
        dbDelta($sql);
    }
}
add_action('after_switch_theme', 'oblink_install_messages_table');
// We also hook to init to be sure in dev environment, but in prod 'after_switch_theme' is better
// For this dev session, I'll add a temporary init hook that runs ONCE then can be removed
// add_action('init', 'oblink_install_messages_table'); // DISABLED: Only run on switch theme to avoid critical error on frontend with dbDelta

// 2. SEND MESSAGE FUNCTION
function oblink_send_message($receiver_id, $subject, $message)
{
    global $wpdb;
    $sender_id = get_current_user_id();
    if (!$sender_id)
        return false;

    // Generate Conversation ID (Smaller_ID-Larger_ID) to group messages between 2 people
    $ids = [$sender_id, $receiver_id];
    sort($ids);
    $conversation_id = implode('-', $ids);

    $table_name = $wpdb->prefix . 'oblink_messages';

    $result = $wpdb->insert(
        $table_name,
        array(
            'time' => current_time('mysql'),
            'sender_id' => $sender_id,
            'receiver_id' => $receiver_id,
            'subject' => sanitize_text_field($subject),
            'message' => sanitize_textarea_field($message),
            'is_read' => 0,
            'conversation_id' => $conversation_id
        )
    );

    return $result;
}

// 3. GET CONVERSATIONS FOR CURRENT USER
function oblink_get_conversations()
{
    global $wpdb;
    $user_id = get_current_user_id();
    $table_name = $wpdb->prefix . 'oblink_messages';

    // Get latest message for each conversation involving the user
    // This is a bit complex SQL to group by conversation and get the LATEST entry
    /* 
       Logic: Find all unique conversation_ids where user is sender or receiver.
       Then get the last message details for that conversation.
    */

    $sql = "
        SELECT m1.*, 
               CASE 
                   WHEN m1.sender_id = $user_id THEN m1.receiver_id 
                   ELSE m1.sender_id 
               END as contact_id
        FROM $table_name m1
        JOIN (
            SELECT conversation_id, MAX(id) as last_msg_id
            FROM $table_name
            WHERE sender_id = $user_id OR receiver_id = $user_id
            GROUP BY conversation_id
        ) m2 ON m1.id = m2.last_msg_id
        ORDER BY m1.time DESC
    ";

    return $wpdb->get_results($sql);
}

// 4. GET MESSAGES IN A CONVERSATION
function oblink_get_messages($contact_id)
{
    global $wpdb;
    $user_id = get_current_user_id();
    $ids = [$user_id, $contact_id];
    sort($ids);
    $conversation_id = implode('-', $ids);

    $table_name = $wpdb->prefix . 'oblink_messages';

    // Mark as read when opening (simple logic)
    $wpdb->update(
        $table_name,
        ['is_read' => 1],
        ['conversation_id' => $conversation_id, 'receiver_id' => $user_id]
    );

    $results = $wpdb->get_results(
        $wpdb->prepare(
            "SELECT * FROM $table_name WHERE conversation_id = %s ORDER BY time ASC",
            $conversation_id
        )
    );

    return $results;
}

// 5. AJAX HANDLERS
add_action('wp_ajax_oblink_send_msg', 'oblink_ajax_send_msg');
function oblink_ajax_send_msg()
{
    check_ajax_referer('oblink_nonce', 'nonce');

    $receiver_id = intval($_POST['receiver_id']);
    $message = sanitize_textarea_field($_POST['message']);

    if (oblink_send_message($receiver_id, '', $message)) {
        wp_send_json_success(['message' => 'Envoyé']);
    } else {
        wp_send_json_error(['message' => 'Erreur envoi']);
    }
}

add_action('wp_ajax_oblink_load_chat', 'oblink_ajax_load_chat');
function oblink_ajax_load_chat()
{
    check_ajax_referer('oblink_nonce', 'nonce');
    $contact_id = intval($_GET['contact_id']);

    $messages = oblink_get_messages($contact_id);

    // Format HTML return
    ob_start();
    $current_user = get_current_user_id();
    foreach ($messages as $msg) {
        $is_me = $msg->sender_id == $current_user;
        ?>
        <div class="flex <?php echo $is_me ? 'justify-end' : 'justify-start'; ?> mb-4">
            <div
                class="<?php echo $is_me ? 'bg-oblink-blue text-white' : 'bg-gray-100 text-gray-800'; ?> rounded-2xl py-2 px-4 max-w-[80%] text-sm">
                <?php echo nl2br(esc_html($msg->message)); ?>
                <div class="text-[10px] <?php echo $is_me ? 'text-blue-100' : 'text-gray-400'; ?> mt-1 text-right">
                    <?php echo date_i18n('d M H:i', strtotime($msg->time)); ?>
                </div>
            </div>
        </div>
        <?php
    }
    $html = ob_get_clean();
    wp_send_json_success(['html' => $html]);
}

// 6. MISSION ALERT NOTIFICATION (EMAIL & SMS MOCK)
add_action('wp_ajax_trigger_mission_alert', 'oblink_ajax_trigger_mission_alert');
function oblink_ajax_trigger_mission_alert()
{
    // check_ajax_referer('oblink_nonce', 'nonce'); 
    
    $mission_title = sanitize_text_field($_POST['title']);
    $city = sanitize_text_field($_POST['city']);
    $type = sanitize_text_field($_POST['type']);
    $salary = sanitize_text_field($_POST['salary']);
    
    // --- PYRAMIDE DE MATCHING (Logique théorique pour le Jury) ---
    // 1. GÉOLOCALISATION : Rayon de 30km autour de la ville
    // 2. COMPÉTENCE : Match strict sur le logiciel (ex: WinOptics)
    // 3. DISPONIBILITÉ : Calendrier "Libre" sur la période
    // 4. SCORE : Priorité d'envoi (Délai de grâce 15min) aux experts avec Score > 4.5/5
    
    // Mock Result: 12 Experts trouvés
    $expert_count = 12; 

    // --- 1. NOTIFICATION SMS (L'Urgence) ---
    // Modèle : "🚨 OBLINK - Mission Flash ! Un magasin à $city cherche un expert $type... Match 95%... Lien: ..."
    // API Call (Twilio/Nexmo) would go here.

    // --- 2. EMAIL DE MATCHING (Le Détail) ---
    $subject = "🎯 Nouvelle mission à " . $city . " : Ton profil a été sélectionné !";

    ob_start();
    ?>
    <!DOCTYPE html>
    <html>
    <head>
        <style>
            body { font-family: 'Helvetica', sans-serif; background-color: #f3f4f6; padding: 20px; }
            .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto; border-top: 6px solid #FF6600; }
            .header-tag { display: inline-block; background: #FFF0E6; color: #FF6600; font-weight: bold; padding: 6px 12px; border-radius: 99px; font-size: 14px; margin-bottom: 20px; }
            .mission-box { background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; padding: 25px; margin: 25px 0; }
            .btn { display: block; width: 100%; text-align: center; padding: 15px 0; background: #007AFF; color: white; text-decoration: none; border-radius: 12px; font-weight: 800; font-size: 16px; margin-top: 30px; }
            .expert-badge { background: #DCFCE7; color: #166534; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        </style>
    </head>
    <body>
        <div class="card">
            <span class="header-tag">⚡️ Opportunité Certifiée</span>
            <h2 style="color: #111827; margin-top:0; font-size: 24px;">Bonjour Jean-Expert,</h2>
            <p style="color: #4B5563; line-height: 1.6;">Un nouveau besoin vient d'être publié et correspond à tes compétences certifiées.</p>
            
            <div class="mission-box">
                <h3 style="margin:0 0 15px 0; color: #111827; font-size: 18px;"><?php echo $mission_title; ?></h3>
                <ul style="list-style: none; padding: 0; margin: 0; color: #4B5563; line-height: 2;">
                    <li>📍 <strong>Lieu :</strong> <?php echo $city; ?> (Zone A)</li>
                    <li>💻 <strong>Logiciel :</strong> WinOptics <span class="expert-badge">Match ✅</span></li>
                    <li>💶 <strong>TJM proposé :</strong> <span style="color: #FF6600; font-weight: bold;"><?php echo $salary; ?> € / jour</span></li>
                    <li>🔥 <strong>Score Matching :</strong> 98%</li>
                </ul>
            </div>

            <p style="color: #4B5563; font-size: 14px;"><strong>Pourquoi toi ?</strong><br>Notre algorithme a analysé ton profil. Tu fais partie des rares experts qualifiés et disponibles sur ce secteur.</p>

            <a href="<?php echo home_url('/dashboard-opticien'); ?>" class="btn">Voir les détails et Postuler</a>
            
            <p style="color: #9CA3AF; font-size: 12px; margin-top: 30px; text-align: center;">
                Envoyé par l'Algorithme de Matching OBLINK PRO.
            </p>
        </div>
    </body>
    </html>
    <?php
    $email_body = ob_get_clean();
    $headers = array('Content-Type: text/html; charset=UTF-8');

    // Make it real for the demo: Send to the currently logged in user (or hardcoded for demo)
    // wp_mail('demo@oblink.fr', $subject, $email_body, $headers); 

    // Return success to frontend with dynamic count
    wp_send_json_success([
        'sent_count' => $expert_count, 
        'message' => "Votre annonce a été envoyée par SMS/Email à $expert_count experts qualifiés aux alentours."
    ]);
}
--- FILE: theme/inc/theme-activation.php ---
<?php
/**
 * OBLINK - Activation du thème
 * Copie automatiquement les fichiers nécessaires à la racine WordPress
 */

function oblink_theme_activation()
{
    $theme_dir = get_template_directory();
    $root_dir = ABSPATH;

    // Copier generate-sitemap.php
    $sitemap_source = $theme_dir . '/setup/generate-sitemap.php';
    $sitemap_dest = $root_dir . 'generate-sitemap.php';

    if (file_exists($sitemap_source) && !file_exists($sitemap_dest)) {
        copy($sitemap_source, $sitemap_dest);
    }

    // Copier robots.txt
    $robots_source = $theme_dir . '/setup/robots.txt';
    $robots_dest = $root_dir . 'robots.txt';

    if (file_exists($robots_source) && !file_exists($robots_dest)) {
        copy($robots_source, $robots_dest);
    }

    // Générer le sitemap initial
    if (file_exists($sitemap_dest)) {
        // Trigger sitemap generation
        $response = wp_remote_get(home_url('/generate-sitemap.php?save=true'));
    }
}

// Hook sur le switch de thème
add_action('after_switch_theme', 'oblink_theme_activation');
?>--- FILE: theme/inc/simulator-email.php ---
<?php
/**
 * OBLINK - Email Sender for Simulator Results
 * Sends calculation results to user after email capture
 */

function send_simulator_email($email, $results, $mode, $params)
{
    $to = $email;
    $subject = '💰 Vos résultats de simulation OBLINK';

    // Préparer le contenu selon le mode
    if ($mode === 'freelance') {
        $body = get_freelance_email_body($results, $params);
    } else {
        $body = get_contrat_email_body($results, $params);
    }

    // Headers
    $headers = array(
        'Content-Type: text/html; charset=UTF-8',
        'From: OBLINK <noreply@oblink.fr>',
        'Reply-To: contact@oblink.fr'
    );

    // Envoyer l'email
    $sent = wp_mail($to, $subject, $body, $headers);

    return $sent;
}

function get_freelance_email_body($results, $params)
{
    $tjm = $params['tjm'];
    $days = $params['days'];
    $status = $params['status'] === 'micro' ? 'Micro-Entreprise' : 'EURL';
    $net = number_format($results['net'], 0, ',', ' ');
    $gross = number_format($results['gross'], 0, ',', ' ');
    $charges = number_format($results['charges'], 0, ',', ' ');

    $site_url = home_url();

    return "
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset='UTF-8'>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #303030; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #FF6600 0%, #9A48D0 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
            .content { background: #f9fafb; padding: 30px; }
            .result-box { background: white; border-left: 4px solid #FF6600; padding: 20px; margin: 20px 0; border-radius: 8px; }
            .big-number { font-size: 36px; font-weight: bold; color: #FF6600; margin: 10px 0; }
            .detail { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb; }
            .cta { background: #FF6600; color: white; text-decoration: none; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 20px 0; font-weight: bold; }
            .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 14px; }
        </style>
    </head>
    <body>
        <div class='container'>
            <div class='header'>
                <h1>🎉 Vos résultats de simulation</h1>
                <p>Mode Freelance - {$status}</p>
            </div>
            
            <div class='content'>
                <p>Bonjour,</p>
                <p>Voici le détail de votre simulation en tant qu'opticien freelance :</p>
                
                <div class='result-box'>
                    <h2 style='margin-top: 0; color: #FF6600;'>💰 Net dans votre poche</h2>
                    <div class='big-number'>{$net} €</div>
                    <p style='color: #6b7280;'>Pour {$days} jour(s) de travail</p>
                </div>
                
                <div class='result-box'>
                    <h3>Détail du calcul</h3>
                    <div class='detail'>
                        <span>Taux journalier</span>
                        <strong>{$tjm} €</strong>
                    </div>
                    <div class='detail'>
                        <span>Nombre de jours</span>
                        <strong>{$days}</strong>
                    </div>
                    <div class='detail'>
                        <span>Chiffre d'affaires (HT)</span>
                        <strong>{$gross} €</strong>
                    </div>
                    <div class='detail'>
                        <span>Charges estimées</span>
                        <strong style='color: #ef4444;'>-{$charges} €</strong>
                    </div>
                    <div class='detail' style='border-bottom: none; font-size: 18px;'>
                        <span><strong>Net final</strong></span>
                        <strong style='color: #FF6600;'>{$net} €</strong>
                    </div>
                </div>
                
                <p><strong>Intéressé par ces revenus ?</strong></p>
                <p>Créez votre profil gratuitement et accédez à des centaines de missions qualifiées partout en France.</p>
                
                <div style='text-align: center;'>
                    <a href='{$site_url}/inscription-opticien' class='cta'>
                        Créer mon profil gratuitement
                    </a>
                </div>
                
                <p style='color: #6b7280; font-size: 14px;'>
                    💡 <strong>Bon à savoir :</strong> Les charges peuvent varier selon votre situation personnelle. Ce calcul est une estimation.
                </p>
            </div>
            
            <div class='footer'>
                <p>À bientôt sur OBLINK !</p>
                <p style='font-size: 12px;'>
                    <a href='{$site_url}' style='color: #FF6600;'>oblink.fr</a> | 
                    <a href='{$site_url}/confidentialite' style='color: #6b7280;'>Confidentialité</a>
                </p>
            </div>
        </div>
    </body>
    </html>
    ";
}

function get_contrat_email_body($results, $params)
{
    $salaire = $params['salaire'];
    $type = $params['contrat'] === 'cdd' ? 'CDD' : 'CDI';
    $cadre = isset($params['cadre']) && $params['cadre'] ? 'Cadre' : 'Non-Cadre';
    $heures = isset($params['heures']) ? $params['heures'] : 35;

    $net = number_format($results['net'], 0, ',', ' ');
    $gross = number_format($results['gross'], 0, ',', ' ');
    $charges = number_format($results['charges'], 0, ',', ' ');
    $tauxHoraireBrut = number_format($results['tauxHoraireBrut'], 2, ',', ' ');
    $tauxHoraireNet = number_format($results['tauxHoraireNet'], 2, ',', ' ');

    $site_url = home_url();

    return "
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset='UTF-8'>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #303030; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #0099FF 0%, #9A48D0 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
            .content { background: #f9fafb; padding: 30px; }
            .result-box { background: white; border-left: 4px solid #0099FF; padding: 20px; margin: 20px 0; border-radius: 8px; }
            .big-number { font-size: 36px; font-weight: bold; color: #0099FF; margin: 10px 0; }
            .detail { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb; }
            .cta { background: #0099FF; color: white; text-decoration: none; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 20px 0; font-weight: bold; }
            .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 14px; }
        </style>
    </head>
    <body>
        <div class='container'>
            <div class='header'>
                <h1>🎉 Vos résultats de simulation</h1>
                <p>Mode Contrat - {$type} {$cadre}</p>
            </div>
            
            <div class='content'>
                <p>Bonjour,</p>
                <p>Voici le détail de votre simulation en contrat salarié :</p>
                
                <div class='result-box'>
                    <h2 style='margin-top: 0; color: #0099FF;'>💰 Net mensuel après impôt</h2>
                    <div class='big-number'>{$net} €</div>
                    <p style='color: #6b7280;'>Salaire net versé chaque mois</p>
                </div>
                
                <div class='result-box'>
                    <h3>Détail du calcul</h3>
                    <div class='detail'>
                        <span>Salaire brut mensuel</span>
                        <strong>{$gross} €</strong>
                    </div>
                    <div class='detail'>
                        <span>Type de contrat</span>
                        <strong>{$type}</strong>
                    </div>
                    <div class='detail'>
                        <span>Statut</span>
                        <strong>{$cadre}</strong>
                    </div>
                    <div class='detail'>
                        <span>Heures/semaine</span>
                        <strong>{$heures}h</strong>
                    </div>
                    <div class='detail'>
                        <span>Charges salariales + impôt</span>
                        <strong style='color: #ef4444;'>-{$charges} €</strong>
                    </div>
                    <div class='detail' style='border-bottom: none; font-size: 18px;'>
                        <span><strong>Net après impôt</strong></span>
                        <strong style='color: #0099FF;'>{$net} €</strong>
                    </div>
                </div>
                
                <div class='result-box'>
                    <h3>Taux horaires</h3>
                    <div class='detail'>
                        <span>Taux horaire brut</span>
                        <strong>{$tauxHoraireBrut} €/h</strong>
                    </div>
                    <div class='detail' style='border-bottom: none;'>
                        <span>Taux horaire net</span>
                        <strong style='color: #0099FF;'>{$tauxHoraireNet} €/h</strong>
                    </div>
                </div>
                
                <p><strong>Vous cherchez un poste en contrat ?</strong></p>
                <p>Découvrez les offres CDI et CDD sur OBLINK.</p>
                
                <div style='text-align: center;'>
                    <a href='{$site_url}/emploi-opticien' class='cta'>
                        Voir les offres d'emploi
                    </a>
                </div>
                
                <p style='color: #6b7280; font-size: 14px;'>
                    💡 <strong>Bon à savoir :</strong> Ce calcul est une estimation basée sur des taux moyens. Le taux d'imposition réel dépend de votre situation fiscale.
                </p>
            </div>
            
            <div class='footer'>
                <p>À bientôt sur OBLINK !</p>
                <p style='font-size: 12px;'>
                    <a href='{$site_url}' style='color: #0099FF;'>oblink.fr</a> | 
                    <a href='{$site_url}/confidentialite' style='color: #6b7280;'>Confidentialité</a>
                </p>
            </div>
        </div>
    </body>
    </html>
    ";
}
?>--- FILE: theme/inc/emails/application-confirm.php ---
<h2 style="color: #1f2937; margin-top: 0; font-size: 24px;">Candidature Envoyée ! 🚀</h2>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Votre candidature pour le poste a bien été transmise au recruteur.
</p>

<div
    style="background-color: #f0fdf4; border-left: 4px solid #10b981; padding: 20px; margin: 30px 0; border-radius: 8px;">
    <p style="margin: 0; color: #15803d; font-size: 15px;">
        <strong>Statut :</strong> En attente de réponse du recruteur.
    </p>
</div>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Vous recevrez une notification (Email & SMS) dès que le recruteur aura traité votre demande. En attendant, mettez
    toutes les chances de votre côté en complétant votre profil !
</p>

<p style="text-align: center; margin: 40px 0;">
    <a href="<?php echo home_url('/dashboard-opticien'); ?>"
        style="background-color: #1f2937; color: #ffffff; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 16px; display: inline-block;">
        Suivre mes candidatures
    </a>
</p>--- FILE: theme/inc/emails/new-application.php ---
<h2 style="color: #1f2937; margin-top: 0; font-size: 24px;">Nouvelle Candidature ! 🎯</h2>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Bonne nouvelle ! Un opticien vient de postuler à votre offre.
</p>

<div style="background-color: #fff7ed; padding: 20px; border-radius: 12px; margin: 25px 0; border: 1px solid #fed7aa;">
    <table width="100%">
        <tr>
            <td width="60" valign="top">
                <div
                    style="width: 50px; height: 50px; background-color: #FF6600; color: white; border-radius: 25px; text-align: center; line-height: 50px; font-weight: bold; font-size: 18px;">
                    JD</div>
            </td>
            <td>
                <p style="margin: 0; font-weight: bold; font-size: 18px; color: #1f2937;">Jean D.</p>
                <p style="margin: 5px 0 0 0; color: #4b5563; font-size: 14px;">BTS Opticien • 5 ans d'exp.</p>
            </td>
        </tr>
    </table>
</div>

<p style="text-align: center; margin: 40px 0;">
    <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
        style="background-color: #0099FF; color: #ffffff; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 16px; display: inline-block;">
        Voir le profil complet
    </a>
</p>

<p style="color: #6b7280; font-size: 14px;">
    Le candidat attend votre réponse. Connectez-vous vite pour accepter ou refuser cette candidature.
</p>--- FILE: theme/inc/emails/offer-published.php ---
<h2 style="color: #1f2937; margin-top: 0; font-size: 24px;">Offre publiée ! 📢</h2>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Votre offre d'emploi <strong>
        <?php echo esc_html($job_title); ?>
    </strong> a bien été enregistrée.
</p>

<div
    style="background-color: #f0fdf4; border-left: 4px solid #10b981; padding: 20px; margin: 30px 0; border-radius: 8px;">
    <p style="margin: 0; color: #15803d; font-size: 15px;">
        <strong>Statut :</strong> En ligne (Visible par les candidats).
    </p>
</div>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Vous recevrez une notification par email à chaque nouvelle candidature. Vous pouvez gérer vos offres depuis votre
    tableau de bord.
</p>

<p style="text-align: center; margin: 40px 0;">
    <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
        style="background-color: #0099FF; color: #ffffff; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 16px; display: inline-block;">
        Accéder au Dashboard
    </a>
</p>--- FILE: theme/inc/emails/header.php ---
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>OBLINK Notification</title>
</head>

<body
    style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f9fafb; margin: 0; padding: 0; -webkit-font-smoothing: antialiased;">

    <table width="100%" border="0" cellpadding="0" cellspacing="0" style="background-color: #f9fafb; padding: 40px 0;">
        <tr>
            <td align="center">

                <!-- CONTAINER -->
                <table width="600" border="0" cellpadding="0" cellspacing="0"
                    style="background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">

                    <!-- HEADER -->
                    <tr>
                        <td align="center"
                            style="padding: 40px 0; background-color: #ffffff; border-bottom: 2px solid #f3f4f6;">
                            <h1 style="margin: 0; font-size: 28px; font-weight: 900; letter-spacing: -1px;">
                                <span style="color: #1f2937;">OB</span><span style="color: #FF6600;">LINK</span><span
                                    style="color: #0099FF;">.</span>
                            </h1>
                        </td>
                    </tr>

                    <!-- CONTENT AREA (Starts here) -->
                    <tr>
                        <td style="padding: 40px;">--- FILE: theme/inc/emails/footer.php ---
</td>
</tr>
<!-- CONTENT AREA (Ends here) -->

<!-- FOOTER -->
<tr>
    <td style="background-color: #f3f4f6; padding: 30px; text-align: center;">
        <p style="margin: 0 0 10px 0; font-size: 14px; color: #6b7280; font-weight: bold;">
            <a href="#" style="color: #6b7280; text-decoration: none; margin: 0 10px;">Contact</a>
            <a href="#" style="color: #6b7280; text-decoration: none; margin: 0 10px;">Mentions Légales</a>
            <a href="#" style="color: #6b7280; text-decoration: none; margin: 0 10px;">Se connecter</a>
        </p>
        <p style="margin: 0; font-size: 12px; color: #9ca3af;">
            &copy;
            <?php echo date('Y'); ?> OBLINK. Tous droits réservés.<br>
            La plateforme des Opticiens Freelances.
        </p>
    </td>
</tr>

</table>
<!-- END CONTAINER -->

</td>
</tr>
</table>

</body>

</html>--- FILE: theme/inc/emails/welcome-opticien.php ---
<h2 style="color: #1f2937; margin-top: 0; font-size: 24px;">Bienvenue,
    <?php echo esc_html($name); ?> ! 👋
</h2>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Votre compte <strong>OBLINK</strong> a bien été créé. Vous faites désormais partie de la première communauté
    d'opticiens freelances en France.
</p>

<div
    style="background-color: #eff6ff; border-left: 4px solid #0099FF; padding: 20px; margin: 30px 0; border-radius: 8px;">
    <p style="margin: 0; color: #1e40af; font-size: 15px;">
        <strong>Prochaine étape :</strong> Complétez votre profil avec vos disponibilités et votre CV pour être visible
        des recruteurs dès maintenant.
    </p>
</div>

<p style="text-align: center; margin: 40px 0;">
    <a href="<?php echo home_url('/login'); ?>"
        style="background-color: #FF6600; color: #ffffff; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 16px; display: inline-block;">
        Accéder à mon Espace
    </a>
</p>

<p style="color: #6b7280; font-size: 14px; margin-top: 40px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
    Besoin d'aide ? Répondez simplement à cet email, notre équipe est là pour vous.
</p>--- FILE: theme/inc/seo-meta.php ---
<?php
/**
 * OBLINK - SEO Meta Tags Management
 * 
 * Centralized system for managing meta descriptions, Open Graph tags,
 * Twitter Cards, and JSON-LD structured data for all pages.
 */

/**
 * Get SEO metadata for the current page
 * 
 * @return array Associative array with title, description, og_image, etc.
 */
function oblink_get_seo_meta()
{
    $site_url = home_url();
    $default_og_image = $site_url . '/wp-content/uploads/oblink-og-image.jpg';
    $default_logo = $site_url . '/wp-content/uploads/oblink-logo.png';

    // Default meta
    $meta = [
        'title' => 'OBLINK - Un opticien en un clin d\'œil',
        'description' => 'OBLINK connecte opticiens freelances et magasins d\'optique en France. +500 opticiens actifs, missions qualifiées partout en France. Inscription gratuite.',
        'og_title' => 'OBLINK - Plateforme opticiens freelances',
        'og_description' => 'Connecte opticiens free lances et magasins d\'optique en France. +500 opticiens actifs, missions qualifiées partout en France.',
        'og_image' => $default_og_image,
        'og_url' => $site_url,
        'og_type' => 'website',
        'twitter_card' => 'summary_large_image',
        'twitter_title' => 'OBLINK - Plateforme opticiens freelances',
        'twitter_description' => 'Connecte opticiens freelances et magasins d\'optique en France. +500 opticiens actifs.',
        'twitter_image' => $site_url . '/wp-content/uploads/oblink-twitter-card.jpg',
        'canonical' => $site_url,
    ];

    // Detect current page and override meta
    if (is_front_page() || is_home()) {
        // Homepage - déjà configuré par défaut
    } elseif (is_page('pour-opticiens')) {
        $meta['title'] = 'Pour Opticiens Freelance | OBLINK';
        $meta['description'] = 'Devenez opticien freelance avec OBLINK. Accédez à des missions qualifiées partout en France, portage salarial et accompagnement complet. Créez votre profil gratuit.';
        $meta['og_title'] = 'Pour Opticiens Freelance | OBLINK';
        $meta['canonical'] = home_url('/pour-opticiens');
    } elseif (is_page('pour-entreprises')) {
        $meta['title'] = 'Pour Entreprises | Recrutez des Opticiens | OBLINK';
        $meta['description'] = 'Recrutez des opticiens freelances qualifiés en 48h avec OBLINK. Profils pré-validés, économies jusqu\'à 40%. +200 magasins partenaires nous font confiance.';
        $meta['og_title'] = 'Recrutez des opticiens qualifiés | OBLINK';
        $meta['canonical'] = home_url('/pour-entreprises');
    } elseif (is_page('emploi-opticien')) {
        $meta['title'] = 'Emploi Opticien Freelance | Missions en France | OBLINK';
        $meta['description'] = 'Trouvez votre prochaine mission d\'opticien freelance. Offres de remplacement et missions ponctuelles dans toute la France. Postulez en ligne gratuitement.';
        $meta['og_title'] = 'Missions Opticien Freelance | OBLINK';
        $meta['canonical'] = home_url('/emploi-opticien');
    } elseif (is_page('blog')) {
        $meta['title'] = 'Blog Opticien Indépendant | Conseils & Guides | OBLINK';
        $meta['description'] = 'Conseils, guides pratiques et actualités pour opticiens indépendants. Gestion, facturation, témoignages et réglementation. Blog OBLINK.';
        $meta['og_title'] = 'Blog OBLINK | Conseils pour Opticiens';
        $meta['canonical'] = home_url('/blog');
    } elseif (is_page('simulateur')) {
        $meta['title'] = 'Simulateur Revenus Opticien Freelance | OBLINK';
        $meta['description'] = 'Calculez votre revenu net d\'opticien freelance. Simulateur gratuit incluant charges sociales, congés et frais professionnels. Résultat instantané.';
        $meta['og_title'] = 'Simulateur Revenus | OBLINK';
        $meta['canonical'] = home_url('/simulateur');
    } elseif (is_page('abonnements')) {
        $meta['title'] = 'Tarifs & Abonnements | Pour Magasins d\'Optique | OBLINK';
        $meta['description'] = 'Tarifs transparents pour magasins d\'optique : Découverte 0€, Premium 49€/mois, Corporate sur-mesure. Sans engagement, annulable à tout moment.';
        $meta['og_title'] = 'Tarifs OBLINK | Pour Entreprises';
        $meta['canonical'] = home_url('/abonnements');
    } elseif (is_page('a-propos')) {
        $meta['title'] = 'À Propos | Notre Mission | OBLINK';
        $meta['description'] = 'OBLINK, la première plateforme de mise en relation pour opticiens freelances et magasins d\'optique en France. Mission, valeurs et équipe.';
        $meta['og_title'] = 'À Propos d\'OBLINK';
        $meta['canonical'] = home_url('/a-propos');
    } elseif (is_page('inscription-opticien')) {
        $meta['title'] = 'Inscription Opticien Freelance | Créez Votre Profil | OBLINK';
        $meta['description'] = 'Créez votre profil d\'opticien freelance gratuitement. Accédez aux meilleures missions partout en France. Inscription en 3 minutes.';
        $meta['og_title'] = 'Rejoignez OBLINK | Opticiens';
        $meta['canonical'] = home_url('/inscription-opticien');
    } elseif (is_page('inscription-entreprise')) {
        $meta['title'] = 'Inscription Entreprise | Recrutez des Opticiens | OBLINK';
        $meta['description'] = 'Inscrivez votre magasin d\'optique et accédez à des centaines d\'opticiens qualifiés. Inscription gratuite sans engagement.';
        $meta['og_title'] = 'Rejoignez OBLINK | Entreprises';
        $meta['canonical'] = home_url('/inscription-entreprise');
    } elseif (is_page('opticien-freelance-paris')) {
        $meta['title'] = 'Opticien Freelance Paris | Missions & Emplois Optique 75 | OBLINK';
        $meta['description'] = 'Opticien freelance à Paris : trouvez des missions qualifiées dans les 20 arrondissements. +450 magasins partenaires. Inscription gratuite OBLINK.';
        $meta['og_title'] = 'Missions Opticien Freelance Paris | OBLINK';
        $meta['og_description'] = 'Trouvez des missions d\'opticien à Paris. 450+ magasins, taux 280-350€/jour. Inscription gratuite.';
        $meta['canonical'] = home_url('/opticien-freelance-paris');
    } elseif (is_page('opticien-freelance-lyon')) {
        $meta['title'] = 'Opticien Freelance Lyon | Missions Rhône (69) | OBLINK';
        $meta['description'] = 'Missions opticien freelance à Lyon. 200+ magasins partenaires. Taux journalier attractif. Inscription gratuite OBLINK.';
        $meta['og_title'] = 'Missions Opticien Lyon | OBLINK';
        $meta['canonical'] = home_url('/opticien-freelance-lyon');
    } elseif (is_page('opticien-freelance-marseille')) {
        $meta['title'] = 'Opticien Freelance Marseille | Missions Bouches-du-Rhône | OBLINK';
        $meta['description'] = 'Trouvez des missions d\'opticien freelance à Marseille et PACA. 150+ magasins partenaires. Inscription gratuite.';
        $meta['og_title'] = 'Missions Opticien Marseille | OBLINK';
        $meta['canonical'] = home_url('/opticien-freelance-marseille');
    } elseif (is_page('comment-ca-marche')) {
        $meta['title'] = 'Comment ça marche ? | Le Process OBLINK';
        $meta['description'] = 'Découvrez comment OBLINK connecte opticiens et magasins en 3 étapes simples : inscription, validation et matching. Simple, rapide, efficace.';
        $meta['og_title'] = 'Comment ça marche | OBLINK';
        $meta['canonical'] = home_url('/comment-ca-marche');
    } elseif (is_page('mentions-legales')) {
        $meta['title'] = 'Mentions Légales | OBLINK';
        $meta['description'] = 'Mentions légales du site OBLINK : éditeur, hébergeur, directeur de publication et informations légales.';
        $meta['og_title'] = 'Mentions Légales | OBLINK';
        $meta['canonical'] = home_url('/mentions-legales');
    } elseif (is_single()) {
        // Blog single article
        global $post;
        $meta['title'] = get_the_title() . ' | OBLINK Blog';
        $meta['description'] = get_the_excerpt() ?: wp_trim_words(get_the_content(), 30);
        $meta['og_title'] = get_the_title();
        $meta['og_type'] = 'article';
        $meta['canonical'] = get_permalink();

        if (has_post_thumbnail()) {
            $meta['og_image'] = get_the_post_thumbnail_url(null, 'large');
            $meta['twitter_image'] = get_the_post_thumbnail_url(null, 'large');
        }
    }

    // Synchronize Twitter with OG
    $meta['twitter_title'] = $meta['og_title'];
    $meta['twitter_description'] = $meta['og_description'];

    return apply_filters('oblink_seo_meta', $meta);
}

/**
 * Output SEO meta tags in <head>
 */
function oblink_output_seo_meta()
{
    $meta = oblink_get_seo_meta();
    ?>
    <!-- SEO Meta Tags -->
    <title>
        <?php echo esc_html($meta['title']); ?>
    </title>
    <meta name="description" content="<?php echo esc_attr($meta['description']); ?>">
    <link rel="canonical" href="<?php echo esc_url($meta['canonical']); ?>">

    <!-- Open Graph -->
    <meta property="og:title" content="<?php echo esc_attr($meta['og_title']); ?>">
    <meta property="og:description" content="<?php echo esc_attr($meta['og_description']); ?>">
    <meta property="og:image" content="<?php echo esc_url($meta['og_image']); ?>">
    <meta property="og:url" content="<?php echo esc_url($meta['canonical']); ?>">
    <meta property="og:type" content="<?php echo esc_attr($meta['og_type']); ?>">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="OBLINK">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="<?php echo esc_attr($meta['twitter_card']); ?>">
    <meta name="twitter:title" content="<?php echo esc_attr($meta['twitter_title']); ?>">
    <meta name="twitter:description" content="<?php echo esc_attr($meta['twitter_description']); ?>">
    <meta name="twitter:image" content="<?php echo esc_url($meta['twitter_image']); ?>">
    <?php
}

/**
 * Output JSON-LD Structured Data
 */
function oblink_output_json_ld()
{
    $site_url = home_url();
    $schemas = [];

    // Organization Schema (Global)
    $schemas[] = [
        '@context' => 'https://schema.org',
        '@type' => 'Organization',
        'name' => 'OBLINK',
        'url' => $site_url,
        'logo' => $site_url . '/wp-content/uploads/oblink-logo.png',
        'description' => 'Plateforme de mise en relation entre opticiens freelances et magasins d\'optique en France',
        'email' => 'contact@oblink.fr',
        'areaServed' => [
            '@type' => 'Country',
            'name' => 'France'
        ],
        'sameAs' => [
            'https://www.linkedin.com/company/oblink',
            'https://www.facebook.com/oblink',
            'https://www.instagram.com/oblink'
        ],
        'aggregateRating' => [
            '@type' => 'AggregateRating',
            'ratingValue' => '4.9',
            'reviewCount' => '180'
        ]
    ];

    // Page-specific schemas
    if (is_page('emploi-opticien')) {
        // JobPosting Schema
        $schemas[] = [
            '@context' => 'https://schema.org',
            '@type' => 'JobPosting',
            'title' => 'Missions Opticien Freelance',
            'description' => 'Trouvez des missions d\'opticien freelance partout en France via OBLINK',
            'datePosted' => current_time('Y-m-d'),
            'employmentType' => 'CONTRACTOR',
            'hiringOrganization' => [
                '@type' => 'Organization',
                'name' => 'OBLINK',
                'sameAs' => $site_url
            ],
            'jobLocation' => [
                '@type' => 'Place',
                'address' => [
                    '@type' => 'PostalAddress',
                    'addressCountry' => 'FR'
                ]
            ],
            'baseSalary' => [
                '@type' => 'MonetaryAmount',
                'currency' => 'EUR',
                'value' => [
                    '@type' => 'QuantitativeValue',
                    'value' => 280,
                    'unitText' => 'DAY'
                ]
            ]
        ];
    }

    // FAQ Schema for Comment ça marche page
    if (is_page('comment-ca-marche')) {
        $schemas[] = [
            '@context' => 'https://schema.org',
            '@type' => 'FAQPage',
            'mainEntity' => [
                [
                    '@type' => 'Question',
                    'name' => 'Comment m\'inscrire sur OBLINK en tant qu\'opticien ?',
                    'acceptedAnswer' => [
                        '@type' => 'Answer',
                        'text' => 'L\'inscription est 100% gratuite. Créez votre profil en 3 minutes, ajoutez votre CV et diplômes, puis notre équipe valide  votre dossier sous 48h. Vous recevez ensuite des propositions de missions directement.'
                    ]
                ],
                [
                    '@type' => 'Question',
                    'name' => 'Combien coûte OBLINK pour les magasins ?',
                    'acceptedAnswer' => [
                        '@type' => 'Answer',
                        'text' => 'OBLINK propose 3 formules : Découverte à 0€ (1 offre/mois), Premium à 49€/mois (offres illimitées + support prioritaire), et Corporate sur-mesure. Sans engagement, annulable à tout moment.'
                    ]
                ],
                [
                    '@type' => 'Question',
                    'name' => 'Quel est le délai pour trouver un opticien ?',
                    'acceptedAnswer' => [
                        '@type' => 'Answer',
                        'text' => 'En moyenne, nos magasins partenaires reçoivent les premières candidatures sous 48h. 85% des offres sont pourvues en moins de 7 jours grâce à notre réseau de +500 opticiens actifs.'
                    ]
                ]
            ]
        ];
    }

    // FAQ Schema for Pour Opticiens page
    if (is_page('pour-opticiens')) {
        $schemas[] = [
            '@context' => 'https://schema.org',
            '@type' => 'FAQPage',
            'mainEntity' => [
                [
                    '@type' => 'Question',
                    'name' => 'Quel est le taux journalier moyen pour un opticien freelance ?',
                    'acceptedAnswer' => [
                        '@type' => 'Answer',
                        'text' => 'Le taux journalier varie de 250€ à 350€ selon la région, l\'expérience et le type de mission. À Paris, la moyenne est de 280-320€/jour. Sur OBLINK, vous négociez directement vos tarifs avec les magasins.'
                    ]
                ],
                [
                    '@type' => 'Question',
                    'name' => 'OBLINK propose-t-il du portage salarial ?',
                    'acceptedAnswer' => [
                        '@type' => 'Answer',
                        'text' => 'Oui, OBLINK est partenaire avec plusieurs sociétés de portage salarial. Vous pouvez travailler en freelance tout en bénéficiant du statut salarié : assurance chômage, retraite, mutuelle et RC Pro incluses.'
                    ]
                ]
            ]
        ];
    }

    // Breadcrumb Schema (for all pages except homepage)
    if (!is_front_page() && !is_home()) {
        $breadcrumbs = [
            '@context' => 'https://schema.org',
            '@type' => 'BreadcrumbList',
            'itemListElement' => []
        ];

        // Always start with homepage
        $breadcrumbs['itemListElement'][] = [
            '@type' => 'ListItem',
            'position' => 1,
            'name' => 'Accueil',
            'item' => home_url('/')
        ];

        // Add current page
        $position = 2;
        if (is_single()) {
            // Blog post breadcrumb
            $breadcrumbs['itemListElement'][] = [
                '@type' => 'ListItem',
                'position' => 2,
                'name' => 'Blog',
                'item' => home_url('/blog')
            ];
            $breadcrumbs['itemListElement'][] = [
                '@type' => 'ListItem',
                'position' => 3,
                'name' => get_the_title(),
                'item' => get_permalink()
            ];
        } elseif (is_page()) {
            global $post;
            $breadcrumbs['itemListElement'][] = [
                '@type' => 'ListItem',
                'position' => 2,
                'name' => get_the_title(),
                'item' => get_permalink()
            ];
        }

        $schemas[] = $breadcrumbs;
    }

    // Output all schemas
    foreach ($schemas as $schema) {
        echo '<script type="application/ld+json">' . "\n";
        echo wp_json_encode($schema, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES) . "\n";
        echo '</script>' . "\n";
    }
}
?>--- FILE: theme/inc/emails.php ---
<?php
/**
 * OBLINK Transactional Email System
 */

/**
 * Send a styled transactional email
 *
 * @param string $to Recipient email
 * @param string $subject Email subject
 * @param string $template_name Template filename (without .php) in inc/emails/
 * @param array $data Data to pass to the template
 * @return bool True on success
 */
function oblink_send_mail($to, $subject, $template_name, $data = [])
{
    // 1. Load Template
    $template_path = get_template_directory() . '/inc/emails/' . $template_name . '.php';

    if (!file_exists($template_path)) {
        error_log("OBLINK EMAIL ERROR: Template $template_name not found.");
        return false;
    }

    // Extract data to make it available in template
    extract($data);

    // Buffer output
    ob_start();

    // Header
    include get_template_directory() . '/inc/emails/header.php';

    // content
    include $template_path;

    // Footer
    include get_template_directory() . '/inc/emails/footer.php';

    $message = ob_get_clean();

    // 2. Headers
    $headers = array('Content-Type: text/html; charset=UTF-8');
    $headers[] = 'From: OBLINK <no-reply@oblink.com>';

    // 3. Send
    return wp_mail($to, $subject, $message, $headers);
}

// REGISTER AJAX ACTIONS FOR EMAILS (Simulated for Demo)

// 1. AJAX: Inscription Opticien
add_action('wp_ajax_nopriv_oblink_register_opticien', 'oblink_handle_register_opticien');
add_action('wp_ajax_oblink_register_opticien', 'oblink_handle_register_opticien');

function oblink_handle_register_opticien()
{
    // Simulate processing
    $email = isset($_POST['email']) ? sanitize_email($_POST['email']) : '';
    $name = isset($_POST['first_name']) ? sanitize_text_field($_POST['first_name']) : 'Opticien';

    if ($email) {
        oblink_send_mail($email, 'Bienvenue sur OBLINK !', 'welcome-opticien', ['name' => $name]);
        wp_send_json_success(['message' => 'Inscription réussie']);
    } else {
        wp_send_json_error(['message' => 'Email invalide']);
    }
}

// 2. AJAX: Candidature (One Click Apply)
add_action('wp_ajax_nopriv_oblink_apply_job', 'oblink_handle_apply_job');
add_action('wp_ajax_oblink_apply_job', 'oblink_handle_apply_job');

function oblink_handle_apply_job()
{
    // Simulate
    $job_id = isset($_POST['job_id']) ? intval($_POST['job_id']) : 0;

    // In a real app we would get user email from session or post
    $user_email = 'opticien.demo@test.com'; // Mock current user
    $recruiter_email = 'recruteur.demo@test.com'; // Mock

    if ($job_id) {
        // Mail to Candidate
        oblink_send_mail($user_email, 'Candidature envoyée', 'application-confirm', ['job_id' => $job_id]);

        // Mail to Recruiter
        oblink_send_mail($recruiter_email, 'Nouvelle Candidature !', 'new-application', ['job_id' => $job_id]);

        wp_send_json_success(['message' => 'Candidature envoyée']);
    }
    wp_die();
}
--- FILE: theme/page-mission-detail.php ---
<?php
/*
Template Name: Mission Detail
*/
include 'header-inc.php';

// Get job ID from URL parameter
$job_id = isset($_GET['id']) ? sanitize_text_field($_GET['id']) : null;
?>

<!-- Loading State -->
<div id="loading-state" class="min-h-screen bg-gray-50 pt-32 flex items-center justify-center">
    <div class="text-center">
        <i class="fas fa-circle-notch fa-spin text-4xl text-oblink-blue mb-4"></i>
        <p class="text-gray-500">Chargement de l'offre...</p>
    </div>
</div>

<!-- Job Detail Content (Hidden initially) -->
<div id="job-detail" class="min-h-screen bg-gray-50 pt-32 pb-20 hidden">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Back Button -->
        <a href="<?php echo home_url('/emploi-opticien'); ?>"
            class="inline-flex items-center text-gray-600 hover:text-oblink-blue mb-6 transition">
            <i class="fas fa-arrow-left mr-2"></i> Retour aux offres
        </a>

        <!-- Job Card -->
        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">

            <!-- Header with Company -->
            <div class="bg-gradient-to-r from-oblink-blue/10 to-oblink-violet/10 p-8">
                <div class="flex items-start gap-6">
                    <div id="company-logo"
                        class="w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-bold border-2 border-white shadow-lg">
                        <!-- Dynamically filled -->
                    </div>
                    <div class="flex-1">
                        <h1 id="job-title" class="text-3xl font-bold text-oblink-gray mb-2">
                            <!-- Dynamically filled -->
                        </h1>
                        <p id="company-name" class="text-lg text-gray-600">
                            <!-- Dynamically filled -->
                        </p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons (Sticky on scroll) -->
            <div id="action-bar" class="sticky top-20 z-30 bg-white border-b border-gray-100 p-6 flex gap-3">
                <!-- Dynamically filled based on auth -->
            </div>

            <!-- Job Details -->
            <div class="p-8 space-y-8">

                <!-- Key Info Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded-xl">
                        <i class="fas fa-map-marker-alt text-oblink-blue text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Localisation</p>
                        <p id="job-city" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-xl">
                        <i class="fas fa-euro-sign text-green-600 text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Rémunération</p>
                        <p id="job-salary" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-xl">
                        <i class="fas fa-file-contract text-purple-600 text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Type</p>
                        <p id="job-contract" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-xl">
                        <i class="fas fa-calendar-alt text-oblink-orange text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Début</p>
                        <p id="job-start-date" class="font-bold text-oblink-gray">-</p>
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <h2 class="text-2xl font-bold text-oblink-gray mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-oblink-blue"></i> Description du poste
                    </h2>
                    <div id="job-description" class="prose prose-gray max-w-none text-gray-700 leading-relaxed">
                        <!-- Dynamically filled -->
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-lg text-oblink-gray mb-3">📍 Détails du contrat</h3>
                        <ul class="space-y-2 text-gray-600">
                            <li id="job-duration"><!-- Dynamically filled --></li>
                            <li id="job-hours"><!-- Dynamically filled --></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-oblink-gray mb-3">✨ Avantages</h3>
                        <div id="job-benefits" class="space-y-2 text-gray-600">
                            <!-- Dynamically filled -->
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Contact Section (for messaging later) -->
        <div id="contact-section" class="mt-6 hidden">
            <!-- Will be implemented in v2 -->
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const jobId = '<?php echo $job_id; ?>';
        const loadingState = document.getElementById('loading-state');
        const jobDetail = document.getElementById('job-detail');

        if (!jobId) {
            loadingState.innerHTML = '<p class="text-red-500">ID de mission manquant</p>';
            return;
        }

        try {
            // Get current user
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            const currentUser = session?.user || null;

            // Fetch job details (simplified query - no JOIN)
            const { data: job, error } = await window.oblinkSupabase
                .from('offers')
                .select('*')
                .eq('id', jobId)
                .single();

            if (error) throw error;
            if (!job) throw new Error('Offre introuvable');

            console.log('Job loaded:', job);

            // Populate job details
            document.getElementById('job-title').textContent = job.title;
            document.getElementById('company-name').textContent = job.company_name || 'Entreprise confidentielle';
            document.getElementById('job-city').textContent = job.city || 'Non spécifié';
            document.getElementById('job-salary').textContent = job.daily_rate ? `${job.daily_rate}€/jour` : 'À négocier';
            document.getElementById('job-contract').textContent = job.contract_type?.toUpperCase() || 'Non spécifié';
            document.getElementById('job-start-date').textContent = job.start_date ?
                new Date(job.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) :
                'Dès que possible';
            document.getElementById('job-description').textContent = job.description || 'Aucune description disponible.';

            // Company logo
            const letter = job.company_name?.charAt(0) || 'O';
            const colors = ['bg-blue-100 text-blue-600', 'bg-purple-100 text-purple-600', 'bg-orange-100 text-orange-600'];
            const colorClass = colors[job.title.length % 3];
            document.getElementById('company-logo').className = `w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-bold border-2 border-white shadow-lg ${colorClass}`;
            document.getElementById('company-logo').textContent = letter;

            // Duration & Hours
            document.getElementById('job-duration').innerHTML = `<i class="fas fa-clock text-oblink-blue mr-2"></i> Durée: ${job.duration || 'Indéterminée'}`;
            document.getElementById('job-hours').innerHTML = `<i class="fas fa-hourglass-half text-oblink-blue mr-2"></i> Temps de travail: ${job.work_hours || '35h/semaine'}`;

            // Benefits
            const benefits = job.benefits || 'Avantages standards';
            document.getElementById('job-benefits').innerHTML = `<p>${benefits}</p>`;

            // Action buttons
            const actionBar = document.getElementById('action-bar');
            if (currentUser) {
                // Check if already applied
                const { data: existingApp } = await window.oblinkSupabase
                    .from('applications')
                    .select('id')
                    .eq('offer_id', jobId)
                    .eq('opticien_id', currentUser.id)
                    .single();

                if (existingApp) {
                    actionBar.innerHTML = `
                    <button class="flex-1 px-6 py-4 bg-green-100 text-green-700 font-bold rounded-xl cursor-default flex items-center justify-center gap-2">
                        <i class="fas fa-check-circle"></i> Déjà postulé
                    </button>
                `;
                } else {
                    actionBar.innerHTML = `
                    <button onclick="applyToJob('${jobId}')" 
                            class="flex-1 px-6 py-4 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition shadow-lg flex items-center justify-center gap-2">
                        <i class="fas fa-paper-plane"></i> Postuler maintenant
                    </button>
                    <button onclick="contactCompany()" 
                            class="px-6 py-4 bg-white border-2 border-oblink-blue text-oblink-blue font-bold rounded-xl hover:bg-blue-50 transition flex items-center justify-center gap-2">
                        <i class="fas fa-envelope"></i> Contacter
                    </button>
                `;
                }
            } else {
                actionBar.innerHTML = `
                <a href="<?php echo home_url('/login'); ?>?redirect=/mission-detail?id=${jobId}" 
                   class="flex-1 px-6 py-4 bg-oblink-gray text-white font-bold rounded-xl hover:bg-gray-800 transition shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-lock"></i> Connectez-vous pour postuler
                </a>
            `;
            }

            // Show content
            loadingState.classList.add('hidden');
            jobDetail.classList.remove('hidden');

        } catch (error) {
            console.error('Error loading job:', error);
            loadingState.innerHTML = `<p class="text-red-500">Erreur: ${error.message}</p>`;
        }
    });

    // Apply function
    window.applyToJob = async function (jobId) {
        try {
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            if (!session) throw new Error("Non connecté");

            const { error } = await window.oblinkSupabase
                .from('applications')
                .insert([{
                    offer_id: jobId,
                    opticien_id: session.user.id,
                    status: 'pending'
                }]);

            if (error) throw error;

            alert('✅ Candidature envoyée avec succès !');
            location.reload();

        } catch (error) {
            console.error('Apply error:', error);
            alert('Erreur: ' + error.message);
        }
    }

    // Contact function (placeholder)
    window.contactCompany = function () {
        alert('📧 Fonctionnalité de messagerie disponible prochainement !');
    }
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-contact.php ---
<?php
/**
 * Template Name: Contact
 */
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-12">
            <div
                class="inline-block px-3 py-1 bg-oblink-blue/10 text-oblink-blue font-bold rounded-full text-xs uppercase tracking-wider mb-3">
                Contact & Support
            </div>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Nous sommes là pour vous aider
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Une question ? Besoin d'assistance ? Notre équipe vous répondra dans les plus brefs délais.
            </p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">

            <!-- Contact Form -->
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Envoyez-nous un message</h2>

                <form id="contact-form" class="space-y-5">

                    <!-- Honeypot (Anti-spam) -->
                    <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

                    <!-- Name -->
                    <div class="form-group">
                        <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                            Nom complet <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="name" name="name" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none"
                            placeholder="Jean Dupont" />
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                            Email <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="email" name="email" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none"
                            placeholder="jean.dupont@example.com" />
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Subject -->
                    <div class="form-group">
                        <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">
                            Sujet <span class="text-red-500">*</span>
                        </label>
                        <select id="subject" name="subject" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Choisissez un sujet...</option>
                            <option value="support">Support technique</option>
                            <option value="partnership">Partenariat</option>
                            <option value="billing">Facturation & Abonnements</option>
                            <option value="general">Question générale</option>
                            <option value="feedback">Suggestion / Feedback</option>
                        </select>
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Message -->
                    <div class="form-group">
                        <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">
                            Message <span class="text-red-500">*</span>
                        </label>
                        <textarea id="message" name="message" required rows="6"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none resize-none"
                            placeholder="Décrivez votre demande en détail..."></textarea>
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submit-btn"
                        class="w-full px-6 py-4 bg-oblink-blue text-white font-bold rounded-xl hover:bg-oblink-blue/90 transition-all duration-300 shadow-lg shadow-oblink-blue/20 flex items-center justify-center gap-2">
                        <span id="btn-text">Envoyer le message</span>
                        <i class="fas fa-paper-plane" id="btn-icon"></i>
                    </button>
                </form>

                <!-- Success/Error Messages -->
                <div id="form-success" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-green-600 text-xl mt-0.5"></i>
                        <div>
                            <h3 class="font-bold text-green-900 mb-1">Message envoyé !</h3>
                            <p class="text-sm text-green-700">Nous vous répondrons dans les 24-48 heures.</p>
                        </div>
                    </div>
                </div>

                <div id="form-error" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-circle text-red-600 text-xl mt-0.5"></i>
                        <div>
                            <h3 class="font-bold text-red-900 mb-1">Erreur d'envoi</h3>
                            <p class="text-sm text-red-700" id="error-text">Une erreur est survenue. Veuillez réessayer.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Info & FAQ -->
            <div class="space-y-6">

                <!-- Contact Info Card -->
                <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Autres moyens de contact</h3>

                    <!-- Email -->
                    <div class="flex items-start gap-4 mb-5">
                        <div
                            class="w-10 h-10 rounded-xl bg-oblink-blue/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-envelope text-oblink-blue"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-1">Email</h4>
                            <a href="mailto:contact@oblink.fr" class="text-oblink-blue hover:underline">
                                contact@oblink.fr
                            </a>
                            <p class="text-sm text-gray-500 mt-1">Réponse sous 24-48h</p>
                        </div>
                    </div>

                    <!-- Support -->
                    <div class="flex items-start gap-4">
                        <div
                            class="w-10 h-10 rounded-xl bg-oblink-orange/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-life-ring text-oblink-orange"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-1">Support</h4>
                            <p class="text-gray-600 text-sm">
                                Consultez notre <a href="<?php echo home_url('/blog'); ?>"
                                    class="text-oblink-blue hover:underline">blog</a>
                                pour des guides et tutoriels.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Quick FAQ -->
                <div class="bg-gradient-to-br from-oblink-blue to-blue-600 rounded-3xl p-8 text-white">
                    <h3 class="text-xl font-bold mb-4">Questions fréquentes</h3>

                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-1">Combien de temps pour une réponse ?</h4>
                            <p class="text-sm text-blue-100">Nous répondons sous 24-48 heures ouvrées.</p>
                        </div>

                        <div>
                            <h4 class="font-semibold mb-1">Comment modifier mon abonnement ?</h4>
                            <p class="text-sm text-blue-100">
                                Connectez-vous à votre <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
                                    class="underline hover:text-white">espace entreprise</a>.
                            </p>
                        </div>

                        <div>
                            <h4 class="font-semibold mb-1">Problème de connexion ?</h4>
                            <p class="text-sm text-blue-100">
                                Utilisez la récupération de mot de passe sur la <a
                                    href="<?php echo home_url('/login'); ?>" class="underline hover:text-white">page de
                                    connexion</a>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('contact-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const successMsg = document.getElementById('form-success');
        const errorMsg = document.getElementById('form-error');
        const errorText = document.getElementById('error-text');

        // Real-time validation
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', () => validateField(input));
            input.addEventListener('input', () => {
                if (input.classList.contains('border-red-500')) {
                    validateField(input);
                }
            });
        });

        function validateField(field) {
            const formGroup = field.closest('.form-group');
            const errorSpan = formGroup.querySelector('.error-message');
            let isValid = true;
            let errorMessage = '';

            // Reset styles
            field.classList.remove('border-red-500');
            errorSpan.classList.add('hidden');

            // Check required
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
                errorMessage = 'Ce champ est requis';
            }

            // Email validation
            if (field.type === 'email' && field.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    isValid = false;
                    errorMessage = 'Email invalide';
                }
            }

            // Show error if invalid
            if (!isValid) {
                field.classList.add('border-red-500');
                errorSpan.textContent = errorMessage;
                errorSpan.classList.remove('hidden');
            }

            return isValid;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validate all fields
            let formValid = true;
            inputs.forEach(input => {
                if (input.name !== 'website') { // Skip honeypot
                    if (!validateField(input)) {
                        formValid = false;
                    }
                }
            });

            if (!formValid) return;

            // Check honeypot (anti-spam)
            if (form.querySelector('[name="website"]').value) {
                console.log('Spam detected');
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Envoi en cours...';
            btnIcon.className = 'fas fa-spinner fa-spin';
            successMsg.classList.add('hidden');
            errorMsg.classList.add('hidden');

            // Prepare form data
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value,
            };

            try {
                // Send email via WordPress AJAX
                const response = await fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'send_contact_form',
                        ...formData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Show success message
                    successMsg.classList.remove('hidden');
                    form.reset();

                    // Scroll to success message
                    successMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    throw new Error(result.data?.message || 'Erreur d\'envoi');
                }

            } catch (error) {
                console.error('Contact form error:', error);
                errorText.textContent = error.message || 'Une erreur est survenue. Veuillez réessayer ou nous contacter directement à contact@oblink.fr';
                errorMsg.classList.remove('hidden');
                errorMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'Envoyer le message';
                btnIcon.className = 'fas fa-paper-plane';
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/setup-pages.php ---
<?php
// Script d'Initialisation Automatique d'OBLINK
// Crée toutes les pages nécessaires et assigne les bons Templates PHP.

require_once('../../../wp-load.php');

if (!current_user_can('manage_options')) {
    die('Accès refusé. Admin requis.');
}

// Mapping : Titre de la page => [Slug, Nom du fichier Template]
$pages_to_create = [
    'Accueil' => ['home', 'front-page.php'],
    'Pour Opticiens' => ['pour-opticiens', 'page-pour-opticiens.php'],
    'Pour Entreprises' => ['pour-entreprises', 'page-pour-entreprises.php'],
    'Inscription Opticien' => ['inscription-opticien', 'page-inscription-opticien.php'],
    'Inscription Entreprise' => ['inscription-entreprise', 'page-inscription-entreprise.php'],
    'Tableau de Bord Opticien' => ['dashboard-opticien', 'page-dashboard-opticien.php'],
    'Tableau de Bord Entreprise' => ['dashboard-entreprise', 'page-dashboard-entreprise.php'],
    'Observatoire' => ['observatoire', 'page-observatoire.php'],
    'Simulateur Revenus' => ['simulateur', 'page-simulateur.php'],
    'Recherche Opticiens' => ['recherche-opticiens', 'page-recherche-opticiens.php'],
    'Abonnements & Tarifs' => ['abonnements', 'page-abonnements.php'],
    'Formation ERP' => ['formation-erp', 'page-formation-erp.php'],
    'Générateur de Contrat' => ['generateur-de-contrat', 'page-generateur-contrat.php'],
    'Connexion' => ['login', 'page-login.php'],
    'Comment ça marche' => ['comment-ca-marche', 'page-comment-ca-marche.php'],
    'À Propos' => ['a-propos', 'page-a-propos.php'],
    'Devis' => ['devis', 'page-devis.php'],
    'Facture' => ['facture', 'page-facture.php'],
    'Comparatif Verres' => ['comparatif-verres', 'page-comparatif-verres.php'],
    'Mentions Légales' => ['mentions-legales', 'page-mentions-legales.php'],
    'CGU & CGV' => ['cgu', 'page-cgu.php'],
    'Politique de Confidentialité' => ['confidentialite', 'page-confidentialite.php']
];

echo "<h1>Initialisation du Site OBLINK</h1>";
echo "<ul>";

foreach ($pages_to_create as $title => $props) {
    $slug = $props[0];
    $template_file = $props[1];

    // 1. Vérifier si la page existe
    $page = get_page_by_path($slug);
    $page_id = 0;

    if ($page) {
        $page_id = $page->ID;
        echo "<li style='color:orange'>La page <strong>$title</strong> (/$slug) existe déjà.</li>";
    } else {
        // 2. Créer la page
        $page_id = wp_insert_post([
            'post_title' => $title,
            'post_content' => '', // Contenu vide car géré par le template PHP
            'post_status' => 'publish',
            'post_type' => 'page',
            'post_name' => $slug,
        ]);

        if ($page_id) {
            echo "<li style='color:green'>Création de <strong>$title</strong> (/$slug) : SUCCÈS.</li>";
        } else {
            echo "<li style='color:red'>Erreur création <strong>$title</strong>.</li>";
        }
    }

    // 3. Assigner le Template
    if ($page_id) {
        $current_template = get_post_meta($page_id, '_wp_page_template', true);
        if ($current_template != $template_file) {
            update_post_meta($page_id, '_wp_page_template', $template_file);
            echo " -> Template assigné : <em>$template_file</em><br>";
        } else {
            echo " -> Template déjà OK.<br>";
        }
    }
}

// Spécial : Définir la page d'accueil
$home_page = get_page_by_path('home');
if ($home_page) {
    update_option('show_on_front', 'page');
    update_option('page_on_front', $home_page->ID);
    echo "<br><strong>Configuration :</strong> La page 'Accueil' a été définie comme page d'accueil du site.";
}

echo "</ul>";
echo "<h2>Configuration Terminée !</h2>";
echo "<p>Vos liens devraient maintenant fonctionner correctement. <a href='/'>Retour au site</a></p>";
?>--- FILE: theme/index.php ---
<?php
/**
 * Template Name: Blog
 */

include 'header-inc.php';
?>

<div class="container mx-auto px-4 py-8 pt-32 min-h-screen">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4 font-display text-oblink-gray">Le Blog <span
                class="text-oblink-orange">OBLINK</span></h1>
        <p class="text-lg text-gray-500">Conseils, guides pratiques et actualités pour les opticiens indépendants et les
            entreprises d'optique</p>
    </div>

    <!-- FILTRES PAR CATÉGORIE -->
    <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button class="category-filter active px-6 py-2.5 rounded-full font-bold transition-all duration-300"
            data-category="all">
            Tous
        </button>
        <?php
        $categories = get_categories(array(
            'orderby' => 'name',
            'order' => 'ASC',
            'hide_empty' => true,
        ));

        foreach ($categories as $category):
            if ($category->slug !== 'non-classe'):
                ?>
                <button class="category-filter px-6 py-2.5 rounded-full font-bold transition-all duration-300"
                    data-category="<?php echo esc_attr($category->slug); ?>">
                    <?php echo esc_html($category->name); ?>
                </button>
                <?php
            endif;
        endforeach;
        ?>
    </div>

    <style>
        .category-filter {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
        }

        .category-filter:hover {
            border-color: #FF6600;
            color: #FF6600;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.2);
        }

        .category-filter.active {
            background: #FF6600;
            color: white;
            border-color: #FF6600;
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
        }

        .article-card {
            transition: opacity 0.3s, transform 0.3s;
        }

        .article-card.hidden {
            display: none;
        }
    </style>

    <?php if (have_posts()): ?>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="articles-grid">
            <?php
            // Custom query to pagination work correctly on a static page used as blog
            $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
            $args = array(
                'post_type' => 'post',
                'posts_per_page' => 9,
                'paged' => $paged
            );
            $the_query = new WP_Query($args);

            if ($the_query->have_posts()):
                while ($the_query->have_posts()):
                    $the_query->the_post();

                    // Get post categories
                    $post_categories = get_the_category();
                    $category_slugs = array();
                    if ($post_categories) {
                        foreach ($post_categories as $cat) {
                            $category_slugs[] = $cat->slug;
                        }
                    }
                    $categories_data = implode(' ', $category_slugs);
                    ?>
                    <article id="post-<?php the_ID(); ?>"
                        class="article-card <?php echo implode(' ', array_map(function ($slug) {
                            return 'cat-' . $slug;
                        }, $category_slugs)); ?> bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-gray-100 flex flex-col h-full"
                        data-categories="<?php echo esc_attr($categories_data); ?>">
                        <?php if (has_post_thumbnail()): ?>
                            <a href="<?php the_permalink(); ?>" class="block overflow-hidden relative h-56">
                                <?php the_post_thumbnail('medium_large', ['class' => 'w-full h-full object-cover transform hover:scale-105 transition-transform duration-500']); ?>
                            </a>
                        <?php else: ?>
                            <a href="<?php the_permalink(); ?>"
                                class="block overflow-hidden relative h-56 bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-image text-gray-300 text-4xl"></i>
                            </a>
                        <?php endif; ?>

                        <div class="p-6 flex-1 flex flex-col">
                            <div class="mb-3 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-oblink-orange">
                                <?php
                                $categories = get_the_category();
                                if (!empty($categories)) {
                                    echo esc_html($categories[0]->name);
                                } else {
                                    echo 'Article';
                                }
                                ?>
                            </div>

                            <h2 class="text-xl font-bold mb-3 font-display leading-tight">
                                <a href="<?php the_permalink(); ?>"
                                    class="text-oblink-gray hover:text-oblink-blue transition-colors">
                                    <?php the_title(); ?>
                                </a>
                            </h2>

                            <div class="text-gray-600 mb-4 text-sm flex-1 line-clamp-3">
                                <?php the_excerpt(); ?>
                            </div>

                            <div class="mt-auto flex items-center justify-between pt-4 border-t border-gray-100">
                                <div class="text-xs text-gray-400">
                                    <i class="far fa-calendar-alt mr-1"></i> <?php echo get_the_date(); ?>
                                </div>
                                <a href="<?php the_permalink(); ?>"
                                    class="text-sm font-bold text-oblink-blue hover:text-oblink-violet transition-colors flex items-center gap-1">
                                    Lire <i class="fas fa-arrow-right text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                    <?php
                endwhile;

                // Pagination
                echo '<div class="mt-12 col-span-full">';
                echo '<style>
                    .pagination {
                        display: flex;
                        justify-content: center;
                        gap: 8px;
                        align-items: center;
                    }
                    .pagination a,
                    .pagination span {
                        display: inline-block;
                        padding: 10px 16px;
                        background: white;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        color: #4b5563;
                        font-weight: 600;
                        text-decoration: none;
                        transition: all 0.3s ease;
                    }
                    .pagination a:hover {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .current {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .dots {
                        border: none;
                        background: transparent;
                        color: #9ca3af;
                    }
                </style>';
                echo '<div class="pagination">';
                echo paginate_links(array(
                    'total' => $the_query->max_num_pages,
                    'current' => $paged,
                    'prev_text' => 'Précédent',
                    'next_text' => 'Suivant',
                    'mid_size' => 2,
                    'type' => 'plain',
                ));
                echo '</div>';
                echo '</div>';

                wp_reset_postdata();
            else:
                ?>
                <div class="col-span-full text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-300">
                    <i class="far fa-newspaper text-4xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-400">Aucun article publié pour le moment.</h3>
                    <p class="text-gray-400 mt-2">Revenez bientôt pour découvrir nos actualités.</p>
                </div>
                <?php
            endif;
            ?>
        </div>
    <?php endif; ?>
</div>

<script>
    // Système de filtrage des articles par catégorie
    document.addEventListener('DOMContentLoaded', function () {
        const filterButtons = document.querySelectorAll('.category-filter');
        const articles = document.querySelectorAll('.article-card');

        filterButtons.forEach(button => {
            button.addEventListener('click', function () {
                const selectedCategory = this.dataset.category;

                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // Filter articles
                articles.forEach(article => {
                    if (selectedCategory === 'all') {
                        article.classList.remove('hidden');
                    } else {
                        const articleCategories = article.dataset.categories.split(' ');
                        if (articleCategories.includes(selectedCategory)) {
                            article.classList.remove('hidden');
                        } else {
                            article.classList.add('hidden');
                        }
                    }
                });
            });
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-login.php ---
<?php
/*
Template Name: Connexion
*/

include 'header-inc.php';
?>

<div class="bg-oblink-beige/20 min-h-screen pt-32 pb-20 flex items-center justify-center">
    <!-- Form -->
    <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 max-w-lg w-full">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-oblink-gray mb-3" style="font-family: 'Montserrat', sans-serif;">
                Connexion
            </h1>
            <p class="text-oblink-gray/70">Accédez à votre espace OBLINK</p>
        </div>

        <!-- Contextual Auth Message -->
        <div id="auth-message" class="hidden mb-6 p-4 rounded-xl bg-oblink-blue/10 border border-oblink-blue/20">
            <div class="flex items-start gap-3">
                <i class="fas fa-info-circle text-oblink-blue mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-oblink-gray" id="auth-message-text"></p>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="login-error" class="hidden mb-6 p-4 rounded-xl bg-red-50 border border-red-200">
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-circle text-red-500 mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-red-700" id="login-error-text"></p>
                </div>
            </div>
        </div>

        <form id="supabase-login-form" class="space-y-6">
            <div>
                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                    Email <span class="text-red-500">*</span>
                </label>
                <input type="email" name="email" required
                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                    placeholder="votre@email.com">
            </div>
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-semibold text-oblink-gray">
                        Mot de passe <span class="text-red-500">*</span>
                    </label>
                    <a href="#" id="forgot-password-link" class="text-xs text-oblink-orange hover:underline">Mot de
                        passe oublié ?</a>
                </div>
                <input type="password" name="password" required
                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                    placeholder="••••••••">
            </div>

            <button type="submit"
                class="w-full px-6 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition font-semibold shadow-lg flex justify-center items-center gap-2">
                Se connecter <i class="fas fa-sign-in-alt"></i>
            </button>
        </form>

        <div class="mt-8 pt-6 border-t border-oblink-beige text-center">
            <p class="text-sm text-oblink-gray/70">
                Vous n'avez pas de compte ?<br>
                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                    class="text-oblink-orange font-semibold hover:underline">Inscription Opticien</a>
                <span class="mx-2 text-gray-300">|</span>
                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="text-oblink-blue font-semibold hover:underline">Inscription Entreprise</a>
            </p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('supabase-login-form');
        const authMessage = document.getElementById('auth-message');
        const authMessageText = document.getElementById('auth-message-text');

        // Check for redirect parameter and show contextual message
        const urlParams = new URLSearchParams(window.location.search);
        const redirect = urlParams.get('redirect');

        if (redirect) {
            const messages = {
                '/publier-offre': '⚠️ Vous devez être connecté pour publier une offre',
                '/dashboard-opticien': '⚠️ Connectez-vous pour accéder à votre tableau de bord opticien',
                '/dashboard-entreprise': '⚠️ Connectez-vous pour accéder à votre espace entreprise',
                '/dashboard': '⚠️ Connectez-vous pour accéder à votre tableau de bord',
                '/parametres': '⚠️ Connectez-vous pour accéder aux paramètres',
            };

            authMessageText.textContent = messages[redirect] || '⚠️ Vous devez être connecté pour accéder à cette page';
            authMessage.classList.remove('hidden');
        }

        // Forgot password handler
        document.getElementById('forgot-password-link').addEventListener('click', function (e) {
            e.preventDefault();
            const errorDiv = document.getElementById('login-error');
            const errorText = document.getElementById('login-error-text');
            errorText.textContent = 'Fonctionnalité de réinitialisation en cours de développement. Contactez contact@oblink.fr';
            errorDiv.classList.remove('hidden');
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const email = form.querySelector('input[name="email"]').value;
            const password = form.querySelector('input[name="password"]').value;

            try {
                console.log('[LOGIN] Starting authentication...');

                // 1. Sign In
                const { data, error } = await window.oblinkSupabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                // 2. Get FRESH session to ensure metadata is loaded
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();

                if (!session) {
                    throw new Error('Session introuvable après connexion');
                }

                const user = session.user;
                const userType = user.user_metadata?.user_type;

                console.log('[LOGIN] ✅ Authentification réussie');
                console.log('[LOGIN] User Type:', userType);
                console.log('[LOGIN] User Metadata:', user.user_metadata);

                // 3. Check for redirect parameter
                const urlParams = new URLSearchParams(window.location.search);
                const redirectTo = urlParams.get('redirect');

                // 4. Determine redirect URL
                let redirectUrl;

                if (redirectTo) {
                    redirectUrl = '<?php echo home_url(); ?>' + redirectTo;
                    console.log('[LOGIN] 🔄 Redirect vers:', redirectUrl);
                } else {
                    if (userType === 'opticien') {
                        redirectUrl = '<?php echo home_url("/dashboard-opticien"); ?>';
                        console.log('[LOGIN] 🔄 Redirect opticien:', redirectUrl);
                    } else if (userType === 'entreprise') {
                        redirectUrl = '<?php echo home_url("/dashboard-entreprise"); ?>';
                        console.log('[LOGIN] 🔄 Redirect entreprise:', redirectUrl);
                    } else {
                        console.warn('[LOGIN] ⚠️ Type utilisateur inconnu:', userType);
                        redirectUrl = '<?php echo home_url("/"); ?>';
                    }
                }

                // 5. Redirect
                window.location.href = redirectUrl;

            } catch (error) {
                console.error('Login Error:', error);

                // Show inline error message instead of alert
                const errorDiv = document.getElementById('login-error');
                const errorText = document.getElementById('login-error-text');
                errorText.textContent = error.message || 'Identifiants incorrects. Veuillez réessayer.';
                errorDiv.classList.remove('hidden');

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');

                // Scroll to error
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-comparatif-verres.php ---
<?php
/*
Template Name: Comparatif Verres 2025
*/
include 'header-inc.php';
?>

<!-- Header Section with Glassmorphism -->
<section class="pt-32 pb-20 relative overflow-hidden bg-white">
    <!-- Background elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0">
        <div class="absolute -top-20 -right-20 w-96 h-96 bg-oblink-orange/5 rounded-full blur-3xl"></div>
        <div class="absolute top-40 -left-20 w-72 h-72 bg-oblink-blue/5 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center max-w-3xl mx-auto">
            <span
                class="inline-block px-4 py-1.5 bg-orange-100 text-oblink-orange rounded-full text-sm font-bold mb-6 animate-fade-in-down">
                MISE À JOUR 2025
            </span>
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-oblink-gray"
                style="font-family: 'Montserrat', sans-serif;">
                Comparatif des Verres <span class="text-oblink-orange">Progressifs & Intérieurs</span>
            </h1>
            <p class="text-xl text-oblink-gray/70 mb-8 leading-relaxed">
                Découvrez le classement de référence pour les opticiens freelances. <br>
                Intégration du nouveau <span class="font-bold text-oblink-gray">Score 10</span> (IA Générative) et mise
                à jour des gammes MDD.
            </p>
        </div>
    </div>
</section>

<!-- Score 10 Highlight Section -->
<section class="py-12 bg-gradient-to-br from-slate-50 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-10 flex items-center justify-between">
            <h2 class="text-2xl font-bold text-oblink-gray flex items-center">
                <span
                    class="w-10 h-10 rounded-full bg-oblink-orange text-white flex items-center justify-center font-bold mr-3 text-lg">10</span>
                Les Nouveautés Premium+ (Score 10)
            </h2>
            <span
                class="hidden md:inline-block text-sm text-gray-500 bg-white px-3 py-1 rounded-md border border-gray-100 shadow-sm">
                <i class="fas fa-robot mr-2 text-oblink-blue"></i>Technologies IA intégrées
            </span>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Essilor -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">ESSILOR</span>
                </div>
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded">FLAGSHIP
                        2025</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-orange mb-2">Varilux XR Series</h3>
                <p class="text-sm text-gray-500 mb-4">La référence absolue pilotée par IA comportementale.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Gravure
                        nasale spécifique</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Volume
                        de vision instantané</li>
                </ul>
            </div>

            <!-- Zeiss -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">ZEISS</span>
                </div>
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded">SMARTVIEW
                        2.0</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-blue mb-2">SmartLife Individual 3</h3>
                <p class="text-sm text-gray-500 mb-4">Optimisation dynamique pour les vies connectées.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Intelligence
                        augmentée</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Adaptation
                        morphologique</li>
                </ul>
            </div>

            <!-- Hoya -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">HOYA</span>
                </div>
                <div class="mb-4">
                    <span
                        class="inline-block px-2 py-1 bg-purple-50 text-purple-600 text-xs font-bold rounded">BINOCULAR
                        HARMONIZATION</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-violet mb-2">Hoyalux iD MySelf</h3>
                <p class="text-sm text-gray-500 mb-4">La personnalisation extrême par Hoya.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Gestion
                        des anisotropies</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Confort
                        digital</li>
                </ul>
            </div>

            <!-- Nikon -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">NIKON</span>
                </div>
                <div class="mb-4">
                    <span
                        class="inline-block px-2 py-1 bg-yellow-50 text-yellow-600 text-xs font-bold rounded">Z-CONTRAST</span>
                </div>
                <h3 class="text-xl font-bold text-yellow-600 mb-2">Z Suite (Ultimate/Master)</h3>
                <p class="text-sm text-gray-500 mb-4">La haute définition japonaise repensée.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Contraste
                        optimisé</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Vision
                        nocturne améliorée</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- Table Section: Comparison MDD & Private Labels -->
<section class="py-12 pb-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-oblink-gray mb-2">
                Mise à jour Marques Enseignes (2024-2025)
            </h2>
            <p class="text-gray-500">Pour identifier rapidement les verres en magasin lors de vos missions.</p>
        </div>

        <div class="overflow-x-auto rounded-xl shadow-lg border border-gray-100">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                        <th class="p-4 font-bold border-b">Enseigne</th>
                        <th class="p-4 font-bold border-b">Gamme</th>
                        <th class="p-4 font-bold border-b">Désignation 2025</th>
                        <th class="p-4 font-bold border-b">Équivalence Verrier</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 text-sm">
                    <!-- KRYS -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-oblink-blue">KRYS</td>
                        <td class="p-4">Progressif Premium</td>
                        <td class="p-4 font-bold">KALYSTÉ 2.0 Full HD</td>
                        <td class="p-4 text-gray-500">Codir / Hoya (Variable selon fournisseur)</td>
                    </tr>
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-oblink-blue">KRYS</td>
                        <td class="p-4">Intérieur (Proxi)</td>
                        <td class="p-4 font-bold">KALYSTÉ 2.0 My Proxi ID</td>
                        <td class="p-4 text-gray-500">Dégressif optimisé</td>
                    </tr>

                    <!-- OPTIC 2000 -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-green-600">OPTIC 2000</td>
                        <td class="p-4">Progressif Haut de Gamme</td>
                        <td class="p-4 font-bold">INFINIGLASS</td>
                        <td class="p-4 text-gray-500">Equivalent BBGR Haut de Gamme</td>
                    </tr>

                    <!-- AFFLELOU -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-gray-800">AFFLELOU</td>
                        <td class="p-4">Progressif</td>
                        <td class="p-4 font-bold">CENT POUR CENT / EGO</td>
                        <td class="p-4 text-gray-500">BBGR / Shamir (Souvent gravé "CP")</td>
                    </tr>

                    <!-- GRAND OPTICAL -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-gray-800">GRAND OPTICAL</td>
                        <td class="p-4">Progressif</td>
                        <td class="p-4 font-bold">VARIVIEW HD</td>
                        <td class="p-4 text-gray-500">Seiko / Hoya</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-8 text-center bg-blue-50 p-6 rounded-xl border border-blue-100">
            <h3 class="text-lg font-bold text-oblink-blue mb-2">Besoin de la base de données complète ?</h3>
            <p class="text-sm text-gray-600 mb-4">Téléchargez le fichier CSV complet avec plus de 200 références de
                verres (Mise à jour 2025).</p>
            <a href="<?php echo get_template_directory_uri(); ?>/comparatif-verres-2025.csv" download
                class="inline-block px-6 py-3 bg-oblink-blue text-white rounded-lg font-bold shadow-md hover:bg-oblink-blue/90 transition">
                <i class="fas fa-download mr-2"></i> Télécharger le Comparatif Complet (CSV)
            </a>
            <p class="text-xs text-gray-400 mt-2">Mise à jour : Janvier 2025</p>
        </div>
    </div>
</section>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-formation-erp-v2.php ---
<?php
/*
Template Name: Marketplace Formations V2 (Premium)
Description: Modern course marketplace with filters, ratings, wishlist, quick view
*/
include 'header-inc.php';
?>

<style>
    /* Premium Card Hover Effects */
    .course-card {
        transition: all 0.3s ease;
    }

    .course-card:hover {
        transform: translateY(-8px);
    }

    /* Quick View Modal */
    .modal-backdrop {
        backdrop-filter: blur(8px);
        background: rgba(0, 0, 0, 0.6);
    }

    /* Rating Stars */
    .rating-stars {
        color: #FCD34D;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-50 via-violet-50/30 to-orange-50/20 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-12">
            <span
                class="inline-block py-1 px-4 rounded-full bg-oblink-violet/10 text-oblink-violet font-bold text-sm mb-4 uppercase">
                <i class="fas fa-graduation-cap mr-2"></i>Académie OBLINK
            </span>
            <h1 class="text-4xl md:text-6xl font-black text-oblink-gray mb-6">
                L'Académie <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                <strong class="text-oblink-violet">47 formations</strong> pour booster votre carrière en optique
            </p>
        </div>

        <div class="grid lg:grid-cols-4 gap-8">

            <!-- SIDEBAR FILTERS -->
            <aside class="lg:col-span-1 space-y-6">

                <!-- Search -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <input type="text" id="search-courses" placeholder="Rechercher une formation..."
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 transition">
                </div>

                <!-- Filter: Category -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-layer-group text-oblink-violet"></i>Catégorie
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="all"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet" checked>
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Toutes</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="logiciels"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Logiciels
                                ERP</span>
                            <span class="ml-auto text-xs text-gray-400">12</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="clinique"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Expertise
                                Clinique</span>
                            <span class="ml-auto text-xs text-gray-400">18</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="vente"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Vente &
                                Management</span>
                            <span class="ml-auto text-xs text-gray-400">10</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="certif"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span
                                class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Certifications</span>
                            <span class="ml-auto text-xs text-gray-400">7</span>
                        </label>
                    </div>
                </div>

                <!-- Filter: Price -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-euro-sign text-oblink-orange"></i>Prix
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="free"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Gratuit</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="0-50"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Moins de
                                50€</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="50-150"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">50€ -
                                150€</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="150+"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">150€+</span>
                        </label>
                    </div>
                </div>

                <!-- Filter: Rating -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-star text-yellow-400"></i>Note minimum
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="all"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet" checked>
                            <span class="text-sm text-gray-700">Toutes</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="4"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <div class="rating-stars text-sm">★★★★☆ et plus</div>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="4.5"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <div class="rating-stars text-sm">★★★★★ 4.5+</div>
                        </label>
                    </div>
                </div>

                <!-- Reset -->
                <button id="reset-filters-courses"
                    class="w-full px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition">
                    <i class="fas fa-redo mr-2"></i>Réinitialiser
                </button>

            </aside>

            <!-- MAIN CONTENT -->
            <main class="lg:col-span-3">

                <!-- Toolbar -->
                <div
                    class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6 flex items-center justify-between">
                    <p class="text-sm text-gray-600"><span id="courses-count"
                            class="font-bold text-oblink-violet">47</span> formations trouvées</p>

                    <select id="sort-courses"
                        class="px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 transition text-sm">
                        <option value="popular">Les plus populaires</option>
                        <option value="rating">Mieux notées</option>
                        <option value="price-asc">Prix croissant</option>
                        <option value="price-desc">Prix décroissant</option>
                        <option value="newest">Plus récentes</option>
                    </select>
                </div>

                <!-- Courses Grid -->
                <div id="courses-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Courses will be injected here -->
                </div>

            </main>

        </div>

    </div>
</div>

<!-- Quick View Modal -->
<div id="quick-view-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop"
    onclick="closeQuickView()">
    <div class="bg-white rounded-3xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto"
        onclick="event.stopPropagation()">
        <div id="modal-content" class="p-8">
            <!-- Content injected dynamically -->
        </div>
    </div>
</div>

<script>
    // MOCK DATA
    const MOCK_COURSES = [
        { id: 1, title: "Maîtriser Cosium Optic", instructor: "Team Cosium", category: "logiciels", price: 0, rating: 4.9, students: 1247, duration: "2h30", image: "cosium", bestseller: true, certified: false },
        { id: 2, title: "Réfraction Complexe : Le Cas par Cas", instructor: "Dr. Marc L.", category: "clinique", price: 159, rating: 4.9, students: 523, duration: "8h", image: "refraction", bestseller: true, certified: true },
        { id: 3, title: "Adaptation Lentilles Rigides", instructor: "Sarah B.", category: "clinique", price: 129, rating: 4.8, students: 387, duration: "6h", image: "lentilles", bestseller: false, certified: true },
        { id: 4, title: "Ivoirnet : L'essentiel", instructor: "Team Ivoirnet", category: "logiciels", price: 0, rating: 4.7, students: 892, duration: "1h45", image: "ivoirnet", bestseller: false, certified: false },
        { id: 5, title: "Vente Consultative en Optique", instructor: "Julie M.", category: "vente", price: 89, rating: 4.6, students: 654, duration: "4h", image: "vente", bestseller: false, certified: false },
        { id: 6, title: "Initiation Basse Vision", instructor: "Jean V.", category: "clinique", price: 89, rating: 4.5, students: 234, duration: "5h", image: "basse-vision", bestseller: false, certified: true },
        { id: 7, title: "WinOptics Start", instructor: "Win Academy", category: "logiciels", price: 0, rating: 4.8, students: 743, duration: "1h", image: "winoptics", bestseller: false, certified: false },
        { id: 8, title: "Manager une Équipe Optique", instructor: "Pierre D.", category: "vente", price: 119, rating: 4.7, students: 421, duration: "7h", image: "management", bestseller: false, certified: false },
        { id: 9, title: "Certification Contactologie Avancée", instructor: "Dr. Anne P.", category: "certif", price: 199, rating: 4.9, students: 178, duration: "12h", image: "certif-contact", bestseller: false, certified: true },
    ];

    let allCourses = [...MOCK_COURSES];
    let filteredCourses = [...MOCK_COURSES];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        renderCourses();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Search
        document.getElementById('search-courses').addEventListener('input', applyFilters);

        // Category filter
        document.querySelectorAll('input[name="category"]').forEach(radio => {
            radio.addEventListener('change', applyFilters);
        });

        // Price filters
        document.querySelectorAll('.filter-price').forEach(cb => {
            cb.addEventListener('change', applyFilters);
        });

        // Rating filter
        document.querySelectorAll('input[name="rating"]').forEach(radio => {
            radio.addEventListener('change', applyFilters);
        });

        // Sort
        document.getElementById('sort-courses').addEventListener('change', () => {
            sortCourses();
            renderCourses();
        });

        // Reset
        document.getElementById('reset-filters-courses').addEventListener('click', resetFilters);
    }

    function applyFilters() {
        const searchTerm = document.getElementById('search-courses').value.toLowerCase();
        const selectedCategory = document.querySelector('input[name="category"]:checked').value;
        const selectedPrices = Array.from(document.querySelectorAll('.filter-price:checked')).map(cb => cb.value);
        const selectedRating = document.querySelector('input[name="rating"]:checked').value;

        filteredCourses = allCourses.filter(course => {
            // Search
            const matchesSearch = !searchTerm || course.title.toLowerCase().includes(searchTerm) || course.instructor.toLowerCase().includes(searchTerm);

            // Category
            const matchesCategory = selectedCategory === 'all' || course.category === selectedCategory;

            // Price
            let matchesPrice = selectedPrices.length === 0;
            if (selectedPrices.includes('free') && course.price === 0) matchesPrice = true;
            if (selectedPrices.includes('0-50') && course.price > 0 && course.price <= 50) matchesPrice = true;
            if (selectedPrices.includes('50-150') && course.price > 50 && course.price <= 150) matchesPrice = true;
            if (selectedPrices.includes('150+') && course.price > 150) matchesPrice = true;

            // Rating
            const matchesRating = selectedRating === 'all' || course.rating >= parseFloat(selectedRating);

            return matchesSearch && matchesCategory && matchesPrice && matchesRating;
        });

        sortCourses();
        renderCourses();
    }

    function sortCourses() {
        const sortValue = document.getElementById('sort-courses').value;

        filteredCourses.sort((a, b) => {
            switch (sortValue) {
                case 'popular':
                    return b.students - a.students;
                case 'rating':
                    return b.rating - a.rating;
                case 'price-asc':
                    return a.price - b.price;
                case 'price-desc':
                    return b.price - a.price;
                case 'newest':
                    return b.id - a.id;
                default:
                    return 0;
            }
        });
    }

    function renderCourses() {
        const container = document.getElementById('courses-container');
        document.getElementById('courses-count').textContent = filteredCourses.length;

        if (filteredCourses.length === 0) {
            container.innerHTML = '<div class="col-span-3 text-center py-12"><p class="text-gray-500 text-lg">Aucune formation trouvée</p></div>';
            return;
        }

        container.innerHTML = filteredCourses.map(course => `
        <div class="course-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group">
            <!-- Thumbnail -->
            <div class="relative h-48 bg-gradient-to-br ${getGradient(course.image)} flex items-center justify-center overflow-hidden">
                <i class="fas ${getIcon(course.category)} text-6xl text-white/20 group-hover:scale-110 transition"></i>
                ${course.bestseller ? '<span class="absolute top-3 left-3 bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-full">🔥 BEST SELLER</span>' : ''}
                ${course.certified ? '<span class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full"><i class="fas fa-certificate mr-1"></i>CERTIFIÉ</span>' : ''}
                <button onclick="addToWishlist(${course.id}); event.stopPropagation();" class="absolute bottom-3 right-3 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center hover:bg-oblink-orange hover:text-white transition shadow-lg">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
            
            <!-- Content -->
            <div class="p-5" onclick="showQuickView(${course.id})">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1 text-yellow-400 text-sm">
                        ${'★'.repeat(Math.floor(course.rating))}${'☆'.repeat(5 - Math.floor(course.rating))}
                        <span class="text-gray-600 ml-1 font-semibold">${course.rating}</span>
                    </div>
                    <span class="text-xs text-gray-500"><i class="fas fa-users mr-1"></i>${course.students}</span>
                </div>
                
                <h3 class="font-bold text-lg text-oblink-gray mb-2 group-hover:text-oblink-violet transition line-clamp-2">${course.title}</h3>
                
                <div class="flex items-center gap-2 mb-4 text-xs text-gray-500">
                    <img src="https://randomuser.me/api/portraits/men/${course.id}.jpg" class="w-6 h-6 rounded-full">
                    <span>${course.instructor}</span>
                    <span>·</span>
                    <span><i class="fas fa-clock mr-1"></i>${course.duration}</span>
                </div>
                
                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <span class="font-black text-2xl text-oblink-gray">${course.price === 0 ? '<span class="text-green-600">GRATUIT</span>' : course.price + '€'}</span>
                    <button onclick="buyCourse(${course.id}); event.stopPropagation();" class="px-4 py-2 bg-oblink-violet hover:bg-oblink-violet/90 text-white font-semibold rounded-lg transition">
                        ${course.price === 0 ? 'Voir' : 'Acheter'}
                    </button>
                </div>
            </div>
        </div>
    `).join('');
    }

    function getGradient(image) {
        const gradients = {
            cosium: 'from-gray-900 to-gray-700',
            refraction: 'from-indigo-900 to-indigo-700',
            lentilles: 'from-teal-800 to-teal-600',
            ivoirnet: 'from-emerald-800 to-emerald-600',
            vente: 'from-orange-700 to-orange-500',
            'basse-vision': 'from-gray-800 to-gray-600',
            winoptics: 'from-orange-700 to-orange-500',
            management: 'from-blue-800 to-blue-600',
            'certif-contact': 'from-violet-800 to-violet-600',
        };
        return gradients[image] || 'from-gray-700 to-gray-500';
    }

    function getIcon(category) {
        const icons = {
            logiciels: 'fa-laptop-code',
            clinique: 'fa-microscope',
            vente: 'fa-chart-line',
            certif: 'fa-certificate',
        };
        return icons[category] || 'fa-book';
    }

    function showQuickView(courseId) {
        const course = allCourses.find(c => c.id === courseId);
        const modal = document.getElementById('quick-view-modal');
        const content = document.getElementById('modal-content');

        content.innerHTML = `
        <button onclick="closeQuickView()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 text-2xl">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="grid md:grid-cols-2 gap-8">
            <div>
                <div class="h-64 rounded-2xl bg-gradient-to-br ${getGradient(course.image)} flex items-center justify-center mb-6">
                    <i class="fas ${getIcon(course.category)} text-8xl text-white/30"></i>
                </div>
                ${course.bestseller ? '<span class="inline-block bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-full mb-3">🔥 BEST SELLER</span>' : ''}
            </div>
            
            <div>
                <h2 class="text-3xl font-black text-oblink-gray mb-4">${course.title}</h2>
                
                <div class="flex items-center gap-2 mb-4">
                    <div class="flex items-center gap-1 text-yellow-400 text-lg">
                        ${'★'.repeat(Math.floor(course.rating))}${'☆'.repeat(5 - Math.floor(course.rating))}
                        <span class="text-gray-600 ml-2 font-bold">${course.rating}</span>
                    </div>
                    <span class="text-gray-500">·</span>
                    <span class="text-sm text-gray-600"><i class="fas fa-users mr-1"></i>${course.students} étudiants</span>
                </div>
                
                <div class="flex items-center gap-3 mb-6">
                    <img src="https://randomuser.me/api/portraits/men/${course.id}.jpg" class="w-12 h-12 rounded-full border-2 border-oblink-violet">
                    <div>
                        <p class="font-bold text-gray-900">${course.instructor}</p>
                        <p class="text-sm text-gray-500">Expert certifié</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <h4 class="font-bold text-gray-900 mb-3">Ce que vous allez apprendre</h4>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Maîtriser toutes les fonctionnalités</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Gagner du temps au quotidien</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Devenir autonome rapidement</li>
                    </ul>
                </div>
                
                <div class="flex items-center gap-4 mb-6">
                    <span class="text-4xl font-black text-oblink-gray">${course.price === 0 ? '<span class="text-green-600">GRATUIT</span>' : course.price + '€'}</span>
                    <span class="text-sm text-gray-500"><i class="fas fa-clock mr-1"></i>${course.duration}</span>
                </div>
                
                <button onclick="buyCourse(${course.id})" class="w-full px-8 py-4 bg-oblink-violet hover:bg-oblink-violet/90 text-white font-bold rounded-xl transition shadow-lg">
                    ${course.price === 0 ? 'Commencer maintenant' : 'Acheter la formation'}
                </button>
            </div>
        </div>
    `;

        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeQuickView() {
        document.getElementById('quick-view-modal').classList.add('hidden');
        document.getElementById('quick-view-modal').classList.remove('flex');
    }

    function addToWishlist(courseId) {
        alert(`Formation #${courseId} ajoutée aux favoris ! 💜`);
    }

    function buyCourse(courseId) {
        alert(`Redirection vers le paiement pour la formation #${courseId}...`);
    }

    function resetFilters() {
        document.getElementById('search-courses').value = '';
        document.querySelector('input[name="category"][value="all"]').checked = true;
        document.querySelectorAll('.filter-price').forEach(cb => cb.checked = false);
        document.querySelector('input[name="rating"][value="all"]').checked = true;
        applyFilters();
    }
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-recherche-opticiens.php ---
<?php
/*
Template Name: Recherche Opticiens
*/

include 'header-inc.php';
?>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<!-- Nav is handled by header.php -->

<!-- Header (Compact) -->
<div class="bg-gradient-to-r from-oblink-blue to-oblink-violet text-white pt-32 pb-8">
    <div class="max-w-7xl mx-auto px-4">
        <h1 class="text-3xl font-bold mb-2">Trouvez un opticien</h1>
        <p class="opacity-90">Explorez la carte pour trouver les meilleurs talents disponibles.</p>
    </div>
</div>

<!-- Map & Filters Layout -->
<div class="h-[calc(100vh-200px)] flex flex-col md:flex-row">

    <!-- Sidebar / List (30% width) -->
    <div class="w-full md:w-1/3 bg-white border-r border-gray-200 flex flex-col z-20 shadow-xl">

        <!-- Filters -->
        <div class="p-4 border-b border-gray-100 bg-gray-50">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="filter-search" placeholder="Ville, Nom..."
                    class="w-full pl-10 pr-4 py-2 rounded-lg border-gray-200 focus:ring-oblink-blue focus:border-oblink-blue text-sm">
            </div>

            <div class="flex gap-2 mt-2">
                <select id="filter-availability" class="flex-1 text-sm border-gray-200 rounded-lg py-2">
                    <option value="">Tous statuts</option>
                    <option value="available">Disponible</option>
                </select>
                <!-- Add more filters here later -->
            </div>
        </div>

        <!-- Results List -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="opticians-list">
            <!-- Loading State -->
            <div class="text-center py-8 text-gray-400">
                <i class="fas fa-circle-notch fa-spin mb-2"></i>
                <p class="text-xs">Chargement des opticiens...</p>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="p-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between bg-gray-50">
            <span id="result-count">0 opticiens trouvés</span>
            <span>France</span>
        </div>
    </div>

    <!-- Map Container (70% width) -->
    <div class="flex-1 relative bg-gray-100 z-10">
        <div id="map" class="absolute inset-0 w-full h-full"></div>

        <!-- Map Overlay Controls -->
        <div class="absolute top-4 right-4 z-[400] bg-white rounded-lg shadow-md p-2">
            <button id="locate-me-btn"
                class="w-8 h-8 flex items-center justify-center text-gray-600 hover:text-oblink-blue"
                title="Ma position">
                <i class="fas fa-location-arrow"></i>
            </button>
        </div>
    </div>

</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    document.addEventListener('DOMContentLoaded', async () => {

        // 1. Initialize Map
        const map = L.map('map').setView([46.603354, 1.888334], 6); // Centered on France

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        const markersLayer = L.layerGroup().addTo(map);
        let allOpticians = [];

        // 2. Fetch Opticians from Supabase
        async function fetchOpticians() {
            try {
                // Fetch profiles where user_type is opticien
                // Note: We should filter by latitude not null ideally, but client-side filter is fine for MVP size
                const { data: opticians, error } = await window.oblinkSupabase
                    .from('profiles')
                    .select('*')
                    .eq('user_type', 'opticien');

                if (error) throw error;

                // Filter out those without coordinates
                allOpticians = opticians.filter(opt => opt.latitude && opt.longitude);

                updateDisplay(allOpticians);

            } catch (err) {
                console.error("Error loading opticians:", err);
                document.getElementById('opticians-list').innerHTML = '<div class="text-red-500 p-4 text-center">Erreur de chargement des données.</div>';
            }
        }

        // 3. Render Markers & List
        function updateDisplay(opticians) {
            // Clear existing
            markersLayer.clearLayers();
            const listContainer = document.getElementById('opticians-list');
            listContainer.innerHTML = '';

            document.getElementById('result-count').textContent = `${opticians.length} opticiens géolocalisés`;

            if (opticians.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center py-10 px-4">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">🌍</div>
                        <h3 class="font-bold text-gray-500">Aucun opticien sur la carte</h3>
                        <p class="text-xs text-gray-400 mt-2">Invitez des opticiens à mettre à jour leur localisation dans "Paramètres".</p>
                    </div>
                `;
                return;
            }

            // Loop
            opticians.forEach(opt => {
                // Add Marker
                const customIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="w-8 h-8 rounded-full bg-oblink-blue border-2 border-white shadow-lg flex items-center justify-center text-white font-bold text-xs">${opt.first_name ? opt.first_name.charAt(0) : 'O'}</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                });

                const marker = L.marker([opt.latitude, opt.longitude], { icon: customIcon })
                    .on('click', () => {
                        // Highlight list item
                        document.querySelectorAll('.optician-item').forEach(el => el.classList.remove('ring-2', 'ring-oblink-blue'));
                        const listItem = document.getElementById(`opt-${opt.id}`);
                        if (listItem) {
                            listItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            listItem.classList.add('ring-2', 'ring-oblink-blue');
                        }
                    })
                    .bindPopup(`
                        <div class="text-center">
                            <h3 class="font-bold text-gray-800">${escapeHtml(opt.first_name)} ${escapeHtml(opt.last_name)}</h3>
                            <p class="text-xs text-gray-500 mb-2">${escapeHtml(opt.city || '')}</p>
                            <a href="<?php echo home_url('/profil-opticien'); ?>?id=${opt.id}" class="block text-xs bg-oblink-blue text-white px-2 py-1 rounded hover:bg-blue-600">Voir profil</a>
                        </div>
                    `);

                markersLayer.addLayer(marker);

                // Add List Item
                const card = document.createElement('div');
                card.id = `opt-${opt.id}`;
                card.className = "optician-item bg-white p-3 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer flex gap-3";
                card.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-bold flex-shrink-0">
                        ${opt.first_name ? opt.first_name.charAt(0) : 'O'}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-sm text-gray-800 truncate">${escapeHtml(opt.first_name)} ${escapeHtml(opt.last_name)}</h4>
                            <span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded">Dispo</span>
                        </div>
                        <p class="text-xs text-gray-500 truncate"><i class="fas fa-map-marker-alt text-oblink-orange/70 mr-1"></i> ${escapeHtml(opt.city || 'Ville inconnue')}</p>
                        <p class="text-xs text-gray-400 mt-1 line-clamp-1">${escapeHtml(opt.bio_short || 'Aucune bio.')}</p>
                    </div>
                `;

                // Card Click -> Zoom Map
                card.addEventListener('click', () => {
                    map.flyTo([opt.latitude, opt.longitude], 12);
                    marker.openPopup();
                });

                listContainer.appendChild(card);
            });
        }

        // Security Helper
        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Locate Me Button
        document.getElementById('locate-me-btn').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    map.setView([lat, lon], 12);
                    // Could add a "You are here" marker
                });
            } else {
                alert("La géolocalisation n'est pas supportée par votre navigateur.");
            }
        });

        // Search Filter (Basic Client-Side)
        document.getElementById('filter-search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allOpticians.filter(opt => {
                const name = (opt.first_name + ' ' + opt.last_name).toLowerCase();
                const city = (opt.city || '').toLowerCase();
                return name.includes(term) || city.includes(term);
            });
            updateDisplay(filtered);
        });

        // Availability Filter (FIXED - was missing event listener)
        document.getElementById('filter-availability').addEventListener('change', (e) => {
            const statusValue = e.target.value;
            const searchTerm = document.getElementById('filter-search').value.toLowerCase();

            let filtered = allOpticians;

            // Apply search term if exists
            if (searchTerm) {
                filtered = filtered.filter(opt => {
                    const name = (opt.first_name + ' ' + opt.last_name).toLowerCase();
                    const city = (opt.city || '').toLowerCase();
                    return name.includes(searchTerm) || city.includes(searchTerm);
                });
            }

            //  Apply availability filter
            if (statusValue === 'available') {
                // Assuming profiles have an `availability_status` or similar field
                // If not, you'll need to add this field to the profiles table
                filtered = filtered.filter(opt => opt.availability_status === 'available');
            }

            updateDisplay(filtered);
        });

        // Init
        fetchOpticians();

    });
</script>

<?php
// No footer content for the map view to maximize space, just scripts
wp_footer();
?>--- FILE: theme/page-formation-erp.php ---
<?php
/*
Template Name: Académie Oblink (Anciennement Formation ERP)
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header: La Vision Académie HUB -->
        <div class="text-center mb-16 relative">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
                <i class="fas fa-graduation-cap mr-2"></i>L'excellence Optique
            </span>
            <h1 class="text-4xl md:text-6xl font-black font-display text-oblink-gray mb-6">
                Académie <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto font-body leading-relaxed mb-12">
                De l'étudiant au professionnel aguerri. Une plateforme unique pour réussir votre diplôme et booster
                votre carrière.
            </p>

            <!-- HUB NAVIGATION CARDS -->
            <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto text-left">

                <!-- Card 1: PASS EXAMEN (New) -->
                <a href="<?php echo home_url('/pass-examen'); ?>"
                    class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-orange/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-oblink-orange/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-orange to-pink-500 text-white flex items-center justify-center text-2xl shadow-lg">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <span
                                class="bg-red-100 text-red-600 font-bold px-3 py-1 rounded-full text-xs">NOUVEAU</span>
                        </div>
                        <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-orange transition">Je
                            passe mon BTS</h3>
                        <p class="text-gray-500 mb-6 font-medium">Annales corrigées, IA prédictive et fiches de révision
                            pour assurer votre diplôme.</p>
                        <div class="flex items-center text-oblink-blue font-bold text-sm">
                            Découvrir le Pass Examen <i
                                class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                        </div>
                    </div>
                </a>

                <!-- Card 2: FORMATIONS PRO (Existing) -->
                <a href="#formations-logiciels"
                    class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-blue/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-blue to-cyan-500 text-white flex items-center justify-center text-2xl shadow-lg">
                                <i class="fas fa-laptop-medical"></i>
                            </div>
                            <span class="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded-full text-xs">PRO</span>
                        </div>
                        <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-blue transition">Je
                            suis Opticien</h3>
                        <p class="text-gray-500 mb-6 font-medium">Maîtrisez les logiciels ERP et développez des
                            compétences cliniques rares.</p>
                        <div class="flex items-center text-oblink-blue font-bold text-sm">
                            Voir les formations <i
                                class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <div id="formations-logiciels" class="pt-12"></div>

        <!-- 5 ARGUMENTS CHOCS SECTION -->
        <div class="mb-20 bg-white rounded-3xl p-8 md:p-12 shadow-xl border border-gray-100 relative overflow-hidden">
            <div
                class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-oblink-blue/5 to-transparent skew-x-12 transform pointer-events-none">
            </div>

            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black text-oblink-gray mb-4">
                    Pourquoi se former ? <span class="text-oblink-blue">Les 5 vérités "Cash"</span>
                </h2>
                <p class="text-lg text-gray-500 font-medium">Ne soyez pas juste un remplaçant. Soyez l'expert que tout
                    le monde s'arrache.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 relative z-10">
                <!-- Argument 1: TJM -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Boostez votre TJM de +15%</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Un expert certifié Cosium facture <strong class="text-oblink-blue">420€/j</strong> contre 350€
                        pour un profil standard. Votre formation est rentabilisée en <span
                            class="underline decoration-green-500 decoration-2">2 jours de mission</span>.
                    </p>
                </div>

                <!-- Argument 2: Zero Onboarding -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-stopwatch"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Zéro Onboarding</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        "Arrivez, connectez-vous, vendez." Les gérants détestent former les remplaçants. Avec le badge
                        <strong class="text-oblink-orange">Certifié ERP</strong>, vous passez en priorité sur toutes les
                        offres.
                    </p>
                </div>

                <!-- Argument 3: Sécurité -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-red-100 text-red-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Zéro Erreur Facturation</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        En 2026, une erreur de télétransmission est fatale. Maîtrisez les pièges du Tiers-Payant pour
                        éviter les rejets. Dormez tranquille, vos dossiers sont carrés.
                    </p>
                </div>

                <!-- Argument 4: Luxe -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-gem"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Accès Marché Luxe</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        80% des magasins de prestige ont des ERP complexes. Sans formation, ces portes restent fermées.
                        Travaillez dans les plus beaux magasins.
                    </p>
                </div>

                <!-- Argument 5: IA Efficiency -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20 md:col-span-2 lg:col-span-2">
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div>
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center text-2xl mb-4">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="font-bold text-xl text-gray-900 mb-2">L'Avantage IA 2026</h3>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Utilisez l'IA de votre ERP pour automatiser l'administratif. Finissez vos journées à 18h
                                tout en ayant traité <strong class="text-oblink-blue">+20% de dossiers</strong>.
                                Travaillez moins, gagnez plus.
                            </p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-100 w-full md:w-auto">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                                <span class="text-xs font-bold text-gray-400">STATUS: OPTIMISÉ</span>
                            </div>
                            <div class="space-y-2">
                                <div class="h-2 bg-gray-100 rounded-full w-48"></div>
                                <div class="h-2 bg-gray-100 rounded-full w-32"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 1: Logiciels & ERP -->
        <div class="mb-20">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
                    <span
                        class="w-10 h-10 rounded-xl bg-oblink-blue text-white flex items-center justify-center text-lg"><i
                            class="fas fa-laptop-code"></i></span>
                    Formations Certifiantes (ERP)
                </h2>
                <span class="bg-oblink-blue/10 text-oblink-blue font-bold px-3 py-1 rounded-full text-xs animate-pulse">
                    <i class="fas fa-certificate mr-1"></i> BADGE FINAL INCLUS
                </span>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Course Card: Cosium (Premium) -->
                <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer relative">

                    <!-- Free Preview Badge -->
                    <div
                        class="absolute top-4 left-4 z-20 bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/20">
                        <i class="fas fa-eye mr-1"></i> Aperçu Gratuit (2min)
                    </div>

                    <div class="relative h-48 bg-gray-900 overflow-hidden">
                        <!-- YouTube Thumbnail Preview -->
                        <div class="absolute inset-0 flex items-center justify-center bg-gray-900">
                            <h3 class="text-white font-black text-3xl tracking-tighter">
                                COSIUM <span class="text-oblink-blue">EXPERT</span></h3>
                        </div>
                        <div
                            class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                            <i class="fas fa-clock mr-1"></i> 4h00
                        </div>
                        <div
                            class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                            <span
                                class="w-16 h-16 rounded-full bg-white text-oblink-blue flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                                <i class="fas fa-play ml-1"></i>
                            </span>
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-oblink-gray mb-1">Cosium Expert 2026</h3>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Maîtrisez l'IA, le Tiers-Payant complexe et
                            les stocks. Certification incluse.</p>
                        <ul class="text-xs text-gray-500 mb-4 space-y-1">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Badge
                                "Certifié Cosium"</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Accès
                                prioritaire jobs</li>
                        </ul>
                        <div class="flex items-center justify-between border-t border-gray-100 pt-3">
                            <span class="text-2xl font-black text-oblink-gray">99 €</span>
                            <button onclick="event.stopPropagation(); openCourseModal('cosium')"
                                class="bg-oblink-blue text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-oblink-blue/90 transition hover:shadow-lg transform hover:-translate-y-0.5 z-10 relative">
                                Détails & Programme
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Course Card: Osmose (Premium) -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer relative opacity-75 grayscale hover:grayscale-0 hover:opacity-100">
                    <div
                        class="absolute top-4 right-4 z-20 bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform rotate-3">
                        BIENTÔT
                    </div>
                    <div class="relative h-48 bg-emerald-800 overflow-hidden">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <h3 class="text-white font-black text-3xl tracking-tighter">
                                OSMOSE</h3>
                        </div>
                        <div
                            class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                            <i class="fas fa-clock mr-1"></i> 3h30
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-oblink-gray mb-1">Osmose & IA</h3>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Automatisez vos tâches avec l'assistant
                            Osmose. Le futur du métier.</p>
                        <div class="flex items-center justify-between border-t border-gray-100 pt-3">
                            <span class="text-2xl font-black text-oblink-gray">99 €</span>
                            <button
                                class="bg-gray-100 text-gray-400 px-4 py-2 rounded-lg font-bold text-sm cursor-not-allowed">
                                Liste d'attente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Expertise Clinique & Technique (Premium) -->
        <div class="mb-20">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
                    <span
                        class="w-10 h-10 rounded-xl bg-oblink-violet text-white flex items-center justify-center text-lg"><i
                            class="fas fa-microscope"></i></span>
                    Expertise Clinique (Rare)
                </h2>
                <a href="#" class="text-sm font-bold text-gray-400 hover:text-oblink-violet">Tout voir <i
                        class="fas fa-arrow-right ml-1"></i></a>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Course Card: Réfraction -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
                    <div class="relative h-48 bg-indigo-900 flex items-center justify-center overflow-hidden">
                        <i class="fas fa-eye text-6xl text-white/20 group-hover:scale-110 transition"></i>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                            <span class="bg-oblink-orange text-white text-[10px] font-bold px-2 py-1 rounded">BEST
                                SELLER</span>
                        </div>
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-oblink-gray leading-tight">Refraction Complexe : Le Cas
                                par Cas</h3>
                            <div class="flex items-center text-yellow-400 text-xs gap-1">
                                <i class="fas fa-star"></i> 4.9
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Analysez et résolvez 99% des plaintes clients
                            en examen de vue.</p>

                        <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                            <div class="flex items-center gap-2">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg"
                                    class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                                <span class="text-xs font-bold text-gray-600">Dr. Marc L.</span>
                            </div>
                            <span class="font-black text-xl text-oblink-gray">159 €</span>
                        </div>
                    </div>
                </div>

                <!-- Course Card: Contactologie -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
                    <div class="relative h-48 bg-teal-800 flex items-center justify-center overflow-hidden">
                        <i class="fas fa-dot-circle text-6xl text-white/20 group-hover:scale-110 transition"></i>
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-oblink-gray leading-tight">Adaptation Lentilles Rigides
                            </h3>
                            <div class="flex items-center text-yellow-400 text-xs gap-1">
                                <i class="fas fa-star"></i> 4.8
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Ne laissez plus partir de clients faute de
                            compétence en rigides.</p>

                        <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                            <div class="flex items-center gap-2">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                    class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                                <span class="text-xs font-bold text-gray-600">Sarah B.</span>
                            </div>
                            <span class="font-black text-xl text-oblink-gray">129 €</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA: Devenir Formateur -->
        <div
            class="bg-gradient-to-br from-oblink-gray to-gray-900 rounded-3xl p-8 md:p-16 relative overflow-hidden text-center md:text-left">
            <!-- Background Decoration -->
            <div
                class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-[100px] pointer-events-none transform translate-x-1/2 -translate-y-1/2">
            </div>

            <div class="relative z-10 grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <span
                        class="inline-block py-1 px-3 rounded-full bg-white/10 text-white font-bold text-xs mb-4 border border-white/20">
                        APPEL AUX EXPERTS
                    </span>
                    <h2 class="text-3xl md:text-4xl font-black text-white font-display mb-6">Monétisez votre expertise
                        optique</h2>
                    <ul class="space-y-4 mb-8 text-gray-300">
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Touchez <strong>70% de commission</strong> sur chaque vente.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Nous gérons le marketing et la plateforme.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Accès immédiat à +500 opticiens qualifiés.</span>
                        </li>
                    </ul>
                    <a href="mailto:partenaires@oblink.com?subject=Je veux devenir formateur"
                        class="inline-block px-8 py-4 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange hover:text-white transition shadow-lg transform hover:-translate-y-1">
                        Devenir Formateur Oblink
                    </a>
                </div>
                <div class="relative hidden md:block">
                    <!-- Simuler une carte profil formateur -->
                    <div
                        class="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl transform rotate-3 hover:rotate-0 transition duration-500">
                        <div class="flex items-center gap-4 mb-4">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                class="w-16 h-16 rounded-full border-2 border-oblink-orange">
                            <div>
                                <h4 class="text-white font-bold text-lg">Sarah B.</h4>
                                <p class="text-gray-400 text-sm">Experte Contactologie</p>
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-xl p-4 mb-2">
                            <div class="text-xs text-gray-400 uppercase font-bold mb-1">Revenus ce mois</div>
                            <div class="text-3xl font-black text-white">2 450,00 €</div>
                        </div>
                        <div class="text-xs text-center text-gray-400 mt-2 italic"> * Revenu moyen top formateur</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4"
    onclick="closeVideoModal()">
    <div class="relative w-full max-w-5xl" onclick="event.stopPropagation()">
        <button onclick="closeVideoModal()"
            class="absolute -top-12 right-0 text-white hover:text-oblink-orange transition text-2xl">
            <i class="fas fa-times"></i>
        </button>
        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
            <iframe id="videoIframe" class="absolute top-0 left-0 w-full h-full rounded-xl" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
    </div>
</div>

<script>
    function openVideoModal(videoUrl) {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = videoUrl + '?autoplay=1';
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = '';
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>
<!-- Header: La Vision Académie HUB -->
<div class="text-center mb-16 relative">
    <span
        class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
        <i class="fas fa-graduation-cap mr-2"></i>L'excellence Optique
    </span>
    <h1 class="text-4xl md:text-6xl font-black font-display text-oblink-gray mb-6">
        Académie <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
    </h1>
    <p class="text-xl text-gray-500 max-w-3xl mx-auto font-body leading-relaxed mb-12">
        De l'étudiant au professionnel aguerri. Une plateforme unique pour réussir votre diplôme et booster
        votre carrière.
    </p>

    <!-- HUB NAVIGATION CARDS -->
    <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto text-left">

        <!-- Card 1: PASS EXAMEN (New) -->
        <a href="<?php echo home_url('/pass-examen'); ?>"
            class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-orange/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
            <div
                class="absolute top-0 right-0 w-32 h-32 bg-oblink-orange/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
            </div>
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-orange to-pink-500 text-white flex items-center justify-center text-2xl shadow-lg">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <span class="bg-red-100 text-red-600 font-bold px-3 py-1 rounded-full text-xs">NOUVEAU</span>
                </div>
                <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-orange transition">Je
                    passe mon BTS</h3>
                <p class="text-gray-500 mb-6 font-medium">Annales corrigées, IA prédictive et fiches de révision
                    pour assurer votre diplôme.</p>
                <div class="flex items-center text-oblink-blue font-bold text-sm">
                    Découvrir le Pass Examen <i
                        class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                </div>
            </div>
        </a>

        <!-- Card 2: FORMATIONS PRO (Existing) -->
        <a href="#formations-logiciels"
            class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-blue/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
            <div
                class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
            </div>
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-blue to-cyan-500 text-white flex items-center justify-center text-2xl shadow-lg">
                        <i class="fas fa-laptop-medical"></i>
                    </div>
                    <span class="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded-full text-xs">PRO</span>
                </div>
                <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-blue transition">Je
                    suis Opticien</h3>
                <p class="text-gray-500 mb-6 font-medium">Maîtrisez les logiciels ERP et développez des
                    compétences cliniques rares.</p>
                <div class="flex items-center text-oblink-blue font-bold text-sm">
                    Voir les formations <i
                        class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                </div>
            </div>
        </a>
    </div>
</div>

<div id="formations-logiciels" class="pt-12"></div>


<!-- Section 1: Logiciels & ERP (Gratuit - Partenaires) -->
<div class="mb-20">
    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
        <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
            <span class="w-10 h-10 rounded-xl bg-oblink-blue text-white flex items-center justify-center text-lg"><i
                    class="fas fa-laptop-code"></i></span>
            Maîtriser les Outils (Gratuit)
        </h2>
        <span class="bg-green-100 text-green-700 font-bold px-3 py-1 rounded-full text-xs">OFFERT PAR LES
            ÉDITEURS</span>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Course Card: Cosium -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-gray-900 overflow-hidden">
                <!-- YouTube Thumbnail Preview -->
                <div class="absolute inset-0 flex items-center justify-center bg-gray-900">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        COSIUM</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 2h30
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-oblink-blue flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">Maîtriser Cosium Optic</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">De la création client à la télétransmission.
                    Le guide complet officiel.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">
                            C</div>
                        <span class="text-xs font-bold text-gray-500">Team Cosium</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>

        <!-- Course Card: Ivoirnet -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-emerald-800 overflow-hidden">
                <div class="absolute inset-0 flex items-center justify-center">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        IVOIRNET</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 1h45
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-emerald-600 flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">Ivoirnet : L'essentiel</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Gérer un magasin indépendant avec Ivoirnet.
                    Tiers-payant inclus.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs font-bold">
                            I</div>
                        <span class="text-xs font-bold text-gray-500">Team Ivoirnet</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>

        <!-- Course Card: WinOptics -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-orange-700 overflow-hidden">
                <div class="absolute inset-0 flex items-center justify-center">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        WinOptics</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 1h00
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-orange-600 flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">WinOptics Start</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Prise en main rapide pour les remplacements
                    d'été.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-xs font-bold">
                            W</div>
                        <span class="text-xs font-bold text-gray-500">Win Academy</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 2: Expertise Clinique & Technique (Premium) -->
<div class="mb-20">
    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
        <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
            <span class="w-10 h-10 rounded-xl bg-oblink-violet text-white flex items-center justify-center text-lg"><i
                    class="fas fa-microscope"></i></span>
            Expertise Clinique (Certifiant)
        </h2>
        <a href="#" class="text-sm font-bold text-gray-400 hover:text-oblink-violet">Tout voir <i
                class="fas fa-arrow-right ml-1"></i></a>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Course Card: Réfraction -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-indigo-900 flex items-center justify-center overflow-hidden">
                <i class="fas fa-eye text-6xl text-white/20 group-hover:scale-110 transition"></i>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                    <span class="bg-oblink-orange text-white text-[10px] font-bold px-2 py-1 rounded">BEST
                        SELLER</span>
                </div>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Refraction Complexe : Le Cas
                        par Cas</h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.9
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Analysez et résolvez 99% des plaintes clients
                    en examen de vue.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Dr. Marc L.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">159 €</span>
                </div>
            </div>
        </div>

        <!-- Course Card: Contactologie -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-teal-800 flex items-center justify-center overflow-hidden">
                <i class="fas fa-dot-circle text-6xl text-white/20 group-hover:scale-110 transition"></i>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Adaptation Lentilles Rigides
                    </h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.8
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Ne laissez plus partir de clients faute de
                    compétence en rigides.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Sarah B.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">129 €</span>
                </div>
            </div>
        </div>
        <!-- Course Card: Low Vision -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-gray-800 flex items-center justify-center overflow-hidden">
                <i class="fas fa-search-plus text-6xl text-white/20 group-hover:scale-110 transition"></i>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Initiation Basse Vision</h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.5
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Un marché de niche très rentable. Apprenez
                    les bases.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/men/85.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Jean V.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">89 €</span>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- CTA: Devenir Formateur -->
<div
    class="bg-gradient-to-br from-oblink-gray to-gray-900 rounded-3xl p-8 md:p-16 relative overflow-hidden text-center md:text-left">
    <!-- Background Decoration -->
    <div
        class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-[100px] pointer-events-none transform translate-x-1/2 -translate-y-1/2">
    </div>

    <div class="relative z-10 grid md:grid-cols-2 gap-12 items-center">
        <div>
            <span
                class="inline-block py-1 px-3 rounded-full bg-white/10 text-white font-bold text-xs mb-4 border border-white/20">
                APPEL AUX EXPERTS
            </span>
            <h2 class="text-3xl md:text-4xl font-black text-white font-display mb-6">Monétisez votre expertise
                optique</h2>
            <ul class="space-y-4 mb-8 text-gray-300">
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Touchez <strong>70% de commission</strong> sur chaque vente.</span>
                </li>
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Nous gérons le marketing et la plateforme.</span>
                </li>
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Accès immédiat à +500 opticiens qualifiés.</span>
                </li>
            </ul>
            <a href="mailto:partenaires@oblink.com?subject=Je veux devenir formateur"
                class="inline-block px-8 py-4 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange hover:text-white transition shadow-lg transform hover:-translate-y-1">
                Devenir Formateur Oblink
            </a>
        </div>
        <div class="relative hidden md:block">
            <!-- Simuler une carte profil formateur -->
            <div
                class="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl transform rotate-3 hover:rotate-0 transition duration-500">
                <div class="flex items-center gap-4 mb-4">
                    <img src="https://randomuser.me/api/portraits/women/44.jpg"
                        class="w-16 h-16 rounded-full border-2 border-oblink-orange">
                    <div>
                        <h4 class="text-white font-bold text-lg">Sarah B.</h4>
                        <p class="text-gray-400 text-sm">Experte Contactologie</p>
                    </div>
                </div>
                <div class="bg-black/30 rounded-xl p-4 mb-2">
                    <div class="text-xs text-gray-400 uppercase font-bold mb-1">Revenus ce mois</div>
                    <div class="text-3xl font-black text-white">2 450,00 €</div>
                </div>
                <div class="text-xs text-center text-gray-400 mt-2 italic"> * Revenu moyen top formateur</div>
            </div>
        </div>
    </div>
</div>

</div>
</div>

<!-- Video Modal -->
<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4"
    onclick="closeVideoModal()">
    <div class="relative w-full max-w-5xl" onclick="event.stopPropagation()">
        <button onclick="closeVideoModal()"
            class="absolute -top-12 right-0 text-white hover:text-oblink-orange transition text-2xl">
            <i class="fas fa-times"></i>
        </button>
        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
            <iframe id="videoIframe" class="absolute top-0 left-0 w-full h-full rounded-xl" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
    </div>
</div>

<!-- Course Detail Modal (Expert Cosium) -->
<div id="courseModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-3xl w-full max-w-4xl min-h-[50vh] relative animate-fade-in-up flex flex-col"
        onclick="event.stopPropagation()">

        <!-- Modal Header -->
        <div
            class="sticky top-0 bg-white/95 backdrop-blur z-20 border-b border-gray-100 p-6 flex justify-between items-center rounded-t-3xl">
            <div>
                <span
                    class="bg-oblink-blue/10 text-oblink-blue font-bold px-3 py-1 rounded-full text-xs mb-2 inline-block">
                    <i class="fas fa-certificate mr-1"></i> CERTIFIANT
                </span>
                <h2 class="text-2xl md:text-3xl font-black text-oblink-gray">Expert Cosium 2026</h2>
            </div>
            <button onclick="closeCourseModal()"
                class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Scrollable Content -->
        <div class="p-8 md:p-12 overflow-y-auto flex-grow">

            <!-- Intro / Why -->
            <div class="mb-12">
                <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-fire text-orange-500"></i> Pourquoi ce module est indispensable ?
                </h3>
                <p class="text-gray-600 leading-relaxed text-lg">
                    En 2026, la maîtrise superficielle de Cosium ne suffit plus. Entre la généralisation de la
                    facturation électronique et les nouvelles normes de télétransmission, une erreur de saisie peut
                    bloquer des milliers d'euros de trésorerie pour un magasin. Ce module vous apprend à devenir <span
                        class="font-bold text-oblink-gray bg-yellow-100 px-1">l'opticien que les gérants
                        s'arrachent</span> : celui qui fluidifie les ventes sans jamais générer de rejets.
                </p>
            </div>

            <!-- The Technical Program -->
            <div class="mb-12 bg-gray-50 rounded-2xl p-8 border border-gray-100">
                <h3 class="text-xl font-black text-oblink-gray mb-6 uppercase tracking-wider text-center">
                    Le Programme Technique (Expert Grade)
                </h3>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Block 1 -->
                    <div>
                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">1</span>
                            Configuration & Mesures
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2 mb-6">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Intégration colonnes prise de mesures (Activisu...)</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> Gestion
                                historique réfraction & comparatifs</li>
                        </ul>

                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">2</span>
                            Ingénierie Tiers-Payant
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> <span
                                    class="font-bold">PEC Automatisée :</span> Paramétrage conventions</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> <span
                                    class="font-bold">Anti-Rejets :</span> Méthode "Resubmission" (Noémie, LPP erronés)
                            </li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Optimisation des devis mixtes 100% Santé</li>
                        </ul>
                    </div>

                    <!-- Block 2 -->
                    <div>
                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">3</span>
                            Stock & Logistique EDI
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2 mb-6">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Réception EDI & Étiquetage auto</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Inventaire tournant sans fermer le magasin</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> Relances
                                fournisseurs automatiques</li>
                        </ul>

                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">4</span>
                            Conformité & Sécurité
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Signature électronique & RGPD</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Facturation électronique (PPF)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- EXAMEN QUIZ SECTION (New) -->
            <div class="mb-12 bg-white rounded-2xl p-8 border-2 border-oblink-blue/10 shadow-lg relative overflow-hidden"
                id="quiz-section">
                <div class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/5 rounded-full blur-2xl -mr-10 -mt-10">
                </div>

                <h3 class="text-xl font-black text-oblink-gray mb-2 flex items-center gap-2 relative z-10">
                    <i class="fas fa-vial text-oblink-blue"></i> Testez votre niveau "Expert"
                </h3>
                <p class="text-sm text-gray-500 mb-6 relative z-10">Répondez à ces 3 situations critiques pour voir si
                    vous avez besoin de cette formation.</p>

                <!-- Step 1: Start -->
                <div id="quiz-start" class="text-center py-6">
                    <button onclick="startQuiz()"
                        class="bg-oblink-gray text-white font-bold py-3 px-8 rounded-xl hover:bg-black transition transform hover:scale-105 shadow-xl ring-4 ring-oblink-gray/10">
                        <i class="fas fa-play mr-2"></i> Lancer le Test (3 min)
                    </button>
                    <p class="text-xs text-gray-400 mt-3 italic">Réservé aux opticiens diplômés</p>
                </div>

                <!-- Step 2: Questions (Hidden by default) -->
                <div id="quiz-question-container" class="hidden">
                    <div class="mb-4 flex justify-between items-center">
                        <span class="text-xs font-bold text-oblink-blue bg-blue-50 px-2 py-1 rounded">QUESTION <span
                                id="current-q-num">1</span>/3</span>
                        <div class="h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden">
                            <div id="quiz-progress-bar" class="h-full bg-oblink-blue w-1/3 transition-all duration-500">
                            </div>
                        </div>
                    </div>

                    <h4 id="question-text" class="font-bold text-lg text-gray-800 mb-6"></h4>

                    <div class="space-y-3" id="answers-container">
                        <!-- Answers injected via JS -->
                    </div>
                </div>

                <!-- Step 3: Success Result (Hidden) -->
                <div id="quiz-result-success" class="hidden text-center py-6 animate-fade-in-up">
                    <div
                        class="w-16 h-16 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-3xl mx-auto mb-4">
                        <i class="fas fa-check"></i>
                    </div>
                    <h4 class="font-black text-xl text-gray-900 mb-2">Bien joué !</h4>
                    <p class="text-sm text-gray-600 mb-6">Vous avez de bonnes bases, mais le Tiers-Payant 2026 demande
                        une précision chirurgicale. Ce module va vous rendre infaillible.</p>
                    <button onclick="scrollToCTA()" class="text-oblink-blue font-bold underline">Voir l'offre
                        spéciale</button>
                </div>

                <!-- Step 3: Fail Result (Hidden) -->
                <div id="quiz-result-fail" class="hidden text-center py-6 animate-fade-in-up">
                    <div
                        class="w-16 h-16 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-3xl mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h4 class="font-black text-xl text-gray-900 mb-2">Alerte Formation</h4>
                    <p class="text-sm text-gray-600 mb-6">Ces erreurs vous coûteraient cher en magasin réel. Il est
                        urgent de vous mettre à niveau avant de postuler.</p>
                    <button onclick="scrollToCTA()" class="text-oblink-orange font-bold underline">Profiter de la
                        formation (-30%)</button>
                </div>

            </div>

            <!-- Method & Bonus -->
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div
                    class="bg-gradient-to-br from-oblink-violet/10 to-transparent p-6 rounded-2xl border border-oblink-violet/20">
                    <h3 class="font-bold text-lg text-oblink-violet mb-4"><i class="fas fa-brain mr-2"></i> La Méthode
                        OBLINK</h3>
                    <ul class="space-y-3 text-sm text-gray-700">
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Bac à sable Cosium :</strong> Entraînez-vous sans risque.
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Quiz de Validation :</strong> 20 situations critiques à résoudre.
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Support IA 24/7 :</strong> Votre "Professeur Virtuel" dédié.
                        </li>
                    </ul>
                </div>

                <div
                    class="bg-gradient-to-br from-oblink-orange/10 to-transparent p-6 rounded-2xl border border-oblink-orange/20">
                    <h3 class="font-bold text-lg text-oblink-orange mb-4"><i class="fas fa-gift mr-2"></i> Bonus :
                        Survival Kit</h3>
                    <ul class="space-y-3 text-sm text-gray-700">
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-orange"></span>
                            Checklist "Prise de Poste" (Check-up magasin)
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-orange"></span>
                            Guide Codes LPP 2026 (Imprimable)
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Sticky CTA Mobile / Bottom -->
            <div id="modal-cta" class="text-center pt-8 border-t border-gray-100">
                <div
                    class="flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-900 text-white p-4 rounded-xl">
                    <div class="text-left">
                        <div class="text-sm text-gray-400">Investissement PRO</div>
                        <div class="text-3xl font-black">99 € <span
                                class="text-xs font-normal text-gray-500">(Déductible frais pro)</span></div>
                    </div>
                    <button
                        class="w-full md:w-auto px-8 py-4 bg-oblink-orange text-white font-bold rounded-xl hover:bg-white hover:text-oblink-orange transition transform hover:scale-105 shadow-lg">
                        🚀 M'INSCRIRE MAINTENANT
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-4">Accès immédiat • Satisfait ou Remboursé 14j</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Video Modal
    function openVideoModal(videoUrl) {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = videoUrl + '?autoplay=1';
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = '';
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }

    // Course Modal
    function openCourseModal(courseId) {
        const modal = document.getElementById('courseModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeCourseModal() {
        const modal = document.getElementById('courseModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }

    function scrollToCTA() {
        document.getElementById('modal-cta').scrollIntoView({ behavior: 'smooth' });
    }

    // --- QUIZ LOGIC (Static Expert Questions) ---
    const quizData = [
        {
            question: "Rejet Tiers-Payant 'Droits Incomplets' avec carte valide. Quelle action immédiate ?",
            answers: [
                { text: "Forcer la télétransmission", isCorrect: false },
                { text: "Vérifier code convention & dates PEC", isCorrect: true },
                { text: "Appeler la mutuelle (15 min)", isCorrect: false }
            ]
        },
        {
            question: "Écart de stock -5 montures RayBan. Le magasin est plein. Que faites-vous ?",
            answers: [
                { text: "Inventaire complet (Fermeture)", isCorrect: false },
                { text: "Inventaire partiel + Régul Vol", isCorrect: true },
                { text: "Attendre le prochain bilan", isCorrect: false }
            ]
        },
        {
            question: "Facturation 100% Santé (Classe A) bloquée. Erreur fréquente ?",
            answers: [
                { text: "Code LPP Monture ne matche pas Panier A", isCorrect: true },
                { text: "Le client n'a pas sa carte Vitale", isCorrect: false },
                { text: "Erreur serveur Cosium", isCorrect: false }
            ]
        }
    ];

    let currentQuestion = 0;
    let score = 0;

    function startQuiz() {
        document.getElementById('quiz-start').classList.add('hidden');
        document.getElementById('quiz-question-container').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = quizData[currentQuestion];
        document.getElementById('question-text').innerText = q.question;
        document.getElementById('current-q-num').innerText = currentQuestion + 1;

        // Progress bar
        const progress = ((currentQuestion + 1) / quizData.length) * 100;
        document.getElementById('quiz-progress-bar').style.width = progress + "%";

        const answersDiv = document.getElementById('answers-container');
        answersDiv.innerHTML = '';

        q.answers.forEach(ans => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition flex items-center justify-between group";
            btn.innerHTML = `
                <span class="font-medium text-gray-700 group-hover:text-oblink-blue">${ans.text}</span>
                <i class="fas fa-chevron-right text-gray-300"></i>
            `;
            btn.onclick = () => selectAnswer(ans.isCorrect);
            answersDiv.appendChild(btn);
        });
    }

    function selectAnswer(isCorrect) {
        if (isCorrect) score++;

        if (currentQuestion < quizData.length - 1) {
            currentQuestion++;
            showQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('quiz-question-container').classList.add('hidden');
        if (score >= 2) {
            document.getElementById('quiz-result-success').classList.remove('hidden');
        } else {
            document.getElementById('quiz-result-fail').classList.remove('hidden');
        }
    }

</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-devis.php ---
<?php
/*
Template Name: Devis
*/
include 'header-inc.php';
?>

<div class="max-w-[1600px] mx-auto px-4 pt-32 pb-32">
    <!-- Back Link -->
    <div class="mb-6">
        <a href="<?php echo home_url('/dashboard-opticien'); ?>"
            class="text-oblink-blue font-semibold hover:underline inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Retour au tableau de bord
        </a>
    </div>

    <div class="grid lg:grid-cols-2 gap-8 items-start">

        <!-- LEFT COLUMN: FORM -->
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 h-fit">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-oblink-gray mb-2">
                    <i class="fas fa-file-alt text-oblink-blue mr-2"></i>
                    Éditeur de <span class="text-oblink-blue">Devis</span>
                </h1>
                <p class="text-sm text-oblink-gray/70">Remplissez les champs pour générer votre devis.</p>
            </div>

            <form id="quote-form" data-validate class="space-y-6">
                <!-- Quote Info -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-info-circle text-oblink-blue mr-2"></i> Informations
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Numéro</label>
                            <input type="text" id="input-number" name="quoteNumber"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-oblink-blue outline-none text-sm"
                                value="DEV-2025-001">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date d'émission</label>
                            <input type="date" id="input-date" name="issueDate"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                                value="<?php echo date('Y-m-d'); ?>">
                        </div>
                    </div>
                </div>

                <!-- Mission Dates (New) -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-calendar-alt text-oblink-blue mr-2"></i> Période de Mission
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date de début</label>
                            <input type="date" id="input-start-date" name="startDate"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-oblink-blue outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date de fin (Optionnel)</label>
                            <input type="date" id="input-end-date" name="endDate"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm">
                        </div>
                    </div>
                </div>

                <!-- Client -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-building text-oblink-violet mr-2"></i> Client
                    </h2>
                    <div class="space-y-3">
                        <input type="text" id="input-client-name" name="toName"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Nom de l'entreprise client">
                        <input type="text" id="input-client-address" name="toAddress"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Adresse complète">
                    </div>
                </div>

                <!-- Prestations -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-list text-oblink-orange mr-2"></i> Prestations
                    </h2>
                    <div id="services-container" class="space-y-4">
                        <!-- Service Line 1 -->
                        <div class="service-line border border-gray-200 rounded-lg p-3 bg-gray-50">
                            <input type="text"
                                class="w-full mb-2 bg-transparent border-b border-gray-300 focus:border-oblink-orange outline-none text-sm font-medium service-desc"
                                placeholder="Description de la mission" value="Mission de remplacement Opticien">
                            <div class="flex gap-3">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-500">Qté (Jours)</label>
                                    <input type="number" class="w-full p-1 border rounded text-sm service-qty" value="3"
                                        min="1">
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-500">Prix Uni. HT</label>
                                    <input type="number" class="w-full p-1 border rounded text-sm service-price"
                                        value="280" min="0">
                                </div>
                                <div class="flex items-end">
                                    <button type="button"
                                        class="text-red-500 hover:bg-red-50 p-2 rounded remove-service"><i
                                            class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="add-service"
                        class="mt-3 text-sm text-oblink-blue font-bold hover:underline">
                        <i class="fas fa-plus-circle"></i> Ajouter une ligne
                    </button>
                </div>

                <!-- Frais -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4 flex items-center justify-between">
                        <span><i class="fas fa-receipt text-green-600 mr-2"></i> Note de Frais</span>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-expenses" class="sr-only peer">
                            <div
                                class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600 relative">
                            </div>
                        </label>
                    </h2>
                    <div id="expenses-section"
                        class="hidden space-y-3 bg-green-50 p-4 rounded-lg border border-green-100">
                        <input type="text" id="input-expense-desc"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Description (ex: Déplacement AR Train, Repas midi)"
                            value="Frais de déplacement">
                        <div class="flex items-center gap-2">
                            <input type="number" id="input-expense-amount"
                                class="w-32 px-3 py-2 border rounded-lg outline-none text-sm font-bold text-green-700"
                                placeholder="0.00">
                            <span class="text-sm text-green-700">€ HT</span>
                        </div>
                    </div>
                </div>

                <!-- Options d'envoi (V51) -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-paper-plane text-oblink-blue mr-2"></i> Options d'envoi
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Email du client</label>
                            <input type="email" id="input-client-email" name="clientEmail"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                                placeholder="client@exemple.com">
                            <p class="text-[10px] text-gray-400 mt-1">L'email sera pré-rempli si le client est reconnu.
                            </p>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="send-internal" name="sendInternal"
                                class="w-4 h-4 text-oblink-blue rounded border-gray-300 focus:ring-oblink-blue">
                            <label for="send-internal"
                                class="ml-2 text-sm text-gray-600 font-medium cursor-pointer">Envoyer également via la
                                messagerie interne OBLINK</label>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-3 pt-4">
                    <div class="flex gap-4">
                        <button type="submit"
                            class="flex-1 py-3 bg-oblink-orange text-white rounded-xl font-bold hover:bg-oblink-orange/90 shadow-lg shadow-orange-200 transition">
                            <i class="fas fa-save mr-2"></i>Valider & Envoyer
                        </button>
                    </div>

                    <div class="flex gap-4">
                        <a href="<?php echo home_url('/dashboard-opticien'); ?>"
                            class="flex-1 px-4 py-3 border border-gray-300 text-gray-500 text-center rounded-xl hover:bg-gray-50 transition font-semibold text-sm">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </a>
                        <!-- Convert Button -->
                        <button type="button" id="btn-convert-invoice"
                            class="flex-1 px-4 py-3 border-2 border-oblink-blue text-oblink-blue rounded-xl hover:bg-oblink-blue hover:text-white transition font-semibold text-sm">
                            <i class="fas fa-exchange-alt mr-2"></i>Transformer en Facture
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <script>
            // Handle "Transformer en Facture"
            document.getElementById('btn-convert-invoice').addEventListener('click', function () {
                // Collect Data
                const clientName = encodeURIComponent(document.getElementById('input-client-name').value);
                const clientAddress = encodeURIComponent(document.getElementById('input-client-address').value);
                // Simple redirection with basic params for MVP
                const url = `<?php echo home_url('/facture'); ?>?from=devis&client=${clientName}&address=${clientAddress}`;
                window.location.href = url;
            });
        </script>

        <!-- RIGHT COLUMN: PREVIEW (A4 Paper Style) -->
        <div class="hidden lg:block sticky top-24">
            <div class="bg-gray-800 rounded-t-xl py-2 px-4 flex justify-between items-center text-white text-xs">
                <span><i class="fas fa-eye mr-2"></i>Aperçu en direct</span>
                <span>Format A4</span>
            </div>
            <div id="pdf-preview"
                class="bg-white mx-auto shadow-2xl p-8 md:p-12 min-h-[800px] text-xs md:text-sm text-gray-800 relative font-sans"
                style="aspect-ratio: 210/297;">

                <!-- HEADER PREVIEW -->
                <div class="flex justify-between items-start mb-12">
                    <div>
                        <h2 class="text-2xl font-bold text-oblink-blue mb-1">DEVIS</h2>
                        <p class="text-gray-500 font-mono" id="preview-number">DEV-2025-001</p>
                        <p class="text-gray-400 text-[10px] mt-1">Date: <span
                                id="preview-date"><?php echo date('d/m/Y'); ?></span></p>
                        <p class="text-gray-400 text-[10px]">Période: <span id="preview-period"
                                class="font-medium text-gray-600">-</span></p>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-lg mb-1">OPTICIEN FREELANCE</div>
                        <div class="text-gray-500 text-xs">
                            Sarah Dubois<br>
                            123 rue de la République<br>
                            75001 Paris<br>
                            SIRET: 123 456 789 00012
                        </div>
                    </div>
                </div>

                <!-- CLIENT PREVIEW -->
                <div class="mb-12 bg-gray-50 p-4 rounded-lg border border-gray-100 w-1/2 ml-auto">
                    <p class="text-[10px] uppercase text-gray-400 font-bold mb-1">Client</p>
                    <p class="font-bold text-lg text-gray-800" id="preview-client-name">Nom du Client</p>
                    <p class="text-gray-500" id="preview-client-address">Adresse du client...</p>
                </div>

                <!-- TABLE PREVIEW -->
                <table class="w-full mb-8">
                    <thead class="bg-oblink-blue text-white">
                        <tr>
                            <th class="py-2 px-3 text-left rounded-l-md">Description</th>
                            <th class="py-2 px-3 text-right">Qté</th>
                            <th class="py-2 px-3 text-right">Prix Uni.</th>
                            <th class="py-2 px-3 text-right rounded-r-md">Total HT</th>
                        </tr>
                    </thead>
                    <tbody id="preview-lines" class="text-gray-600">
                        <!-- Lines injected via JS -->
                    </tbody>
                    <!-- Expenses Line -->
                    <tbody id="preview-expenses" class="hidden text-green-700 bg-green-50/50">
                        <tr>
                            <td class="py-3 px-3 border-b border-green-100 flex items-center">
                                <i class="fas fa-receipt mr-2 text-xs"></i> <span id="preview-expense-desc">Frais</span>
                            </td>
                            <td class="py-3 px-3 text-right border-b border-green-100">1</td>
                            <td class="py-3 px-3 text-right border-b border-green-100" id="preview-expense-price">0.00 €
                            </td>
                            <td class="py-3 px-3 text-right border-b border-green-100 font-bold"
                                id="preview-expense-total">0.00 €</td>
                        </tr>
                    </tbody>
                </table>

                <!-- TOTALS PREVIEW -->
                <div class="flex justify-end">
                    <div class="w-1/2 space-y-2">
                        <div class="flex justify-between border-b pb-1">
                            <span>Total HT</span>
                            <span class="font-bold" id="preview-total-ht">0,00 €</span>
                        </div>
                        <div class="flex justify-between border-b pb-1 text-gray-400">
                            <span>TVA (0%)</span>
                            <span>0,00 €</span>
                        </div>
                        <div class="flex justify-between pt-1 text-lg font-bold text-oblink-orange">
                            <span>Net à payer</span>
                            <span id="preview-total-ttc">0,00 €</span>
                        </div>
                        <p class="text-[9px] text-gray-400 text-right mt-2">
                            TVA non applicable, art. 293 B du CGI (Franchise en base).
                        </p>
                    </div>
                </div>

                <!-- FOOTER PREVIEW -->
                <div class="absolute bottom-12 left-12 right-12 text-center border-t pt-4 text-[10px] text-gray-400">
                    Conditions de règlement : Paiement à réception de facture. <br>
                    En cas de retard, indemnité forfaitaire de 40€ pour frais de recouvrement.
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        // --- 1. SYNC FUNCTIONS ---
        function updatePreview() {
            // Update Basic Info
            document.getElementById('preview-number').textContent = document.getElementById('input-number').value || 'DEV-XXX';

            const dateVal = document.getElementById('input-date').value;
            if (dateVal) {
                const [y, m, d] = dateVal.split('-');
                document.getElementById('preview-date').textContent = `${d}/${m}/${y}`;
            }

            document.getElementById('preview-client-name').textContent = document.getElementById('input-client-name').value || 'Nom du Client';
            document.getElementById('preview-client-address').textContent = document.getElementById('input-client-address').value || '...';

            // Update Period
            const startRaw = document.getElementById('input-start-date').value;
            const endRaw = document.getElementById('input-end-date').value;
            if (startRaw) {
                const [sy, sm, sd] = startRaw.split('-');
                let periodStr = `Du ${sd}/${sm}/${sy}`;
                if (endRaw) {
                    const [ey, em, ed] = endRaw.split('-');
                    periodStr += ` au ${ed}/${em}/${ey}`;
                }
                document.getElementById('preview-period').textContent = periodStr;
            } else {
                document.getElementById('preview-period').textContent = '-';
            }

            // Lines
            const tbody = document.getElementById('preview-lines');
            tbody.innerHTML = '';
            let total = 0;

            // Service Lines
            document.querySelectorAll('.service-line').forEach(line => {
                const desc = line.querySelector('.service-desc').value;
                const qty = parseFloat(line.querySelector('.service-qty').value) || 0;
                const price = parseFloat(line.querySelector('.service-price').value) || 0;
                const lineTotal = qty * price;
                total += lineTotal;

                if (desc || lineTotal > 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="py-2 px-3 border-b border-gray-50">${desc}</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50">${qty}</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50">${price.toFixed(2)} €</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50 font-medium">${lineTotal.toFixed(2)} €</td>
                    `;
                    tbody.appendChild(tr);
                }
            });

            // Expense Line
            const hasExpense = document.getElementById('toggle-expenses').checked;
            const expenseSection = document.getElementById('preview-expenses');
            if (hasExpense) {
                const expenseDesc = document.getElementById('input-expense-desc').value;
                const expenseAmount = parseFloat(document.getElementById('input-expense-amount').value) || 0;

                document.getElementById('preview-expense-desc').textContent = expenseDesc;
                document.getElementById('preview-expense-price').textContent = expenseAmount.toFixed(2) + ' €';
                document.getElementById('preview-expense-total').textContent = expenseAmount.toFixed(2) + ' €';

                expenseSection.classList.remove('hidden');
                total += expenseAmount;
            } else {
                expenseSection.classList.add('hidden');
            }

            // Totals
            document.getElementById('preview-total-ht').textContent = total.toFixed(2).replace('.', ',') + ' €';
            document.getElementById('preview-total-ttc').textContent = total.toFixed(2).replace('.', ',') + ' €';
        }

        // --- 2. EVENTS ---

        // Live Update on Input
        document.getElementById('quote-form').addEventListener('input', updatePreview);

        // Toggle Expenses
        document.getElementById('toggle-expenses').addEventListener('change', function () {
            const section = document.getElementById('expenses-section');
            if (this.checked) {
                section.classList.remove('hidden');
            } else {
                section.classList.add('hidden');
            }
            updatePreview();
        });

        // Add Service
        document.getElementById('add-service').addEventListener('click', function () {
            const container = document.getElementById('services-container');
            const template = container.querySelector('.service-line').cloneNode(true);
            template.querySelector('.service-desc').value = '';
            template.querySelector('.service-qty').value = 1;
            template.querySelector('.service-price').value = 0;

            // Re-attach delete event
            template.querySelector('.remove-service').addEventListener('click', function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    updatePreview();
                }
            });

            container.appendChild(template);
            updatePreview();
        });

        // Remove Service (Initial)
        document.querySelectorAll('.remove-service').forEach(btn => {
            btn.addEventListener('click', function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    updatePreview();
                }
            });
        });

        // Initialize
        updatePreview();

        // Submit Mock
        document.getElementById('quote-form').addEventListener('submit', function (e) {
            e.preventDefault();
            alert('Devis enregistré et prêt à être envoyé !');
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/js/header-auth.js ---
/**
 * OBLINK - Header Auth Dynamic
 * Makes the header react to Supabase authentication state
 */

document.addEventListener('DOMContentLoaded', async function () {
    const headerAuthActions = document.getElementById('header-auth-actions');

    if (!headerAuthActions) {
        console.warn('[Header Auth] Header auth actions container not found');
        return;
    }

    // Wait for Supabase to be ready
    if (!window.oblinkSupabase) {
        console.warn('[Header Auth] Supabase not loaded yet');
        return;
    }

    try {
        // Get current session
        const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

        if (error) {
            console.error('[Header Auth] Error getting session:', error);
            return;
        }

        if (session) {
            // USER IS LOGGED IN
            const user = session.user;
            const userType = user.user_metadata?.user_type;
            const firstName = user.user_metadata?.first_name || 'Utilisateur';
            const companyName = user.user_metadata?.company_name || 'Entreprise';

            // Determine dashboard URL (using window.location.origin)
            const baseUrl = window.location.origin;
            let dashboardPath = '/dashboard';
            let displayName = firstName;

            if (userType === 'opticien') {
                dashboardPath = '/dashboard-opticien';
                displayName = firstName;
            } else if (userType === 'entreprise') {
                dashboardPath = '/dashboard-entreprise';
                displayName = companyName;
            }

            const dashboardUrl = baseUrl + dashboardPath;

            console.log('[Header Auth] User type:', userType, 'Dashboard URL:', dashboardUrl);

            // Replace header content with logged-in state
            headerAuthActions.innerHTML = `
                <a href="${dashboardUrl}" 
                   class="px-4 py-2.5 bg-oblink-orange/10 text-oblink-orange rounded-lg font-bold hover:bg-oblink-orange hover:text-white transition flex items-center gap-2">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Mon Espace</span>
                </a>
                <button id="logout-btn"
                    class="px-5 py-2.5 bg-gray-100 text-oblink-gray rounded-lg font-bold hover:bg-gray-200 transition">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Déconnexion
                </button>
            `;

            // Logout handler
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        await window.oblinkSupabase.auth.signOut();
                        window.location.href = baseUrl + '/';
                    } catch (err) {
                        console.error('[Header Auth] Logout error:', err);
                        alert('Erreur lors de la déconnexion');
                    }
                });
            }

        } else {
            // USER IS NOT LOGGED IN - Keep default HTML (already in header-inc.php)
            console.log('[Header Auth] User not logged in, showing default state');
        }

    } catch (err) {
        console.error('[Header Auth] Unexpected error:', err);
    }
});
--- FILE: theme/js/supabase-config.js ---
// OBLINK - Supabase Configuration
// Handles initialization of the Supabase Client

// OBLINK - Supabase Configuration
// Handles initialization of the Supabase Client

// 1. Initialize Client IMMEDIATELY (Global Scope)
// This ensures window.oblinkSupabase is available before other scripts' DOMContentLoaded events fire.
if (typeof supabase === 'undefined') {
    console.error('Supabase SDK not loaded');
} else {
    const sbUrl = oblink_vars.supabase_url;
    const sbKey = oblink_vars.supabase_key;

    console.log('Supabase Init:', { url: sbUrl, keyLength: sbKey?.length });

    try {
        window.oblinkSupabase = supabase.createClient(sbUrl, sbKey);
        console.log("Supabase Client Initialized Successfully (Global)");
    } catch (err) {
        console.error("Supabase createClient Failed:", err);
    }
}

document.addEventListener('DOMContentLoaded', function () {
    // UI AUTH STATE MANAGEMENT
    // Check session on load
    updateAuthUI();

    // Listen for auth changes
    if (window.oblinkSupabase && window.oblinkSupabase.auth) {
        window.oblinkSupabase.auth.onAuthStateChange((event, session) => {
            console.log("Auth Event:", event);
            updateAuthUI(session);

            if (event === 'SIGNED_OUT') {
                // Optional: Redirect
            }
        });
    } else {
        console.error("Supabase Auth not available - Check Keys");
    }
});

async function updateAuthUI(session = null) {
    if (!window.oblinkSupabase || !window.oblinkSupabase.auth) return;

    try {
        if (!session) {
            const { data } = await window.oblinkSupabase.auth.getSession();
            session = data?.session;
        }
    } catch (err) {
        console.error("Error getting session:", err);
    }

    const authContainer = document.getElementById('header-auth-actions');
    const mobileAuthContainer = document.getElementById('mobile-auth-actions');

    if (session) {
        // USER LOGGED IN
        const user = session.user;
        const displayName = user.user_metadata.full_name || user.email;
        const initial = displayName.charAt(0).toUpperCase();

        // Determine Dashboard URL based on User Type
        const userType = user.user_metadata.user_type;
        const dashboardSlug = userType === 'entreprise' ? '/dashboard-entreprise' : '/dashboard-opticien';
        const dashboardUrl = (oblink_vars.home_url || '') + dashboardSlug;

        const html = `
            <a href="${dashboardUrl}" class="flex items-center space-x-2 text-sm font-semibold text-oblink-gray hover:text-oblink-orange">
                <div class="w-8 h-8 rounded-full bg-oblink-orange text-white flex items-center justify-center font-bold">
                    ${initial}
                </div>
                <span>Mon Espace</span>
            </a>
            <button onclick="oblinkSignOut()" class="text-xs text-gray-400 hover:text-red-500 ml-2">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        `;

        if (authContainer) authContainer.innerHTML = html;
        if (mobileAuthContainer) mobileAuthContainer.innerHTML = html; // Simplify for mobile for now
    } else {
        // USER LOGGED OUT
        const html = `
            <a href="/login" class="text-sm font-semibold text-oblink-gray hover:text-oblink-orange">Connexion</a>
            <a href="/inscription-opticien" class="px-5 py-2.5 bg-oblink-orange text-white rounded-lg font-bold shadow hover:bg-oblink-orange/90 transition transform hover:-translate-y-0.5">S'inscrire</a>
        `;

        if (authContainer) authContainer.innerHTML = html;
        if (mobileAuthContainer) mobileAuthContainer.innerHTML = html;
    }
}

async function oblinkSignOut() {
    const { error } = await window.oblinkSupabase.auth.signOut();
    if (!error) {
        window.location.href = '/login';
    } else {
        alert('Erreur déconnexion: ' + error.message);
    }
}
--- FILE: theme/js/address-autocomplete.js ---
/**
 * OBLINK - Address Autocomplete Helper
 * Using French Government API: https://adresse.data.gouv.fr
 */

class AddressAutocomplete {
    constructor(inputId, options = {}) {
        this.input = document.getElementById(inputId);
        if (!this.input) {
            console.error(`[AddressAutocomplete] Input #${inputId} not found`);
            return;
        }

        this.options = {
            minChars: 3,
            debounceDelay: 300,
            limit: 5,
            onSelect: options.onSelect || (() => { }),
            ...options
        };

        this.suggestionsList = null;
        this.debounceTimer = null;
        this.selectedIndex = -1;

        this.init();
    }

    init() {
        // Create suggestions dropdown
        this.createSuggestionsUI();

        // Attach event listeners
        this.input.addEventListener('input', (e) => this.handleInput(e));
        this.input.addEventListener('keydown', (e) => this.handleKeyboard(e));
        this.input.addEventListener('blur', () => {
            setTimeout(() => this.hideSuggestions(), 200);
        });

        console.log('[AddressAutocomplete] Initialized for', this.input.id);
    }

    createSuggestionsUI() {
        // Create container
        this.suggestionsList = document.createElement('ul');
        this.suggestionsList.id = `${this.input.id}-suggestions`;
        this.suggestionsList.className = 'address-suggestions';
        this.suggestionsList.style.cssText = `
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: none;
            margin: 0;
            padding: 0;
            list-style: none;
        `;

        // Make input container relative
        this.input.parentElement.style.position = 'relative';
        this.input.parentElement.appendChild(this.suggestionsList);
    }

    handleInput(e) {
        const query = e.target.value.trim();

        if (query.length < this.options.minChars) {
            this.hideSuggestions();
            return;
        }

        // Debounce API calls
        clearTimeout(this.debounceTimer);
        this.debounceTimer = setTimeout(() => {
            this.searchAddresses(query);
        }, this.options.debounceDelay);
    }

    async searchAddresses(query) {
        try {
            const url = `https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(query)}&limit=${this.options.limit}`;
            const response = await fetch(url);
            const data = await response.json();

            if (data.features && data.features.length > 0) {
                this.displaySuggestions(data.features);
            } else {
                this.hideSuggestions();
            }
        } catch (error) {
            console.error('[AddressAutocomplete] Error fetching addresses:', error);
            this.hideSuggestions();
        }
    }

    displaySuggestions(features) {
        this.suggestionsList.innerHTML = '';
        this.selectedIndex = -1;

        features.forEach((feature, index) => {
            const li = document.createElement('li');
            li.className = 'address-suggestion-item';
            li.dataset.index = index;
            li.style.cssText = `
                padding: 0.75rem 1rem;
                cursor: pointer;
                border-bottom: 1px solid #f3f4f6;
                transition: background-color 0.15s;
            `;

            const props = feature.properties;
            li.innerHTML = `
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                    ${props.name || props.label}
                </div>
                <div style="font-size: 0.875rem; color: #6b7280;">
                    ${props.postcode} ${props.city} ${props.context ? '· ' + props.context : ''}
                </div>
            `;

            li.addEventListener('mouseenter', () => {
                this.selectSuggestion(index);
            });

            li.addEventListener('click', () => {
                this.applySuggestion(feature);
            });

            this.suggestionsList.appendChild(li);
        });

        this.suggestionsList.style.display = 'block';
    }

    selectSuggestion(index) {
        // Remove previous selection
        const items = this.suggestionsList.querySelectorAll('.address-suggestion-item');
        items.forEach(item => {
            item.style.backgroundColor = '';
        });

        // Apply new selection
        if (items[index]) {
            items[index].style.backgroundColor = '#f3f4f6';
            this.selectedIndex = index;
        }
    }

    handleKeyboard(e) {
        const items = this.suggestionsList.querySelectorAll('.address-suggestion-item');

        if (items.length === 0) return;

        switch (e.key) {
            case 'ArrowDown':
                e.preventDefault();
                this.selectedIndex = Math.min(this.selectedIndex + 1, items.length - 1);
                this.selectSuggestion(this.selectedIndex);
                break;

            case 'ArrowUp':
                e.preventDefault();
                this.selectedIndex = Math.max(this.selectedIndex - 1, 0);
                this.selectSuggestion(this.selectedIndex);
                break;

            case 'Enter':
                e.preventDefault();
                if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
                    items[this.selectedIndex].click();
                }
                break;

            case 'Escape':
                this.hideSuggestions();
                break;
        }
    }

    applySuggestion(feature) {
        const props = feature.properties;

        // Fill input
        this.input.value = props.label;

        // Call callback with address data
        this.options.onSelect({
            label: props.label,
            name: props.name,
            street: props.street,
            postcode: props.postcode,
            city: props.city,
            context: props.context,
            coordinates: {
                lat: props.y,
                lng: props.x
            }
        });

        this.hideSuggestions();
    }

    hideSuggestions() {
        this.suggestionsList.style.display = 'none';
        this.selectedIndex = -1;
    }

    destroy() {
        if (this.suggestionsList) {
            this.suggestionsList.remove();
        }
    }
}

/**
 * Get user's current location
 */
async function getCurrentLocation() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            reject(new Error('Géolocalisation non supportée par votre navigateur'));
            return;
        }

        navigator.geolocation.getCurrentPosition(
            position => resolve({
                lat: position.coords.latitude,
                lng: position.coords.longitude
            }),
            error => {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        reject(new Error('Permission de géolocalisation refusée'));
                        break;
                    case error.POSITION_UNAVAILABLE:
                        reject(new Error('Position indisponible'));
                        break;
                    case error.TIMEOUT:
                        reject(new Error('Timeout de géolocalisation'));
                        break;
                    default:
                        reject(new Error('Erreur de géolocalisation'));
                }
            },
            {
                timeout: 10000,
                enableHighAccuracy: true
            }
        );
    });
}

/**
 * Reverse geocode (coordinates -> address)
 */
async function reverseGeocode(lat, lng) {
    try {
        const url = `https://api-adresse.data.gouv.fr/reverse/?lon=${lng}&lat=${lat}`;
        const response = await fetch(url);
        const data = await response.json();

        if (data.features && data.features.length > 0) {
            const props = data.features[0].properties;
            return {
                label: props.label,
                name: props.name,
                street: props.street,
                postcode: props.postcode,
                city: props.city,
                context: props.context,
                coordinates: { lat, lng }
            };
        }

        throw new Error('Aucune adresse trouvée');
    } catch (error) {
        console.error('[reverseGeocode] Error:', error);
        throw error;
    }
}

/**
 * Add geolocation button to input
 */
function addGeolocationButton(inputId, onSuccess) {
    const input = document.getElementById(inputId);
    if (!input) return;

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'geolocation-btn';
    button.innerHTML = '<i class="fas fa-location-arrow"></i>';
    button.style.cssText = `
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        color: white;
        border: none;
        border-radius: 0.5rem;
        width: 2.5rem;
        height: 2.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(255, 107, 53, 0.2);
    `;

    button.addEventListener('mouseenter', () => {
        button.style.transform = 'translateY(-50%) scale(1.05)';
        button.style.boxShadow = '0 4px 8px rgba(255, 107, 53, 0.3)';
    });

    button.addEventListener('mouseleave', () => {
        button.style.transform = 'translateY(-50%) scale(1)';
        button.style.boxShadow = '0 2px 4px rgba(255, 107, 53, 0.2)';
    });

    button.addEventListener('click', async () => {
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        button.disabled = true;

        try {
            const { lat, lng } = await getCurrentLocation();
            const address = await reverseGeocode(lat, lng);

            input.value = address.label;
            if (onSuccess) onSuccess(address);

            button.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-location-arrow"></i>';
                button.disabled = false;
            }, 2000);
        } catch (error) {
            alert('❌ ' + error.message);
            button.innerHTML = '<i class="fas fa-location-arrow"></i>';
            button.disabled = false;
        }
    });

    input.parentElement.style.position = 'relative';
    input.parentElement.appendChild(button);
}

// Export for global use
window.AddressAutocomplete = AddressAutocomplete;
window.getCurrentLocation = getCurrentLocation;
window.reverseGeocode = reverseGeocode;
window.addGeolocationButton = addGeolocationButton;
--- FILE: theme/js/app.js ---
// OBLINK Advanced Frontend JavaScript

document.addEventListener('DOMContentLoaded', function () {
  console.log('🚀 OBLINK Glassmorphism v3.1 with Blog initialized');

  // ===== BLOG FILTERS =====
  const filterButtons = document.querySelectorAll('.filter-btn');
  const articleCards = document.querySelectorAll('.article-card');

  if (filterButtons.length > 0) {
    filterButtons.forEach(button => {
      button.addEventListener('click', function () {
        const category = this.getAttribute('data-category');

        // Update active button
        filterButtons.forEach(btn => {
          btn.classList.remove('active');
          btn.classList.remove('bg-gradient-to-r', 'from-oblink-orange', 'to-oblink-violet', 'text-white');
          btn.classList.add('bg-white/60', 'backdrop-blur-xl', 'border', 'border-white/40', 'text-oblink-gray');
        });

        this.classList.add('active');
        this.classList.remove('bg-white/60', 'backdrop-blur-xl', 'border', 'border-white/40', 'text-oblink-gray');
        this.classList.add('bg-gradient-to-r', 'from-oblink-orange', 'to-oblink-violet', 'text-white');

        // Filter articles
        articleCards.forEach(card => {
          const cardCategory = card.getAttribute('data-category');

          if (category === 'all' || cardCategory === category) {
            card.style.display = 'block';
            setTimeout(() => {
              card.style.opacity = '1';
              card.style.transform = 'scale(1)';
            }, 50);
          } else {
            card.style.opacity = '0';
            card.style.transform = 'scale(0.95)';
            setTimeout(() => {
              card.style.display = 'none';
            }, 300);
          }
        });
      });
    });
  }

  // ===== 3D CAROUSEL =====
  const carousel = document.getElementById('processCarousel');
  const prevBtn = document.getElementById('carousel-prev');
  const nextBtn = document.getElementById('carousel-next');
  const indicators = document.querySelectorAll('.carousel-indicator');
  const items = document.querySelectorAll('.carousel-3d-item');

  let currentIndex = 0;
  let autoRotateInterval;
  const totalItems = items.length || 3;

  function updateCarousel() {
    items.forEach((item, index) => {
      item.classList.remove('active', 'prev', 'next');

      if (index === currentIndex) {
        item.classList.add('active');
      } else if (index === (currentIndex - 1 + totalItems) % totalItems) {
        item.classList.add('prev');
      } else if (index === (currentIndex + 1) % totalItems) {
        item.classList.add('next');
      }
    });

    // Update indicators
    indicators.forEach((indicator, index) => {
      if (index === currentIndex) {
        indicator.classList.add('active');
      } else {
        indicator.classList.remove('active');
      }
    });
  }

  function nextSlide() {
    currentIndex = (currentIndex + 1) % totalItems;
    updateCarousel();
  }

  function prevSlide() {
    currentIndex = (currentIndex - 1 + totalItems) % totalItems;
    updateCarousel();
  }

  function goToSlide(index) {
    currentIndex = index;
    updateCarousel();
  }

  // Event listeners
  if (nextBtn && prevBtn) {
    nextBtn.addEventListener('click', () => {
      nextSlide();
      resetAutoRotate();
    });

    prevBtn.addEventListener('click', () => {
      prevSlide();
      resetAutoRotate();
    });
  }

  // Indicator clicks
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      goToSlide(index);
      resetAutoRotate();
    });
  });

  // Auto rotate
  function startAutoRotate() {
    autoRotateInterval = setInterval(nextSlide, 8000); // Increased from 5s to 8s for better readability
  }

  function stopAutoRotate() {
    if (autoRotateInterval) {
      clearInterval(autoRotateInterval);
    }
  }

  function resetAutoRotate() {
    stopAutoRotate();
    startAutoRotate();
  }

  // Start auto-rotation when carousel is visible
  const carouselObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        startAutoRotate();
      } else {
        stopAutoRotate();
      }
    });
  }, { threshold: 0.5 });

  if (carousel) {
    carouselObserver.observe(carousel);
  }

  // Pause on hover
  if (carousel) {
    carousel.addEventListener('mouseenter', stopAutoRotate);
    carousel.addEventListener('mouseleave', startAutoRotate);
  }

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      prevSlide();
      resetAutoRotate();
    } else if (e.key === 'ArrowRight') {
      nextSlide();
      resetAutoRotate();
    }
  });

  // Touch/Swipe support
  let touchStartX = 0;
  let touchEndX = 0;

  if (carousel) {
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });
  }

  function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;

    if (Math.abs(diff) > swipeThreshold) {
      if (diff > 0) {
        // Swipe left - next
        nextSlide();
      } else {
        // Swipe right - prev
        prevSlide();
      }
      resetAutoRotate();
    }
  }

  // ===== MOBILE MENU =====
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', function () {
      mobileMenu.classList.toggle('hidden');
      const icon = this.querySelector('i');
      if (mobileMenu.classList.contains('hidden')) {
        icon.className = 'fas fa-bars text-2xl';
      } else {
        icon.className = 'fas fa-times text-2xl';
      }
    });
  }

  // ===== SMOOTH SCROLL =====
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        const navHeight = document.querySelector('nav').offsetHeight;
        const targetPosition = target.offsetTop - navHeight;

        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });

        // Close mobile menu if open
        if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
          mobileMenu.classList.add('hidden');
          const icon = mobileMenuButton.querySelector('i');
          icon.className = 'fas fa-bars text-2xl';
        }
      }
    });
  });

  // ===== LIQUID GLASS PARTICLES =====
  function createParticles(containerId, count = 20) {
    const container = document.getElementById(containerId);
    if (!container) return;

    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.top = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 15 + 's';
      particle.style.animationDuration = (10 + Math.random() * 10) + 's';
      container.appendChild(particle);
    }
  }

  // Create particles for testimonials section
  createParticles('particles-testimonials', 15);

  // ===== LIQUID GLASS CARD ANIMATIONS =====
  const liquidCards = document.querySelectorAll('.service-card-liquid, .testimonial-card-liquid');
  liquidCards.forEach((card, index) => {
    const delay = card.getAttribute('data-delay') || (index * 0.1);
    card.style.opacity = '0';
    card.style.transform = 'translateY(30px)';
    card.style.transition = `all 0.6s cubic-bezier(0.4, 0, 0.2, 1) ${delay}s`;
  });

  // ===== INTERSECTION OBSERVER FOR ANIMATIONS =====
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const fadeInObserver = new IntersectionObserver(function (entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
        fadeInObserver.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe liquid cards
  liquidCards.forEach(card => fadeInObserver.observe(card));

  // Observe sections for fade-in
  document.querySelectorAll('section').forEach(section => {
    fadeInObserver.observe(section);
  });

  // ===== ANIMATED COUNTERS =====
  const counterObserver = new IntersectionObserver(function (entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const counter = entry.target;
        // Parse target, handling both string '8.3' and numbers
        const targetAttr = counter.getAttribute('data-target');
        const target = parseFloat(targetAttr);

        // Determine if we need decimal formatting based on the input string or value
        // If data-target is "8.3", isDecimal is true. If "13300", false.
        const isDecimal = targetAttr.includes('.') || target % 1 !== 0;

        // Reset text content to 0 before starting (in case it wasn't)
        counter.textContent = isDecimal ? "0,0" : "0";

        console.log(`Starting counter animation for ${targetAttr}`);

        animateCounter(counter, 0, target, 2500, isDecimal);
        counterObserver.unobserve(counter);
      }
    });
  }, { threshold: 0.5 }); // Increased threshold to ensure visibility

  document.querySelectorAll('.counter').forEach(counter => {
    counterObserver.observe(counter);
  });

  function animateCounter(element, start, end, duration, isDecimal) {
    let startTimestamp = null;
    const step = (timestamp) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);

      // Easing function (easeOutExpo) for smoother animation
      // 1 - Math.pow(2, -10 * progress)
      const easeProgress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);

      const current = start + (easeProgress * (end - start));

      if (isDecimal) {
        element.textContent = current.toFixed(1).replace('.', ',');
      } else {
        element.textContent = Math.round(current).toLocaleString('fr-FR');
      }

      if (progress < 1) {
        window.requestAnimationFrame(step);
      } else {
        // Ensure final value is exact
        if (isDecimal) {
          element.textContent = end.toFixed(1).replace('.', ',');
        } else {
          element.textContent = Math.round(end).toLocaleString('fr-FR');
        }
      }
    };
    window.requestAnimationFrame(step);
  }

  // ===== PARALLAX EFFECT =====
  let ticking = false;

  function updateParallax() {
    const scrolled = window.pageYOffset;
    const hero = document.getElementById('hero');

    if (hero && scrolled < window.innerHeight) {
      const shapes = hero.querySelectorAll('.floating-shape');
      shapes.forEach((shape, index) => {
        const speed = 0.5 + (index * 0.1);
        const yPos = scrolled * speed;
        shape.style.transform = `translate3d(0, ${yPos}px, 0)`;
      });
    }

    ticking = false;
  }

  window.addEventListener('scroll', function () {
    if (!ticking) {
      window.requestAnimationFrame(updateParallax);
      ticking = true;
    }
  });

  // ===== NAVBAR SHADOW ON SCROLL =====
  const navbar = document.getElementById('navbar');

  window.addEventListener('scroll', function () {
    if (window.scrollY > 50) {
      navbar.classList.add('shadow-lg');
      navbar.style.background = 'rgba(255, 255, 255, 0.98)';
    } else {
      navbar.classList.remove('shadow-lg');
      navbar.style.background = 'rgba(255, 255, 255, 0.95)';
    }
  });

  // ===== CTA CARD HOVER EFFECT =====
  const ctaCards = document.querySelectorAll('.cta-card');

  ctaCards.forEach(card => {
    card.addEventListener('mouseenter', function () {
      this.style.transform = 'scale(1.02)';
    });

    card.addEventListener('mouseleave', function () {
      this.style.transform = 'scale(1)';
    });
  });

  // ===== MOUSE TRAIL EFFECT =====
  let mouseX = 0;
  let mouseY = 0;
  let cursorDot, cursorOutline;

  function createCursor() {
    cursorDot = document.createElement('div');
    cursorDot.style.cssText = `
      width: 8px;
      height: 8px;
      background: #FF6600;
      border-radius: 50%;
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      transition: transform 0.1s;
      display: none;
    `;

    cursorOutline = document.createElement('div');
    cursorOutline.style.cssText = `
      width: 32px;
      height: 32px;
      border: 2px solid rgba(255, 102, 0, 0.3);
      border-radius: 50%;
      position: fixed;
      pointer-events: none;
      z-index: 9998;
      transition: all 0.15s ease;
      display: none;
    `;

    document.body.appendChild(cursorDot);
    document.body.appendChild(cursorOutline);

    // Only show on desktop
    if (window.innerWidth > 768) {
      cursorDot.style.display = 'block';
      cursorOutline.style.display = 'block';
    }
  }

  createCursor();

  document.addEventListener('mousemove', function (e) {
    mouseX = e.clientX;
    mouseY = e.clientY;

    if (cursorDot && cursorOutline) {
      cursorDot.style.left = mouseX - 4 + 'px';
      cursorDot.style.top = mouseY - 4 + 'px';

      cursorOutline.style.left = mouseX - 16 + 'px';
      cursorOutline.style.top = mouseY - 16 + 'px';
    }
  });

  // Cursor hover effect on clickable elements
  const clickables = document.querySelectorAll('a, button, .cta-card');
  clickables.forEach(el => {
    el.addEventListener('mouseenter', () => {
      if (cursorOutline) {
        cursorOutline.style.transform = 'scale(1.5)';
        cursorOutline.style.borderColor = 'rgba(255, 102, 0, 0.5)';
      }
    });

    el.addEventListener('mouseleave', () => {
      if (cursorOutline) {
        cursorOutline.style.transform = 'scale(1)';
        cursorOutline.style.borderColor = 'rgba(255, 102, 0, 0.3)';
      }
    });
  });

  // ===== FORM VALIDATION =====
  const forms = document.querySelectorAll('form[data-validate]');
  forms.forEach(form => {
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      let isValid = true;
      const requiredFields = form.querySelectorAll('[required]');

      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          isValid = false;
          field.classList.add('border-red-500');
          field.classList.add('shake');
          setTimeout(() => field.classList.remove('shake'), 500);
        } else {
          field.classList.remove('border-red-500');
        }
      });

      if (isValid) {
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Envoi en cours...';
        }

        setTimeout(() => {
          showNotification('Formulaire envoyé avec succès !', 'success');
          form.reset();
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Envoyer';
          }
        }, 1500);
      } else {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
      }
    });
  });

  // ===== NOTIFICATION SYSTEM =====
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';

    notification.className = `fixed top-24 right-4 ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
    notification.innerHTML = `
      <div class="flex items-center">
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-3"></i>
        <span>${message}</span>
      </div>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.transform = 'translateX(0)';
    }, 100);

    setTimeout(() => {
      notification.style.transform = 'translateX(calc(100% + 2rem))';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  // ===== CTA TRACKING =====
  const ctaButtons = document.querySelectorAll('a[href*="register"], a[href*="inscription"], a[href*="opticiens"], a[href*="entreprises"]');
  ctaButtons.forEach(btn => {
    btn.addEventListener('click', function (e) {
      const action = this.href.includes('opticien') ? 'Opticien CTA' : 'Entreprise CTA';
      console.log('📊 CTA clicked:', action, this.href);
      // Here you would send to analytics
      // gtag('event', 'cta_click', { action: action });
    });
  });

  // ===== LAZY LOADING IMAGES =====
  if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove('lazy');
          imageObserver.unobserve(img);
        }
      });
    });

    document.querySelectorAll('img.lazy').forEach(img => {
      imageObserver.observe(img);
    });
  }

  // ===== DYNAMIC YEAR IN FOOTER =====
  const yearElements = document.querySelectorAll('.current-year');
  const currentYear = new Date().getFullYear();
  yearElements.forEach(el => {
    el.textContent = currentYear;
  });

  // ===== PARTICLE EFFECT ON HERO =====
  function createParticles() {
    const hero = document.getElementById('hero');
    if (!hero || window.innerWidth < 768) return;

    for (let i = 0; i < 20; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.cssText = `
        position: absolute;
        width: ${Math.random() * 4 + 2}px;
        height: ${Math.random() * 4 + 2}px;
        background: rgba(255, 102, 0, ${Math.random() * 0.5 + 0.2});
        border-radius: 50%;
        left: ${Math.random() * 100}%;
        top: ${Math.random() * 100}%;
        animation: float ${Math.random() * 10 + 10}s infinite ease-in-out;
        animation-delay: ${Math.random() * 5}s;
      `;
      hero.appendChild(particle);
    }
  }

  createParticles();

  // ===== RESIZE HANDLER =====
  let resizeTimer;
  window.addEventListener('resize', function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      if (window.innerWidth > 768) {
        if (cursorDot) cursorDot.style.display = 'block';
        if (cursorOutline) cursorOutline.style.display = 'block';
      } else {
        if (cursorDot) cursorDot.style.display = 'none';
        if (cursorOutline) cursorOutline.style.display = 'none';
      }
    }, 250);
  });
  // ===== MESSAGING SYSTEM (V62) =====
  const conversationList = document.getElementById('conversation-list');
  const chatMessages = document.getElementById('chat-messages');
  const chatInputArea = document.getElementById('chat-input-area');
  const currentContactIdInput = document.getElementById('current-contact-id');
  const sendMessageForm = document.getElementById('send-message-form');

  if (conversationList) {
    // 1. CLICK CONVERSATION
    conversationList.addEventListener('click', function (e) {
      const item = e.target.closest('.conversation-item');
      if (!item) return;

      // Enhance UI active state
      document.querySelectorAll('.conversation-item').forEach(el => el.classList.remove('bg-blue-50', 'border-l-4', 'border-oblink-blue'));
      item.classList.add('bg-blue-50', 'border-l-4', 'border-oblink-blue');

      const contactId = item.getAttribute('data-contact-id');
      currentContactIdInput.value = contactId;
      chatInputArea.classList.remove('hidden');

      // Load Messages AJAX
      chatMessages.innerHTML = '<div class="flex h-full items-center justify-center text-gray-400"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

      const formData = new FormData();
      formData.append('action', 'oblink_load_chat');
      formData.append('contact_id', contactId);
      formData.append('nonce', oblink_vars.nonce);

      fetch(oblink_vars.ajax_url + '?action=oblink_load_chat&contact_id=' + contactId + '&nonce=' + oblink_vars.nonce)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            chatMessages.innerHTML = data.data.html || '<div class="text-center text-xs text-gray-400 mt-10">Début de la conversation</div>';
            chatMessages.scrollTop = chatMessages.scrollHeight;
          } else {
            chatMessages.innerHTML = '<div class="text-red-500 text-center">Erreur chargement</div>';
          }
        });
    });

    // 2. SEND MESSAGE
    if (sendMessageForm) {
      sendMessageForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const contactId = currentContactIdInput.value;
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value.trim();

        if (!message) return;

        // Optimistic UI update
        const tempMsg = document.createElement('div');
        tempMsg.className = 'flex justify-end mb-4 opacity-50';
        tempMsg.innerHTML = `<div class="bg-oblink-blue text-white rounded-2xl py-2 px-4 max-w-[80%] text-sm">${message}</div>`;
        chatMessages.appendChild(tempMsg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        messageInput.value = '';

        const formData = new FormData();
        formData.append('action', 'oblink_send_msg');
        formData.append('receiver_id', contactId);
        formData.append('message', message);
        formData.append('nonce', oblink_vars.nonce);

        fetch(oblink_vars.ajax_url, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              tempMsg.classList.remove('opacity-50');
            } else {
              tempMsg.classList.add('bg-red-500');
              alert('Erreur envoi');
            }
          });
      });
    }
  }
  const OBLINK = {
    async fetchStats() {
      try {
        const response = await fetch('/api/stats');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching stats:', error);
        return null;
      }
    },

    async submitContact(formData) {
      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        return await response.json();
      } catch (error) {
        console.error('Error submitting contact:', error);
        return { error: 'Une erreur est survenue' };
      }
    }
  };

  // Make OBLINK API available globally
  window.OBLINK = OBLINK;

  // ===== CSS ANIMATIONS HELPER =====
  const style = document.createElement('style');
  style.textContent = `
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
  }
  
  .shake {
    animation: shake 0.5s;
  }
`;
  document.head.appendChild(style);
});
--- FILE: theme/page-verify-cert.php ---
<?php
/*
Template Name: OBLINK Certificate Verification
*/

// Security: Retrieve Param from URL
$cert_id = get_query_var('cert_id', 'CERT-OB-2026-88X42'); // Fallback for demo
$student_name = "Thomas R."; // Mock data for V1
$score = 92;
$date = date('d/m/Y', strtotime('-2 days'));

?>
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow"> <!-- SEO Request -->
    <title>Vérification Certificat - <?php echo $cert_id; ?></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">

    <!-- 1. Header Banner -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500 to-blue-600 flex items-center justify-center text-white font-bold text-xs">
                    OB</div>
                <span class="font-bold text-gray-900 tracking-tight">OBLINK <span
                        class="text-gray-400 font-normal">Check</span></span>
            </div>
            <div
                class="flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-100">
                <i class="fas fa-check-circle"></i> PROFIL VÉRIFIÉ
            </div>
        </div>
    </div>

    <main class="flex-grow p-4 md:p-8">
        <div class="max-w-2xl mx-auto space-y-6">

            <!-- 2. Certificate Status Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-green-200 overflow-hidden relative">
                <div class="h-2 bg-gradient-to-r from-green-500 to-teal-500 w-full"></div>
                <div class="p-6 md:p-8 text-center">
                    <div
                        class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-4xl mx-auto mb-4 border-4 border-white shadow-sm ring-4 ring-green-50">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <h1 class="text-2xl md:text-3xl font-black text-gray-900 mb-2">Statut Expert Confirmé</h1>
                    <p class="text-gray-500 font-mono text-sm bg-gray-100 inline-block px-3 py-1 rounded mb-4">ADELI: 75
                        92 **** 4</p>
                    <p class="text-gray-600 text-sm">Ce professionnel a passé avec succès notre protocole de
                        vérification hybride.</p>
                </div>
            </div>

            <!-- 3. Candidate Identity & Protocols -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8">
                <div class="flex flex-col md:flex-row items-center gap-6 mb-8 text-center md:text-left">
                    <div class="relative">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Candidate"
                            class="w-24 h-24 rounded-full border-4 border-white shadow-lg">
                        <div class="absolute bottom-0 right-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm border-2 border-white shadow-sm"
                            title="Identité Vérifiée">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900"><?php echo $student_name; ?></h2>
                        <div class="flex flex-wrap gap-2 justify-center md:justify-start mt-2">
                            <span
                                class="inline-flex items-center bg-blue-50 text-blue-700 text-xs font-bold px-2 py-1 rounded border border-blue-100">
                                <i class="fas fa-file-medical mr-1"></i> ADELI Vérifié
                            </span>
                            <span
                                class="inline-flex items-center bg-purple-50 text-purple-700 text-xs font-bold px-2 py-1 rounded border border-purple-100">
                                <i class="fab fa-stripe mr-1"></i> ID Stripe (KYC)
                            </span>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-6">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Protocole de Sécurité
                        Hybride</h3>
                    <div class="grid gap-4">
                        <!-- Step 1 -->
                        <div class="flex items-start gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center shrink-0 mt-1">
                                <i class="fas fa-check font-bold text-sm"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Vérification Légale (ADELI)</h4>
                                <p class="text-xs text-gray-500">Numéro ADELI correspondant à l'identité, validé auprès
                                    de l'Annuaire Santé National.</p>
                            </div>
                        </div>
                        <!-- Step 2 -->
                        <div class="flex items-start gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center shrink-0 mt-1">
                                <i class="fas fa-check font-bold text-sm"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Vérification d'Identité Bancaire (KYC)</h4>
                                <p class="text-xs text-gray-500">Identité physique validée par Stripe Connect
                                    (Partenaire Paiement Sécurisé).</p>
                            </div>
                        </div>
                        <!-- Step 3 -->
                        <div class="flex items-start gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center shrink-0 mt-1">
                                <i class="fas fa-check font-bold text-sm"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Validation Technique (Académie OBLINK)</h4>
                                <p class="text-xs text-gray-500">Score de <?php echo $score; ?>% obtenu sur le module
                                    "Cosium Expert" le <?php echo $date; ?>.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Recruiter CTA -->
            <div
                class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl shadow-xl p-6 md:p-8 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="font-bold text-xl mb-2">Profil Sécurisé & Validé</h3>
                    <p class="text-gray-300 text-sm mb-6">Avec OBLINK, vous ne recrutez pas seulement un CV, mais une
                        compétence technique vérifiée et une identité certifiée.</p>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button
                            class="bg-oblink-orange hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition shadow-lg flex-1 text-center bg-orange-500">
                            <i class="fas fa-handshake mr-2"></i> Proposer une mission
                        </button>
                    </div>
                </div>
                <!-- Decor -->
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none">
                </div>
            </div>

            <!-- Conditions Section (New) -->
            <div class="text-center">
                <a href="#" class="text-xs text-gray-400 hover:text-gray-600 underline">Voir les conditions d'accès au
                    statut Expert</a>
            </div>

        </div>
    </main>

    <footer class="text-center py-6 text-xs text-gray-400">
        &copy; <?php echo date('Y'); ?> OBLINK. Tous droits réservés.
    </footer>

</body>

</html>--- FILE: theme/page-pass-examen.php ---
<?php
/*
Template Name: Pass Examen BTS
*/
include 'header-inc.php';
?>

<div class="bg-white font-sans text-gray-900">

    <!-- HERO SECTION -->
    <div class="relative overflow-hidden bg-gray-900 text-white border-b border-gray-800">
        <div
            class="absolute inset-0 bg-[url('<?php echo get_template_directory_uri(); ?>/images/grid-pattern.png')] opacity-10">
        </div>
        <div
            class="absolute top-0 right-0 w-[500px] h-[500px] bg-oblink-orange/20 rounded-full blur-[120px] pointer-events-none transform translate-x-1/2 -translate-y-1/2">
        </div>
        <div
            class="absolute bottom-0 left-0 w-[300px] h-[300px] bg-oblink-violet/20 rounded-full blur-[100px] pointer-events-none transform -translate-x-1/3 translate-y-1/3">
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-20 relative z-10">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div>
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-oblink-orange font-bold text-xs mb-6 border border-white/10 uppercase tracking-wider">
                        <i class="fas fa-crown"></i> Nouveau • BTS Opticien Lunetier
                    </div>
                    <h1 class="text-4xl md:text-6xl font-black font-display leading-[1.1] mb-6">
                        Ne laissez pas le hasard décider de <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">votre
                            diplôme</span>.
                    </h1>
                    <p class="text-lg text-gray-400 mb-8 leading-relaxed max-w-lg">
                        Accédez à 27 ans d'annales corrigées et laissez notre IA analyser vos points faibles. Le seul
                        outil de révision qui s'adapte à vous.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <a href="#pricing"
                            class="inline-flex justify-center items-center px-8 py-4 text-base font-bold text-white bg-oblink-orange rounded-xl hover:bg-orange-600 transition shadow-lg hover:shadow-orange-500/25 transform hover:-translate-y-1">
                            Obtenir mon Pass Examen
                        </a>
                        <a href="#demo"
                            class="inline-flex justify-center items-center px-8 py-4 text-base font-bold text-white bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition backdrop-blur-sm">
                            <i class="fas fa-play mr-2 text-oblink-orange"></i> Voir la démo
                        </a>
                    </div>
                    <div class="mt-8 flex items-center gap-4 text-sm text-gray-500">
                        <div class="flex -space-x-2">
                            <img class="w-8 h-8 rounded-full border-2 border-gray-900"
                                src="https://randomuser.me/api/portraits/thumb/men/1.jpg" alt="">
                            <img class="w-8 h-8 rounded-full border-2 border-gray-900"
                                src="https://randomuser.me/api/portraits/thumb/women/2.jpg" alt="">
                            <img class="w-8 h-8 rounded-full border-2 border-gray-900"
                                src="https://randomuser.me/api/portraits/thumb/men/3.jpg" alt="">
                        </div>
                        <p>Rejoint par <span class="text-white font-bold">2,140+ étudiants</span> cette année</p>
                    </div>
                </div>
                <div class="relative lg:h-[600px] flex items-center justify-center">
                    <!-- Conceptuel UI Mockup -->
                    <div
                        class="relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-800 rotate-[-2deg] hover:rotate-0 transition duration-700">
                        <div class="bg-gray-100 p-3 border-b border-gray-200 flex gap-2">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                        </div>
                        <div class="p-6 bg-white">
                            <div class="flex items-center gap-3 mb-6">
                                <div
                                    class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900">Analyse de la Vision</h4>
                                    <p class="text-xs text-gray-500">Sujet 2024 • Note estimée: 14/20</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <p class="text-xs font-bold text-gray-400 uppercase mb-2">Question IA</p>
                                    <p class="text-sm font-semibold text-gray-800 mb-2">Décrivez le trajet des rayons
                                        lumineux dans un œil hypermétrope non corrigé.</p>
                                    <div class="h-2 w-3/4 bg-gray-200 rounded animate-pulse"></div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                    <p class="text-xs font-bold text-blue-400 uppercase mb-2">Correction Instantanée</p>
                                    <p class="text-sm text-gray-700">Dans un œil hypermétrope au repos, l'image d'un
                                        objet à l'infini se forme <strong>en arrière de la rétine</strong>. Le Punctum
                                        Remotum est virtuel, situé derrière l'œil.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Widget -->
                    <div
                        class="absolute bottom-12 -right-4 bg-white p-4 rounded-xl shadow-xl border border-gray-100 max-w-xs transform translate-y-4 animate-bounce-slow">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 bg-oblink-orange rounded-full flex items-center justify-center text-white">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div>
                                <p class="text-sm font-bold text-gray-900">138 Annales incluses</p>
                                <p class="text-xs text-green-600 font-semibold">Téléchargement immédiat</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VALUE PROPOSITION -->
    <div class="py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-3xl md:text-4xl font-black text-gray-900 font-display mb-4">Pourquoi payer pour ce que
                    vous pouvez trouver gratuitement ?</h2>
                <p class="text-lg text-gray-500">Parce que vous n'achetez pas de l'information. Vous achetez du temps,
                    de la structure et une correction personnalisée impossible à obtenir seul.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <!-- Feature 1 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg transition-all group">
                    <div
                        class="w-14 h-14 rounded-2xl bg-orange-100 text-oblink-orange flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Diagnostic IA Personnalisé</h3>
                    <p class="text-gray-500 leading-relaxed">Fini de réviser ce que vous savez déjà. Notre IA identifie
                        vos lacunes précises en 5 minutes et crée un plan de révision sur mesure.</p>
                </div>

                <!-- Feature 2 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg transition-all group">
                    <div
                        class="w-14 h-14 rounded-2xl bg-blue-100 text-oblink-blue flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">27 Ans d'Archives</h3>
                    <p class="text-gray-500 leading-relaxed">Accédez à la plus grande base de données d'annales
                        (1999-2025). Sujets et corrigés officiels, classés et analysés.</p>
                </div>

                <!-- Feature 3 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg transition-all group">
                    <div
                        class="w-14 h-14 rounded-2xl bg-purple-100 text-purple-600 flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-comment-dots"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Simulateur d'Examen</h3>
                    <p class="text-gray-500 leading-relaxed">Posez n'importe quelle question sur un sujet. L'IA vous
                        répond comme un correcteur d'examen, avec les attendus officiels.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PRICING SECTION -->
    <div id="pricing" class="py-24 bg-white relative overflow-hidden">
        <div class="absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="lg:grid lg:grid-cols-12 gap-12 items-center">
                <div class="lg:col-span-5 mb-12 lg:mb-0">
                    <h2 class="text-3xl md:text-5xl font-black text-gray-900 font-display mb-6">Investissez sur votre
                        réussite.</h2>
                    <p class="text-lg text-gray-500 mb-8">Un tuteur privé coûte 50€/heure. OBLINK Académie vous offre un
                        accès illimité à l'intelligence de 27 ans d'examens pour le prix d'un seul repas.</p>

                    <div class="space-y-4">
                        <div class="flex items-center gap-3 text-gray-700">
                            <i class="fas fa-check text-green-500"></i> <span>Paiement unique, accès à vie</span>
                        </div>
                        <div class="flex items-center gap-3 text-gray-700">
                            <i class="fas fa-check text-green-500"></i> <span>Satisfait ou remboursé (14j)</span>
                        </div>
                        <div class="flex items-center gap-3 text-gray-700">
                            <i class="fas fa-check text-green-500"></i> <span>Support technique 7j/7</span>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7">
                    <div class="relative bg-gray-900 rounded-3xl p-1 shadow-2xl">
                        <div
                            class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-oblink-orange text-white px-6 py-1 rounded-full text-sm font-bold uppercase tracking-wide shadow-lg">
                            Offre de Lancement
                        </div>
                        <div class="bg-gray-800 rounded-[22px] p-8 md:p-12">
                            <div
                                class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-8 border-b border-gray-700">
                                <div>
                                    <h3 class="text-2xl font-bold text-white mb-2">Pass Examen BTS OL</h3>
                                    <p class="text-gray-400 text-sm">Accès Illimité 6 mois — Rentabilisé dès la 1ère
                                        heure</p>
                                </div>
                                <div class="mt-4 md:mt-0 text-right">
                                    <div class="text-sm text-gray-400 line-through">99,00 €</div>
                                    <div class="text-4xl font-black text-white">29,00 €</div>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-y-4 gap-x-8 mb-8">
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> 138 Annales (1999-2025)
                                </li>
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> Analyse de Vision & OGP
                                </li>
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> Corrigés Détaillés
                                </li>
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> Assistant IA Illimité
                                </li>
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> Fiches Révision NotebookLM
                                </li>
                                <li class="flex items-center gap-3 text-gray-300">
                                    <i class="fas fa-check-circle text-oblink-orange"></i> Quiz Interactifs
                                </li>
                            </div>

                            <div class="mb-6 bg-gray-700/50 p-4 rounded-xl border border-gray-600">
                                <label class="flex items-start gap-3 cursor-pointer group">
                                    <div class="relative flex items-center">
                                        <input type="checkbox" id="cgu-consent"
                                            class="peer h-5 w-5 cursor-pointer appearance-none rounded border border-gray-500 bg-gray-800 transition-all checked:border-oblink-orange checked:bg-oblink-orange hover:border-oblink-orange" />
                                        <div
                                            class="pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-white opacity-0 peer-checked:opacity-100">
                                            <i class="fas fa-check text-xs"></i>
                                        </div>
                                    </div>
                                    <span class="text-sm text-gray-300 select-none group-hover:text-white transition">
                                        J'accepte les <a href="<?php echo home_url('/cgu#academie-conditions'); ?>"
                                            target="_blank"
                                            class="text-oblink-orange underline hover:text-orange-400">CGU</a> et je
                                        reconnais qu'en accédant immédiatement au contenu numérique, <strong>je renonce
                                            à mon droit de rétractation</strong>.
                                    </span>
                                </label>
                            </div>

                            <button
                                onclick="if(!document.getElementById('cgu-consent').checked) { alert('Veuillez accepter les conditions (renoncement au droit de rétractation) pour accéder au contenu immédiat.'); return; } alert('Redirection vers Stripe... (Module en cours d\'intégration)')"
                                class="w-full py-5 bg-white text-gray-900 font-black rounded-xl hover:bg-oblink-orange hover:text-white transition-all transform hover:scale-[1.02] shadow-xl text-lg flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span>Débloquer mon accès maintenant</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <p class="text-center text-gray-500 text-xs mt-4">Paiement sécurisé par Stripe • Facture
                                disponible</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ SECTION -->
    <div class="py-24 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-black text-center text-gray-900 mb-12">Questions Fréquentes</h2>

            <div class="space-y-4">
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-lg text-gray-900 mb-2">Est-ce que cela couvre toutes les matières ?</h3>
                    <p class="text-gray-500">Nous nous concentrons principalement sur les matières techniques à fort
                        coefficient : Analyse de la Vision, Optique Géométrique et Physique, et Étude Technique. Les
                        maths et la gestion sont inclus en bonus.</p>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-lg text-gray-900 mb-2">Comment fonctionne l'IA ?</h3>
                    <p class="text-gray-500">Notre IA est entraînée sur 27 ans d'annales officielles. Elle ne fait pas
                        qu'inventer des réponses, elle restructure les connaissances officielles pour qu'elles soient
                        pédagogiques et faciles à retenir.</p>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-lg text-gray-900 mb-2">Puis-je l'utiliser sur mon téléphone ?</h3>
                    <p class="text-gray-500">Absolument. OBLINK Académie est une web-app optimisée pour mobile. Révisez
                        dans le bus, entre deux cours ou au lit.</p>
                </div>
            </div>
        </div>
    </div>

</div>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-dashboard-entreprise.php ---
<?php
/*
Template Name: Page Dashboard Entreprise
*/
include 'header-inc.php';

// 1. DATA SIMULATION (MOCK)
// $user = wp_get_current_user(); <-- Removed for Supabase
$company_name = "Votre Entreprise"; // Placeholder until JS loads

// Offres simulées
?>
<!-- JS AUTH GUARD (Supabase) -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Wait for Supabase to be ready
        if (!window.oblinkSupabase) {
            console.error('Supabase not loaded!');
            // Show content anyway in dev mode
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');
            return;
        }

        try {
            // 2. Check Auth
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                console.error('Auth error:', error);
                const content = document.getElementById('dashboard-content');
                if (content) content.classList.remove('opacity-0');
                return;
            }

            if (!session) {
                window.location.href = '<?php echo home_url("/login"); ?>';
                return;
            }

            // 3. Check User Type
            const userType = session.user.user_metadata?.user_type;
            if (userType && userType !== 'entreprise') {
                // Wrong dashboard -> Show clear message then redirect
                const dashboardContent = document.getElementById('dashboard-content');
                dashboardContent.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="max-w-md text-center p-8 bg-white rounded-2xl shadow-xl border border-gray-100">
                            <div class="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-circle text-red-500 text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-oblink-gray mb-3">Accès Refusé</h2>
                            <p class="text-gray-600 mb-6">
                                Cette page est réservée aux <strong>entreprises</strong>.<br>
                                Vous serez redirigé vers votre tableau de bord...
                            </p>
                            <div class="animate-pulse text-sm text-gray-400">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Redirection en cours
                            </div>
                        </div>
                    </div>
                `;
                dashboardContent.classList.remove('opacity-0');

                // Redirect after 2 seconds
                setTimeout(() => {
                    if (userType === 'opticien') window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                    else window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }, 2000);
                return;
            }

            // 4. Inject Company Info
            const companyNameElement = document.querySelector('.text-oblink-blue');
            if (companyNameElement) {
                companyNameElement.textContent = session.user.user_metadata?.company_name || 'Entreprise';
            }

            // 5. Show Content
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');

        } catch (err) {
            console.error('Dashboard auth error:', err);
            // Show content anyway to avoid blank page
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');
        }
    });
</script>
<?php

// 1. DATA SIMULATION (MOCK)
$company_name = "Votre Entreprise"; // Placeholder until JS loads

// Offres simulées
$jobs = [
    [
        'title' => 'Remplacement Été (Juillet/Août)',
        'date' => 'Juillet - Août 2025',
        'type' => 'CDD',
        'salary' => '350€ /j',
        'views' => 45,
        'status' => 'Active',
        'candidates_count' => 3
    ],
    [
        'title' => 'Opticien Collaborateur Samedi',
        'date' => 'Dès que possible',
        'type' => 'CDI Partiel',
        'salary' => 'Selon profil',
        'views' => 124,
        'status' => 'Active',
        'candidates_count' => 8
    ]
];

// Si on vient de poster une offre (simulation : on l'ajoute en tête)
if (isset($_GET['success']) && $_GET['success'] === 'job_posted') {
    array_unshift($jobs, [
        'title' => 'Nouvelle Mission (Postée à l\'instant)',
        'date' => 'À définir',
        'type' => 'CDD',
        'salary' => 'À définir',
        'views' => 0,
        'status' => 'Active',
        'candidates_count' => 0
    ]);
}

// KPI Calculés
$active_jobs_count = count($jobs);
$total_candidates = 14;
$confirmed_missions = 5;
?>

<div id="dashboard-content" class="min-h-screen bg-gray-50 pt-24 pb-12 transition-opacity duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Verification Banner (Account Only) -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 rounded-r-xl shadow-sm relative group">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                        <span class="font-bold">Compte en attente de certification.</span>
                        Votre profil a bien été enregistré. Un membre de l'équipe OBLINK va vous contacter (sous 24h)
                        pour certifier votre établissement.
                    </p>
                </div>
                <!-- Mock Close Button -->
                <button class="absolute top-2 right-2 text-yellow-400 hover:text-yellow-600"
                    onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- GRID LAYOUT -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- LEFT COLUMN -->
            <div class="lg:col-span-2 space-y-8">

                <!-- Welcome Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-3xl font-bold font-display text-oblink-gray">Espace Recruteur <span
                                class="text-oblink-blue">
                                <?php echo esc_html($company_name); ?>
                            </span></h1>
                        <p class="text-gray-500">Gérez vos recrutements (CDI/CDD) et missions freelance au même endroit.
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <a href="<?php echo home_url('/parametres'); ?>"
                            class="px-4 py-2 bg-white border border-gray-200 rounded-xl font-semibold text-gray-600 hover:border-oblink-blue hover:text-oblink-blue transition flex items-center gap-2">
                            <i class="fas fa-cog"></i> Paramètres
                        </a>
                        <a href="<?php echo home_url('/publier-offre'); ?>"
                            class="px-4 py-2 bg-oblink-blue text-white rounded-xl font-bold hover:bg-oblink-gray transition flex items-center gap-2 shadow-lg shadow-blue-200">
                            <i class="fas fa-plus-circle"></i> Publier une annonce
                        </a>
                    </div>
                </div>

                <!-- KPI Cards -->
                <!-- ... (Skipping KPI changes for brevity unless requested) ... -->

                <!-- ... -->

                <!-- Vos Offres -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">Vos Annonces (Emploi & Missions)
                        </h2>
                        <a href="#" class="text-sm font-semibold text-oblink-blue hover:underline">Gérer tout</a>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <?php foreach ($jobs as $job):
                            $status_color = ($job['status'] === 'Active') ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700';
                            $type_badge_color = (strpos($job['type'], 'CDD') !== false) ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700';
                            ?>
                            <div
                                class="p-5 border border-gray-200 rounded-2xl hover:border-oblink-blue transition cursor-pointer relative">
                                <span
                                    class="absolute top-5 right-5 <?php echo $type_badge_color; ?> text-[10px] font-bold px-2 py-0.5 rounded-full uppercase">
                                    <?php echo $job['type']; ?>
                                </span>

                                <div class="flex justify-between items-start mb-2">
                                    <span class="<?php echo $status_color; ?> text-xs font-bold px-2 py-1 rounded-full">
                                        <?php echo $job['status']; ?>
                                    </span>
                                </div>
                                <h3 class="font-bold text-oblink-gray mb-1 pr-12">
                                    <?php echo $job['title']; ?>
                                </h3>
                                <p class="text-sm text-gray-500 mb-3"><i class="far fa-clock mr-1"></i>
                                    <?php echo $job['date']; ?>
                                </p>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="font-bold text-oblink-blue">
                                        <?php echo $job['salary']; ?>
                                    </span>
                                    <span class="text-gray-400">
                                        <?php echo $job['views']; ?> Vues
                                    </span>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>

                <!-- CANDIDATURES (New Section) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">
                            <i class="fas fa-users text-oblink-violet mr-2"></i>Dernières Candidatures
                        </h2>
                        <a href="#" class="text-sm font-semibold text-oblink-blue hover:underline">Voir tout</a>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="text-xs text-gray-400 border-b border-gray-100">
                                    <th class="py-3 font-semibold uppercase">Candidat</th>
                                    <th class="py-3 font-semibold uppercase">Offre</th>
                                    <th class="py-3 font-semibold uppercase">Date</th>
                                    <th class="py-3 font-semibold uppercase">Statut</th>
                                    <th class="py-3 font-semibold uppercase text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-candidatures-body" class="text-sm text-gray-600">
                                <!-- Dynamic Content -->
                                <tr>
                                    <td colspan="5" class="py-8 text-center text-gray-400">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p>Chargement des candidatures...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', async () => {
                        const tbody = document.getElementById('dashboard-candidatures-body');
                        const currentUserId = '<?php echo get_current_user_id(); ?>'; // We need Supabase ID, not WP ID. Assuming they are linked or we use Supabase Auth session.

                        // Actually, better to rely on Supabase session since we are client-side
                        const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                        if (!session) {
                            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-400">Non connecté à Supabase</td></tr>';
                            return;
                        }
                        const user = session.user;

                        try {
                            // 1. Get my offers IDs first (recursive approach or direct join if RLS allows)
                            // More efficient: Fetch applications where offer.company_id = me.
                            // Supabase filtered query on foreign table is easier.

                            const { data: applications, error } = await window.oblinkSupabase
                                .from('applications')
                                .select(`
                                *,
                                opticien:profiles!opticien_id (
                                    id, first_name, last_name, full_name
                                ),
                                offer:offers!offer_id (
                                    id, title
                                )
                            `)
                                // We need to filter by offers owned by THIS company.
                                // RLS 'Companies can view applications for own offers' should handle this implicitly if set up correctly?
                                // Let's rely on RLS or specific filter.
                                // Ideally: .eq('offer.company_id', user.id) -> Supabase JS supports filtering on joined tables.
                                .eq('offer.company_id', user.id)
                                .order('created_at', { ascending: false })
                                .limit(5);

                            /* 
                               NOTE: If the RLS on 'applications' table is set to:
                               USING (offer_id IN (SELECT id FROM offers WHERE company_id = auth.uid()))
                               Then a simple select() is enough, no need for explicit .eq() filter on joined table if RLS enforces it.
                               However, explicit filter is safer for logic if RLS is 'true' for some reason.
                               Supabase JS filtering on joined resource: .eq('offers.company_id', user.id) might be tricky depending on version.
                               Let's try standard select first, expecting RLS to filter results to only mine.
                            */

                            if (error) throw error;

                            if (!applications || applications.length === 0) {
                                tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-400">Aucune candidature reçue pour le moment.</td></tr>';
                                return;
                            }

                            // Render rows
                            tbody.innerHTML = applications.map(app => {
                                const date = new Date(app.created_at).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });

                                // Initials
                                const initials = (app.opticien?.first_name?.[0] || '') + (app.opticien?.last_name?.[0] || '');

                                // Status Badge
                                let statusBadge = '';
                                switch (app.status) {
                                    case 'pending': statusBadge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">À contacter</span>'; break;
                                    case 'viewed': statusBadge = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">Vue</span>'; break;
                                    case 'interview': statusBadge = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Entretien</span>'; break;
                                    case 'rejected': statusBadge = '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold">Refusée</span>'; break;
                                    default: statusBadge = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-bold">En attente</span>';
                                }

                                return `
                            <tr class="border-b border-gray-50 hover:bg-gray-50 transition">
                                <td class="py-4 flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 uppercase">
                                        ${initials || '?'}
                                    </div>
                                    <span class="font-semibold text-gray-800">${app.opticien?.full_name || 'Candidat inconnu'}</span>
                                </td>
                                <td class="py-4">${app.offer?.title || 'Offre supprimée'}</td>
                                <td class="py-4 text-gray-400">${date}</td>
                                <td class="py-4">${statusBadge}</td>
                                <td class="py-4 text-right">
                                    <button class="contact-candidate-btn text-oblink-blue hover:bg-blue-50 p-2 rounded-lg transition" 
                                        data-candidate-id="${app.opticien?.id}" 
                                        data-candidate-name="${app.opticien?.full_name}">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </td>
                            </tr>
                            `;
                            }).join('');

                            // Re-attach event listeners for the dynamic buttons
                            // Since we just replaced innerHTML, we need to re-bind the 'click' events for contact modal
                            // Or better: Use event delegation on the body or container.
                            // For now, let's just re-run the binding logic if it was defined globally, 
                            // BUT since the modal logic is likely defined in 'DOMContentLoaded', it ran BEFORE we injected this HTML.
                            // We must MANUALLY trigger the binding logic again or change how it's bound.

                            // Let's assume we need to re-bind. 
                            const newContactBtns = document.querySelectorAll('.contact-candidate-btn');
                            const contactModal = document.getElementById('contact-modal');
                            const contactIdInput = document.getElementById('contact-id');
                            const contactNameSpan = document.getElementById('contact-name');

                            newContactBtns.forEach(btn => {
                                btn.addEventListener('click', function () {
                                    const candidateId = this.dataset.candidateId;
                                    const candidateName = this.dataset.candidateName;
                                    contactIdInput.value = candidateId;
                                    contactNameSpan.textContent = candidateName;
                                    contactModal.classList.remove('hidden');
                                    contactModal.classList.add('flex');
                                });
                            });

                        } catch (err) {
                            console.error('Error loading applications:', err);
                            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Erreur chargement.</td></tr>';
                        }
                    });
                </script>

                <!-- MESSAGERIE (Recruteur V62) -->
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100"
                    id="messagerie-section">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-xl font-bold font-display text-oblink-gray flex items-center gap-2">
                            <i class="fas fa-comment-dots text-oblink-blue"></i> Messagerie Candidats
                        </h2>
                    </div>
                    <div class="flex h-[400px]">
                        <!-- Sidebar Conversations -->
                        <div class="w-1/3 border-r border-gray-100 bg-gray-50 overflow-y-auto" id="conversation-list">
                            <?php
                            // Initial load
                            $convs = oblink_get_conversations();
                            if ($convs) {
                                foreach ($convs as $c) {
                                    $contact_name = "Candidat #" . $c->contact_id; // TO DO: Get Real Name
                                    ?>
                                    <div class="p-4 border-b border-gray-100 hover:bg-white cursor-pointer transition conversation-item"
                                        data-contact-id="<?php echo $c->contact_id; ?>">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-violet text-white flex items-center justify-center font-bold text-sm">
                                                <?php echo substr($contact_name, 0, 1); ?>
                                            </div>
                                            <div class="overflow-hidden">
                                                <h4 class="font-bold text-sm text-gray-800 truncate">
                                                    <?php echo $contact_name; ?>
                                                </h4>
                                                <p class="text-xs text-gray-500 truncate">
                                                    <?php echo $c->message; ?>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-4 text-xs text-gray-400 text-center mt-10">Aucune conversation active</div>';
                            }
                            ?>
                        </div>
                        <!-- Chat Area -->
                        <div class="w-2/3 flex flex-col bg-white">
                            <div class="flex-1 p-6 overflow-y-auto space-y-4" id="chat-messages">
                                <div class="flex flex-col items-center justify-center h-full text-gray-400">
                                    <i class="fas fa-comments text-4xl mb-4 text-gray-200"></i>
                                    <p class="text-sm">Sélectionnez un candidat pour échanger</p>
                                </div>
                            </div>
                            <!-- Input -->
                            <div class="p-4 border-t border-gray-100 bg-gray-50 hidden" id="chat-input-area">
                                <form id="send-message-form" class="flex gap-2">
                                    <input type="hidden" id="current-contact-id" value="">
                                    <input type="text" id="message-input"
                                        class="flex-1 rounded-xl border-gray-200 text-sm focus:ring-oblink-blue focus:border-oblink-blue"
                                        placeholder="Écrivez votre message...">
                                    <button type="submit"
                                        class="w-10 h-10 rounded-xl bg-oblink-blue text-white hover:bg-blue-600 transition flex items-center justify-center">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GESTION FINANCIERE (New) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">
                            <i class="fas fa-file-invoice-dollar text-oblink-orange mr-2"></i>Gestion Financière
                        </h2>
                        <div class="flex gap-2">
                            <a href="<?php echo home_url('/facture'); ?>"
                                class="text-xs font-bold text-white bg-oblink-blue px-3 py-2 rounded-lg hover:bg-blue-700 transition flex items-center">
                                <i class="fas fa-plus mr-1"></i> Facturer
                            </a>
                            <button
                                class="text-xs font-bold text-gray-500 bg-gray-100 px-3 py-2 rounded-lg hover:bg-gray-200 transition">Tout
                                voir</button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <!-- Devis à valider -->
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-orange-50 border border-orange-100 rounded-xl">
                            <div class="flex items-center gap-4 mb-3 sm:mb-0">
                                <div
                                    class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center">
                                    <i class="fas fa-file-signature"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">Devis #DEV-2025-089</h4>
                                    <p class="text-xs text-orange-700 font-medium">En attente de signature - 840,00 €
                                    </p>
                                    <p class="text-xs text-gray-500">Remplacement Sarah D.</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <a href="<?php echo home_url('/facture'); ?>"
                                    class="px-4 py-2 bg-orange-500 text-white text-xs font-bold rounded-lg hover:bg-orange-600 transition shadow-sm">
                                    <i class="fas fa-pen-nib mr-1"></i> Signer
                                </a>
                            </div>
                        </div>

                        <!-- Facture à payer -->
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-white border border-gray-200 rounded-xl">
                            <div class="flex items-center gap-4 mb-3 sm:mb-0">
                                <div
                                    class="w-10 h-10 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">Facture #FACT-2025-042</h4>
                                    <p class="text-xs text-red-500 font-medium">À payer avant le 15/02 - 450,00 €</p>
                                    <p class="text-xs text-gray-500">Frais de service OBLINK</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="alert('Simulation: Facture envoyée à compta@votre-entreprise.com')"
                                    class="px-3 py-2 bg-gray-100 text-gray-600 text-xs font-bold rounded-lg hover:bg-gray-200 transition">
                                    <i class="fas fa-envelope mr-1"></i> Comptable
                                </button>
                                <button
                                    class="px-3 py-2 bg-oblink-blue text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition">
                                    <i class="fas fa-credit-card mr-1"></i> Payer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div> <!-- END LEFT COLUMN -->

        <!-- RIGHT COLUMN (Sidebar) -->
        <div class="space-y-8">

            <!-- Quick Search -->
            <div class="bg-gradient-to-br from-oblink-blue to-oblink-violet rounded-3xl p-6 text-white shadow-xl">
                <h2 class="text-xl font-bold font-display mb-2">Besoin d'un remplaçant urgent ?</h2>
                <p class="text-white/80 text-sm mb-6">Accédez à la CV-thèque et contactez directement les opticiens
                    disponibles.</p>
                <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                    class="block w-full py-3 bg-white text-oblink-blue font-bold text-center rounded-xl hover:bg-gray-50 transition shadow-lg">
                    <i class="fas fa-search mr-2"></i> Rechercher
                </a>
            </div>

            <!-- Latest Messages Removed (Replaced by Main Module) -->

            <!-- Statistiques -->
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-lg font-bold font-display text-oblink-gray mb-4">Statistiques</h2>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">Vues du profil</span>
                        <span class="font-bold text-oblink-gray">145</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5">
                        <div class="bg-oblink-orange h-1.5 rounded-full" style="width: 70%"></div>
                    </div>

                    <div class="flex justify-between text-sm mt-2">
                        <span class="text-gray-500">Taux de réponse</span>
                        <span class="font-bold text-oblink-gray">90%</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5">
                        <div class="bg-green-500 h-1.5 rounded-full" style="width: 90%"></div>
                    </div>
                </div>
            </div>

        </div>

    </div> <!-- END SIDEBAR -->

</div> <!-- END GRID -->

</div>
</div>

<!-- MESSAGING JAVASCRIPT -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const conversationItems = document.querySelectorAll('.conversation-item');
        const chatMessages = document.getElementById('chat-messages');
        const chatInputArea = document.getElementById('chat-input-area');
        const currentContactIdInput = document.getElementById('current-contact-id');
        const sendMessageForm = document.getElementById('send-message-form');
        const messageInput = document.getElementById('message-input');

        // Load chat when clicking a conversation
        conversationItems.forEach(item => {
            item.addEventListener('click', function () {
                const contactId = this.dataset.contactId;
                currentContactIdInput.value = contactId;

                // Highlight selected
                conversationItems.forEach(c => c.classList.remove('bg-white', 'ring-2', 'ring-oblink-blue'));
                this.classList.add('bg-white', 'ring-2', 'ring-oblink-blue');

                // Show input area
                chatInputArea.classList.remove('hidden');

                // Load messages via AJAX
                loadChat(contactId);
            });
        });

        function loadChat(contactId) {
            chatMessages.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-spinner fa-spin mr-2"></i> Chargement...</div>';

            fetch(`<?php echo admin_url('admin-ajax.php'); ?>?action=oblink_load_chat&contact_id=${contactId}&nonce=${oblink_vars.nonce}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        chatMessages.innerHTML = data.data.html || '<p class="text-center text-gray-400 text-sm">Aucun message</p>';
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur chargement</p>';
                    }
                })
                .catch(() => {
                    chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur réseau</p>';
                });
        }

        // Send message
        if (sendMessageForm) {
            sendMessageForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const message = messageInput.value.trim();
                const receiverId = currentContactIdInput.value;

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            messageInput.value = '';
                            loadChat(receiverId); // Reload chat
                        } else {
                            alert('Erreur: ' + (data.data?.message || 'Envoi impossible'));
                        }
                    })
                    .catch(() => alert('Erreur réseau'));
            });
        }

        // ===== NEW: CONTACT MODAL FUNCTIONALITY =====
        const contactModal = document.getElementById('contact-modal');
        const contactForm = document.getElementById('contact-form');
        const contactBtns = document.querySelectorAll('.contact-candidate-btn');
        const closeModalBtn = document.getElementById('close-contact-modal');
        const contactNameSpan = document.getElementById('contact-name');
        const contactIdInput = document.getElementById('contact-id');

        // Open modal
        contactBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const candidateId = this.dataset.candidateId;
                const candidateName = this.dataset.candidateName;
                contactIdInput.value = candidateId;
                contactNameSpan.textContent = candidateName;
                contactModal.classList.remove('hidden');
                contactModal.classList.add('flex');
            });
        });

        // Close modal
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                contactModal.classList.add('hidden');
                contactModal.classList.remove('flex');
            });
        }

        // Submit contact form
        if (contactForm) {
            contactForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                const receiverId = contactIdInput.value;
                const message = document.getElementById('contact-message').value.trim();

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                try {
                    const res = await fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();

                    if (data.success) {
                        showToast('Message envoyé ! La conversation est maintenant dans votre messagerie.', 'success');
                        contactModal.classList.add('hidden');
                        contactForm.reset();
                        // Reload page to show new conversation
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast('Erreur: ' + (data.data?.message || 'Envoi impossible'), 'error');
                    }
                } catch (err) {
                    showToast('Erreur réseau', 'error');
                }
            });
        }
    });
</script>

<!-- CONTACT MODAL -->
<div id="contact-modal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden">
        <div class="bg-gradient-to-r from-oblink-blue to-oblink-violet p-6 text-white">
            <h3 class="text-lg font-bold">Contacter <span id="contact-name">le candidat</span></h3>
            <p class="text-sm text-white/80">Envoyez votre premier message</p>
        </div>
        <form id="contact-form" class="p-6">
            <input type="hidden" id="contact-id" value="">
            <div class="mb-4">
                <label class="block text-sm font-bold text-gray-700 mb-2">Votre message</label>
                <textarea id="contact-message" rows="4" required
                    class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition resize-none"
                    placeholder="Bonjour, votre profil correspond à notre offre..."></textarea>
            </div>
            <div class="flex gap-3">
                <button type="button" id="close-contact-modal"
                    class="flex-1 px-4 py-3 border border-gray-200 text-gray-600 font-semibold rounded-xl hover:bg-gray-50 transition">
                    Annuler
                </button>
                <button type="submit"
                    class="flex-1 px-4 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition flex items-center justify-center gap-2">
                    <i class="fas fa-paper-plane"></i> Envoyer
                </button>
            </div>
        </form>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-cgu.php ---
<?php
/*
Template Name: CGU / CGV
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header Section -->
        <div class="text-center mb-16">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
                Juridique
            </span>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">Conditions Générales</h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Dernière mise à jour : <?php echo date('d/m/Y'); ?>. <br>
                L'utilisation de la plateforme OBLINK implique l'acceptation pleine et entière des présentes conditions.
            </p>
        </div>

        <!-- Navigation Tabs (Fake Tabs for Visual Structure) -->
        <div class="flex flex-col md:flex-row gap-4 mb-12 border-b border-gray-200 pb-4">
            <a href="#cgu" class="px-6 py-2 bg-oblink-orange text-white rounded-lg font-bold">1. CGU (Pour Tous)</a>
            <a href="#cgv"
                class="px-6 py-2 bg-white border border-gray-200 text-oblink-gray rounded-lg font-bold hover:bg-gray-50">2.
                CGV (Pour Magasins)</a>
            <a href="#responsabilite"
                class="px-6 py-2 bg-white border border-gray-200 text-oblink-gray rounded-lg font-bold hover:bg-gray-50">3.
                Responsabilité</a>
        </div>

        <div class="grid md:grid-cols-3 gap-12">

            <!-- Main Content -->
            <div class="md:col-span-2 space-y-12 prose prose-lg text-gray-600">

                <!-- SECTION 1 : CGU -->
                <section id="cgu" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-oblink-orange pl-4">1.
                        Conditions Générales d'Utilisation (CGU)</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables à tous les utilisateurs (Opticiens
                        Freelances et Magasins d'Optique).</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.1. Rôle de la plateforme</h3>
                    <p>OBLINK agit exclusivement en qualité d'intermédiaire technique de mise en relation. OBLINK n'est
                        ni l'employeur des opticiens freelances, ni le mandataire des magasins d'optique. La plateforme
                        ne saurait être tenue responsable de la qualité des prestations (examens de vue, montages)
                        réalisées.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.2. Vérification des profils</h3>
                    <p>L'utilisateur Freelance certifie l'exactitude des informations fournies (Diplômes BTS/Licence,
                        Numéro ADELI/RPPS, Assurance RC Pro). OBLINK procède à des vérifications mais l'utilisateur
                        reste seul responsable en cas de fausse déclaration. Tout manquement entraînera la suspension
                        immédiate du compte.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.3. Modération</h3>
                    <p>OBLINK se réserve le droit de modérer ou supprimer tout contenu (avis, commentaires, descriptions
                        de mission) jugé diffamatoire, injurieux ou contraire à l'éthique de la profession.</p>
                </section>

                <hr class="border-gray-200">

                <!-- SECTION 2 : CGV -->
                <section id="cgv" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-oblink-blue pl-4">2.
                        Conditions Générales de Vente (CGV)</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables aux clients Magasins souscrivant aux
                        services payants.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.1. Modèle Économique</h3>
                    <p>L'accès à la CV-thèque et la publication d'offres sont soumis à la souscription d'un abonnement
                        (Pack Découverte, Premium ou Corporate). Les tarifs sont indiqués en euros HT. La commission de
                        mise en relation est facturée en sus au magasin donneur d'ordre.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.2. Paiement et Séquestre</h3>
                    <p>Les paiements sont sécurisés et gérés par notre prestataire de services de paiement (PSP) agréé
                        (Stripe Connect). OBLINK n'encaisse pas les fonds pour compte de tiers ; les flux financiers
                        transitent directement via les comptes de cantonnement sécurisés.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.3. Absence de Droit de Rétractation (B2B)</h3>
                    <p>Conformément au Code de Commerce, le droit de rétractation de 14 jours ne s'applique pas aux
                        transactions réalisées entre professionnels (B2B) dans le cadre de leur activité principale.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.4. Lutte contre le travail dissimulé</h3>
                    <p>Le magasin est tenu de vérifier, via la plateforme, la conformité légale du freelance
                        (Attestation de vigilance URSSAF, Kbis) lors de la contractualisation et tous les 6 mois.</p>
                </section>

                <hr class="border-gray-200">

                <!-- SECTION 3 : NON CONTOURNEMENT -->
                <section id="responsabilite" class="scroll-mt-32">
                    <div class="bg-red-50 border border-red-100 rounded-2xl p-8">
                        <h2 class="text-2xl font-bold text-red-600 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-3"></i> 3. Clause de Non-Intermédiation
                        </h2>
                        <p class="font-bold mb-4">La pérennité d'OBLINK repose sur le respect de cette clause.</p>
                        <p>Il est strictement interdit aux utilisateurs (Magasins et Freelances) de contourner la
                            plateforme pour contractualiser en direct une mission initialement proposée via OBLINK.</p>
                        <p class="mb-0">En cas d'embauche directe ou de collaboration hors plateforme d'un freelance
                            présenté par OBLINK dans les 12 mois suivant la mise en relation, une <strong>indemnité
                                compensatrice forfaitaire</strong> sera facturée au magasin (voir grille tarifaire en
                            vigueur).</p>
                    </div>
                </section>

                </section>

                <hr class="border-gray-200">

                <!-- SECTION 4 : OBLINK ACADEMIE -->
<!-- SECTION 4 : OBLINK ACADEMIE (PASS REVISION) -->
                <section id="academie-conditions" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-purple-600 pl-4">4. Conditions Spécifiques - Pass Révision</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables à tout achat du "Pass Révision" ou "Pass Examen".</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.1. Objet du Service</h3>
                    <p>Le Pass Révision donne un accès personnel et non exclusif à la plateforme OBLINK Académie, incluant la base de quiz et le générateur d'exercices par Intelligence Artificielle.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.2. Accès et Sécurité (Fair Use)</h3>
                    <ul class="list-disc pl-5 mb-4 space-y-2">
                        <li><strong>Limite d'appareils :</strong> L'accès est strictement personnel. Il est limité à <strong>deux (2) appareils simultanés</strong> (ex: un smartphone et un ordinateur). Toute détection de partage de compte entraînera une suspension immédiate sans remboursement.</li>
                        <li><strong>Quota IA :</strong> OBLINK applique une politique d'usage raisonnable ("Fair Use"). L'accès est limité à 50 nouvelles générations de questions par jour. Les questions déjà présentes en cache restent accessibles en illimité.</li>
                    </ul>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.3. Absence de Garantie de Résultat</h3>
                    <p>OBLINK est un outil d'accompagnement. L'entreprise <strong>ne garantit pas la réussite aux examens</strong> du BTS OL. L'utilisateur reste seul responsable de l'assimilation de ses connaissances.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.4. Responsabilité liée à l'IA</h3>
                    <p>Le contenu est généré ou assisté par Intelligence Artificielle. Bien que nous appliquions des filtres de contrôle, OBLINK ne peut être tenu responsable d'éventuelles erreurs factuelles isolées. Un système de "Signalement" permet de corriger toute imprécision sous 48h.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.5. Droit de Rétractation et Remboursement (Article L221-28)</h3>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 mb-4">
                        <p class="font-bold text-purple-900 mb-2">Attention : Renoncement au droit de rétractation</p>
                        <p class="text-sm text-purple-800">Conformément à l'article L221-28 du Code de la consommation, le droit de rétractation ne peut être exercé pour les contenus numériques fournis sur un support non matériel dont l'exécution a commencé après accord préalable exprès du consommateur. <strong>En validant l'achat du Pass, l'utilisateur accepte l'accès immédiat au service et renonce expressément à son droit de rétractation.</strong></p>
                    </div>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.6. Protection des Données</h3>
                    <p>Les données collectées (Email, résultats de quiz) servent uniquement à l'amélioration de l'expérience utilisateur et au suivi de progression. Elles ne sont jamais revendues à des tiers.</p>
                </section>

                <hr class="border-gray-200">

                <section>
                    <h3 class="text-xl font-bold text-oblink-gray">5. Propriété Intellectuelle</h3>
                    <p>La marque OBLINK, le logo, la charte graphique et le code source de la plateforme sont la
                        propriété exclusive de la société OBLINK SAS. Toute reproduction totale ou partielle est
                        interdite.</p>
                </section>

            </div>

            <!-- Sidebar Sticky -->
            <div class="hidden md:block">
                <div class="sticky top-32 space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                        <h3 class="font-bold text-oblink-gray mb-4">Besoin d'aide ?</h3>
                        <p class="text-sm text-gray-500 mb-4">Notre équipe juridique est disponible pour répondre à vos
                            questions sur le fonctionnement de la plateforme.</p>
                        <a href="mailto:contact@oblink.fr"
                            class="block text-center w-full py-3 bg-oblink-blue/10 text-oblink-blue font-bold rounded-lg hover:bg-oblink-blue hover:text-white transition">Contact
                            Support</a>
                    </div>

                    <div class="bg-oblink-gray p-6 rounded-2xl text-white">
                        <h3 class="font-bold mb-2">RGPD & Données</h3>
                        <p class="text-xs text-gray-400 mb-4">Consultez notre politique de confidentialité concernant
                            les données de santé et personnelles.</p>
                        <a href="<?php echo home_url('/confidentialite'); ?>"
                            class="text-oblink-orange text-sm font-bold underline">Voir la politique RGPD</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- GLOBAL HARDCODED FOOTER REUSE -->
<div class="footer-wrapper">
    <?php include get_template_directory() . '/footer-content.php'; ?>
</div>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-pour-opticiens.php ---
<?php
/*
Template Name: Pour Opticiens
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white">

    <!-- Hero Section -->
    <div class="pt-32 pb-20 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        <div class="text-center max-w-4xl mx-auto">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-6 uppercase tracking-wider">
                Pour les Opticiens & optométristes
            </span>
            <h1 class="text-5xl md:text-7xl font-black font-display text-oblink-gray mb-8 leading-tight">
                Votre carrière, <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">vos
                    règles.</span>
            </h1>
            <p class="text-xl text-gray-500 mb-10 max-w-2xl mx-auto font-light leading-relaxed">
                Reprenez le contrôle de votre temps et de vos revenus. Devenez freelance et doublez votre salaire en
                choisissant vos missions.
            </p>

            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                    class="px-8 py-4 bg-oblink-orange text-white font-bold rounded-xl shadow-lg hover:shadow-orange-500/30 hover:-translate-y-1 transition text-lg">
                    Devenir Freelance
                </a>
                <a href="<?php echo home_url('/simulateur'); ?>"
                    class="px-8 py-4 bg-gray-100 text-oblink-gray font-bold rounded-xl hover:bg-gray-200 transition text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-calculator text-oblink-orange"></i> Simuler mes revenus
                </a>
            </div>
        </div>
    </div>

    <!-- Benefits Grid -->
    <div class="bg-gray-50 py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <!-- Card 1 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-orange-100 flex items-center justify-center text-oblink-orange text-2xl mb-6">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Liberté Totale</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Choisissez vos jours, vos horaires et vos zones géographiques. Vous êtes seul maître de votre
                        emploi du temps.
                    </p>
                </div>

                <!-- Card 2 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-blue-100 flex items-center justify-center text-oblink-blue text-2xl mb-6">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Revenus Boostés</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Fixez votre TJM (Taux Journalier) sans intermédiaire. En moyenne, nos freelances gagnent 30% de
                        plus qu'en salariat.
                    </p>
                </div>

                <!-- Card 3 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-purple-100 flex items-center justify-center text-oblink-violet text-2xl mb-6">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Zéro Administratif</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Contrats, factures, relances... OBLINK gère tout pour vous avec son <a
                            href="<?php echo home_url('/generateur-contrat'); ?>"
                            class="text-oblink-blue underline">outil dédié</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profils Recherchés Section -->
    <div class="py-20 px-4 bg-white">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-black font-display text-oblink-gray mb-6">
                    Tous les profils de l'optique
                </h2>
                <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                    Notre plateforme accueille <strong>tous les professionnels</strong> du secteur optique,
                    quel que soit votre métier ou votre statut.
                </p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Colonne 1: En Magasin -->
                <div class="bg-orange-50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-oblink-orange rounded-xl flex items-center justify-center text-white">
                            <i class="fas fa-store"></i>
                        </div>
                        <h3 class="text-xl font-bold text-oblink-gray">En Magasin</h3>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Opticien collaborateur</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Opticien remplaçant</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Opticien en alternance</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Vendeur optique</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Monteur-vendeur</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Conseiller solaires</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Audioprothésiste</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Assistant audioprothésiste</li>
                        <li><i class="fas fa-check text-oblink-orange mr-2"></i>Adaptateur lentilles</li>
                    </ul>
                </div>

                <!-- Colonne 2: Nomades / Terrain -->
                <div class="bg-blue-50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-oblink-blue rounded-xl flex items-center justify-center text-white">
                            <i class="fas fa-road"></i>
                        </div>
                        <h3 class="text-xl font-bold text-oblink-gray">Nomades</h3>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check text-oblink-blue mr-2"></i>Opticien à domicile</li>
                        <li><i class="fas fa-check text-oblink-blue mr-2"></i>Agent VRP</li>
                        <li><i class="fas fa-check text-oblink-blue mr-2"></i>Commercial secteur</li>
                        <li><i class="fas fa-check text-oblink-blue mr-2"></i>Animateur réseau</li>
                        <li><i class="fas fa-check text-oblink-blue mr-2"></i>Responsable de secteur</li>
                    </ul>
                </div>

                <!-- Colonne 3: Experts / Management -->
                <div class="bg-purple-50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-oblink-violet rounded-xl flex items-center justify-center text-white">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="text-xl font-bold text-oblink-gray">Experts</h3>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Opticien directeur</li>
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Responsable technique</li>
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Optométriste</li>
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Opticien tiers payant</li>
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Directeur des ventes</li>
                        <li><i class="fas fa-check text-oblink-violet mr-2"></i>Chef de produits</li>
                    </ul>
                </div>

                <!-- Colonne 4: Autres Professions -->
                <div class="bg-gray-100 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-oblink-gray rounded-xl flex items-center justify-center text-white">
                            <i class="fas fa-ellipsis-h"></i>
                        </div>
                        <h3 class="text-xl font-bold text-oblink-gray">Autres</h3>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check text-oblink-gray mr-2"></i>Orthoptiste</li>
                        <li><i class="fas fa-check text-oblink-gray mr-2"></i>AMO (Assistant médical)</li>
                        <li><i class="fas fa-check text-oblink-gray mr-2"></i>Enseignant optique</li>
                        <li><i class="fas fa-check text-oblink-gray mr-2"></i>... et bien d'autres !</li>
                    </ul>
                </div>
            </div>

            <div class="text-center mt-12">
                <p class="text-gray-500 text-lg">
                    Vous ne trouvez pas votre profil ? <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="text-oblink-orange font-bold hover:underline">Inscrivez-vous quand même !</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="py-20 px-4">
        <div
            class="max-w-5xl mx-auto bg-oblink-gray rounded-3xl p-8 md:p-16 text-center transform hover:scale-[1.01] transition duration-500 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10">
                <div class="absolute right-0 top-0 w-64 h-64 bg-oblink-orange rounded-full blur-3xl"></div>
                <div class="absolute left-0 bottom-0 w-64 h-64 bg-oblink-blue rounded-full blur-3xl"></div>
            </div>

            <div class="relative z-10">
                <h2 class="text-3xl md:text-5xl font-black font-display text-white mb-6">
                    Prêt à changer de vie ?
                </h2>
                <p class="text-xl text-gray-400 mb-10 max-w-2xl mx-auto font-light">
                    Rejoignez les 500+ opticiens qui ont déjà franchi le pas. Lancez-vous sans risque.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="px-8 py-4 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white font-bold rounded-xl shadow-lg hover:shadow-orange-500/30 hover:-translate-y-1 transition text-lg">
                        Créer mon compte Freelance
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- GLOBAL HARDCODED FOOTER REUSE -->
<div class="footer-wrapper">
    <?php include get_template_directory() . '/footer-content.php'; ?>
</div>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/setup/generate-sitemap.php ---
<?php
/**
 * OBLINK - Sitemap Generator
 * 
 * Generates dynamic XML sitemap for all public pages and posts.
 * Can be run manually or via cron job.
 * 
 * Usage: Upload to WordPress root and access via /generate-sitemap.php
 */

// Load WordPress
require_once('wp-load.php');

// Set XML header
header('Content-Type: application/xml; charset=utf-8');

// Start XML
echo '<?xml version="1.0" encoding="UTF-8"?>' . "\n";
echo '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' . "\n";

// Homepage
echo '  <url>' . "\n";
echo '    <loc>' . esc_url(home_url('/')) . '</loc>' . "\n";
echo '    <lastmod>' . date('Y-m-d') . '</lastmod>' . "\n";
echo '    <changefreq>daily</changefreq>' . "\n";
echo '    <priority>1.0</priority>' . "\n";
echo '  </url>' . "\n";

// Get all published pages
$pages = get_pages([
    'post_status' => 'publish',
    'sort_column' => 'post_modified',
]);

foreach ($pages as $page) {
    $permalink = get_permalink($page->ID);
    $lastmod = date('Y-m-d', strtotime($page->post_modified));

    // Determine priority based on page
    $priority = '0.8';
    if (in_array($page->post_name, ['pour-opticiens', 'pour-entreprises', 'emploi-opticien'])) {
        $priority = '0.9';
    }

    // Determine changefreq
    $changefreq = 'monthly';
    if (in_array($page->post_name, ['emploi-opticien', 'blog'])) {
        $changefreq = 'daily';
    } elseif (strpos($page->post_name, 'opticien-freelance-') === 0) {
        // Pages villes
        $changefreq = 'weekly';
    }

    echo '  <url>' . "\n";
    echo '    <loc>' . esc_url($permalink) . '</loc>' . "\n";
    echo '    <lastmod>' . $lastmod . '</lastmod>' . "\n";
    echo '    <changefreq>' . $changefreq . '</changefreq>' . "\n";
    echo '    <priority>' . $priority . '</priority>' . "\n";
    echo '  </url>' . "\n";
}

// Get all published posts (blog articles)
$posts = get_posts([
    'post_type' => 'post',
    'post_status' => 'publish',
    'numberposts' => -1,
    'orderby' => 'modified',
]);

foreach ($posts as $post) {
    $permalink = get_permalink($post->ID);
    $lastmod = date('Y-m-d', strtotime($post->post_modified));

    echo '  <url>' . "\n";
    echo '    <loc>' . esc_url($permalink) . '</loc>' . "\n";
    echo '    <lastmod>' . $lastmod . '</lastmod>' . "\n";
    echo '    <changefreq>monthly</changefreq>' . "\n";
    echo '    <priority>0.7</priority>' . "\n";
    echo '  </url>' . "\n";
}

// Close XML
echo '</urlset>';

// Optionally save to file
if (isset($_GET['save']) && $_GET['save'] === 'true') {
    $xml_content = ob_get_clean();
    file_put_contents(ABSPATH . 'sitemap.xml', $xml_content);
    echo "Sitemap saved to /sitemap.xml\n";
    echo '<a href="' . home_url('/sitemap.xml') . '">View Sitemap</a>';
}
?>--- FILE: theme/page-certificate.php ---
<?php
/*
Template Name: OBLINK Certificate
*/

// Security Check: Ensure valid access (normally checked via UUID in URL)
$cert_id = get_query_var('cert_id', 'DEMO-123456');
$student_name = isset($_GET['student']) ? sanitize_text_field($_GET['student']) : 'Étudiant OBLINK';
$score = isset($_GET['score']) ? intval($_GET['score']) : 100;
$date = date('d/m/Y');

?>
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificat de Réussite -
        <?php echo $student_name; ?>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for "Diploma" look -->
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        .font-diploma {
            font-family: 'Cinzel', serif;
        }

        .font-serif-body {
            font-family: 'Playfair Display', serif;
        }

        .watermark {
            background-image: url('https://www.svgrepo.com/show/499664/certificate.svg');
            /* Placeholder icon */
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.03;
        }

        .border-fancy {
            border: 8px double #1e3a8a;
            /* oblink-blue approx */
            padding: 4px;
        }

        .border-fancy-inner {
            border: 2px solid #ea580c;
            /* oblink-orange approx */
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Actions Bar -->
    <div class="mb-8 flex gap-4 no-print">
        <button onclick="downloadPDF()"
            class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            Télécharger le PDF
        </button>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=<?php echo urlencode(home_url('/verify/' . $cert_id)); ?>"
            target="_blank"
            class="bg-[#0077b5] text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-[#006396] transition flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
            Partager sur LinkedIn
        </a>
    </div>

    <!-- CERTIFICATE CONTAINER -->
    <div id="certificate"
        class="bg-white w-[297mm] h-[210mm] shadow-2xl relative flex p-10 mx-auto text-gray-800 watermark">
        <div class="border-fancy w-full h-full p-2">
            <div class="border-fancy-inner w-full h-full relative flex flex-col items-center justify-between p-12">

                <!-- Header -->
                <div class="text-center w-full">
                    <div class="flex items-center justify-center gap-2 mb-2 text-oblink-blue">
                        <!-- Logo Placeholder -->
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-orange-500 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xs">
                            OB</div>
                        <span class="font-bold tracking-[0.2em] text-gray-400 text-sm">OBLINK ACADEMY</span>
                    </div>
                    <h1 class="font-diploma text-5xl md:text-6xl text-gray-900 mb-2 mt-4 uppercase tracking-widest">
                        Certificat de Réussite</h1>
                    <h2 class="font-serif-body text-2xl text-orange-600 italic">Expert ERP Optique (Cosium 2026)</h2>
                </div>

                <!-- Body -->
                <div class="text-center w-3/4 mx-auto my-6">
                    <p class="font-serif-body text-xl text-gray-500 mb-4">Le présent certificat est délivré à</p>
                    <div
                        class="font-diploma text-4xl text-gray-900 border-b-2 border-gray-300 pb-2 mb-6 inline-block min-w-[300px]">
                        <?php echo $student_name; ?>
                    </div>
                    <p class="font-serif-body text-lg text-gray-600 leading-relaxed">
                        Pour avoir complété avec succès le parcours de formation avancée et validé l'examen de
                        certification <strong class="text-gray-900">"Cosium Expert : Flux Métiers & Optimisation
                            Tiers-Payant"</strong> avec un score d'excellence de <strong class="text-blue-600">
                            <?php echo $score; ?>%
                        </strong>.
                    </p>
                </div>

                <!-- Skills -->
                <div class="w-full grid grid-cols-2 gap-8 my-4 px-12">
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Ingénierie Tiers-Payant</strong>
                                (Flux AMC/DRE)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Conformité 2026</strong> (100%
                                Santé & Devis)</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Logistique EDI</strong> (Appro &
                                Stocks)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Performance</strong> (Pilotage
                                Marge & Dossiers)</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="w-full flex items-end justify-between mt-8 border-t border-gray-200 pt-8">
                    <div class="text-left">
                        <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Date de délivrance</p>
                        <p class="font-diploma text-lg">
                            <?php echo $date; ?>
                        </p>
                        <p class="text-[10px] text-gray-400 mt-2">ID:
                            <?php echo $cert_id; ?>
                        </p>
                    </div>

                    <div class="text-center">
                        <!-- Simplified Seal -->
                        <div
                            class="w-24 h-24 border-4 border-orange-500 rounded-full flex items-center justify-center p-1 rotate-[-10deg] opacity-80">
                            <div
                                class="w-full h-full border border-orange-500 rounded-full flex flex-col items-center justify-center text-orange-600 pb-1">
                                <span class="text-[8px] font-bold uppercase tracking-widest">Officiel</span>
                                <span class="font-diploma text-xl font-black">OBLINK</span>
                                <span class="text-[8px] font-bold uppercase tracking-widest">Academy</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-right flex flex-col items-end">
                        <p class="text-xs text-gray-400 uppercase tracking-wider mb-2">Vérifier l'authenticité</p>
                        <div id="qrcode" class="mb-2"></div>
                        <p class="font-diploma text-sm text-gray-900">Le Comité Pédagogique</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Generate QR Code
        const verifyUrl = "<?php echo home_url('/verify/' . $cert_id); ?>";
        new QRCode(document.getElementById("qrcode"), {
            text: verifyUrl,
            width: 80,
            height: 80,
            colorDark: "#1f2937",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        // PDF Generation
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('certificate');

            // Adjust scale for better quality
            html2canvas(element, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape, A4
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();

                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save("Certificat-Oblink-<?php echo $cert_id; ?>.pdf");
            });
        }
    </script>
</body>

</html>--- FILE: theme/page-mentions-legales.php ---
<?php
/*
Template Name: Mentions Légales
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl font-bold font-display text-oblink-gray mb-8">Mentions Légales</h1>

        <div class="prose prose-lg text-gray-500">
            <h3>1. Éditeur du site</h3>
            <p>Le site OBLINK est édité par la société OBLINK SAS, au capital de 10 000 euros, immatriculée au Registre
                du Commerce et des Sociétés de Paris sous le numéro 123 456 789.</p>
            <p><strong>Siège social :</strong> 10 Rue de la Paix, 75000 Paris, France.</p>
            <p><strong>Email :</strong> contact@oblink.fr</p>

            <h3>2. Directeur de publication</h3>
            <p>Monsieur Sergio Sandoval.</p>

            <h3>3. Hébergement</h3>
            <p>Le site est hébergé par OVH SAS, 2 rue Kellermann - 59100 Roubaix - France.</p>

            <h3>4. Propriété intellectuelle</h3>
            <p>L'ensemble de ce site relève de la législation française et internationale sur le droit d'auteur et la
                propriété intellectuelle. Tous les droits de reproduction sont réservés.</p>
        </div>
    </div>
</div>

<!-- HARDCODED FOOTER REUSE -->
<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-inscription-opticien.php ---
<?php
/*
Template Name: Page Inscription Opticien
*/
include 'header-inc.php';
?>

<!-- Auth Protection: Redirect if already logged in -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        if (window.oblinkSupabase) {
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            if (session) {
                // Already logged in, redirect to appropriate dashboard
                const userType = session.user.user_metadata?.user_type;
                if (userType === 'opticien') {
                    window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                } else if (userType === 'entreprise') {
                    window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                } else {
                    window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }
            }
        }
    });
</script>

<div class="min-h-screen bg-oblink-orange-claire/30 pt-32 pb-20 relative overflow-hidden">

    <!-- Background Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-10 w-64 h-64 bg-oblink-orange/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 left-10 w-80 h-80 bg-oblink-blue/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-4 relative z-10">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Devenez Opticien <span class="text-oblink-orange">Partenaire</span>
            </h1>
            <p class="text-lg text-oblink-gray/70 max-w-xl mx-auto font-body">
                Rejoignez la première communauté d'opticiens freelances. Trouvez des missions, gérez votre emploi du
                temps et boostez vos revenus.
            </p>
        </div>

        <!-- Multi-step Form Container -->
        <div class="bg-white rounded-[2rem] shadow-2xl border border-white/50 backdrop-blur-xl overflow-hidden">

            <!-- Progress Bar -->
            <div class="bg-gray-50 px-8 py-6 border-b border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-oblink-gray uppercase tracking-wider">Progression</span>
                    <span class="text-xs font-bold text-oblink-orange" id="progress-text">Étape 1 sur 3</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet h-2 rounded-full transition-all duration-500"
                        style="width: 33%" id="progress-bar"></div>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-green-50 border border-green-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-check-circle text-green-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-green-700" id="success-text"></p>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-red-50 border border-red-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-red-700" id="error-text"></p>
                    </div>
                </div>
            </div>

            <form id="opticien-register-form" class="p-8 md:p-12">

                <!-- STEP 1: Identité -->
                <div class="form-step active" data-step="1">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-orange/20 text-oblink-orange flex items-center justify-center text-sm font-bold">1</span>
                        Créez votre compte
                    </h2>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Prénom</label>
                            <input type="text" name="first_name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="Jean" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nom</label>
                            <input type="text" name="last_name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="Dupont" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email professionnel</label>
                        <div class="relative">
                            <i
                                class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="email" name="email"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="jean.dupont@email.com" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Type de poste recherché <span
                                class="text-red-500">*</span></label>
                        <select name="job_type" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition">
                            <option value="">Sélectionnez votre profil...</option>
                            <optgroup label="💼 En Magasin">
                                <option value="Opticien collaborateur H/F">Opticien collaborateur H/F</option>
                                <option value="Opticien remplaçant H/F">Opticien remplaçant H/F</option>
                                <option value="Opticien en alternance H/F">Opticien en alternance H/F</option>
                                <option value="Opticien directeur, gérant ou responsable H/F">Opticien directeur/gérant
                                    H/F</option>
                                <option value="Opticien tiers payant H/F">Opticien tiers payant H/F</option>
                                <option value="Vendeur H/F">Vendeur H/F</option>
                                <option value="Monteur H/F">Monteur H/F</option>
                                <option value="Monteur-vendeur H/F">Monteur-vendeur H/F</option>
                                <option value="Conseiller vendeur de solaires H/F">Conseiller solaires H/F</option>
                                <option value="Audioprothésiste H/F">Audioprothésiste H/F</option>
                                <option value="Assistant audioprothésiste H/F">Assistant audioprothésiste H/F</option>
                                <option value="Adaptateur de lentilles H/F">Adaptateur de lentilles H/F</option>
                            </optgroup>
                            <optgroup label="🚗 Nomades / Terrain">
                                <option value="Opticien à domicile H/F">Opticien à domicile H/F</option>
                                <option value="Agent - Commercial - VRP H/F">Agent VRP H/F</option>
                                <option value="Animateur réseau H/F">Animateur réseau H/F</option>
                                <option value="Responsable de secteur H/F">Responsable de secteur H/F</option>
                            </optgroup>
                            <optgroup label="👔 Experts / Management">
                                <option value="Responsable technique H/F">Responsable technique H/F</option>
                                <option value="Optométriste H/F">Optométriste H/F</option>
                                <option value="Directeur des ventes H/F">Directeur des ventes H/F</option>
                                <option value="Chef de produits H/F">Chef de produits H/F</option>
                            </optgroup>
                            <optgroup label="🩺 Autres Professions">
                                <option value="Orthoptiste H/F">Orthoptiste H/F</option>
                                <option value="AMO (Assistant médical ophta) H/F">AMO (Assistant médical ophta) H/F
                                </option>
                                <option value="Enseignant H/F">Enseignant optique H/F</option>
                                <option value="Autre en magasin H/F">Autre en magasin H/F</option>
                                <option value="Autre H/F">Autre profession H/F</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mot de passe</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="password" name="password"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="••••••••" required>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Au moins 8 caractères, une majuscule et un chiffre.</p>
                    </div>

                    <div class="flex justify-end">
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-orange transition-all flex items-center gap-2">
                            Continuer <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Profil Pro -->
                <div class="form-step hidden" data-step="2">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-blue/20 text-oblink-blue flex items-center justify-center text-sm font-bold">2</span>
                        Votre profil pro
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Niveau de diplôme</label>
                        <select name="diploma"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition">
                            <option value="bts">BTS Opticien Lunetier</option>
                            <option value="licence">Licence Pro d'Optique</option>
                            <option value="master">Master Sciences de la Vision</option>
                            <option value="etudiant">Étudiant (Stage/Alternance)</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Années d'expérience</label>
                        <div class="flex gap-4">
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="junior" class="hidden peer" checked>
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">0-2 ans</span>
                                    <span class="text-xs text-gray-500">Junior</span>
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="confirme" class="hidden peer">
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">3-7 ans</span>
                                    <span class="text-xs text-gray-500">Confirmé</span>
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="expert" class="hidden peer">
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">8+ ans</span>
                                    <span class="text-xs text-gray-500">Expert</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">CV & Diplômes (Optionnel)</label>
                        <div
                            class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-oblink-blue transition cursor-pointer bg-gray-50">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                            <p class="font-medium text-gray-600">Glissez vos fichiers ici ou <span
                                    class="text-oblink-blue underline">cliquez pour parcourir</span></p>
                            <p class="text-xs text-gray-400 mt-2">PDF, JPG, PNG (Max 5Mo)</p>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-blue transition-all flex items-center gap-2">
                            Suivant <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Préférences -->
                <div class="form-step hidden" data-step="3">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-violet/20 text-oblink-violet flex items-center justify-center text-sm font-bold">3</span>
                        Vos préférences
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Ville principale</label>
                        <div class="relative">
                            <i
                                class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="city"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 outline-none transition"
                                placeholder="Paris, Lyon, Bordeaux..." required>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mobilité</label>
                        <input type="range"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-oblink-violet"
                            min="0" max="100" step="10" value="20">
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span>0 km</span>
                            <span>50 km</span>
                            <span>100 km+</span>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" required
                                class="w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-600">J'accepte les <a href="#"
                                    class="underline text-oblink-violet">Conditions Générales d'Utilisation</a> et la
                                Politique de Confidentialité.</span>
                        </label>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2">
                            Valider mon inscription <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <div class="text-center mt-8">
            <p class="text-gray-500">Déjà inscrit ? <a href="<?php echo home_url('/login'); ?>"
                    class="font-bold text-oblink-orange hover:underline">Connexion</a></p>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('opticien-register-form');
        const steps = document.querySelectorAll('.form-step');
        const nextBtns = document.querySelectorAll('.next-step-btn');
        const prevBtns = document.querySelectorAll('.prev-step-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        let currentStep = 1;

        function updateStep(step) {
            steps.forEach(s => s.classList.add('hidden'));
            steps.forEach(s => s.classList.remove('active'));
            const activeStep = document.querySelector(`.form-step[data-step="${step}"]`);
            activeStep.classList.remove('hidden');

            const percentage = (step / 3) * 100;
            progressBar.style.width = percentage + '%';
            progressText.textContent = `Étape ${step} sur 3`;
            document.querySelector('.bg-white').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        nextBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep < 3) {
                    const inputs = steps[currentStep - 1].querySelectorAll('input[required]');
                    let valid = true;
                    inputs.forEach(input => {
                        if (!input.value) {
                            valid = false;
                            input.classList.add('border-red-500');
                        } else {
                            input.classList.remove('border-red-500');
                        }
                    });

                    if (valid) {
                        currentStep++;
                        updateStep(currentStep);
                    }
                }
            });
        });

        prevBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateStep(currentStep);
                }
            });
        });

        // SUPABASE SUBMISSION (Updated)
        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const formData = new FormData(form);
            const email = formData.get('email');
            const password = formData.get('password');
            const firstName = formData.get('first_name');
            const lastName = formData.get('last_name');

            // Metadata for Profile
            const metaData = {
                first_name: firstName,
                last_name: lastName,
                full_name: `${firstName} ${lastName}`,
                user_type: 'opticien',
                diploma: formData.get('diploma'),
                experience: formData.get('experience'),
                city: formData.get('city')
            };

            try {
                // 1. Sign Up
                const { data, error } = await window.oblinkSupabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: metaData
                    }
                });

                if (error) throw error;

                // 2. Wait for session to be fully established (fix race condition)
                let sessionReady = false;
                let attempts = 0;

                while (!sessionReady && attempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                    if (session) {
                        sessionReady = true;
                    }
                    attempts++;
                }

                if (!sessionReady) {
                    throw new Error("Session non établie. Veuillez vous reconnecter.");
                }

                // 3. Success - redirect with active session
                const successDiv = document.getElementById('success-message');
                const successText = document.getElementById('success-text');
                successText.textContent = '✅ Compte créé avec succès ! Redirection vers votre tableau de bord...';
                successDiv.classList.remove('hidden');
                successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                }, 1500);

            } catch (error) {
                console.error('Supabase Error:', error);

                // Show inline error
                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : ' + error.message;
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-confidentialite.php ---
<?php
/*
Template Name: Politique de Confidentialité (RGPD)
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <div class="text-center mb-16">
            <span
                class="inline-block py-1 px-3 rounded-full bg-blue-50 text-oblink-blue font-bold text-sm mb-4 uppercase tracking-wider">
                Données Personnelles
            </span>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">Politique de Confidentialité
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Vos données sont précieuses. Voici comment OBLINK les protège, conformément au RGPD.
            </p>
        </div>

        <div class="prose prose-lg text-gray-600 mx-auto">

            <h3>1. Collecte des données</h3>
            <p>Dans le cadre de l'utilisation de la plateforme, OBLINK est amené à collecter les données suivantes :</p>
            <ul>
                <li><strong>Identité :</strong> Nom, Prénom, Email, Téléphone.</li>
                <li><strong>Professionnelles :</strong> Diplômes, Numéro ADELI / RPPS, CV, Expérience.</li>
                <li><strong>Financières :</strong> RIB, Données de facturation (traitées par Stripe).</li>
                <li><strong>Connexion :</strong> Adresse IP, logs de connexion.</li>
            </ul>

            <h3>2. Données de Santé</h3>
            <p>OBLINK n'héberge <strong>aucune donnée de santé</strong> relative aux patients des opticiens
                (ordonnances, mesures de vue). Ces données restent exclusivement dans le logiciel métier du magasin et
                ne transitent pas par la plateforme.</p>

            <h3>3. Utilisation des données</h3>
            <p>Les données sont collectées pour les finalités suivantes :</p>
            <ul>
                <li>Mise en relation entre Opticiens et Magasins.</li>
                <li>Vérification des qualifications professionnelles.</li>
                <li>Gestion des paiements et de la facturation.</li>
                <li>Envoi de notifications liées aux missions.</li>
            </ul>

            <h3>4. Partage des données</h3>
            <p>Vos données ne sont jamais vendues à des tiers. Elles sont transmises uniquement :</p>
            <ul>
                <li>Aux magasins (pour les profils freelances) dans le cadre d'une candidature.</li>
                <li>À notre prestataire de paiement (Stripe) pour les obligations légales KYC (Know Your Customer).</li>
                <li>Aux autorités compétentes en cas de réquisition judiciaire.</li>
            </ul>

            <h3>5. Sécurité</h3>
            <p>OBLINK met en œuvre toutes les mesures techniques (chiffrement SSL, serveurs sécurisés) pour protéger vos
                données contre l'accès non autorisé.</p>

            <h3>6. Vos Droits</h3>
            <p>Conformément au RGPD, vous disposez d'un droit d'accès, de rectification, de portabilité et d'effacement
                de vos données. Pour exercer ce droit, contactez notre DPO à : <a
                    href="mailto:dpo@oblink.fr">dpo@oblink.fr</a>.</p>
        </div>

    </div>
</div>

<!-- GLOBAL HARDCODED FOOTER REUSE -->
<div class="footer-wrapper">
    <?php include get_template_directory() . '/footer-content.php'; ?>
</div>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-dashboard-etudiant.php ---
<?php
/*
Template Name: Dashboard Etudiant
*/
/*
Template Name: Dashboard Etudiant
*/
include 'header-inc.php';

// Verification simple de connexion (à renforcer)
if (!is_user_logged_in()) {
    echo '<script>window.location.href="' . home_url('/connexion') . '";</script>';
    exit;
}
$current_user = wp_get_current_user();
?>

<div class="bg-gray-50 min-h-screen pb-20 font-sans">

    <!-- Top Bar -->
    <div class="bg-white border-b border-gray-200 sticky top-16 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-graduation-cap text-oblink-orange mr-3"></i>
                    Mon Espace Académie
                </h1>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex items-center text-sm text-gray-500">
                        <span class="mr-2">Crédits IA:</span>
                        <span class="font-bold text-gray-900">500 / 500</span>
                    </div>
                    <button
                        class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 transition">
                        <i class="fas fa-play mr-2"></i>Nouveau Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Welcome Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Bonjour,
                <?php echo esc_html($current_user->display_name); ?> 👋
            </h2>
            <p class="text-gray-500">Prêt à sécuriser des points pour l'examen ?</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">

            <!-- Left Column: Stats & Progress -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Progress Card -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4">Progression Globale</h3>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-500">Analyse de la Vision</span>
                            <span class="font-bold text-oblink-orange">42%</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-oblink-orange rounded-full" style="width: 42%"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-500">Optique Géométrique</span>
                            <span class="font-bold text-oblink-blue">15%</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-oblink-blue rounded-full" style="width: 15%"></div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-yellow-500 shadow-sm border border-gray-100">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 text-transform uppercase font-bold">Points forts</p>
                                <p class="text-sm font-bold text-gray-900">Hypermétropie, Prismes</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4">Outils Rapides</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-file-pdf text-2xl text-red-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Annales</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-robot text-2xl text-oblink-violet mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Coach IA</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-calculator text-2xl text-green-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Formules</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-users text-2xl text-blue-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Forum</p>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Column: Activity Feed / Simulations -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Banner -->
                <div
                    class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-6 text-white relative overflow-hidden shadow-lg">
                    <div class="absolute right-0 top-0 h-full w-1/3 bg-white/5 skew-x-12 transform translate-x-12">
                    </div>
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold mb-2">Simulateur d'Examen 2026</h3>
                        <p class="text-gray-300 mb-4 text-sm max-w-md">Entraînez-vous sur des sujets probables générés
                            par IA en fonction des tendances des 5 dernières années.</p>
                        <button
                            class="bg-white text-gray-900 px-5 py-2 rounded-lg text-sm font-bold hover:bg-gray-100 transition">
                            Lancer une simulation (1h)
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <!-- Recent Activity (DYNAMIC FROM RAG) -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                            <h3 class="font-bold text-gray-900">Quiz du Jour (Basé sur vos Annales)</h3>
                            <span class="text-xs font-bold bg-oblink-orange/10 text-oblink-orange px-2 py-1 rounded">IA
                                Generated</span>
                        </div>
                        <div class="divide-y divide-gray-100">
                            <?php
                            // Load RAG Database from theme folder (embedded in zip)
                            $json_path = get_template_directory() . '/rag_database.json';

                            $rag_data = null;
                            if (file_exists($json_path)) {
                                $rag_data = json_decode(file_get_contents($json_path), true);
                            }

                            if ($rag_data && !empty($rag_data['exams'])) {
                                // Flatten concepts to get a random list
                                $all_concepts = [];
                                foreach ($rag_data['exams'] as $exam) {
                                    foreach ($exam['concepts'] as $concept) {
                                        $concept['year'] = $exam['year'];
                                        $concept['subject_name'] = $exam['subject'];
                                        $all_concepts[] = $concept;
                                    }
                                }

                                // Take 2 random concepts
                                shuffle($all_concepts);
                                $todays_quiz = array_slice($all_concepts, 0, 2);

                                foreach ($todays_quiz as $index => $q) {
                                    $unique_id = 'quiz-' . $index;
                                    ?>
                                    <div class="p-6 hover:bg-gray-50 transition group">
                                        <div class="flex items-start gap-4 mb-4">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-blue/10 text-oblink-blue flex items-center justify-center shrink-0 font-bold">
                                                <?php echo substr($q['subject_name'], 0, 1); ?>
                                            </div>
                                            <div class="flex-1">
                                            <div class="flex justify-between mb-1 relative pr-8">
                                                <h4 class="font-bold text-gray-900 text-sm">
                                                    <?php echo esc_html($q['topic']); ?> <span
                                                        class="text-gray-400 font-normal">•
                                                        <?php echo esc_html($q['year']); ?></span>
                                                    <?php if (isset($q['year']) && $q['year'] >= 2024): ?>
                                                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 text-purple-800 border border-purple-200">
                                                            Réforme 2024
                                                        </span>
                                                    <?php endif; ?>
                                                </h4>
                                                
                                                <!-- Close Button -->
                                                <button onclick="this.closest('.group').style.display='none'" class="absolute -top-1 -right-1 text-gray-300 hover:text-red-500 transition p-1">
                                                    <i class="fas fa-times"></i>
                                                </button>

                                                <!-- Difficulty (moved via flex but kept structure) -->
                                                <!-- <span class="text-xs text-gray-400">Difficulté: <?php echo str_repeat('★', $q['difficulty']); ?></span> -->
                                            </div>
                                            <div class="flex justify-between mb-3">
                                                <span class="text-xs text-gray-400">Difficulté: <?php echo str_repeat('★', $q['difficulty']); ?></span>
                                            </div>
                                                <p class="text-sm text-gray-800 font-medium mb-3">
                                                    "<?php echo esc_html($q['question_snippet']); ?>"
                                                </p>

                                                <!-- Hidden Answer -->
                                                <div id="<?php echo $unique_id; ?>"
                                                    class="hidden mt-3 p-4 bg-green-50 rounded-xl border border-green-100 text-sm">
                                                    <p class="font-bold text-green-800 mb-1"><i
                                                            class="fas fa-check-circle mr-2"></i>Réponse Officielle :</p>
                                                    <p class="text-gray-700 mb-2">
                                                        <?php echo esc_html($q['official_answer_snippet']); ?>
                                                    </p>

                                                    <?php if (!empty($q['common_mistakes'])): ?>
                                                        <div class="mt-2 pt-2 border-t border-green-200">
                                                            <p class="text-xs font-bold text-red-500 uppercase mb-1">⚠️ Pièges à
                                                                éviter :</p>
                                                            <ul class="list-disc list-inside text-xs text-gray-600">
                                                                <?php foreach ($q['common_mistakes'] as $mistake): ?>
                                                                    <li><?php echo esc_html($mistake); ?></li>
                                                                <?php endforeach; ?>
                                                            </ul>
                                                        </div>
                                                    <?php endif; ?>
                                                </div>

                                                <button
                                                    onclick="document.getElementById('<?php echo $unique_id; ?>').classList.toggle('hidden')"
                                                    class="text-xs text-white bg-oblink-blue px-3 py-1.5 rounded-lg font-bold hover:bg-blue-700 transition">
                                                    <i class="fas fa-eye mr-1"></i> Voir la correction
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-6 text-center text-gray-500">Aucune donnée de quiz disponible. Lancez l\'extraction IA.</div>';
                            }
                            ?>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <?php
    include get_template_directory() . "/footer-content.php";
    wp_footer();
    ?>--- FILE: theme/page-dashboard-opticien.php ---
<?php
/*
Template Name: Page Dashboard Opticien
*/
include 'header-inc.php';
?>

<!-- JS AUTH GUARD (Supabase) -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Wait for Supabase to be ready
        if (!window.oblinkSupabase) {
            console.error('Supabase not loaded!');
            // Show content anyway in dev mode
            document.getElementById('dashboard-content').classList.remove('opacity-0');
            return;
        }

        try {
            // 2. Check Auth
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                console.error('Auth error:', error);
                document.getElementById('dashboard-content').classList.remove('opacity-0');
                return;
            }

            if (!session) {
                // Not logged in -> Redirect Login
                window.location.href = '<?php echo home_url("/login"); ?>';
                return;
            }

            // 3. Check User Type (Security)
            const userType = session.user.user_metadata?.user_type;
            if (userType && userType !== 'opticien') {
                // Wrong dashboard -> Show clear message then redirect
                const dashboardContent = document.getElementById('dashboard-content');
                dashboardContent.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="max-w-md text-center p-8 bg-white rounded-2xl shadow-xl border border-gray-100">
                            <div class="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-circle text-red-500 text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-oblink-gray mb-3">Accès Refusé</h2>
                            <p class="text-gray-600 mb-6">
                                Cette page est réservée aux <strong>opticiens</strong>.<br>
                                Vous serez redirigé vers votre tableau de bord...
                            </p>
                            <div class="animate-pulse text-sm text-gray-400">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Redirection en cours
                            </div>
                        </div>
                    </div>
                `;
                dashboardContent.classList.remove('opacity-0');

                // Redirect after 2 seconds
                setTimeout(() => {
                    if (userType === 'entreprise') window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                    else window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }, 2000);
                return;
            }

            // 4. Inject User Name
            const userNameElement = document.getElementById('dashboard-username');
            if (userNameElement) {
                userNameElement.textContent = session.user.user_metadata?.first_name || 'Partenaire';
            }

            // 5. Show Content
            document.getElementById('dashboard-content').classList.remove('opacity-0');

        } catch (err) {
            console.error('Dashboard auth error:', err);
            // Show content anyway to avoid blank page
            document.getElementById('dashboard-content').classList.remove('opacity-0');
        }
    });
</script>

<!-- Main Content (Always Visible) -->
<div id="dashboard-content" class="min-h-screen bg-gray-50 pt-24 pb-12 transition-opacity duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Welcome Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-bold font-display text-oblink-gray">Bonjour, <span class="text-oblink-orange"
                        id="dashboard-username">...</span> 👋</h1>
                <p class="text-gray-500">Voici ce qui se passe aujourd'hui sur votre espace.</p>
            </div>
            <div class="flex gap-3">
                <a href="<?php echo home_url('/emploi-opticien'); ?>"
                    class="px-6 py-3 bg-gradient-to-r from-oblink-orange to-red-500 text-white rounded-full font-bold hover:shadow-xl transition-all flex items-center gap-2 shadow-lg">
                    <i class="fas fa-search"></i> Voir les offres
                </a>
                <a href="<?php echo home_url('/devis'); ?>"
                    class="px-4 py-2 bg-oblink-gray text-white rounded-xl font-bold hover:bg-oblink-orange transition flex items-center gap-2">
                    <i class="fas fa-file-invoice"></i> Nouveau Devis
                </a>
                <a href="<?php echo home_url('/parametres'); ?>"
                    class="px-4 py-2 bg-white border border-gray-200 rounded-xl font-semibold text-gray-600 hover:border-oblink-orange hover:text-oblink-orange transition flex items-center gap-2">
                    <i class="fas fa-cog"></i> Paramètres
                </a>
            </div>
        </div>

        <!-- KPI Cards (MOCKS STATIQUES POUR L'INSTANT) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- CA Mensuel -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-orange/10 flex items-center justify-center text-oblink-orange">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <span class="text-xs text-green-500 font-bold bg-green-50 px-2 py-1 rounded-full">+12%</span>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">
                    1 400 €
                </h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">CA Confirmé (Jan)</p>
            </div>

            <!-- Missions -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-blue/10 flex items-center justify-center text-oblink-blue">
                        <i class="fas fa-briefcase"></i>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">3</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Missions proposées</p>
            </div>

            <!-- Candidatures -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-violet/10 flex items-center justify-center text-oblink-violet">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <span class="text-xs text-oblink-orange font-bold bg-orange-50 px-2 py-1 rounded-full">2 news</span>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">5</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Candidatures en cours</p>
            </div>

            <!-- Note -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">4.9/5</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Note Moyenne</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- LEFT COLUMN (Main Content) -->
            <div class="lg:col-span-2 space-y-8">

                <!-- MESSAGERIE (Full Implementation) -->
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100"
                    id="messagerie-section">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-xl font-bold font-display text-oblink-gray flex items-center gap-2">
                            <i class="fas fa-comment-dots text-oblink-orange"></i> Messagerie
                        </h2>
                    </div>
                    <div class="flex h-[350px]">
                        <!-- Sidebar Conversations -->
                        <div class="w-1/3 border-r border-gray-100 bg-gray-50 overflow-y-auto" id="conversation-list">
                            <?php
                            $convs = oblink_get_conversations();
                            if ($convs) {
                                foreach ($convs as $c) {
                                    $contact = get_userdata($c->contact_id);
                                    $contact_name = $contact ? $contact->display_name : "Entreprise #" . $c->contact_id;
                                    ?>
                                    <div class="p-4 border-b border-gray-100 hover:bg-white cursor-pointer transition conversation-item"
                                        data-contact-id="<?php echo $c->contact_id; ?>">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-blue text-white flex items-center justify-center font-bold text-sm">
                                                <?php echo strtoupper(substr($contact_name, 0, 1)); ?>
                                            </div>
                                            <div class="overflow-hidden">
                                                <h4 class="font-bold text-sm text-gray-800 truncate">
                                                    <?php echo esc_html($contact_name); ?>
                                                </h4>
                                                <p class="text-xs text-gray-500 truncate">
                                                    <?php echo esc_html(substr($c->message, 0, 40)); ?>...
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-4 text-xs text-gray-400 text-center mt-10">Aucune conversation active</div>';
                            }
                            ?>
                        </div>
                        <!-- Chat Area -->
                        <div class="w-2/3 flex flex-col bg-white">
                            <div class="flex-1 p-6 overflow-y-auto space-y-4" id="chat-messages">
                                <div class="flex flex-col items-center justify-center h-full text-gray-400">
                                    <i class="fas fa-comments text-4xl mb-4 text-gray-200"></i>
                                    <p class="text-sm">Sélectionnez une conversation</p>
                                </div>
                            </div>
                            <!-- Input -->
                            <div class="p-4 border-t border-gray-100 bg-gray-50 hidden" id="chat-input-area">
                                <form id="send-message-form" class="flex gap-2">
                                    <input type="hidden" id="current-contact-id" value="">
                                    <input type="text" id="message-input"
                                        class="flex-1 rounded-xl border-gray-200 text-sm focus:ring-oblink-orange focus:border-oblink-orange"
                                        placeholder="Écrivez votre message...">
                                    <button type="submit"
                                        class="w-10 h-10 rounded-xl bg-oblink-orange text-white hover:bg-orange-600 transition flex items-center justify-center">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Missions (DYNAMIC) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">Missions récentes</h2>
                        <a href="<?php echo home_url('/emploi-opticien'); ?>"
                            class="text-sm font-semibold text-oblink-blue hover:underline">Voir tout</a>
                    </div>

                    <div id="dashboard-offers-container" class="space-y-4">
                        <!-- Loading State -->
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Chargement des offres...</p>
                        </div>
                    </div>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', async () => {
                        const container = document.getElementById('dashboard-offers-container');

                        try {
                            // Fetch active offers
                            const { data: offers, error } = await window.oblinkSupabase
                                .from('offers')
                                .select(`
                                *,
                                company:profiles!company_id (
                                    company_name,
                                    company_city
                                )
                            `)
                                .eq('status', 'active')
                                .order('created_at', { ascending: false })
                                .limit(5);

                            if (error) throw error;

                            if (!offers || offers.length === 0) {
                                container.innerHTML = '<div class="p-4 text-center text-gray-500">Aucune offre disponible pour le moment.</div>';
                                return;
                            }

                            // Render offers
                            container.innerHTML = offers.map(offer => {
                                const startDate = new Date(offer.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                                const endDate = offer.end_date ? new Date(offer.end_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }) : '';
                                const dateDisplay = endDate ? `${startDate} - ${endDate}` : `À partir du ${startDate}`;

                                // Determine color based on title first letter (randomish)
                                const letter = offer.company?.company_name?.charAt(0) || 'O';
                                const colors = ['oblink-blue', 'oblink-violet', 'oblink-orange'];
                                const colorClass = colors[offer.title.length % 3];

                                return `
                            <div class="flex flex-col md:flex-row md:items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100 hover:border-oblink-blue/30 transition group cursor-pointer" onclick="window.location.href='<?php echo home_url('/emploi-opticien'); ?>?id=${offer.id}'">
                                <div class="flex items-center gap-4 mb-4 md:mb-0">
                                    <div class="w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center text-xl font-bold ${colorClass}">
                                        ${letter}
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-oblink-gray group-hover:text-oblink-blue transition">
                                            ${offer.title}
                                        </h3>
                                        <p class="text-sm text-gray-500">
                                            <span class="font-semibold text-gray-700">${offer.company?.company_name || 'Entreprise confidentielle'}</span> • 
                                            <i class="far fa-calendar ml-1 mr-1"></i> ${dateDisplay}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="text-right">
                                        <span class="block font-bold text-oblink-gray">${offer.daily_rate} €/j</span>
                                        <span class="text-xs text-gray-500">${offer.city}</span>
                                    </div>
                                </div>
                            </div>
                            `;
                            }).join('');

                        } catch (err) {
                            console.error('Error loading offers:', err);
                            container.innerHTML = '<div class="text-red-500 text-center py-4">Impossible de charger les offres.</div>';
                        }
                    });
                </script>

                <!-- Available Missions Suggestions -->
                <div
                    class="bg-gradient-to-br from-oblink-gray to-black rounded-3xl p-6 md:p-8 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-oblink-orange/20 rounded-full blur-[80px]"></div>

                    <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                        <div>
                            <h2 class="text-xl font-bold font-display mb-2">3 nouvelles missions correspondent à votre
                                profil</h2>
                            <p class="text-white/60 text-sm">Basé sur vos préférences : Paris, >300€/j</p>
                        </div>
                        <a href="<?php echo home_url('/emploi-opticien'); ?>"
                            class="whitespace-nowrap px-6 py-3 bg-oblink-orange text-white font-bold rounded-xl hover:bg-white hover:text-oblink-orange transition shadow-lg shadow-oblink-orange/30">
                            Voir les offres
                        </a>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN (Sidebar) -->
            <div class="space-y-8">
                <!-- Quick Actions -->
                <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                    <h2 class="text-lg font-bold font-display text-oblink-gray mb-4">Accès Rapide</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="<?php echo home_url('/facture'); ?>"
                            class="p-4 rounded-xl bg-orange-100 hover:bg-orange-200 text-center transition group">
                            <i
                                class="fas fa-file-invoice-dollar text-2xl text-oblink-orange mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Nouvelle Facture</span>
                        </a>
                        <a href="<?php echo home_url('/generateur-contrat'); ?>"
                            class="p-4 rounded-xl bg-blue-50 hover:bg-blue-100 text-center transition group">
                            <i
                                class="fas fa-file-contract text-2xl text-oblink-blue mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Générateur Contrat</span>
                        </a>
                        <a href="<?php echo home_url('/formation-erp'); ?>"
                            class="p-4 rounded-xl bg-purple-50 hover:bg-purple-100 text-center transition group">
                            <i
                                class="fas fa-graduation-cap text-2xl text-oblink-violet mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Formation</span>
                        </a>
                        <a href="<?php echo home_url('/simulateur'); ?>"
                            class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 text-center transition group">
                            <i
                                class="fas fa-calculator text-2xl text-gray-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Simulateur</span>
                        </a>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<!-- MESSAGING JAVASCRIPT -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const conversationItems = document.querySelectorAll('.conversation-item');
        const chatMessages = document.getElementById('chat-messages');
        const chatInputArea = document.getElementById('chat-input-area');
        const currentContactIdInput = document.getElementById('current-contact-id');
        const sendMessageForm = document.getElementById('send-message-form');
        const messageInput = document.getElementById('message-input');

        // Load chat when clicking a conversation
        conversationItems.forEach(item => {
            item.addEventListener('click', function () {
                const contactId = this.dataset.contactId;
                currentContactIdInput.value = contactId;

                // Highlight selected
                conversationItems.forEach(c => c.classList.remove('bg-white', 'ring-2', 'ring-oblink-orange'));
                this.classList.add('bg-white', 'ring-2', 'ring-oblink-orange');

                // Show input area
                chatInputArea.classList.remove('hidden');

                // Load messages via AJAX
                loadChat(contactId);
            });
        });

        function loadChat(contactId) {
            chatMessages.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-spinner fa-spin mr-2"></i> Chargement...</div>';

            fetch(`<?php echo admin_url('admin-ajax.php'); ?>?action=oblink_load_chat&contact_id=${contactId}&nonce=${oblink_vars.nonce}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        chatMessages.innerHTML = data.data.html || '<p class="text-center text-gray-400 text-sm">Aucun message</p>';
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur chargement</p>';
                    }
                })
                .catch(() => {
                    chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur réseau</p>';
                });
        }

        // Send message
        if (sendMessageForm) {
            sendMessageForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const message = messageInput.value.trim();
                const receiverId = currentContactIdInput.value;

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            messageInput.value = '';
                            loadChat(receiverId); // Reload chat
                        } else {
                            alert('Erreur: ' + (data.data?.message || 'Envoi impossible'));
                        }
                    })
                    .catch(() => alert('Erreur réseau'));
            });
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-inscription-entreprise.php ---
<?php
/*
Template Name: Page Inscription Entreprise
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-oblink-blue/5 pt-32 pb-20 relative overflow-hidden">

    <!-- Background Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-10 w-96 h-96 bg-oblink-blue/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 left-10 w-64 h-64 bg-oblink-violet/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-4 relative z-10">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Recrutez vos <span class="text-oblink-blue">Opticiens</span>
            </h1>
            <p class="text-lg text-oblink-gray/70 max-w-xl mx-auto font-body">
                Inscrivez votre magasin en 2 minutes et accédez instantanément à notre vivier d'opticiens vérifiés.
            </p>
        </div>

        <!-- Multi-step Form Container -->
        <div class="bg-white rounded-[2rem] shadow-2xl border border-white/50 backdrop-blur-xl overflow-hidden">

            <!-- Progress Bar -->
            <div class="bg-gray-50 px-8 py-6 border-b border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-oblink-gray uppercase tracking-wider">Progression</span>
                    <span class="text-xs font-bold text-oblink-blue" id="progress-text">Étape 1 sur 3</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-oblink-blue to-oblink-violet h-2 rounded-full transition-all duration-500"
                        style="width: 33%" id="progress-bar"></div>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-green-50 border border-green-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-check-circle text-green-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-green-700" id="success-text"></p>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-red-50 border border-red-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-red-700" id="error-text"></p>
                    </div>
                </div>
            </div>

            <form id="entreprise-register-form" class="p-8 md:p-12">

                <!-- STEP 1: Entreprise -->
                <div class="form-step active" data-step="1">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-blue/20 text-oblink-blue flex items-center justify-center text-sm font-bold">1</span>
                        Votre Entreprise
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Raison Sociale / Nom du
                            Magasin</label>
                        <input type="text" name="company_name"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="Ex: Optic 2000 - Centre Villagio" required>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Numéro SIRET</label>
                        <input type="text" name="siret"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="14 chiffres" required>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Adresse Principale</label>
                        <div class="relative">
                            <i
                                class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="address" id="entreprise-address"
                                class="w-full pl-12 pr-16 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Commencez à taper votre adresse..." required>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-blue transition-all flex items-center gap-2">
                            Continuer <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Contact Admin -->
                <div class="form-step hidden" data-step="2">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-violet/20 text-oblink-violet flex items-center justify-center text-sm font-bold">2</span>
                        Administrateur du compte
                    </h2>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Prénom</label>
                            <input type="text" name="admin_firstname"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Marie" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nom</label>
                            <input type="text" name="admin_lastname"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Curie" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email de connexion</label>
                        <input type="email" name="admin_email"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="marie@optic2000.com" required>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" name="password"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="••••••••" required>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit" id="submit-btn"
                            class="px-8 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-oblink-gray transition-all flex items-center gap-2">
                            <i class="fas fa-check mr-2"></i> Créer mon compte
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Offre (TEMPORAIREMENT MASQUÉ) -->
                <div class="form-step hidden" data-step="3" style="display: none !important;">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-orange/20 text-oblink-orange flex items-center justify-center text-sm font-bold">3</span>
                        Choisissez votre formule
                    </h2>

                    <div class="grid md:grid-cols-2 gap-4 mb-8">
                        <!-- Plan Gratuit -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="plan" value="free" class="hidden peer" checked>
                            <div
                                class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-gray-50 transition-all shadow-sm">
                                <h3 class="text-xl font-bold text-oblink-gray mb-2">Découverte</h3>
                                <p class="text-3xl font-black text-oblink-gray mb-4">0 €<span
                                        class="text-sm font-normal text-gray-500">/mois</span></p>
                                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> 1
                                        Offre d'emploi</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i>
                                        Visibilité standard</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i>
                                        Commission standard</li>
                                </ul>
                            </div>
                            <div
                                class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-oblink-gray flex items-center justify-center transition-colors">
                                <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                            </div>
                        </label>

                        <!-- Plan Premium -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="plan" value="premium" class="hidden peer">
                            <div
                                class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-oblink-blue peer-checked:border-oblink-blue peer-checked:bg-blue-50/50 transition-all shadow-sm">
                                <div
                                    class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-oblink-blue text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">
                                    Recommandé</div>
                                <h3 class="text-xl font-bold text-oblink-blue mb-2">Premium</h3>
                                <p class="text-3xl font-black text-oblink-gray mb-4">49 €<span
                                        class="text-sm font-normal text-gray-500">/mois</span></p>
                                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Offres illimitées</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Accès CV-thèque</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Commission réduite</li>
                                </ul>
                            </div>
                            <div
                                class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-blue peer-checked:bg-oblink-blue flex items-center justify-center transition-colors">
                                <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                            </div>
                            <!-- Plan Corporate -->
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="plan" value="corporate" class="hidden peer">
                                <div
                                    class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-oblink-gray peer-checked:border-oblink-gray peer-checked:bg-gray-50 transition-all shadow-sm">
                                    <h3 class="text-xl font-bold text-oblink-gray mb-2">Corporate</h3>
                                    <p class="text-2xl font-black text-oblink-gray mb-4">Sur Mesure</p>
                                    <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            Multi-comptes</li>
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            API RH</li>
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            Facturation centralisée</li>
                                    </ul>
                                </div>
                                <div
                                    class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-oblink-gray flex items-center justify-center transition-colors">
                                    <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                                </div>
                            </label>
                    </div>

                    <!-- Payment Details (Conditional) -->
                    <div id="payment-section" class="hidden border-t border-gray-100 pt-6 mb-8 animated fadeIn">
                        <h4 class="font-bold text-oblink-gray mb-4">Paiement Sécurisé</h4>
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <div class="flex items-center gap-3 mb-4">
                                <i class="fas fa-credit-card text-gray-400"></i>
                                <input type="text" placeholder="Numéro de carte"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" placeholder="MM/AA"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                                <input type="text" placeholder="CVC"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2">
                            Créer mon compte Entreprise <i class="fas fa-building"></i>
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <div class="text-center mt-8">
            <p class="text-gray-500">Vous avez déjà un compte ? <a href="<?php echo home_url('/login'); ?>"
                    class="font-bold text-oblink-blue hover:underline">Connectez-vous</a></p>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Reuse the same logic as opticien form for stepper
        const steps = document.querySelectorAll('.form-step');
        const nextBtns = document.querySelectorAll('.next-step-btn');
        const prevBtns = document.querySelectorAll('.prev-step-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        let currentStep = 1;

        function updateStep(step) {
            steps.forEach(s => s.classList.add('hidden'));
            steps.forEach(s => s.classList.remove('active'));

            const activeStep = document.querySelector(`.form-step[data-step="${step}"]`);
            activeStep.classList.remove('hidden');

            const percentage = (step / 3) * 100;
            progressBar.style.width = percentage + '%';
            progressText.textContent = `Étape ${step} sur 3`;

            document.querySelector('form').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        nextBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Add validation here if needed
                if (currentStep < 3) {
                    currentStep++;
                    updateStep(currentStep);
                }
            });
        });

        prevBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateStep(currentStep);
                }
            });
        });

        // PAYMENT LOGIC
        const planInputs = document.querySelectorAll('input[name="plan"]');
        const paymentSection = document.getElementById('payment-section');

        function updatePaymentVisibility() {
            const selectedPlan = document.querySelector('input[name="plan"]:checked')?.value;
            if (selectedPlan === 'premium') {
                paymentSection.classList.remove('hidden');
                // Auto scroll to payment if visible
                setTimeout(() => {
                    paymentSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            } else {
                paymentSection.classList.add('hidden');
            }
        }

        planInputs.forEach(input => {
            input.addEventListener('change', updatePaymentVisibility);
        });

        // Init
        updatePaymentVisibility();

        // SUPABASE SUBMISSION (Updated with DEBUG)
        const form = document.getElementById('entreprise-register-form');

        console.log('DEBUG: Form element:', form);

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('DEBUG: Submit event fired!');

            const btn = form.querySelector('button[type="submit"]');
            console.log('DEBUG: Submit button:', btn);

            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const formData = new FormData(form);
            const email = formData.get('admin_email');
            const password = formData.get('password');
            const firstName = formData.get('admin_firstname');
            const lastName = formData.get('admin_lastname');

            console.log('DEBUG: Form values:', { email, firstName, lastName });

            // CHECK IF SUPABASE CLIENT EXISTS
            if (typeof window.oblinkSupabase === 'undefined') {
                console.error('ERREUR CRITIQUE: window.oblinkSupabase n\'existe pas!');

                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : Le système d\'authentification n\'est pas initialisé. Rechargez la page.';
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
                return;
            }

            console.log('DEBUG: Supabase client exists:', window.oblinkSupabase);

            // Metadata for Profile (Entreprise)
            const metaData = {
                first_name: firstName,
                last_name: lastName,
                full_name: `${firstName} ${lastName}`,
                company_name: formData.get('company_name'),
                siret: formData.get('siret'),
                address: formData.get('address'),
                user_type: 'entreprise',
                plan: formData.get('plan')
            };

            console.log('DEBUG: Metadata:', metaData);

            try {
                console.log('DEBUG: Calling signUp...');
                // 1. Sign Up
                const { data, error } = await window.oblinkSupabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: metaData
                    }
                });

                console.log('DEBUG: signUp response:', { data, error });

                if (error) throw error;

                // 2. Success
                const successDiv = document.getElementById('success-message');
                const successText = document.getElementById('success-text');
                successText.textContent = '✅ Compte entreprise créé avec succès ! Redirection...';
                successDiv.classList.remove('hidden');
                successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                }, 1500);

            } catch (error) {
                console.error('Supabase Error:', error);

                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : ' + (error.message || error);
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/header.php ---
<!DOCTYPE html>
<html <?php language_attributes(); ?>>

<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php wp_title('|', true, 'right'); ?></title>
    <?php wp_head(); ?>
    <style>
        /* Dropdown Menu Animation */
        .group:hover .group-hover\:visible {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Menu Animation */
        #mobile-menu {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        #mobile-menu.open {
            max-height: 100vh;
            opacity: 1;
        }

        /* Glassmorphism Header */
        .header-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>
</head>

<body <?php body_class('bg-white text-oblink-gray font-body'); ?>>

    <?php
    $current_role = oblink_get_user_role();
    $user_display_name = is_user_logged_in() ? wp_get_current_user()->display_name : '';
    $user_avatar_initial = $user_display_name ? substr($user_display_name, 0, 1) : '?';
    ?>

    <!-- Smart Header -->
    <header class="fixed w-full top-0 z-50 transition-all duration-300 header-glass shadow-sm" id="main-header">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">

                <!-- 1. LEFT: LOGO (Constant) -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="<?php echo home_url('/'); ?>" class="flex items-center group no-underline">
                        <div
                            class="px-3 py-1 bg-oblink-orange rounded flex items-center justify-center transform group-hover:scale-105 transition-transform duration-300">
                            <span class="text-white font-bold text-xl tracking-wide"
                                style="font-family: 'Overpass', sans-serif;">OBLINK</span>
                        </div>
                        <?php if ($current_role !== 'visitor'): ?>
                            <span
                                class="ml-3 text-xs font-bold uppercase tracking-widest text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full border border-gray-200">
                                <?php
                                switch ($current_role) {
                                    case 'student':
                                        echo 'Étudiant';
                                        break;
                                    case 'freelance':
                                        echo 'Expert Certifié';
                                        break;
                                    case 'recruiter':
                                        echo 'Recruteur';
                                        break;
                                }
                                ?>
                            </span>
                        <?php endif; ?>
                    </a>
                </div>

                <!-- 2. CENTER: NAVIGATION (Dynamic) -->
                <nav class="hidden md:flex space-x-8">

                    <?php if ($current_role === 'visitor'): ?>
                        <!-- === VISITOR MENU === -->

                        <!-- Académie Dropdown -->
                        <div class="relative group">
                            <button
                                class="text-oblink-gray group-hover:text-oblink-orange font-medium flex items-center transition outline-none py-5">
                                <span>Académie</span>
                                <i class="fas fa-chevron-down ml-2 text-xs transition-transform group-hover:rotate-180"></i>
                            </button>
                            <div
                                class="absolute left-1/2 transform -translate-x-1/2 mt-0 w-80 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:visible transition-all duration-200 z-50 top-full">
                                <div class="p-3 space-y-2">
                                    <a href="<?php echo home_url('/pass-examen'); ?>"
                                        class="block px-4 py-3 rounded-lg hover:bg-orange-50 transition">
                                        <p class="text-sm font-bold text-gray-900">Pass Examen BTS</p>
                                        <p class="text-xs text-gray-500">Quiz IA & Annales 2026</p>
                                    </a>
                                    <a href="<?php echo home_url('/formation-erp'); ?>"
                                        class="block px-4 py-3 rounded-lg hover:bg-orange-50 transition">
                                        <p class="text-sm font-bold text-gray-900">Formations ERP</p>
                                        <p class="text-xs text-gray-500">Devenez Expert Cosium</p>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <a href="<?php echo home_url('/simulateur'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition">Simulateur Salaire</a>
                        <a href="<?php echo home_url('/abonnements'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition">Tarifs</a>


                    <?php elseif ($current_role === 'student'): ?>
                        <!-- === STUDENT MENU === -->
                        <a href="<?php echo home_url('/dashboard'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition flex items-center gap-2">
                            <i class="fas fa-chart-pie text-gray-400"></i> Dashboard
                        </a>
                        <a href="<?php echo home_url('/academie'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition flex items-center gap-2">
                            <i class="fas fa-brain text-gray-400"></i> Outils IA
                        </a>
                        <!-- "Passer Expert" Promo Link -->
                        <a href="<?php echo home_url('/formation-erp'); ?>"
                            class="text-oblink-violet font-bold hover:text-oblink-violet/80 transition flex items-center gap-2 animate-pulse">
                            <i class="fas fa-certificate"></i> Devenir Expert
                        </a>

                    <?php elseif ($current_role === 'freelance'): ?>
                        <!-- === FREELANCE MENU === -->
                        <a href="<?php echo home_url('/missions'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition flex items-center gap-2">
                            <i class="fas fa-briefcase text-gray-400"></i> Trouver une mission
                        </a>
                        <a href="<?php echo home_url('/mes-certifications'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition flex items-center gap-2">
                            <i class="fas fa-award text-gray-400"></i> Mes Certifs
                        </a>
                        <a href="<?php echo home_url('/formation-erp'); ?>"
                            class="text-oblink-gray hover:text-oblink-orange font-medium transition flex items-center gap-2">
                            <i class="fas fa-graduation-cap text-gray-400"></i> Se former
                        </a>

                    <?php elseif ($current_role === 'recruiter'): ?>
                        <!-- === RECRUITER MENU === -->
                        <a href="<?php echo home_url('/admin-dashboard'); ?>"
                            class="text-oblink-gray hover:text-oblink-blue font-medium transition flex items-center gap-2">
                            <i class="fas fa-tachometer-alt text-gray-400"></i> Pilotage
                        </a>
                        <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                            class="text-oblink-gray hover:text-oblink-blue font-medium transition flex items-center gap-2">
                            <i class="fas fa-search text-gray-400"></i> CV-thèque
                        </a>
                        <a href="<?php echo home_url('/mes-annonces'); ?>"
                            class="text-oblink-gray hover:text-oblink-blue font-medium transition flex items-center gap-2">
                            <i class="fas fa-bullhorn text-gray-400"></i> Mes Annonces
                        </a>
                    <?php endif; ?>

                </nav>

                <!-- 3. RIGHT: ACTIONS (Dynamic) -->
                <div class="hidden md:flex items-center space-x-4">

                    <?php if ($current_role === 'visitor'): ?>
                        <!-- Visitor Actions -->
                        <a href="<?php echo home_url('/login'); ?>"
                            class="text-sm font-semibold text-gray-500 hover:text-oblink-orange transition">Connexion</a>
                        <a href="<?php echo home_url('/inscription-opticien'); ?>"
                            class="px-5 py-2.5 bg-oblink-orange text-white rounded-lg font-bold shadow hover:bg-oblink-orange/90 transition transform hover:-translate-y-0.5">
                            Accès Membre
                        </a>

                    <?php else: ?>
                        <!-- Logged In Actions (Shared Structure with Role specifics) -->
                        <div class="flex items-center space-x-4 relative group">
                            <button class="flex items-center space-x-2 focus:outline-none">
                                <div class="text-right hidden lg:block">
                                    <p class="text-sm font-bold text-gray-900 leading-none">
                                        <?php echo $user_display_name; ?></p>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <?php echo ucfirst($current_role); ?>
                                    </p>
                                </div>
                                <div
                                    class="w-10 h-10 rounded-full bg-gradient-to-br from-oblink-orange to-orange-400 text-white flex items-center justify-center font-bold shadow-md ring-2 ring-white">
                                    <?php echo $user_avatar_initial; ?>
                                </div>
                            </button>
                            <!-- User Dropdown -->
                            <div
                                class="absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 py-2 opacity-0 invisible group-hover:visible transition-all duration-200 z-50">
                                <a href="<?php echo home_url('/profil'); ?>"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Mon Profil</a>
                                <a href="<?php echo home_url('/compte'); ?>"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Réglages</a>
                                <div class="border-t border-gray-100 my-1"></div>
                                <a href="<?php echo wp_logout_url(home_url()); ?>"
                                    class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Déconnexion</a>
                            </div>
                        </div>
                    <?php endif; ?>

                </div>

                <!-- MOBILE MENU BUTTON -->
                <div class="flex md:hidden">
                    <button type="button" class="text-oblink-gray hover:text-oblink-orange focus:outline-none"
                        id="mobile-menu-btn">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- MOBILE MENU (Simplified for V1) -->
        <div id="mobile-menu" class="bg-white border-t border-gray-100 md:hidden shadow-xl">
            <div class="px-4 pt-4 pb-6 space-y-2">

                <?php if ($current_role === 'visitor'): ?>
                    <a href="<?php echo home_url('/pass-examen'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 rounded-md">Pass
                        Examen</a>
                    <a href="<?php echo home_url('/simulateur'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 rounded-md">Simulateur</a>
                    <div class="border-t border-gray-100 my-2"></div>
                    <a href="<?php echo home_url('/login'); ?>"
                        class="block px-3 py-2 text-base font-medium text-oblink-orange">Connexion</a>

                <?php elseif ($current_role === 'student'): ?>
                    <a href="<?php echo home_url('/dashboard'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700">Dashboard</a>
                    <a href="<?php echo home_url('/academie'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700">Quiz IA</a>
                    <a href="<?php echo home_url('/formation-erp'); ?>"
                        class="block px-3 py-2 text-base font-bold text-oblink-violet">Devenir Expert</a>

                <?php elseif ($current_role === 'freelance'): ?>
                    <a href="<?php echo home_url('/missions'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700">Missions</a>
                    <a href="<?php echo home_url('/mes-certifications'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700">Certifications</a>

                <?php elseif ($current_role === 'recruiter'): ?>
                    <a href="<?php echo home_url('/admin-dashboard'); ?>"
                        class="block px-3 py-2 text-base font-bold text-oblink-blue">Pilotage</a>
                    <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                        class="block px-3 py-2 text-base font-medium text-gray-700">CV-thèque</a>
                <?php endif; ?>

                <?php if ($current_role !== 'visitor'): ?>
                    <div class="border-t border-gray-100 my-2 pt-2">
                        <a href="<?php echo wp_logout_url(home_url()); ?>" class="block px-3 py-2 text-sm text-red-600">Se
                            déconnecter</a>
                    </div>
                <?php endif; ?>
            </div>
        </div>
    </header>

    <!-- Spacer -->
    <div class="h-20"></div>

    <!-- Scripts -->
    <script>
        document.getElementById('mobile-menu-btn').addEventListener('click', function () {
            document.getElementById('mobile-menu').classList.toggle('open');
        });
    </script>--- FILE: theme/page-pour-entreprises.php ---
<?php
/*
Template Name: Pour Entreprises
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white">

    <!-- Hero Section -->
    <div class="pt-32 pb-20 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        <div class="text-center max-w-4xl mx-auto">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-blue/10 text-oblink-blue font-bold text-sm mb-6 uppercase tracking-wider">
                Pour les Magasins & Enseignes
            </span>
            <h1 class="text-5xl md:text-7xl font-black font-display text-oblink-gray mb-8 leading-tight">
                Recrutez un opticien <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-blue to-oblink-violet">en 24
                    heures.</span>
            </h1>
            <p class="text-xl text-gray-500 mb-10 max-w-2xl mx-auto font-light leading-relaxed">
                Accédez à la plus grande base de freelances qualifiés et disponibles immédiatement. Fini les fermetures
                de magasin par manque de personnel.
            </p>

            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="px-8 py-4 bg-oblink-blue text-white font-bold rounded-xl shadow-lg hover:shadow-blue-500/30 hover:-translate-y-1 transition text-lg">
                    Publier une mission
                </a>
                <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                    class="px-8 py-4 bg-gray-100 text-oblink-gray font-bold rounded-xl hover:bg-gray-200 transition text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-search text-oblink-blue"></i> Consulter les CVs
                </a>
            </div>
        </div>
    </div>

    <!-- Benefits Grid -->
    <div class="bg-gray-50 py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <!-- Card 1 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-blue-100 flex items-center justify-center text-oblink-blue text-2xl mb-6">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Réactivité Immédiate</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Un arrêt maladie imprévu ? Trouvez un remplaçant opérationnel pour le lendemain matin. Nos
                        freelances sont notifiés en temps réel.
                    </p>
                </div>

                <!-- Card 2 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-purple-100 flex items-center justify-center text-oblink-violet text-2xl mb-6">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Profils Vérifiés</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Diplômes et identité contrôlés. Vous recrutez des professionnels de confiance, évalués par la
                        communauté.
                    </p>
                </div>

                <!-- Card 3 -->
                <div
                    class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 hover:shadow-xl transition hover:-translate-y-1">
                    <div
                        class="w-14 h-14 rounded-2xl bg-green-100 flex items-center justify-center text-green-600 text-2xl mb-6">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h3 class="text-xl font-bold text-oblink-gray mb-3 font-display">Juridique Sécurisé</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">
                        Générez un contrat de prestation blindé en un clic. Évitez les risques de requalification grâce
                        à nos outils conformes.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="py-20 px-4">
        <div
            class="max-w-5xl mx-auto bg-gray-900 rounded-3xl p-8 md:p-16 text-center transform hover:scale-[1.01] transition duration-500 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-20">
                <div class="absolute right-0 top-0 w-64 h-64 bg-oblink-blue rounded-full blur-3xl"></div>
                <div class="absolute left-0 bottom-0 w-64 h-64 bg-oblink-violet rounded-full blur-3xl"></div>
            </div>

            <div class="relative z-10">
                <h2 class="text-3xl md:text-5xl font-black font-display text-white mb-6">
                    Ne perdez plus de chiffre d'affaires.
                </h2>
                <p class="text-xl text-gray-400 mb-10 max-w-2xl mx-auto font-light">
                    Le coût d'un magasin fermé une journée est de 1500€. Un freelance vous coûte 3x moins cher.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                        class="px-8 py-4 bg-white text-oblink-gray font-bold rounded-xl shadow-lg hover:bg-gray-100 transition text-lg">
                        Créer un compte Magasin
                    </a>
                </div>
            </div>
        </div>
    </div>

</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/footer.php ---
</main><!-- Close Main -->

<!-- FOOTER -->
<!-- Added inline styles to force visibility even if Tailwind fails -->
<footer id="main-footer" class="bg-gray-900 text-white pt-12 pb-6 relative z-10"
        style="background-color: #1F2937 !important; color: #FFFFFF !important; border-top: 4px solid #FF6600; position: relative; width: 100%; display: block !important;">

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">

                        <!-- Brand & Mission -->
                        <div class="space-y-4">
                                <a href="<?php echo home_url('/'); ?>"
                                        class="inline-block text-2xl font-black tracking-tight"
                                        style="font-family: 'Overpass', sans-serif; text-decoration: none;">
                                        <span style="color:#FFF">OB</span><span style="color:#FF6600">LINK</span><span
                                                style="color:#0099FF">.</span>
                                </a>
                                <p class="text-sm leading-relaxed" style="color: #9CA3AF; max-width: 280px;">
                                        La première plateforme de mise en relation directe entre Opticiens Freelances et
                                        Magasins d'Optique.
                                </p>
                        </div>

                        <!-- Navigation Freelances -->
                        <div>
                                <h3 class="text-base font-bold mb-4" style="color:#FFF;">Pour les Opticiens</h3>
                                <ul class="space-y-2 text-sm" style="color: #9CA3AF;">
                                        <li><a href="<?php echo home_url('/inscription-opticien'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Inscription Freelance</a></li>
                                        <li><a href="<?php echo home_url('/emploi-opticien'); ?>"
                                                        class="hover:text-white transition" style="color:inherit">Offres
                                                        d'emploi</a></li>
                                        <li><a href="<?php echo home_url('/simulateur'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Simulateur de Revenus</a></li>
                                        <li><a href="<?php echo home_url('/formation-erp'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Académie Oblink</a></li>
                                </ul>
                        </div>

                        <!-- Navigation Entreprises -->
                        <div>
                                <h3 class="text-base font-bold mb-4" style="color:#FFF;">Pour les Magasins</h3>
                                <ul class="space-y-2 text-sm" style="color: #9CA3AF;">
                                        <li><a href="<?php echo home_url('/inscription-entreprise'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Recruter un Opticien</a></li>
                                        <li><a href="<?php echo home_url('/recherche-opticiens'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">CV-thèque</a></li>
                                        <li><a href="<?php echo home_url('/abonnements'); ?>"
                                                        class="hover:text-white transition" style="color:inherit">Tarifs
                                                        & Abonnements</a></li>
                                        <li><a href="<?php echo home_url('/generateur-contrat'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Générateur de Contrat</a></li>
                                </ul>
                        </div>

                        <!-- Légal & Support -->
                        <div>
                                <h3 class="text-base font-bold mb-4" style="color:#FFF;">Informations</h3>
                                <ul class="space-y-2 text-sm" style="color: #9CA3AF;">
                                        <li><a href="<?php echo home_url('/a-propos'); ?>"
                                                        class="hover:text-white transition" style="color:inherit">À
                                                        propos</a></li>
                                        <li><a href="<?php echo home_url('/blog'); ?>"
                                                        class="hover:text-white transition" style="color:inherit">Le
                                                        Blog</a></li>
                                        <li><a href="mailto:contact@oblink.fr" class="hover:text-white transition"
                                                        style="color:inherit">Contact & Support</a></li>
                                        <li><a href="<?php echo home_url('/mentions-legales'); ?>"
                                                        class="hover:text-white transition"
                                                        style="color:inherit">Mentions Légales</a></li>
                                </ul>
                        </div>

                </div>

                <div class="border-t border-gray-800 pt-6 flex flex-col md:flex-row justify-between items-center gap-4 text-xs"
                        style="border-top-color: #374151; color: #6B7280;">
                        <div class="flex flex-col md:flex-row items-center gap-4">
                                <p>&copy; <?php echo date('Y'); ?> OBLINK. Tous droits réservés.</p>
                                <div class="flex items-center gap-4">
                                        <!-- Social Links -->
                                        <a href="#" class="text-gray-400 hover:text-white transition"><i
                                                        class="fab fa-linkedin-in text-lg"></i></a>
                                        <a href="#" class="text-gray-400 hover:text-white transition"><i
                                                        class="fab fa-instagram text-lg"></i></a>
                                        <a href="#" class="text-gray-400 hover:text-white transition"><i
                                                        class="fab fa-facebook-f text-lg"></i></a>
                                </div>
                        </div>

                        <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-green-500"
                                        style="background-color: #10B981; display:inline-block"></span>
                                <span>Système Opérationnel - <?php echo date('d/m/Y'); ?></span>
                        </div>
                </div>

        </div>
</footer>

<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/style.css ---
/*
Theme Name: OBLINK Theme
Theme URI: https://oblink.fr
Author: OBLINK Team
Author URI: https://oblink.fr
Description: Custom WordPress theme for OBLINK - Optician Logic Link
Version: 1.0
License: GNU General Public License v2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: oblink
*/

/* OBLINK - Apple Vision Pro Glassmorphism Style */

* {
    font-family: 'Inter', sans-serif;
}

h1,
h2,
h3,
h4,
h5,
h6,
.font-display {
    font-family: 'Overpass', sans-serif;
}

html {
    scroll-behavior: smooth;
}

body {
    background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
}

/* ===== GLASSMORPHISM COMPONENTS ===== */

.glass {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}

.glass-dark {
    background: rgba(48, 48, 48, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
}

.glass-gradient {
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0.1) 0%,
            rgba(98, 146, 158, 0.1) 50%,
            rgba(154, 72, 208, 0.1) 100%);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* ===== SMOOTH ANIMATIONS ===== */

@keyframes float {

    0%,
    100% {
        transform: translateY(0px);
    }

    50% {
        transform: translateY(-20px);
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes scaleIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes shimmer {
    0% {
        background-position: -1000px 0;
    }

    100% {
        background-position: 1000px 0;
    }
}

.animate-float {
    animation: float 6s ease-in-out infinite;
}

.animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out;
}

.animate-fade-in {
    animation: fadeIn 1s ease-out;
}

.animate-scale-in {
    animation: scaleIn 0.6s ease-out;
}

/* ===== NAVIGATION ===== */

#navbar {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-link {
    position: relative;
    transition: color 0.3s ease;
}

.nav-link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 50%;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #FF6600, #9A48D0);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(-50%);
}

.nav-link:hover::after {
    width: 100%;
}

/* ===== HERO SECTION ===== */

#hero {
    position: relative;
    overflow: hidden;
}

.hero-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0.03) 0%,
            rgba(98, 146, 158, 0.03) 50%,
            rgba(154, 72, 208, 0.03) 100%);
    z-index: 0;
}

.hero-gradient-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.3;
    animation: float 8s ease-in-out infinite;
}

.orb-1 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255, 102, 0, 0.4), transparent);
    top: 10%;
    left: 10%;
    animation-delay: 0s;
}

.orb-2 {
    width: 350px;
    height: 350px;
    background: radial-gradient(circle, rgba(98, 146, 158, 0.4), transparent);
    top: 50%;
    right: 10%;
    animation-delay: 2s;
}

.orb-3 {
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(154, 72, 208, 0.4), transparent);
    bottom: 10%;
    left: 40%;
    animation-delay: 4s;
}

/* ===== LIQUID GLASS EFFECTS ===== */

@keyframes liquid-morph {

    0%,
    100% {
        border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
        transform: translate(0, 0) scale(1);
    }

    25% {
        border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
        transform: translate(20px, -20px) scale(1.05);
    }

    50% {
        border-radius: 50% 60% 30% 60% / 30% 60% 70% 40%;
        transform: translate(-20px, 20px) scale(0.95);
    }

    75% {
        border-radius: 60% 40% 60% 40% / 70% 30% 50% 60%;
        transform: translate(-20px, -20px) scale(1.02);
    }
}

@keyframes glow-pulse {

    0%,
    100% {
        opacity: 0.3;
        filter: blur(40px);
    }

    50% {
        opacity: 0.6;
        filter: blur(60px);
    }
}

.liquid-glass-blob {
    position: absolute;
    width: 300px;
    height: 300px;
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    filter: blur(60px);
    opacity: 0.4;
    animation: liquid-morph 15s ease-in-out infinite;
    pointer-events: none;
}

.blob-1 {
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.3), rgba(255, 102, 0, 0.1));
    top: -100px;
    left: -50px;
    animation-delay: 0s;
}

.blob-2 {
    background: linear-gradient(135deg, rgba(98, 146, 158, 0.3), rgba(98, 146, 158, 0.1));
    top: 50%;
    right: -100px;
    animation-delay: 5s;
    width: 400px;
    height: 400px;
}

.blob-3 {
    background: linear-gradient(135deg, rgba(154, 72, 208, 0.3), rgba(154, 72, 208, 0.1));
    bottom: -150px;
    left: 30%;
    animation-delay: 10s;
    width: 350px;
    height: 350px;
}

/* ===== COMPACT SERVICE CARDS - LIQUID GLASS ===== */

.service-card-liquid {
    position: relative;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    text-align: center;
    overflow: hidden;
}

.service-card-liquid::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0.1),
            rgba(154, 72, 208, 0.1));
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 0;
}

.service-card-liquid:hover::before {
    opacity: 1;
}

.service-card-liquid:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 20px 40px rgba(255, 102, 0, 0.2);
    border-color: rgba(255, 102, 0, 0.3);
}

.service-icon-mini {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 0.75rem;
    font-size: 1.25rem;
    color: white;
    transition: all 0.4s ease;
    position: relative;
    z-index: 1;
}

.service-card-liquid:hover .service-icon-mini {
    transform: rotateY(360deg) scale(1.1);
    box-shadow: 0 8px 20px rgba(255, 102, 0, 0.4),
        0 0 40px rgba(255, 102, 0, 0.3),
        0 0 60px rgba(154, 72, 208, 0.2);
    animation: tech-glow 2s ease-in-out infinite;
}

@keyframes tech-glow {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(1.2);
    }
}

.service-card-liquid h3 {
    position: relative;
    z-index: 1;
    transition: color 0.3s ease;
}

.service-card-liquid:hover h3 {
    color: #FF6600;
}

/* ===== COMPACT TESTIMONIALS - LIQUID GLASS ===== */

.testimonial-card-liquid {
    position: relative;
    padding: 1.25rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(31, 38, 135, 0.15);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

.testimonial-card-liquid::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg,
            transparent,
            rgba(255, 102, 0, 0.1),
            transparent);
    transform: rotate(45deg);
    transition: all 0.6s ease;
}

.testimonial-card-liquid:hover::before {
    left: 100%;
}

.testimonial-card-liquid:hover {
    transform: translateY(-4px);
    box-shadow: 0 15px 40px rgba(255, 102, 0, 0.15);
    border-color: rgba(255, 102, 0, 0.3);
}

.testimonial-avatar-mini {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #62929E, #9A48D0);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(98, 146, 158, 0.3);
    transition: all 0.3s ease;
}

.testimonial-card-liquid:hover .testimonial-avatar-mini {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 16px rgba(98, 146, 158, 0.4),
        0 0 30px rgba(98, 146, 158, 0.3),
        0 0 50px rgba(154, 72, 208, 0.2);
    animation: avatar-glow 2s ease-in-out infinite;
}

@keyframes avatar-glow {

    0%,
    100% {
        filter: brightness(1) saturate(1);
    }

    50% {
        filter: brightness(1.15) saturate(1.2);
    }
}

/* ===== PARTICLES BACKGROUND ===== */

.particle-container {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    border-radius: 50%;
    opacity: 0.3;
    animation: particle-float 15s ease-in-out infinite;
}

@keyframes particle-float {

    0%,
    100% {
        transform: translate(0, 0);
        opacity: 0.3;
    }

    25% {
        transform: translate(50px, -50px);
        opacity: 0.6;
    }

    50% {
        transform: translate(-30px, 30px);
        opacity: 0.4;
    }

    75% {
        transform: translate(40px, 20px);
        opacity: 0.5;
    }
}

/* ===== BLOG FILTERS ===== */

.filter-btn {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    color: #393D3F;
    transition: all 0.3s ease;
}

.filter-btn.active {
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    color: white;
    border: none;
    box-shadow: 0 8px 16px rgba(255, 102, 0, 0.3);
    transform: translateY(-2px);
}

.filter-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.article-card {
    transition: opacity 0.3s ease, transform 0.3s ease;
}

/* ===== 3D CAROUSEL - ORIGINAL ===== */

.carousel-3d-container {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
    perspective: 2000px;
    height: 500px;
}

.carousel-3d {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
}

.carousel-3d-item {
    position: absolute;
    width: 100%;
    max-width: 600px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    pointer-events: none;
}

.carousel-3d-item.active {
    opacity: 1;
    transform: translate(-50%, -50%) translateZ(0) scale(1);
    z-index: 10;
    pointer-events: auto;
}

.carousel-3d-item.prev {
    opacity: 0.4;
    transform: translate(-50%, -50%) translateX(-400px) translateZ(-200px) rotateY(25deg) scale(0.8);
    z-index: 5;
}

.carousel-3d-item.next {
    opacity: 0.4;
    transform: translate(-50%, -50%) translateX(400px) translateZ(-200px) rotateY(-25deg) scale(0.8);
    z-index: 5;
}

.process-card-glass {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(30px) saturate(180%);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 32px;
    padding: 3rem;
    box-shadow: 0 20px 60px rgba(31, 38, 135, 0.2);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.process-card-glass::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg,
            transparent,
            rgba(255, 102, 0, 0.1),
            transparent);
    transform: rotate(45deg);
    transition: all 0.6s ease;
}

.carousel-3d-item.active .process-card-glass:hover::before {
    left: 100%;
}

.carousel-3d-item.active .process-card-glass:hover {
    transform: translateY(-10px);
    box-shadow: 0 30px 80px rgba(255, 102, 0, 0.25);
    border-color: rgba(255, 102, 0, 0.3);
}

.process-number {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.1), rgba(154, 72, 208, 0.1));
    border: 3px solid rgba(255, 102, 0, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0 auto 2rem;
    transition: all 0.4s ease;
    font-family: 'Montserrat', sans-serif;
}

.carousel-3d-item.active .process-card-glass:hover .process-number {
    transform: rotateY(360deg) scale(1.1);
    box-shadow: 0 0 40px rgba(255, 102, 0, 0.4);
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.2), rgba(154, 72, 208, 0.2));
}

/* Carousel Controls */
.carousel-controls {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    display: flex;
    justify-content: space-between;
    padding: 0 2rem;
    pointer-events: none;
    z-index: 100;
    /* Increased from 20 to prevent overlap */
}

.carousel-btn {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 102, 0, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #FF6600;
    font-size: 1.25rem;
    pointer-events: auto;
    box-shadow: 0 8px 24px rgba(31, 38, 135, 0.15);
}

.carousel-btn:hover {
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 12px 32px rgba(255, 102, 0, 0.3);
}

.carousel-btn:active {
    transform: scale(0.95);
}

/* Carousel Indicators */
.carousel-indicators {
    position: absolute;
    bottom: -60px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 20;
}

.carousel-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 102, 0, 0.2);
    border: 2px solid rgba(255, 102, 0, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-indicator.active {
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    border-color: #FF6600;
    transform: scale(1.5);
    box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
}

.carousel-indicator:hover {
    transform: scale(1.3);
    background: rgba(255, 102, 0, 0.5);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .carousel-3d-container {
        height: 450px;
    }

    .carousel-3d-item.prev,
    .carousel-3d-item.next {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.7);
    }

    .process-card-glass {
        padding: 2rem;
    }

    .process-number {
        width: 60px;
        height: 60px;
        font-size: 2rem;
    }

    /* HIDE carousel arrows on mobile */
    .carousel-controls {
        display: none;
    }

    /* Keep indicators visible */
    .carousel-indicators {
        bottom: -40px;
    }
}

/* ===== COMPACT CAROUSEL - UX OPTIMIZED ===== */

.carousel-compact-container {
    position: relative;
    max-width: 900px;
    margin: 0 auto;
}

/* Progress Bar */
.carousel-progress-bar {
    position: relative;
}

.progress-track {
    height: 3px;
    background: rgba(255, 102, 0, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #FF6600, #9A48D0);
    width: 33.33%;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 10px rgba(255, 102, 0, 0.5);
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    margin-bottom: 2rem;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
    cursor: pointer;
    transition: all 0.3s ease;
}

.step-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 102, 0, 0.2);
    border: 2px solid rgba(255, 102, 0, 0.3);
    transition: all 0.3s ease;
}

.progress-step.active .step-dot {
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    border-color: #FF6600;
    box-shadow: 0 0 15px rgba(255, 102, 0, 0.5);
    transform: scale(1.3);
}

.step-label {
    font-size: 0.75rem;
    color: #393D3F;
    opacity: 0.5;
    transition: all 0.3s ease;
    font-weight: 600;
}

.progress-step.active .step-label {
    opacity: 1;
    color: #FF6600;
}

/* Compact Carousel */
.carousel-3d-compact {
    position: relative;
    height: 200px;
    perspective: 1000px;
    margin-bottom: 2rem;
}

@media (max-width: 768px) {
    .carousel-3d-compact {
        height: 240px;
    }
}

.carousel-compact-item {
    position: absolute;
    width: 100%;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateX(50%) scale(0.9);
    pointer-events: none;
}

.carousel-compact-item.active {
    opacity: 1;
    transform: translateX(0) scale(1);
    pointer-events: auto;
    z-index: 10;
}

.carousel-compact-item.prev {
    opacity: 0.3;
    transform: translateX(-100%) scale(0.85);
}

.carousel-compact-item.next {
    opacity: 0.3;
    transform: translateX(100%) scale(0.85);
}

/* Process Cards - Compact */
.process-card-compact {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 20px;
    padding: 1.5rem;
    box-shadow: 0 10px 40px rgba(31, 38, 135, 0.1);
    transition: all 0.3s ease;
}

.process-card-compact:hover {
    transform: translateY(-4px);
    box-shadow: 0 15px 50px rgba(255, 102, 0, 0.15);
    border-color: rgba(255, 102, 0, 0.3);
}

.process-icon-compact {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 8px 20px rgba(255, 102, 0, 0.3);
    transition: all 0.4s ease;
}

.process-card-compact:hover .process-icon-compact {
    transform: rotateY(360deg) scale(1.1);
    box-shadow: 0 10px 30px rgba(255, 102, 0, 0.4),
        0 0 40px rgba(255, 102, 0, 0.2);
}

.process-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.process-badge.orange {
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.15), rgba(255, 102, 0, 0.05));
    color: #FF6600;
    border: 1px solid rgba(255, 102, 0, 0.2);
}

.process-badge.blue {
    background: linear-gradient(135deg, rgba(98, 146, 158, 0.15), rgba(98, 146, 158, 0.05));
    color: #62929E;
    border: 1px solid rgba(98, 146, 158, 0.2);
}

.process-badge.violet {
    background: linear-gradient(135deg, rgba(154, 72, 208, 0.15), rgba(154, 72, 208, 0.05));
    color: #9A48D0;
    border: 1px solid rgba(154, 72, 208, 0.2);
}

/* Navigation Compact */
.carousel-nav-compact {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
}

.carousel-btn-compact {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 102, 0, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #FF6600;
    font-size: 1rem;
    box-shadow: 0 4px 12px rgba(31, 38, 135, 0.1);
}

.carousel-btn-compact:hover {
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(255, 102, 0, 0.3);
}

.carousel-btn-compact:active {
    transform: scale(0.95);
}

.carousel-counter {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
    color: #393D3F;
}

.current-slide {
    font-size: 1.5rem;
    color: #FF6600;
}

.slide-separator {
    font-size: 1rem;
    color: #393D3F;
    opacity: 0.3;
}

.total-slides {
    font-size: 1rem;
    color: #393D3F;
    opacity: 0.5;
}

/* Auto-play Toggle */
.autoplay-toggle {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 102, 0, 0.2);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #FF6600;
    font-weight: 600;
}

.autoplay-toggle:hover {
    background: rgba(255, 102, 0, 0.1);
    transform: translateY(-2px);
}

.autoplay-toggle.paused {
    opacity: 0.5;
}

.autoplay-toggle.paused i {
    animation: none;
}

/* Responsive */
@media (max-width: 768px) {
    .process-card-compact {
        padding: 1.25rem;
    }

    .process-icon-compact {
        width: 48px;
        height: 48px;
        font-size: 1.25rem;
    }

    .carousel-nav-compact {
        gap: 1rem;
    }

    .carousel-btn-compact {
        width: 40px;
        height: 40px;
        font-size: 0.875rem;
    }
}

/* ===== CTA CARDS WITH GLASSMORPHISM ===== */

.cta-card-glass {
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 24px;
}

.cta-card-glass::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg,
            rgba(255, 255, 255, 0.9),
            rgba(255, 255, 255, 0.7));
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    z-index: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.cta-card-glass:hover::before {
    background: linear-gradient(135deg,
            rgba(255, 255, 255, 0.95),
            rgba(255, 255, 255, 0.8));
}

.cta-card-glass:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
}

.cta-card-content {
    position: relative;
    z-index: 1;
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.cta-character {
    width: 280px;
    height: 280px;
    object-fit: contain;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.1));
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.cta-card-glass:hover .cta-character {
    transform: scale(1.05) translateY(-5px);
}

.cta-info {
    flex: 1;
    text-align: left;
}

.cta-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 1rem;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.cta-badge-optician {
    background: rgba(98, 146, 158, 0.2);
    color: #62929E;
    border: 1px solid rgba(98, 146, 158, 0.3);
}

.cta-badge-company {
    background: rgba(255, 102, 0, 0.2);
    color: #FF6600;
    border: 1px solid rgba(255, 102, 0, 0.3);
}

/* ===== STATS SECTION ===== */

.stat-card-glass {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.stat-card-glass:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.8);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
}

.stat-number {
    font-size: 3rem;
    font-weight: 800;
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
    display: inline-block;
}

/* ===== 3D CAROUSEL ===== */

.carousel-3d-container {
    perspective: 1200px;
    width: 100%;
    height: 500px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.carousel-3d {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.carousel-3d-item {
    position: absolute;
    width: 350px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.4;
}

.carousel-3d-item.active {
    opacity: 1;
    z-index: 3;
}

.carousel-3d-item.prev {
    transform: translate(-50%, -50%) translateX(-400px) translateZ(-200px) rotateY(25deg);
    z-index: 2;
}

.carousel-3d-item.next {
    transform: translate(-50%, -50%) translateX(400px) translateZ(-200px) rotateY(-25deg);
    z-index: 2;
}

/* Process Card for Carousel */
.process-card-glass {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 24px;
    padding: 2.5rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.process-card-glass::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg,
            transparent,
            rgba(255, 102, 0, 0.1),
            transparent);
    transform: rotate(45deg);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
}

.carousel-3d-item.active .process-card-glass::before {
    opacity: 1;
    transform: rotate(45deg) translate(50%, 50%);
}

.carousel-3d-item.active .process-card-glass {
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 30px 80px rgba(255, 102, 0, 0.2);
    transform: scale(1.05);
}

.process-number {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.process-number::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: linear-gradient(135deg, #FF6600, #62929E, #9A48D0);
    border-radius: 50%;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.4s;
}

.carousel-3d-item.active .process-number::before {
    opacity: 0.3;
    animation: spin 3s linear infinite;
}

/* Carousel Controls */
.carousel-controls {
    position: absolute;
    bottom: -60px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 1rem;
    z-index: 10;
}

.carousel-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #FF6600;
    font-size: 1.2rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.carousel-btn:hover {
    background: #FF6600;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 6px 25px rgba(255, 102, 0, 0.3);
}

.carousel-btn:active {
    transform: scale(0.95);
}

/* Carousel Indicators */
.carousel-indicators {
    position: absolute;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.75rem;
    z-index: 10;
}

.carousel-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 102, 0, 0.3);
    border: 2px solid rgba(255, 102, 0, 0.5);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.carousel-indicator.active {
    background: #FF6600;
    transform: scale(1.3);
}

.carousel-indicator:hover {
    background: #FF6600;
    transform: scale(1.2);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .carousel-3d-container {
        height: 450px;
    }

    .carousel-3d-item {
        width: 280px;
    }

    .carousel-3d-item.prev,
    .carousel-3d-item.next {
        transform: translate(-50%, -50%) translateX(0) translateZ(-300px) rotateY(0deg);
        opacity: 0;
    }

    .carousel-controls {
        bottom: -50px;
    }

    .carousel-indicators {
        bottom: -85px;
    }
}

/* ===== FEATURE SECTIONS ===== */

.feature-card-glass {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 28px;
    padding: 3rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.feature-card-glass:hover {
    background: rgba(255, 255, 255, 0.75);
    transform: scale(1.02);
    box-shadow: 0 25px 70px rgba(0, 0, 0, 0.12);
}

.feature-image-wrapper {
    position: relative;
    border-radius: 24px;
    overflow: hidden;
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0.05),
            rgba(98, 146, 158, 0.05),
            rgba(154, 72, 208, 0.05));
    padding: 3rem;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.feature-character {
    width: 100%;
    height: 400px;
    object-fit: contain;
    filter: drop-shadow(0 15px 40px rgba(0, 0, 0, 0.15));
    animation: float 6s ease-in-out infinite;
}

/* ===== SERVICE CARDS ===== */

.service-card-glass {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.service-card-glass::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0),
            rgba(255, 102, 0, 0.1));
    opacity: 0;
    transition: opacity 0.4s;
}

.service-card-glass:hover::after {
    opacity: 1;
}

.service-card-glass:hover {
    transform: translateY(-8px);
    background: rgba(255, 255, 255, 0.8);
    border-color: rgba(255, 102, 0, 0.3);
    box-shadow: 0 20px 60px rgba(255, 102, 0, 0.15);
}

.service-icon {
    width: 72px;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 1.5rem;
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 18px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #62929E;
    transition: all 0.3s;
    position: relative;
    z-index: 1;
}

.service-card-glass:hover .service-icon {
    transform: scale(1.1) rotate(-5deg);
    color: #FF6600;
    background: rgba(255, 102, 0, 0.1);
}

/* ===== TESTIMONIAL CARDS ===== */

.testimonial-card-glass {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 24px;
    padding: 2.5rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.testimonial-card-glass::before {
    content: '"';
    position: absolute;
    top: -30px;
    left: 20px;
    font-size: 10rem;
    color: rgba(255, 102, 0, 0.08);
    font-family: Georgia, serif;
    line-height: 1;
}

.testimonial-card-glass:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.85);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
}

.testimonial-avatar {
    width: 72px;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg,
            rgba(255, 102, 0, 0.2),
            rgba(98, 146, 158, 0.2));
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.5);
    font-size: 1.5rem;
    margin-right: 1rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

/* ===== BUTTONS ===== */

.btn-glass {
    position: relative;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #303030;
    padding: 1rem 2rem;
    border-radius: 16px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

.btn-glass::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #FF6600, #9A48D0);
    opacity: 0;
    transition: opacity 0.3s;
    z-index: -1;
}

.btn-glass:hover::before {
    opacity: 1;
}

.btn-glass:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(255, 102, 0, 0.3);
}

.btn-primary-glass {
    background: linear-gradient(135deg, #FF6600, #FF8533);
    border: none;
    color: white;
}

.btn-primary-glass:hover {
    background: linear-gradient(135deg, #e55a00, #FF6600);
    box-shadow: 0 15px 40px rgba(255, 102, 0, 0.4);
}

/* ===== FOOTER ===== */

footer.glass-dark {
    margin-top: 4rem;
}

/* ===== MOTION DESIGN HELPERS ===== */

.motion-safe {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.hover-scale:hover {
    transform: scale(1.02);
}

.hover-lift:hover {
    transform: translateY(-4px);
}

/* ===== SCROLLBAR ===== */

::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #FF6600, #9A48D0);
    border-radius: 10px;
    border: 2px solid rgba(255, 255, 255, 0.1);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #e55a00, #8839b8);
}

/* ===== RESPONSIVE ===== */

@media (max-width: 768px) {
    .hero-gradient-orb {
        width: 250px !important;
        height: 250px !important;
    }

    .cta-character {
        width: 200px;
        height: 200px;
    }

    .feature-character {
        height: 300px;
    }

    .cta-card-content {
        flex-direction: column;
        text-align: center;
    }

    .cta-info {
        text-align: center;
    }

    .stat-number {
        font-size: 2rem;
    }
}

/* ===== ACCESSIBILITY ===== */

@media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}--- FILE: theme/page-dashboard.php ---
<?php
/*
Template Name: Dashboard
*/
include 'header-inc.php';
?>

<!-- JS AUTH GUARD & ROUTER -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Check Auth
        const { data: { session } } = await window.oblinkSupabase.auth.getSession();

        if (!session) {
            window.location.href = '<?php echo home_url("/login"); ?>';
            return;
        }

        // 2. Redirect based on User Type
        const userType = session.user.user_metadata.user_type;
        if (userType === 'opticien') {
            window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
        } else if (userType === 'entreprise') {
            window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
        }
    });
</script>

<div class="max-w-7xl mx-auto px-4 py-32 min-h-screen">
    <!-- Header -->
    <div class="flex justify-between items-center mb-12">
        <div>
            <h1 class="text-4xl font-bold text-oblink-gray mb-2" style="font-family: 'Montserrat', sans-serif;">
                Tableau de bord
            </h1>
            <p class="text-oblink-gray/70">Bienvenue sur votre espace OBLINK</p>
        </div>
        <div class="flex gap-4">
            <a href="<?php echo home_url('/devis'); ?>"
                class="px-6 py-3 border-2 border-oblink-blue text-oblink-blue rounded-lg font-semibold hover:bg-oblink-blue hover:text-white transition">
                <i class="fas fa-file-alt mr-2"></i>Nouveau Devis
            </a>
            <a href="<?php echo home_url('/facture'); ?>"
                class="px-6 py-3 bg-oblink-orange text-white rounded-lg font-semibold hover:bg-oblink-orange/90 transition shadow-lg">
                <i class="fas fa-plus mr-2"></i>Nouvelle Facture
            </a>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="grid md:grid-cols-4 gap-6 mb-12">
        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-orange">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Chiffre d'affaires</div>
                    <div class="text-2xl font-bold text-oblink-gray">12 450 €</div>
                </div>
                <div
                    class="w-10 h-10 bg-oblink-orange/10 rounded-lg flex items-center justify-center text-oblink-orange">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="text-green-500 text-sm flex items-center">
                <i class="fas fa-arrow-up mr-1"></i> +15% ce mois
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-blue">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Missions réalisées</div>
                    <div class="text-2xl font-bold text-oblink-gray">24</div>
                </div>
                <div class="w-10 h-10 bg-oblink-blue/10 rounded-lg flex items-center justify-center text-oblink-blue">
                    <i class="fas fa-check-circle"></i>
                </div>
            </div>
            <div class="text-oblink-gray/60 text-sm">
                Depuis le début de l'année
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-violet">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Factures en attente</div>
                    <div class="text-2xl font-bold text-oblink-gray">3</div>
                </div>
                <div
                    class="w-10 h-10 bg-oblink-violet/10 rounded-lg flex items-center justify-center text-oblink-violet">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="text-oblink-blue text-sm font-semibold">
                840 € à encaisser
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-green-500">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Taux de réponse</div>
                    <div class="text-2xl font-bold text-oblink-gray">98%</div>
                </div>
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="text-green-500 text-sm flex items-center">
                Top profil
            </div>
        </div>
    </div>

    <!-- Recent Activity / Missions -->
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Missions List -->
        <div class="lg:col-span-2 space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-oblink-gray">Missions récentes</h2>
                <a href="#" class="text-oblink-orange font-semibold hover:underline">Tout voir</a>
            </div>

            <div class="bg-white rounded-2xl shadow-xl overflow-hidden glass-card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50/50 border-b border-gray-100">
                            <tr>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Entreprise</th>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Date/Lieu</th>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Statut</th>
                                <th class="text-right py-4 px-6 text-sm font-semibold text-gray-600">Montant</th>
                                <th class="py-4 px-6"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Optique Martin</div>
                                    <div class="text-xs text-gray-500">SIRET: 123...456</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">15 Jan - 17 Jan</div>
                                    <div class="text-xs text-gray-500">Bordeaux (33)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Terminé
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    840 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Alain Afflelou</div>
                                    <div class="text-xs text-gray-500">Mérignac Soleil</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">20 Jan - 25 Jan</div>
                                    <div class="text-xs text-gray-500">Mérignac (33)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        Confirmé
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    1 680 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Krys</div>
                                    <div class="text-xs text-gray-500">Centre Ville</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">05 Fév</div>
                                    <div class="text-xs text-gray-500">Paris (75)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        En attente
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    280 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sidebar / Tools -->
        <div class="space-y-6">
            <h2 class="text-2xl font-bold text-oblink-gray">Outils rapides</h2>

            <div class="bg-white p-6 rounded-2xl shadow-xl glass-card">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fas fa-file-invoice-dollar text-oblink-orange mr-2"></i>Facturation
                </h3>
                <div class="space-y-3">
                    <a href="<?php echo home_url('/facture'); ?>"
                        class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition group">
                        <div
                            class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 group-hover:bg-green-200 transition">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="ml-3">
                            <div class="font-semibold text-gray-800">Nouvelle facture</div>
                            <div class="text-xs text-gray-500">Éditer une facture conforme</div>
                        </div>
                    </a>
                    <a href="<?php echo home_url('/devis'); ?>"
                        class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition group">
                        <div
                            class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 group-hover:bg-blue-200 transition">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="ml-3">
                            <div class="font-semibold text-gray-800">Nouveau devis</div>
                            <div class="text-xs text-gray-500">Envoyer une proposition</div>
                        </div>
                    </a>
                </div>
            </div>

            <div class="bg-gradient-to-br from-oblink-orange to-oblink-violet p-6 rounded-2xl shadow-xl text-white">
                <h3 class="font-bold text-lg mb-2">Besoin d'aide ?</h3>
                <p class="text-white/80 text-sm mb-4">Contactez notre support dédié aux opticiens.</p>
                <button
                    class="w-full py-2 bg-white/20 backdrop-blur-md rounded-lg hover:bg-white/30 transition text-sm font-semibold">
                    Contacter le support
                </button>
            </div>
        </div>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-generateur-contrat.php ---
<?php
/*
Template Name: Page Generateur Contrat
*/
include 'header-inc.php';
?>

<!-- CDN pour la génération de PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="text-center mb-12">
            <span class="inline-block py-1 px-3 rounded-full bg-oblink-blue/10 text-oblink-blue font-bold text-sm mb-4 uppercase tracking-wider">
                Outil Juridique Gratuit
            </span>
            <h1 class="text-4xl font-bold font-display text-oblink-gray mb-4">
                Générateur de Contrat <span class="text-oblink-blue">Expert Optique</span>
            </h1>
            <p class="text-lg text-gray-500 max-w-2xl mx-auto">
                Créez une convention de prestation sur-mesure. 
                <span class="text-oblink-orange font-bold block mt-2 text-sm"><i class="fas fa-certificate mr-1"></i> Idéal pour valoriser une expertise spécifique (Vente, Réfraction, Atelier).</span>
            </p>
        </div>

        <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
            <form id="contract-form" class="p-8 md:p-12">
                
                <!-- SECTION 1 : The Parties -->
                <div class="grid md:grid-cols-2 gap-12 mb-12">
                    
                    <!-- Client (Magasin) -->
                    <div>
                        <h3 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                            <i class="fas fa-store text-oblink-blue"></i> Le Client (Magasin)
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Raison Sociale</label>
                                <input type="text" id="client_name" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: SAS Optic Vision" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">SIRET</label>
                                <input type="text" id="client_siret" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="14 chiffres" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Adresse Complète</label>
                                <input type="text" id="client_address" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="10 rue de la République, 75000 Paris" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Représenté par</label>
                                <input type="text" id="client_rep" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="M. Dupont (Gérant)" required>
                            </div>
                        </div>
                    </div>

                    <!-- Prestataire (Opticien) -->
                    <div>
                        <h3 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                            <i class="fas fa-user-tie text-oblink-orange"></i> Le Prestataire (Freelance)
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Nom & Prénom</label>
                                <input type="text" id="freelance_name" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="Ex: Julie Martin" required>
                            </div>
                            
                            <!-- Qualification Selector -->
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Niveau de Qualification</label>
                                <select id="freelance_qualif" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" onchange="toggleAdeli()">
                                    <option value="opticien">Opticien Diplômé (BTS)</option>
                                    <option value="monteur">Monteur-Vendeur (Non diplômé)</option>
                                    <option value="expert_refraction">Expert Réfraction / Optométrie</option>
                                    <option value="consultant">Consultant Vente / Business</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">SIRET (Auto-entrepreneur)</label>
                                <input type="text" id="freelance_siret" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="14 chiffres" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Adresse</label>
                                <input type="text" id="freelance_address" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" required>
                            </div>
                            
                            <!-- ADELI : S'affiche seulement si Opticien -->
                            <div id="adeli-field">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Numéro ADELI / RPPS</label>
                                <input type="text" id="freelance_adeli" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="Obligatoire pour les diplômés">
                            </div>
                        </div>
                    </div>

                </div>

                <hr class="border-gray-100 my-8">

                <!-- SECTION 2 : Mission Details with Expertise -->
                <div class="mb-12">
                    <h3 class="text-xl font-bold text-oblink-gray mb-6">Objet de la Mission</h3>
                    
                    <!-- Expertise Type -->
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Nature de l'intervention (Le "Plus" Expert)</label>
                        <select id="mission_expertise" class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none font-bold text-oblink-blue">
                            <option value="standard">Renfort Technique Standard (Vente/Atelier)</option>
                            <option value="examen">Expertise Examens de Vue & Santé Visuelle</option>
                            <option value="business">Coaching Vente & Développement C.A.</option>
                            <option value="atelier">Expertise Montage Complexe & SAV</option>
                            <option value="audit">Audit Organisation & Process Magasin</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i> Préciser une expertise spécifique renforce l'indépendance de la mission vis-à-vis de l'URSSAF.
                        </p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3">Durée</label>
                            <div class="flex gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="mission_type" value="short" class="peer sr-only" checked onchange="toggleMissionDates()">
                                    <div class="px-4 py-3 rounded-lg border-2 border-gray-200 peer-checked:border-oblink-blue peer-checked:bg-white transition text-center">
                                        <span class="block font-bold text-sm">Vacation Ponctuelle</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="mission_type" value="long" class="peer sr-only" onchange="toggleMissionDates()">
                                    <div class="px-4 py-3 rounded-lg border-2 border-gray-200 peer-checked:border-oblink-blue peer-checked:bg-white transition text-center">
                                        <span class="block font-bold text-sm">Mission Longue</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Dynamic Date Inputs -->
                        <div id="date-container-short">
                            <label class="block text-sm font-bold text-gray-700 mb-1">Dates d'intervention</label>
                            <input type="text" id="mission_dates_short" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: Du 12 au 14 Juillet">
                        </div>
                        <div id="date-container-long" class="hidden">
                            <label class="block text-sm font-bold text-gray-700 mb-1">Date de démarrage</label>
                            <input type="date" id="mission_start_long" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none">
                        </div>
                    </div>

                    <div class="mt-6">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Honoraires H.T.</label>
                        <div class="flex gap-4">
                            <input type="number" id="mission_price" class="w-1/3 px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: 350" required>
                            <select id="mission_unit" class="w-1/4 px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none">
                                <option value="euros / jour">Euros / Jour</option>
                                <option value="euros / heure">Euros / Heure</option>
                                <option value="euros forfait">Forfait Global</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SECTION 3 : Mandatory Checkboxes -->
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 mb-8">
                    <h4 class="font-bold text-oblink-gray mb-4 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500"></i> Engagements Réciproques
                    </h4>
                    <div class="space-y-2">
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Le Prestataire déclare disposer des <strong>compétences et diplômes</strong> requis pour l'expertise choisie.</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Obligation de moyens : Le Prestataire mettra tout en œuvre pour atteindre les objectifs (ex: CA), sans obligation de résultat garantie.</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Respect de la confidentialité, du RGPD et du secret professionnel.</span>
                        </label>
                    </div>
                </div>

                <div class="flex justify-center">
                    <button type="button" onclick="generatePDF()" class="px-8 py-4 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all flex items-center gap-3">
                        <i class="fas fa-file-contract"></i> Générer le Contrat Expert PDF
                    </button>
                </div>

            </form>
        </div>
        
    </div>
</div>

<script>
function toggleMissionDates() {
    const isShort = document.querySelector('input[name="mission_type"]:checked').value === 'short';
    document.getElementById('date-container-short').classList.toggle('hidden', !isShort);
    document.getElementById('date-container-long').classList.toggle('hidden', isShort);
}

function toggleAdeli() {
    const qualif = document.getElementById('freelance_qualif').value;
    const adeliField = document.getElementById('adeli-field');
    const isMedical = (qualif === 'opticien' || qualif === 'expert_refraction');
    
    adeliField.style.display = isMedical ? 'block' : 'none';
}

function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // --- DATA ---
    const client = {
        name: document.getElementById('client_name').value,
        siret: document.getElementById('client_siret').value,
        addr: document.getElementById('client_address').value,
        rep: document.getElementById('client_rep').value
    };
    const qualif = document.getElementById('freelance_qualif').value;
    const freelance = {
        name: document.getElementById('freelance_name').value,
        siret: document.getElementById('freelance_siret').value,
        addr: document.getElementById('freelance_address').value,
        // Get generic label for qualification
        role_label: document.getElementById('freelance_qualif').options[document.getElementById('freelance_qualif').selectedIndex].text
    };
    
    // Safety check
    if(!client.name || !freelance.name) { alert("Merci de remplir l'identité des deux parties."); return; }

    // Mission Details
    const missionType = document.querySelector('input[name="mission_type"]:checked').value;
    const dates = missionType === 'short' 
        ? "Vacation précise : " + document.getElementById('mission_dates_short').value 
        : "Mission longue à compter du : " + document.getElementById('mission_start_long').value;
    
    const expertiseValue = document.getElementById('mission_expertise').value;
    const expertiseLabel = document.getElementById('mission_expertise').options[document.getElementById('mission_expertise').selectedIndex].text;

    // --- PDF BUILD ---
    let y = 20;

    doc.setFontSize(20);
    doc.setFont("helvetica", "bold");
    doc.text("CONTRAT DE PRESTATION DE SERVICE", 105, y, { align: "center" });
    y += 10;
    doc.setFontSize(14);
    doc.setTextColor(100);
    doc.text(expertiseLabel.toUpperCase(), 105, y, { align: "center" }); // Subtitle: Expertise
    doc.setTextColor(0);
    y += 15;
    
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    
    // PARTIES
    const partyBlock = (title, data) => {
        doc.setFont("helvetica", "bold");
        doc.text(title, 20, y);
        y += 5;
        doc.setFont("helvetica", "normal");
        doc.text("Raison Sociale / Nom : " + data.name, 20, y); y+=5;
        doc.text("SIRET : " + data.siret, 20, y); y+=5;
        doc.text("Adresse : " + data.addr, 20, y); y+=5;
        if(data.rep) doc.text("Représenté par : " + data.rep, 20, y);
        if(data.role_label) doc.text("Qualification déclarée : " + data.role_label, 20, y);
        y+=10;
    }

    partyBlock("LE CLIENT (DONNEUR D'ORDRE) :", client);
    partyBlock("LE PRESTATAIRE (FREELANCE) :", freelance);
    
    // CLAUSES HELPER
    const addClause = (title, content) => {
        if(y > 270) { doc.addPage(); y = 20; }
        doc.setFont("helvetica", "bold");
        doc.text(title, 20, y);
        y += 5;
        doc.setFont("helvetica", "normal");
        const lines = doc.splitTextToSize(content, 170);
        doc.text(lines, 20, y);
        y += (lines.length * 5) + 8;
    };

    // 1. OBJET (Spécifique avec expertise)
    let expertClause = "Le Client confie au Prestataire une mission spécifique de : " + expertiseLabel + ".\n";
    expertClause += "Le Prestataire mettra en œuvre son savoir-faire technique et commercial pour atteindre les objectifs fixés (notamment en termes de performance ou de qualité).\n";
    expertClause += "Cette mission ne constitue en aucun cas un remplacement standard de salarié mais un apport d'expertise externe.\n";
    expertClause += dates;

    addClause("ARTICLE 1 - OBJET DE LA MISSION D'EXPERTISE", expertClause);

    // 2. INDEPENDANCE (Bouclier URSSAF)
    addClause("ARTICLE 2 - INDEPENDANCE ET ABSENCE DE LIEN DE SUBORDINATION", 
        "Le Prestataire exerce sa mission en totale autonomie. Il n'est soumis à aucun horaire fixe imposé (sauf contraintes d'ouverture du magasin) ni à aucune directive hiérarchique.\n" +
        "Il organise son travail librement pour atteindre les objectifs de la mission."
    );

    // 3. PRIX
    addClause("ARTICLE 3 - HONORAIRES", 
        "En contrepartie, le Client versera : " + document.getElementById('mission_price').value + " " + document.getElementById('mission_unit').value + " (HT).\n" +
        "Le Prestataire ne garantit pas de chiffre d'affaires minimum (Obligation de moyens)."
    );

    // 4. RGPD
    addClause("ARTICLE 4 - CONFIDENTALITE ET DONNEES", 
        "Si la mission implique l'accès à des données clients, le Prestataire agit comme sous-traitant RGPD et s'engage au secret professionnel absolu."
    );

    // 5. RUPTURE
    if(missionType === 'short') {
        addClause("ARTICLE 5 - ANNULATION", "Toute annulation < 72h par le Client entraîne 50% d'indemnités. < 24h : 100% dû.");
    } else {
        addClause("ARTICLE 5 - PREAVIS DE RUPTURE", "Préavis progressif selon l'ancienneté de la relation commerciale (loi Hamon/Code de commerce).");
    }

    // SIGNATURES
    if(y > 240) { doc.addPage(); y = 20; }
    y += 15;
    doc.text("Fait le " + new Date().toLocaleDateString(), 20, y);
    y += 10;
    doc.text("Le Client (Signature)", 20, y);
    doc.text("Le Prestataire (Signature)", 120, y);

    doc.save("Contrat_" + expertiseValue + "_" + freelance.name + ".pdf");
}

// Init
toggleAdeli();
</script>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/single.php ---
<?php include 'header-inc.php'; ?>

<style>
    /* === ARTICLE STYLING === */
    .article-content {
        font-size: 1.125rem;
        line-height: 1.8;
        color: #1f2937;
    }

    /* Headers */
    .article-content h2 {
        font-size: 2rem;
        font-weight: 700;
        color: #FF6600;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        border-bottom: 3px solid #FF6600;
        padding-bottom: 0.5rem;
        scroll-margin-top: 120px;
        /* For anchor links */
    }

    .article-content h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #303030;
        margin-top: 2rem;
        margin-bottom: 1rem;
        scroll-margin-top: 120px;
    }

    /* Paragraphs */
    .article-content p {
        margin-bottom: 1.5rem;
    }

    .article-content strong {
        color: #FF6600;
        font-weight: 700;
    }

    /* Lists */
    .article-content ul,
    .article-content ol {
        margin: 1.5rem 0;
        padding-left: 2rem;
    }

    .article-content li {
        margin-bottom: 0.75rem;
        line-height: 1.8;
    }

    .article-content ul li::marker {
        color: #FF6600;
    }

    .article-content ol li::marker {
        color: #FF6600;
        font-weight: 700;
    }

    /* Tables */
    .article-content table {
        width: 100%;
        margin: 2rem 0;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        overflow: hidden;
    }

    .article-content table th {
        background: linear-gradient(135deg, #FF6600 0%, #ff8833 100%);
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: 700;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .article-content table td {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        font-size: 1rem;
    }

    .article-content table tr:last-child td {
        border-bottom: none;
    }

    .article-content table tr:nth-child(even) {
        background-color: #f9fafb;
    }

    .article-content table tr:hover {
        background-color: #fff7ed;
        transition: background-color 0.2s;
    }

    /* Blockquotes */
    .article-content blockquote {
        background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
        border-left: 5px solid #FF6600;
        padding: 1.5rem 2rem;
        margin: 2rem 0;
        border-radius: 8px;
        font-style: italic;
        font-size: 1.1rem;
        color: #78350f;
        box-shadow: 0 2px 4px rgba(255, 102, 0, 0.1);
    }

    /* Code blocks */
    .article-content pre {
        background: #1e293b;
        color: #e2e8f0;
        padding: 1.5rem;
        border-radius: 12px;
        overflow-x: auto;
        margin: 2rem 0;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
        line-height: 1.6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    .article-content code {
        background: #f3f4f6;
        color: #FF6600;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
    }

    .article-content pre code {
        background: none;
        color: inherit;
        padding: 0;
    }

    /* Colored info boxes */
    .article-content div[style*="background"] {
        border-radius: 12px;
        padding: 1.5rem 2rem !important;
        margin: 2rem 0 !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    /* Links */
    .article-content a {
        color: #0099FF;
        font-weight: 600;
        text-decoration: none;
        border-bottom: 2px solid transparent;
        transition: all 0.3s;
    }

    .article-content a:hover {
        color: #9A48D0;
        border-bottom-color: #9A48D0;
    }

    /* Horizontal rules */
    .article-content hr {
        border: none;
        height: 2px;
        background: linear-gradient(90deg, transparent, #FF6600, transparent);
        margin: 3rem 0;
    }

    /* Superscript references */
    .article-content sup {
        font-size: 0.75em;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
        top: -0.5em;
    }

    .article-content sup a {
        color: #0099FF;
        font-weight: 600;
        text-decoration: none;
        padding: 0 2px;
    }

    .article-content sup a:hover {
        color: #9A48D0;
        text-decoration: underline;
    }

    /* Sources section styling */
    .article-content h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #303030;
        margin-top: 2rem;
        margin-bottom: 1rem;
    }

    .article-content ol {
        background: #f8fafc;
        padding: 1.5rem 2rem 1.5rem 3rem;
        border-radius: 8px;
        border-left: 3px solid #0099FF;
        margin: 1.5rem 0;
    }

    .article-content ol li a {
        color: #0099FF;
        word-break: break-word;
    }

    /* Table of Contents */
    .toc {
        background: #f8fafc;
        border-left: 4px solid #0099FF;
        padding: 1.5rem 2rem;
        margin: 2rem 0;
        border-radius: 8px;
    }

    .toc h3 {
        margin-top: 0 !important;
        color: #0099FF !important;
        border-bottom: none !important;
        font-size: 1.25rem !important;
    }

    .toc ul {
        margin: 1rem 0 0 0;
        padding-left: 1.5rem;
    }

    .toc li {
        margin-bottom: 0.5rem;
    }

    .toc a {
        color: #475569;
        font-weight: 500;
    }

    .toc a:hover {
        color: #0099FF;
    }

    /* Share buttons */
    .share-buttons {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .share-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s;
        text-decoration: none;
        border: none;
        cursor: pointer;
    }

    .share-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .share-linkedin {
        background: #0077b5;
        color: white;
    }

    .share-twitter {
        background: #1DA1F2;
        color: white;
    }

    .share-facebook {
        background: #1877f2;
        color: white;
    }

    .share-email {
        background: #64748b;
        color: white;
    }

    /* Sidebar */
    .sidebar {
        position: sticky;
        top: 120px;
    }

    .sidebar-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .meta-item:last-child {
        border-bottom: none;
    }

    .meta-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #FF6600, #ff8833);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
</style>

<div class="pt-32 pb-20 px-4 min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-violet-50">
    <div class="max-w-7xl mx-auto">
        <?php
        while (have_posts()):
            the_post();

            // Calculate reading time
            $content = get_the_content();
            $word_count = str_word_count(strip_tags($content));
            $reading_time = ceil($word_count / 200); // 200 words per minute
        
            // Get excerpt for meta description
            $excerpt = get_the_excerpt();

            // Get current URL for sharing
            $current_url = urlencode(get_permalink());
            $title = urlencode(get_the_title());
            ?>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- MAIN CONTENT -->
                <div class="lg:col-span-2">
                    <!-- Article Header -->
                    <div class="mb-8">
                        <div
                            class="inline-flex items-center px-4 py-2 bg-white/60 backdrop-blur-xl border border-white/40 rounded-full mb-6 shadow-sm">
                            <span class="text-sm font-semibold text-oblink-orange uppercase tracking-wider">
                                <?php
                                $categories = get_the_category();
                                if (!empty($categories)) {
                                    echo esc_html($categories[0]->name);
                                } else {
                                    echo 'Article';
                                }
                                ?>
                            </span>
                        </div>

                        <h1 class="text-4xl md:text-5xl font-bold text-oblink-gray mb-6 leading-tight"
                            style="font-family: 'Montserrat', sans-serif;">
                            <?php the_title(); ?>
                        </h1>

                        <?php if ($excerpt): ?>
                            <p class="text-xl text-gray-600 mb-6 leading-relaxed">
                                <?php echo esc_html($excerpt); ?>
                            </p>
                        <?php endif; ?>

                        <div class="flex items-center gap-4 text-gray-500 text-sm">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-calendar"></i>
                                <?php echo get_the_date('d/m/Y'); ?>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-clock"></i>
                                <?php echo $reading_time; ?> min de lecture
                            </div>
                        </div>
                    </div>

                    <!-- Featured Image -->
                    <?php if (has_post_thumbnail()): ?>
                        <div class="rounded-2xl overflow-hidden shadow-xl mb-8">
                            <?php the_post_thumbnail('large', array('class' => 'w-full h-auto object-cover')); ?>
                        </div>
                    <?php endif; ?>

                    <!-- Content -->
                    <div class="glass-card p-8 md:p-12">
                        <div class="article-content">
                            <?php the_content(); ?>
                        </div>

                        <!-- Tags -->
                        <?php if (get_the_tags()): ?>
                            <div class="mt-8 pt-8 border-t border-gray-200">
                                <div class="flex flex-wrap gap-2">
                                    <?php
                                    $tags = get_the_tags();
                                    foreach ($tags as $tag) {
                                        echo '<span class="px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-600">#' . esc_html($tag->name) . '</span>';
                                    }
                                    ?>
                                </div>
                            </div>
                        <?php endif; ?>
                    </div>

                    <!-- Share Section -->
                    <div class="glass-card p-6 mt-8">
                        <h3 class="text-lg font-bold text-oblink-gray mb-4">📢 Partager cet article</h3>
                        <div class="share-buttons">
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=<?php echo $current_url; ?>"
                                target="_blank" class="share-btn share-linkedin">
                                <i class="fab fa-linkedin"></i> LinkedIn
                            </a>
                            <a href="https://twitter.com/intent/tweet?url=<?php echo $current_url; ?>&text=<?php echo $title; ?>"
                                target="_blank" class="share-btn share-twitter">
                                <i class="fab fa-twitter"></i> Twitter
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u=<?php echo $current_url; ?>"
                                target="_blank" class="share-btn share-facebook">
                                <i class="fab fa-facebook"></i> Facebook
                            </a>
                            <a href="mailto:?subject=<?php echo $title; ?>&body=<?php echo $current_url; ?>"
                                class="share-btn share-email">
                                <i class="fas fa-envelope"></i> Email
                            </a>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <div>
                            <?php previous_post_link('%link', '<div class="glass-card p-4 hover:scale-105 transition transform h-full"><span class="block text-xs text-gray-500 mb-2">← Article précédent</span><span class="font-bold text-oblink-gray line-clamp-2">%title</span></div>'); ?>
                        </div>
                        <div>
                            <?php next_post_link('%link', '<div class="glass-card p-4 hover:scale-105 transition transform h-full text-right"><span class="block text-xs text-gray-500 mb-2">Article suivant →</span><span class="font-bold text-oblink-gray line-clamp-2">%title</span></div>'); ?>
                        </div>
                    </div>
                </div>

                <!-- SIDEBAR -->
                <div class="lg:col-span-1">
                    <div class="sidebar">
                        <!-- Meta Info -->
                        <div class="sidebar-card">
                            <h3 class="font-bold text-oblink-gray mb-4 text-lg">📋 Informations</h3>

                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Publié le</div>
                                    <div class="font-semibold text-gray-700"><?php echo get_the_date('d/m/Y'); ?></div>
                                </div>
                            </div>

                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Temps de lecture</div>
                                    <div class="font-semibold text-gray-700"><?php echo $reading_time; ?> minutes</div>
                                </div>
                            </div>

                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-folder"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Catégorie</div>
                                    <div class="font-semibold text-gray-700">
                                        <?php echo !empty($categories) ? esc_html($categories[0]->name) : 'Article'; ?>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CTA Card -->
                        <div class="sidebar-card" style="background: linear-gradient(135deg, #FF6600 0%, #ff8833 100%);">
                            <h3 class="font-bold text-white mb-3 text-lg">🚀 Lancez-vous !</h3>
                            <p class="text-white/90 text-sm mb-4">
                                Créez votre profil gratuitement et accédez à des centaines de missions.
                            </p>
                            <a href="<?php echo home_url('/inscription-opticien'); ?>"
                                class="block w-full text-center px-4 py-3 bg-white text-oblink-orange font-bold rounded-lg hover:bg-gray-50 transition">
                                Créer mon compte
                            </a>
                        </div>

                        <!-- Related Links -->
                        <div class="sidebar-card">
                            <h3 class="font-bold text-oblink-gray mb-4 text-lg">🔗 Ressources utiles</h3>
                            <ul class="space-y-3">
                                <li>
                                    <a href="<?php echo home_url('/simulateur'); ?>"
                                        class="text-oblink-blue hover:text-oblink-violet flex items-center gap-2">
                                        <i class="fas fa-calculator"></i> Simulateur de revenus
                                    </a>
                                </li>
                                <li>
                                    <a href="<?php echo home_url('/formation-erp'); ?>"
                                        class="text-oblink-blue hover:text-oblink-violet flex items-center gap-2">
                                        <i class="fas fa-graduation-cap"></i> Formations gratuites
                                    </a>
                                </li>
                                <li>
                                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                                        class="text-oblink-blue hover:text-oblink-violet flex items-center gap-2">
                                        <i class="fas fa-briefcase"></i> Voir les missions
                                    </a>
                                </li>
                                <li>
                                    <a href="<?php echo home_url('/blog'); ?>"
                                        class="text-oblink-blue hover:text-oblink-violet flex items-center gap-2">
                                        <i class="fas fa-newspaper"></i> Tous les articles
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <?php
        endwhile;
        ?>
    </div>
</div>

<script>
    // Auto-generate table of contents from H2 headings
    document.addEventListener('DOMContentLoaded', function () {
        const content = document.querySelector('.article-content');
        const headings = content.querySelectorAll('h2');

        if (headings.length >= 3) {
            const toc = document.createElement('div');
            toc.className = 'toc';
            toc.innerHTML = '<h3>📑 Sommaire</h3><ul></ul>';

            const tocList = toc.querySelector('ul');

            headings.forEach((heading, index) => {
                const id = 'section-' + index;
                heading.id = id;

                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#' + id;
                a.textContent = heading.textContent;
                li.appendChild(a);
                tocList.appendChild(li);
            });

            // Insert TOC after first paragraph
            const firstP = content.querySelector('p');
            if (firstP) {
                firstP.after(toc);
            }
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page.php ---
<?php get_header(); ?>

<div class="pt-32 pb-20 px-4 min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-violet-50">
    <div class="max-w-4xl mx-auto">
        <div class="glass-card p-8 md:p-12">
            <?php
            while (have_posts()):
                the_post();
                ?>
                <h1 class="text-3xl md:text-4xl font-bold text-oblink-gray mb-8"
                    style="font-family: 'Montserrat', sans-serif;">
                    <?php the_title(); ?>
                </h1>

                <div class="prose prose-lg max-w-none text-oblink-gray/80">
                    <?php the_content(); ?>
                </div>
                <?php
            endwhile;
            ?>
        </div>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-comment-ca-marche.php ---
<?php
/**
 * Template Name: Comment ça marche
 */
include 'header-inc.php';
?>

<div class="pt-32 pb-20 bg-oblink-beige/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 text-oblink-gray" style="font-family: 'Montserrat', sans-serif;">
            Comment ça marche ?
        </h1>
        <p class="text-xl text-oblink-gray/80 mb-8 max-w-3xl mx-auto">
            Une plateforme simple et intuitive pour connecter les professionnels de l'optique.
        </p>
    </div>
</div>

<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Step 1 -->
        <div class="flex flex-col md:flex-row items-center mb-20">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pr-12">
                <div
                    class="w-20 h-20 bg-oblink-orange text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    1</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Inscription & Profil</h3>
                <p class="text-lg text-oblink-gray/70">
                    Créez votre compte en quelques clics.
                    <br><br>
                    <strong>Candidats :</strong> Importez votre CV, diplômes et indiquez vos disponibilités.
                    <br>
                    <strong>Recruteurs :</strong> Créez la fiche de votre magasin et définissez vos besoins.
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-user-plus text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="flex flex-col md:flex-row-reverse items-center mb-20">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pl-12">
                <div
                    class="w-20 h-20 bg-oblink-blue text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    2</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Validation & Matching</h3>
                <p class="text-lg text-oblink-gray/70">
                    Notre algorithme vous propose les meilleures correspondances.
                    <br><br>
                    Nous validons manuellement chaque profil pour garantir la qualité du réseau. Vous recevez des
                    notifications dès qu'une opportunité correspond à vos critères.
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-check-circle text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="flex flex-col md:flex-row items-center">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pr-12">
                <div
                    class="w-20 h-20 bg-oblink-violet text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    3</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Mission & Paiement</h3>
                <p class="text-lg text-oblink-gray/70">
                    Collaborez en toute sérénité.
                    <br><br>
                    Une fois la mission validée, le contrat est généré automatiquement. Le paiement est sécurisé et
                    versé à la fin de la mission (ou fin de mois pour les longues durées).
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-handshake text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

    </div>
</section>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-parametres.php ---
<?php
/*
Template Name: Paramètres Compte
*/
include 'header-inc.php';
?>

<!-- Auth Guard -->
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        if (!window.oblinkSupabase) {
            console.error('Supabase not loaded');
            return;
        }

        const { data: { session } } = await window.oblinkSupabase.auth.getSession();
        if (!session) {
            window.location.href = '<?php echo home_url('/login'); ?>?redirect=/parametres';
        }
    });
</script>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold font-display text-oblink-gray mb-2">Paramètres du compte</h1>
            <p class="text-gray-500">Gérez vos informations personnelles et votre sécurité</p>
        </div>

        <!-- Success Message -->
        <div id="success-message" class="hidden mb-6 p-4 rounded-xl bg-green-50 border border-green-200">
            <div class="flex items-start gap-3">
                <i class="fas fa-check-circle text-green-500 text-xl mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-green-700" id="success-text"></p>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="hidden mb-6 p-4 rounded-xl bg-red-50 border border-red-200">
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-red-700" id="error-text"></p>
                </div>
            </div>
        </div>

        <!-- Warning Message -->
        <div id="warning-message" class="hidden mb-6 p-4 rounded-xl bg-yellow-50 border border-yellow-200">
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-yellow-700" id="warning-text"></p>
                </div>
            </div>
        </div>

        <!-- Settings Sections -->
        <div class="space-y-6">

            <!-- Profile Information -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                <h2 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                    <i class="fas fa-user text-oblink-blue"></i> Informations du profil
                </h2>

                <form id="profile-form" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Prénom</label>
                            <input type="text" id="first-name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Votre prénom">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nom</label>
                            <input type="text" id="last-name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Votre nom">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email</label>
                        <input type="email" id="email"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 cursor-not-allowed"
                            placeholder="email@exemple.com" disabled>
                        <p class="text-xs text-gray-500 mt-1">L'email ne peut pas être modifié pour le moment</p>
                    </div>

                    <button type="submit"
                        class="px-6 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition flex items-center gap-2">
                        <i class="fas fa-save"></i> Enregistrer les modifications
                    </button>
                </form>
            </div>

            <!-- Password Change -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                <h2 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                    <i class="fas fa-lock text-oblink-orange"></i> Sécurité
                </h2>

                <form id="password-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Nouveau mot de passe</label>
                        <input type="password" id="new-password"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="Minimum 6 caractères">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Confirmer le mot de passe</label>
                        <input type="password" id="confirm-password"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="Retapez le mot de passe">
                    </div>

                    <button type="submit"
                        class="px-6 py-3 bg-oblink-orange text-white font-bold rounded-xl hover:bg-orange-600 transition flex items-center gap-2">
                        <i class="fas fa-key"></i> Changer le mot de passe
                    </button>
                </form>
            </div>

            <!-- Logout -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                <h2 class="text-xl font-bold text-oblink-gray mb-4 flex items-center gap-2">
                    <i class="fas fa-sign-out-alt text-red-500"></i> Déconnexion
                </h2>
                <p class="text-gray-600 mb-4">Vous souhaitez vous déconnecter de votre compte ?</p>
                <button onclick="logout()"
                    class="px-6 py-3 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition flex items-center gap-2">
                    <i class="fas fa-power-off"></i> Se déconnecter
                </button>
            </div>

        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        if (!window.oblinkSupabase) return;

        // Load current user data
        const { data: { session } } = await window.oblinkSupabase.auth.getSession();
        if (!session) return;

        const user = session.user;

        // Populate form
        document.getElementById('email').value = user.email || '';
        document.getElementById('first-name').value = user.user_metadata?.first_name || '';
        document.getElementById('last-name').value = user.user_metadata?.last_name || '';

        // Profile form handler
        document.getElementById('profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enregistrement...';
            btn.disabled = true;

            try {
                const { error } = await window.oblinkSupabase.auth.updateUser({
                    data: {
                        first_name: document.getElementById('first-name').value,
                        last_name: document.getElementById('last-name').value
                    }
                });

                if (error) throw error;

                btn.innerHTML = '<i class="fas fa-check"></i> Enregistré !';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                showError('Erreur : ' + error.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // Password form handler
        document.getElementById('password-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword.length < 6) {
                showWarning('Le mot de passe doit contenir au moins 6 caractères');
                return;
            }

            if (newPassword !== confirmPassword) {
                showWarning('Les mots de passe ne correspondent pas');
                return;
            }

            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Modification...';
            btn.disabled = true;

            try {
                const { error } = await window.oblinkSupabase.auth.updateUser({
                    password: newPassword
                });

                if (error) throw error;

                btn.innerHTML = '<i class="fas fa-check"></i> Mot de passe changé !';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                showError('Erreur : ' + error.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });
    });

    // Helper functions for messages
    function showSuccess(message) {
        const successDiv = document.getElementById('success-message');
        const successText = document.getElementById('success-text');
        successText.textContent = message;
        successDiv.classList.remove('hidden');
        successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Hide other messages
        document.getElementById('error-message').classList.add('hidden');
        document.getElementById('warning-message').classList.add('hidden');
    }

    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        errorText.textContent = message;
        errorDiv.classList.remove('hidden');
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Hide other messages
        document.getElementById('success-message').classList.add('hidden');
        document.getElementById('warning-message').classList.add('hidden');
    }

    function showWarning(message) {
        const warningDiv = document.getElementById('warning-message');
        const warningText = document.getElementById('warning-text');
        warningText.textContent = message;
        warningDiv.classList.remove('hidden');
        warningDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Hide other messages
        document.getElementById('success-message').classList.add('hidden');
        document.getElementById('error-message').classList.add('hidden');
    }

    // Logout function with inline confirmation
    async function logout() {
        // Show confirmation message
        const warningDiv = document.getElementById('warning-message');
        const warningText = document.getElementById('warning-text');
        warningText.innerHTML = `
            Êtes-vous sûr de vouloir vous déconnecter ?
            <div class="mt-3 flex gap-2">
                <button onclick="confirmLogout()" class="px-4 py-2 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition text-sm">
                    Oui, déconnecter
                </button>
                <button onclick="hideMessages()" class="px-4 py-2 bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition text-sm">
                    Annuler
                </button>
            </div>
        `;
        warningDiv.classList.remove('hidden');
        warningDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    async function confirmLogout() {
        try {
            await window.oblinkSupabase.auth.signOut();
            showSuccess('Déconnexion réussie ! Redirection...');
            setTimeout(() => {
                window.location.href = '<?php echo home_url('/'); ?>';
            }, 1000);
        } catch (error) {
            showError('Erreur lors de la déconnexion : ' + error.message);
        }
    }

    function hideMessages() {
        document.getElementById('success-message').classList.add('hidden');
        document.getElementById('error-message').classList.add('hidden');
        document.getElementById('warning-message').classList.add('hidden');
    }
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/header-inc.php ---
<?php
// OBLINK - Header Universel (Inc)
// Ce fichier est inclus manuellement dans chaque page pour garantir l'affichage du menu
// peu importe la configuration WordPress.
?>
<!DOCTYPE html>
<html <?php language_attributes(); ?>>

<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <?php
    // Load SEO Meta System
    require_once get_template_directory() . '/inc/seo-meta.php';

    // Output SEO Meta Tags (title, description, OG, Twitter)
    oblink_output_seo_meta();

    // Output JSON-LD Structured Data
    oblink_output_json_ld();
    ?>

    <?php wp_head(); ?>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'oblink-orange': '#FF6600',
                        'oblink-blue': '#0099FF',
                        'oblink-violet': '#9A48D0',
                        'oblink-gray': '#303030',
                    },
                    fontFamily: {
                        'display': ['Overpass', 'sans-serif'],
                        'body': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Overpass:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Dropdown Menu Animation */
        .group:hover .group-hover\:visible {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Menu Animation */
        #mobile-menu {
            display: none;
            /* Hidden by default */
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        #mobile-menu.open {
            display: block;
            /* Show when open */
            max-height: 100vh;
            opacity: 1;
        }
    </style>
</head>

<body <?php body_class('bg-white text-oblink-gray font-body'); ?>>

    <!-- HEADER UNIVERSEL (INCRUSTÉ) -->
    <header class="fixed w-full top-0 z-50 bg-white/95 backdrop-blur-md shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">

                <!-- LOGO (Image PNG) -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="<?php echo home_url('/'); ?>" class="flex items-center group no-underline">
                        <!-- Utilisation du logo image généré -->
                        <img src="<?php echo get_template_directory_uri(); ?>/images/logo.png" alt="OBLINK"
                            class="h-12 w-auto object-contain hover:scale-105 transition-transform duration-300">
                    </a>
                </div>

                <!-- DESKTOP NAV -->
                <nav class="hidden md:flex space-x-8 items-center">
                    <a href="<?php echo home_url('/'); ?>"
                        class="text-oblink-gray hover:text-oblink-orange font-medium">Accueil</a>
                    <!-- Dropdown Candidat -->
                    <div class="relative group">
                        <button class="text-oblink-gray hover:text-oblink-orange font-medium flex items-center py-5">
                            Je cherche un job <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <!-- Correction Z-Index et Position -->
                        <div
                            class="absolute left-0 mt-0 w-96 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:visible group-hover:opacity-100 transition-all duration-200 z-50 top-full transform translate-y-2 group-hover:translate-y-0">
                            <div class="p-4 space-y-2">
                                <a href="<?php echo home_url('/opticien-2'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-orange-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 text-oblink-blue flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Découvrir nos services</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Tout savoir sur OBLINK pour
                                            opticiens.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/emploi-opticien'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-orange-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-orange-100 text-oblink-orange flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Trouver une mission</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Accédez à des centaines
                                            d'offres de remplacement.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-orange-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Créer mon compte</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Rejoignez la communauté OBLINK.
                                        </p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Dropdown Entreprise -->
                    <div class="relative group">
                        <button class="text-oblink-gray hover:text-oblink-blue font-medium flex items-center py-5">
                            Je recrute <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div
                            class="absolute left-0 mt-0 w-96 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:visible group-hover:opacity-100 transition-all duration-200 z-50 top-full transform translate-y-2 group-hover:translate-y-0">
                            <div class="p-4 space-y-2">
                                <a href="<?php echo home_url('/pour-entreprise'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-blue-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-orange-100 text-oblink-orange flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Découvrir nos solutions</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Toutes les offres pour recruter
                                            efficacement.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/publier-offre'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-blue-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 text-oblink-blue flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Déposer une offre</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Publiez une annonce en quelques
                                            clics.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-blue-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Créer un compte</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Inscrivez votre établissement.
                                        </p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-blue-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 text-oblink-blue flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Explorer les profils</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Accédez directement aux
                                            meilleurs profils disponibles.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/abonnements'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-blue-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 text-oblink-blue flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-tags"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Tarifs</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Des solutions flexibles
                                            adaptées à tous vos besoins.</p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>


                    <!-- NEW: Dropdown Ressources -->
                    <div class="relative group">
                        <button class="text-oblink-gray hover:text-oblink-violet font-medium flex items-center py-5">
                            Ressources <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div
                            class="absolute left-0 mt-0 w-96 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:visible group-hover:opacity-100 transition-all duration-200 z-50 top-full transform translate-y-2 group-hover:translate-y-0">
                            <div class="p-4 space-y-2">
                                <a href="<?php echo home_url('/blog'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-newspaper"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Blog</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Actualités et conseils pour
                                            professionnels.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/observatoire'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Baromètre Salaires 2026</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Étude complète des
                                            rémunérations.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/simulateur'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-calculator"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Simulateur revenus</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Estimez vos revenus nets.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/comparatif-verres'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-glasses"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Comparatif Verres</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Analysez les gammes de verres.
                                        </p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/formation-erp'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Académie Oblink</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Formations certifiantes et
                                            tutoriels.</p>
                                    </div>
                                </a>
                                <a href="<?php echo home_url('/contactologie'); ?>"
                                    class="group/item block px-4 py-3 rounded-lg hover:bg-violet-50 transition flex items-start">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-violet-100 text-oblink-violet flex items-center justify-center mr-4 mt-1 group-hover/item:scale-110 transition-transform">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 mb-0.5">Contactologie</p>
                                        <p class="text-xs text-gray-500 leading-relaxed">Guides lentilles de contact.
                                        </p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- SEARCH + ACTIONS (JS INJECTED via Supabase) -->
                <div id="header-auth-actions" class="hidden md:flex items-center space-x-4">
                    <!-- Search Button -->
                    <button type="button" id="search-btn" class="text-oblink-gray hover:text-oblink-orange transition"
                        aria-label="Rechercher">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    <!-- Default State (Loading or Guest) -->
                    <a href="<?php echo home_url('/login?redirect=' . urlencode($_SERVER['REQUEST_URI'])); ?>"
                        class="text-sm font-semibold text-oblink-gray hover:text-oblink-orange">Connexion</a>

                    <!-- S'inscrire Dropdown -->
                    <div class="relative group z-50">
                        <button
                            class="px-5 py-2.5 bg-oblink-orange text-white rounded-lg font-bold shadow hover:bg-oblink-orange/90 transition transform hover:-translate-y-0.5 flex items-center gap-2">
                            S'inscrire <i
                                class="fas fa-chevron-down text-xs transition-transform group-hover:rotate-180"></i>
                        </button>
                        <div
                            class="absolute right-0 top-full w-64 opacity-0 invisible group-hover:visible group-hover:opacity-100 transition-all duration-200 transform origin-top-right z-[9999]">
                            <div class="bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden mt-2">
                                <div class="p-3 space-y-2">
                                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                                        class="flex items-start p-3 rounded-lg hover:bg-orange-50 transition group/link">
                                        <div
                                            class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-100 text-oblink-orange flex items-center justify-center mr-3 group-hover/link:scale-110 transition-transform">
                                            <i class="fas fa-user-md"></i>
                                        </div>
                                        <div>
                                            <span class="block text-sm font-bold text-gray-900">Je suis Opticien</span>
                                            <span class="block text-xs text-gray-500">Trouvez des missions</span>
                                        </div>
                                    </a>
                                    <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                                        class="flex items-start p-3 rounded-lg hover:bg-blue-50 transition group/link">
                                        <div
                                            class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 text-oblink-blue flex items-center justify-center mr-3 group-hover/link:scale-110 transition-transform">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div>
                                            <span class="block text-sm font-bold text-gray-900">Je suis
                                                Entreprise</span>
                                            <span class="block text-xs text-gray-500">Recrutez des talents</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MOBILE MENU BUTTON -->
            <div class="flex md:hidden">
                <button type="button" id="mobile-menu-btn"
                    class="text-oblink-gray hover:text-oblink-orange focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
        </div>

        <!-- MOBILE MENU CONTENT -->
        <div id="mobile-menu"
            class="bg-white border-t border-gray-100 md:hidden shadow-xl absolute w-full left-0 top-20 max-h-[calc(100vh-5rem)] overflow-y-auto">
            <!-- Close Button -->
            <button type="button" onclick="closeMobileMenu()"
                class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 transition z-50">
                <i class="fas fa-times text-gray-600"></i>
            </button>
            <div class="px-4 pt-2 pb-6 space-y-1">
                <!-- Search Button Mobile -->
                <button type="button" id="search-btn-mobile"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-md text-base font-medium text-white bg-oblink-orange hover:bg-oblink-orange/90 transition shadow-md">
                    <i class="fas fa-search text-lg"></i>
                    <span>Rechercher sur le site</span>
                </button>

                <!-- Accueil -->
                <a href="<?php echo home_url('/'); ?>"
                    class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-orange hover:bg-orange-50"><i
                        class="fas fa-home mr-2"></i>Accueil</a>

                <!-- Je cherche un job -->
                <button type="button"
                    class="accordion-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider hover:text-oblink-orange transition">
                    <span>Je cherche un job</span>
                    <i class="fas fa-chevron-down text-xs transition-transform"></i>
                </button>
                <div class="accordion-content hidden">
                    <a href="<?php echo home_url('/opticien-2'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-orange hover:bg-orange-50"><i
                            class="fas fa-info-circle mr-2"></i>Découvrir nos services</a>
                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-orange hover:bg-orange-50"><i
                            class="fas fa-search mr-2"></i>Trouver une mission</a>
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-orange hover:bg-orange-50"><i
                            class="fas fa-user-plus mr-2"></i>Créer mon compte</a>
                </div>

                <!-- Je recrute -->
                <button type="button"
                    class="accordion-toggle w-full flex items-center justify-between px-3 py-2 mt-4 text-xs font-semibold text-gray-400 uppercase tracking-wider hover:text-oblink-blue transition">
                    <span>Je recrute</span>
                    <i class="fas fa-chevron-down text-xs transition-transform"></i>
                </button>
                <div class="accordion-content hidden">
                    <a href="<?php echo home_url('/pour-entreprise'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-blue hover:bg-blue-50"><i
                            class="fas fa-info-circle mr-2"></i>Découvrir nos solutions</a>
                    <a href="<?php echo home_url('/publier-offre'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-blue hover:bg-blue-50"><i
                            class="fas fa-briefcase mr-2"></i>Publier une offre</a>
                    <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-blue hover:bg-blue-50"><i
                            class="fas fa-users mr-2"></i>Profils disponibles</a>
                    <a href="<?php echo home_url('/abonnements'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-blue hover:bg-blue-50"><i
                            class="fas fa-tags mr-2"></i>Tarifs</a>
                </div>

                <!-- Ressources -->
                <button type="button"
                    class="accordion-toggle w-full flex items-center justify-between px-3 py-2 mt-4 text-xs font-semibold text-gray-400 uppercase tracking-wider hover:text-oblink-violet transition">
                    <span>Ressources</span>
                    <i class="fas fa-chevron-down text-xs transition-transform"></i>
                </button>
                <div class="accordion-content hidden">
                    <a href="<?php echo home_url('/blog'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-newspaper mr-2"></i>Blog</a>
                    <a href="<?php echo home_url('/observatoire'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-chart-line mr-2"></i>Baromètre Salaires 2026</a>
                    <a href="<?php echo home_url('/simulateur'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-calculator mr-2"></i>Simulateur revenus</a>
                    <a href="<?php echo home_url('/comparatif-verres'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-glasses mr-2"></i>Comparatif Verres</a>
                    <a href="<?php echo home_url('/formation-erp'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-graduation-cap mr-2"></i>Académie Oblink</a>
                    <a href="<?php echo home_url('/contactologie'); ?>"
                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-oblink-violet hover:bg-violet-50"><i
                            class="fas fa-eye mr-2"></i>Contactologie</a>
                </div>

                <!-- Actions -->
                <div class="border-t border-gray-100 my-4 pt-4">
                    <a href="<?php echo home_url('/login?redirect=' . urlencode($_SERVER['REQUEST_URI'])); ?>"
                        class="block w-full text-center px-4 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 mb-3">Connexion</a>
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="block w-full text-center px-4 py-3 bg-oblink-orange text-white rounded-lg font-bold shadow-md mb-2">S'inscrire
                        Candidat</a>
                    <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                        class="block w-full text-center px-4 py-3 bg-oblink-blue text-white rounded-lg font-bold shadow-md">S'inscrire
                        Entreprise</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Modal -->
    <div id="search-modal"
        class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[100] hidden items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 overflow-hidden transform transition-all">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-oblink-gray">Rechercher</h3>
                    <button type="button" id="close-search" class="text-gray-400 hover:text-oblink-orange transition">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form action="<?php echo home_url('/'); ?>" method="get" class="relative">
                    <input type="search" name="s"
                        class="w-full px-6 py-4 pr-14 border-2 border-gray-200 rounded-xl focus:border-oblink-orange focus:outline-none text-lg transition"
                        placeholder="Rechercher des offres, articles, ressources..." autofocus>
                    <button type="submit"
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-oblink-orange hover:text-oblink-gray transition">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                </form>
                <div class="mt-4 flex flex-wrap gap-2">
                    <span class="text-sm text-gray-500">Suggestions:</span>
                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                        class="text-sm px-3 py-1 bg-orange-50 text-oblink-orange rounded-full hover:bg-orange-100 transition">Offres
                        d'emploi</a>
                    <a href="<?php echo home_url('/blog'); ?>"
                        class="text-sm px-3 py-1 bg-violet-50 text-oblink-violet rounded-full hover:bg-violet-100 transition">Blog</a>
                    <a href="<?php echo home_url('/simulateur'); ?>"
                        class="text-sm px-3 py-1 bg-blue-50 text-oblink-blue rounded-full hover:bg-blue-100 transition">Simulateur</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Auth Dynamic Script -->
    <script src="<?php echo get_template_directory_uri(); ?>/js/header-auth.js"></script>

    <!-- Mobile Menu Toggle Script -->
    <script>
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            menu.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            menu.classList.remove('open');
            overlay.classList.add('hidden');
        }

        // Toggle menu on button click
        document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);

        // Close menu when clicking on any link
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        // Search Modal Toggle
        const searchBtn = document.getElementById('search-btn');
        const searchBtnMobile = document.getElementById('search-btn-mobile');
        const searchModal = document.getElementById('search-modal');
        const closeSearch = document.getElementById('close-search');

        if (searchBtn) {
            searchBtn.addEventListener('click', function () {
                searchModal.classList.remove('hidden');
                searchModal.classList.add('flex');
            });
        }

        if (searchBtnMobile) {
            searchBtnMobile.addEventListener('click', function () {
                closeMobileMenu();
                searchModal.classList.remove('hidden');
                searchModal.classList.add('flex');
            });
        }

        if (closeSearch) {
            closeSearch.addEventListener('click', function () {
                searchModal.classList.add('hidden');
                searchModal.classList.remove('flex');
            });
        }

        // Mobile Menu Accordions
        document.querySelectorAll('.accordion-toggle').forEach(button => {
            button.addEventListener('click', function () {
                const content = this.nextElementSibling;
                const icon = this.querySelector('i');

                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            });
        });


        // Close modal on ESC key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && searchModal.classList.contains('flex')) {
                searchModal.classList.add('hidden');
                searchModal.classList.remove('flex');
            }
        });

        // Close modal on backdrop click
        searchModal.addEventListener('click', function (e) {
            if (e.target === searchModal) {
                searchModal.classList.add('hidden');
                searchModal.classList.remove('flex');
            }
        });
    </script>

    <div class="h-20"></div> <!-- Spacer for fixed header -->--- FILE: theme/page-publier-offre.php ---
<?php
/*
Template Name: Page Publier Offre
*/
include 'header-inc.php';

// Protection removed to allow Supabase client-side auth
// if (!is_user_logged_in()) { wp_redirect... }
?>

<!-- Auth Loading State -->
<div id="auth-loading" class="min-h-screen bg-gray-50 flex flex-col items-center justify-center pt-20">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-oblink-orange mb-4"></div>
    <p class="text-gray-500 font-medium">Vérification de vos accès...</p>
</div>

<!-- Protected Content (Hidden by default) -->
<div id="auth-protected-content" class="min-h-screen bg-gray-50 pt-24 pb-12 hidden">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8 text-center">
            <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
                class="inline-flex items-center text-gray-500 hover:text-oblink-blue mb-4 transition">
                <i class="fas fa-arrow-left mr-2"></i> Retour au Dashboard
            </a>
            <h1 class="text-3xl font-bold font-display text-oblink-gray">Publier une nouvelle mission</h1>
            <p class="text-gray-500 mt-2">Trouvez le candidat idéal en quelques clics.</p>
        </div>

        <!-- Formulaire -->
        <form id="publish-offer-form" class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">

            <div class="p-8 space-y-8">

                <!-- Quick Templates (New Feature) -->
                <div class="bg-blue-50 p-4 rounded-2xl mb-6 border border-blue-100">
                    <h3 class="text-sm font-bold text-blue-800 mb-3"><i class="fas fa-bolt mr-2"></i>Remplissage Rapide
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="fillTemplate('rempla')"
                            class="px-3 py-1.5 bg-white text-blue-600 text-xs font-bold rounded-lg hover:bg-blue-100 border border-blue-200 transition">
                            Remplacement Été
                        </button>
                        <button type="button" onclick="fillTemplate('cdi')"
                            class="px-3 py-1.5 bg-white text-blue-600 text-xs font-bold rounded-lg hover:bg-blue-100 border border-blue-200 transition">
                            CDI Collaborateur
                        </button>
                        <button type="button" onclick="fillTemplate('samedi')"
                            class="px-3 py-1.5 bg-white text-blue-600 text-xs font-bold rounded-lg hover:bg-blue-100 border border-blue-200 transition">
                            Renfort Samedi
                        </button>
                    </div>
                </div>

                <!-- Section 1: Le Poste -->
                <div>
                    <h2 class="text-xl font-bold text-oblink-gray mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-blue/10 text-oblink-blue flex items-center justify-center text-sm mr-3">1</span>
                        Détails du poste
                    </h2>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Intitulé de la mission</label>
                            <input type="text" name="job_title" placeholder="Ex: Opticien Collaborateur / Remplaçant..."
                                required
                                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition font-bold text-oblink-gray placeholder-gray-400">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Type de poste recherché <span
                                    class="text-red-500">*</span></label>
                            <select name="job_type" required
                                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition font-medium cursor-pointer">
                                <optgroup label="💼 En Magasin">
                                    <option value="Opticien collaborateur H/F">Opticien collaborateur H/F</option>
                                    <option value="Opticien remplaçant H/F">Opticien remplaçant H/F</option>
                                    <option value="Opticien en alternance H/F">Opticien en alternance H/F</option>
                                    <option value="Opticien directeur, gérant ou responsable H/F">Opticien
                                        directeur/gérant H/F</option>
                                    <option value="Opticien tiers payant H/F">Opticien tiers payant H/F</option>
                                    <option value="Vendeur H/F">Vendeur H/F</option>
                                    <option value="Monteur H/F">Monteur H/F</option>
                                    <option value="Monteur-vendeur H/F">Monteur-vendeur H/F</option>
                                    <option value="Conseiller vendeur de solaires H/F">Conseiller solaires H/F</option>
                                    <option value="Audioprothésiste H/F">Audioprothésiste H/F</option>
                                    <option value="Assistant audioprothésiste H/F">Assistant audioprothésiste H/F
                                    </option>
                                    <option value="Adaptateur de lentilles H/F">Adaptateur de lentilles H/F</option>
                                </optgroup>
                                <optgroup label="🚗 Nomades / Terrain">
                                    <option value="Opticien à domicile H/F">Opticien à domicile H/F</option>
                                    <option value="Agent - Commercial - VRP H/F">Agent VRP H/F</option>
                                    <option value="Animateur réseau H/F">Animateur réseau H/F</option>
                                    <option value="Responsable de secteur H/F">Responsable de secteur H/F</option>
                                </optgroup>
                                <optgroup label="👔 Experts / Management">
                                    <option value="Responsable technique H/F">Responsable technique H/F</option>
                                    <option value="Optométriste H/F">Optométriste H/F</option>
                                    <option value="Directeur des ventes H/F">Directeur des ventes H/F</option>
                                    <option value="Chef de produits H/F">Chef de produits H/F</option>
                                </optgroup>
                                <optgroup label="🩺 Autres Professions">
                                    <option value="Orthoptiste H/F">Orthoptiste H/F</option>
                                    <option value="AMO (Assistant médical ophta) H/F">AMO (Assistant médical ophta) H/F
                                    </option>
                                    <option value="Enseignant H/F">Enseignant optique H/F</option>
                                    <option value="Autre en magasin H/F">Autre en magasin H/F</option>
                                    <option value="Autre H/F">Autre profession H/F</option>
                                </optgroup>
                            </select>
                            <p class="text-xs text-gray-400 mt-1">Choisissez le profil qui correspond le mieux à votre
                                besoin</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Type de contrat</label>
                                <select name="contract_type"
                                    class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition font-medium cursor-pointer">
                                    <option value="cdd">CDD (Remplacement)</option>
                                    <option value="cdi">CDI</option>
                                    <option value="freelance">Freelance / Vacation</option>
                                    <option value="stage">Stage / Alternance</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Salaire / Taux
                                    journalier</label>
                                <div class="relative">
                                    <input type="number" name="salary" placeholder="Ex: 350" required
                                        class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition">
                                    <span class="absolute right-4 top-3 text-gray-400 font-bold">€</span>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">Montant brut ou journalier (chiffre uniquement)
                                </p>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Description du poste</label>
                            <textarea name="description" rows="4"
                                placeholder="Décrivez les missions, l'ambiance, les avantages..."
                                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition text-sm"></textarea>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- Section 2: Planning & Lieu -->
                <div>
                    <h2 class="text-xl font-bold text-oblink-gray mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-violet/10 text-oblink-violet flex items-center justify-center text-sm mr-3">2</span>
                        Planning & Lieu
                    </h2>

                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Date de début</label>
                                <input type="date" name="start_date" required
                                    class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Date de fin
                                    (Optionnel)</label>
                                <input type="date" name="end_date"
                                    class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Ville</label>
                            <input type="text" name="location" placeholder="Ex: Paris" required
                                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Adresse complète (Privé)</label>
                            <input type="text" name="address" placeholder="Ex: 15 rue de Rivoli, 75004 Paris"
                                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition">
                            <p class="text-xs text-gray-400 mt-1">L'adresse exacte ne sera communiquée qu'aux candidats
                                validés.</p>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- Section 3: Compétences (Logiciels) -->
                <div>
                    <h2 class="text-xl font-bold text-oblink-gray mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-orange/10 text-oblink-orange flex items-center justify-center text-sm mr-3">3</span>
                        Logiciel utilisé
                    </h2>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="cursor-pointer group">
                            <input type="checkbox" name="skills[]" value="WinOptics" class="peer hidden">
                            <div
                                class="p-3 bg-gray-50 rounded-xl text-center border-2 border-transparent peer-checked:border-oblink-orange peer-checked:bg-orange-50 transition">
                                <span
                                    class="font-bold text-sm text-gray-600 peer-checked:text-oblink-orange">WinOptics</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="checkbox" name="skills[]" value="Cosium" class="peer hidden">
                            <div
                                class="p-3 bg-gray-50 rounded-xl text-center border-2 border-transparent peer-checked:border-oblink-orange peer-checked:bg-orange-50 transition">
                                <span
                                    class="font-bold text-sm text-gray-600 peer-checked:text-oblink-orange">Cosium</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="checkbox" name="skills[]" value="Irris" class="peer hidden">
                            <div
                                class="p-3 bg-gray-50 rounded-xl text-center border-2 border-transparent peer-checked:border-oblink-orange peer-checked:bg-orange-50 transition">
                                <span
                                    class="font-bold text-sm text-gray-600 peer-checked:text-oblink-orange">Irris</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group relative">
                            <input type="checkbox" name="skills[]" value="Autre" class="peer hidden"
                                id="skill-other-checkbox" onchange="toggleOtherSkillInput(this)">
                            <div
                                class="p-3 bg-gray-50 rounded-xl text-center border-2 border-transparent peer-checked:border-oblink-orange peer-checked:bg-orange-50 transition">
                                <span
                                    class="font-bold text-sm text-gray-600 peer-checked:text-oblink-orange">Autre</span>
                            </div>
                        </label>
                    </div>
                    <!-- Input caché pour 'Autre' -->
                    <div id="skill-other-container" class="mt-3 hidden">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Précisez le logiciel</label>
                        <input type="text" id="skill-other-input" placeholder="Ex: PHOENIX, LEO..."
                            class="w-full px-4 py-2 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-oblink-blue focus:ring-0 transition text-sm font-bold text-gray-700">
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- Section 4: Options Payantes (Boost) -->
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl p-6 border border-yellow-100">
                    <h2 class="text-xl font-bold text-oblink-gray mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-sm mr-3"><i
                                class="fas fa-rocket"></i></span>
                        Options de Visibilité
                    </h2>

                    <div class="space-y-3">
                        <label
                            class="flex items-start p-4 bg-white rounded-xl border border-yellow-100 cursor-pointer hover:border-yellow-300 transition">
                            <input type="checkbox" name="options[]" value="urgent"
                                class="mt-1 w-5 h-5 text-oblink-orange rounded focus:ring-oblink-orange border-gray-300">
                            <div class="ml-3">
                                <span class="block font-bold text-gray-800">Logo "URGENT" <span
                                        class="bg-yellow-100 text-yellow-700 text-xs px-2 py-0.5 rounded ml-2">10€</span></span>
                                <span class="block text-sm text-gray-500">Mettez un logo urgent pour démarquer votre
                                    annonce pendant 30 jours.</span>
                            </div>
                        </label>

                        <label
                            class="flex items-start p-4 bg-white rounded-xl border border-yellow-100 cursor-pointer hover:border-yellow-300 transition">
                            <input type="checkbox" name="options[]" value="top_list"
                                class="mt-1 w-5 h-5 text-oblink-orange rounded focus:ring-oblink-orange border-gray-300">
                            <div class="ml-3">
                                <span class="block font-bold text-gray-800">Remontée en tête de liste <span
                                        class="bg-yellow-100 text-yellow-700 text-xs px-2 py-0.5 rounded ml-2">15€</span></span>
                                <span class="block text-sm text-gray-500">Remontez votre annonce en haut des résultats
                                    chaque semaine.</span>
                            </div>
                        </label>
                    </div>
                </div>

            </div>

            <!-- Footer Actions -->
            <div
                class="bg-gray-50 px-8 py-6 flex flex-col md:flex-row items-center justify-between gap-4 border-t border-gray-100">
                <p class="text-xs text-gray-400 text-center md:text-left">
                    <i class="fas fa-info-circle mr-1"></i> Votre offre sera soumise à validation.
                </p>
                <div class="flex gap-4 w-full md:w-auto">
                    <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
                        class="flex-1 md:flex-none py-3 px-6 rounded-xl font-bold text-gray-500 hover:bg-gray-200 text-center transition">
                        Annuler
                    </a>
                    <button type="submit" id="submit-btn"
                        class="flex-1 md:flex-none py-3 px-8 bg-oblink-blue text-white rounded-xl font-bold hover:bg-oblink-gray transition shadow-lg shadow-blue-200">
                        Publier l'offre
                    </button>
                </div>
            </div>

        </form>

    </div>
</div>

<!-- Auth Guard: Redirect to login if not authenticated -->
<script>
    (async function () {
        try {
            console.log('[PUBLIER-OFFRE] 🔒 Auth guard starting...');

            // Wait for Supabase to be ready (with timeout)
            let attempts = 0;
            while (!window.oblinkSupabase && attempts < 20) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }

            if (!window.oblinkSupabase) {
                console.error('[PUBLIER-OFFRE] ❌ Supabase timeout');
                window.location.href = '<?php echo home_url('/login?redirect=/publier-offre'); ?>';
                return;
            }

            console.log('[PUBLIER-OFFRE] ✅ Supabase loaded');

            // Check session
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            console.log('[PUBLIER-OFFRE] Session:', session ? '✅ Active' : '❌ None');

            if (!session) {
                console.log('[PUBLIER-OFFRE] 🔄 Redirecting to login...');
                window.location.href = '<?php echo home_url('/login?redirect=/publier-offre'); ?>';
                return;
            }

            // Check if user is an entreprise
            const userType = session.user.user_metadata?.user_type;
            console.log('[PUBLIER-OFFRE] User type:', userType);

            if (userType !== 'entreprise') {
                alert('Cette page est réservée aux entreprises. Redirection...');
                window.location.href = '<?php echo home_url('/'); ?>';
                return;
            }

            // User is authenticated and is an entreprise - show the form
            console.log('[PUBLIER-OFFRE] ✅ Access granted!');
            document.getElementById('auth-loading').classList.add('hidden');
            document.getElementById('auth-protected-content').classList.remove('hidden');
        } catch (error) {
            console.error('[PUBLIER-OFFRE] ❌ Error:', error);
            window.location.href = '<?php echo home_url('/login?redirect=/publier-offre'); ?>';
        }
    })();
</script>

<script>
    function fillTemplate(type) {
        const form = document.querySelector('form');
        const typeSelect = form.querySelector('[name="contract_type"]');

        if (type === 'rempla') {
            form.querySelector('[name="job_title"]').value = 'Opticien Remplaçant (Juillet/Août)';
            typeSelect.value = 'cdd';
            form.querySelector('[name="salary"]').value = '350';
            form.querySelector('[name="location"]').value = 'Paris';
            form.querySelector('[name="description"]').value = 'Cherche remplaçant autonome pour la période estivale. Magasin de quartier, ambiance familiale. Logiciel WinOptics. Horaires : 10h-19h.';
        } else if (type === 'cdi') {
            form.querySelector('[name="job_title"]').value = 'Opticien Collaborateur Polyvalent';
            typeSelect.value = 'cdi';
            form.querySelector('[name="salary"]').value = '2600.00';
            form.querySelector('[name="description"]').value = 'Poste polyvalent (Vente, Atelier, Réfraction, Tiers-Payant). Nous cherchons un profil dynamique et souriant pour rejoindre notre équipe de 4 opticiens.';
        } else if (type === 'samedi') {
            form.querySelector('[name="job_title"]').value = 'Renfort Samedi';
            typeSelect.value = 'freelance';
            form.querySelector('[name="salary"]').value = '300';
            form.querySelector('[name="description"]').value = 'Besoin d\'un renfort pour les samedis. Forte affluence. Vente uniquement. Repas pris en charge.';
        }

        // Trigger change event to update date validation
        typeSelect.dispatchEvent(new Event('change'));

        // Visual feedback
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = 'Rempli !';
        btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
        btn.classList.remove('bg-white', 'text-blue-600');
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
            btn.classList.add('bg-white', 'text-blue-600');
        }, 1000);
    }

    document.addEventListener('DOMContentLoaded', function () {
        const typeSelect = document.querySelector('select[name="contract_type"]');
        const endDateInput = document.querySelector('input[name="end_date"]');
        const endDateLabel = endDateInput.previousElementSibling; // Label est juste avant
        const form = document.getElementById('publish-offer-form');
        const submitBtn = document.getElementById('submit-btn');

        function updateDateFields() {
            const val = typeSelect.value;
            // CDD ou Freelance = Date de fin requise
            if (val === 'cdd' || val === 'freelance') {
                endDateInput.required = true;
                endDateLabel.innerHTML = "Date de fin <span class='text-red-500'>*</span>";
                endDateLabel.classList.add('text-oblink-orange');
            } else {
                // CDI ou Stage = Optionnel
                endDateInput.required = false;
                endDateLabel.innerHTML = "Date de fin (Optionnel)";
                endDateLabel.classList.remove('text-oblink-orange');
            }
        }

        typeSelect.addEventListener('change', updateDateFields);
        updateDateFields(); // Run on init

        // Toggle function needs to be global or attached to window because it's called inline via onchange="toggleOtherSkillInput(this)"
        window.toggleOtherSkillInput = function (checkbox) {
            const container = document.getElementById('skill-other-container');
            const input = document.getElementById('skill-other-input');
            if (checkbox.checked) {
                container.classList.remove('hidden');
                setTimeout(() => input.focus(), 100);
            } else {
                container.classList.add('hidden');
                input.value = '';
            }
        };

        // Supabase Submission
        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            // UI Loading
            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publication...';
            submitBtn.disabled = true;

            try {
                // 1. Check Session
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                if (!session) {
                    throw new Error("Vous devez être connecté pour publier une offre.");
                }
                const user = session.user;

                // Collect Options
                const options = [];
                form.querySelectorAll('input[name="options[]"]:checked').forEach(cb => options.push(cb.value));

                // Collect Skills (Software)
                const software = [];
                form.querySelectorAll('input[name="skills[]"]:checked').forEach(cb => {
                    if (cb.value === 'Autre') {
                        const otherVal = document.getElementById('skill-other-input').value.trim();
                        if (otherVal) software.push(otherVal);
                    } else {
                        software.push(cb.value);
                    }
                });

                // Prepare Data for Upsert
                // FIX: Parsons le salaire pour éviter "numeric field overflow" si une chaine vide ou format incorrect est envoyé
                let salaryVal = parseFloat(form.querySelector('[name="salary"]').value);
                if (isNaN(salaryVal)) salaryVal = 0; // Default to 0 or handle error

                const offerData = {
                    company_id: user.id, // Linked to auth.users.id which maps to profiles.id via trigger usually, or we use profile id
                    title: form.querySelector('[name="job_title"]').value,
                    job_type: form.querySelector('[name="job_type"]').value, // NEW: Type de poste
                    contract_type: form.querySelector('[name="contract_type"]').value,
                    salary: salaryVal, // Numeric
                    city: form.querySelector('[name="location"]').value,
                    address: form.querySelector('[name="address"]').value, // Optional
                    description: form.querySelector('[name="description"]').value,
                    skills_needed: software, // We store software in skills_needed array
                    start_date: form.querySelector('[name="start_date"]').value,
                    end_date: form.querySelector('[name="end_date"]').value || null,
                    status: 'active',
                    is_urgent: options.includes('urgent'),
                    is_top_list: options.includes('top_list')
                };

                // 3. Insert into Supabase
                const { data, error } = await window.oblinkSupabase
                    .from('offers')
                    .insert([offerData])
                    .select();

                if (error) throw error;

                // 4. Success
                // Global Toast (if available) or redirect
                if (typeof showToast === 'function') {
                    showToast('Offre publiée avec succès !', 'success');
                }

                // 5. TRIGGER NOTIFICATION SYSTEM (Email/SMS to Experts)
                console.log('[PUBLIER-OFFRE] Triggering alerts...');
                const formData = new FormData();
                formData.append('action', 'trigger_mission_alert');
                formData.append('title', offerData.title);
                formData.append('city', offerData.city);
                formData.append('type', offerData.job_type);
                formData.append('salary', offerData.salary);

                fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
                    method: 'POST',
                    body: formData
                }).then(res => res.json()).then(res => {
                    console.log('[NOTIFICATIONS] Result:', res);
                    if (res.success) {
                        // Display the reassuring message from the backend (Matching Engine)
                        alert("✅ SUCCÈS : L'offre est en ligne !\n📲 " + res.data.message);
                    }
                });

                // Redirect to Dashboard
                setTimeout(() => {
                    window.location.href = '<?php echo home_url('/dashboard-entreprise?success=job_posted'); ?>';
                }, 1000);

            } catch (err) {
                console.error('Error publishing offer:', err);
                alert('Erreur: ' + (err.message || "Impossible de publier l'offre."));
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.disabled = false;
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-ville-seo.php ---
<?php
/*
Template Name: Ville SEO Local
*/

/**
 * Template pour pages SEO locales
 * Exemple d'utilisation : /opticien-freelance-paris
 * 
 * Variables à configurer via Custom Fields ou directement dans la page :
 * - ville_nom : "Paris"
 * - ville_code : "75"
 * - ville_region : "Île-de-France"
 */

include 'header-inc.php';

// Get city data from post meta or page slug
global $post;
$ville_nom = get_post_meta($post->ID, 'ville_nom', true) ?: 'Paris';
$ville_code = get_post_meta($post->ID, 'ville_code', true) ?: '75';
$ville_region = get_post_meta($post->ID, 'ville_region', true) ?: 'Île-de-France';
$ville_nb_magasins = get_post_meta($post->ID, 'ville_nb_magasins', true) ?: '450+';
$ville_nb_opticiens = get_post_meta($post->ID, 'ville_nb_opticiens', true) ?: '2 300+';
$ville_taux_jour_min = get_post_meta($post->ID, 'ville_taux_jour_min', true) ?: '280';
$ville_taux_jour_max = get_post_meta($post->ID, 'ville_taux_jour_max', true) ?: '350';
?>

<!-- Hero Section -->
<section class="pt-32 pb-20 bg-gradient-to-br from-orange-50 via-white to-violet-50 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center max-w-4xl mx-auto">
            <!-- Breadcrumbs -->
            <nav class="text-sm text-gray-500 mb-6">
                <a href="<?php echo home_url('/'); ?>" class="hover:text-oblink-orange">Accueil</a>
                <span class="mx-2">→</span>
                <a href="<?php echo home_url('/emploi-opticien'); ?>" class="hover:text-oblink-orange">Emploi
                    Opticien</a>
                <span class="mx-2">→</span>
                <span class="text-oblink-gray font-semibold">
                    <?php echo esc_html($ville_nom); ?>
                </span>
            </nav>

            <!-- Main Title -->
            <h1 class="text-5xl md:text-6xl font-bold mb-6 font-display text-oblink-gray">
                Opticien Freelance à <span class="text-oblink-orange">
                    <?php echo esc_html($ville_nom); ?>
                </span>
            </h1>

            <p class="text-xl text-gray-600 mb-8 leading-relaxed">
                Trouvez des missions pour professionnels de l'optique à
                <?php echo esc_html($ville_nom); ?> et en
                <?php echo esc_html($ville_region); ?>.
                OBLINK connecte les opticiens, vendeurs, monteurs, audioprothésistes et tous les professionnels de
                l'optique aux meilleurs magasins de la région.
            </p>

            <!-- CTA Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                    class="px-8 py-4 bg-oblink-orange text-white rounded-lg font-bold hover:bg-oblink-orange/90 transition shadow-lg">
                    <i class="fas fa-user-plus mr-2"></i>Créer mon profil gratuit
                </a>
                <a href="<?php echo home_url('/emploi-opticien'); ?>"
                    class="px-8 py-4 bg-white text-oblink-gray border-2 border-gray-200 rounded-lg font-bold hover:border-oblink-orange transition">
                    <i class="fas fa-search mr-2"></i>Voir les missions
                </a>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                    <div class="text-3xl font-bold text-oblink-orange mb-2">
                        <?php echo esc_html($ville_nb_magasins); ?>
                    </div>
                    <div class="text-sm text-gray-600">Magasins d'optique</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                    <div class="text-3xl font-bold text-oblink-blue mb-2">
                        <?php echo esc_html($ville_nb_opticiens); ?>
                    </div>
                    <div class="text-sm text-gray-600">Professionnels actifs</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                    <div class="text-3xl font-bold text-oblink-violet mb-2">
                        <?php echo esc_html($ville_taux_jour_min); ?>-
                        <?php echo esc_html($ville_taux_jour_max); ?>€
                    </div>
                    <div class="text-sm text-gray-600">Taux journalier</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                    <div class="text-3xl font-bold text-green-600 mb-2">48h</div>
                    <div class="text-sm text-gray-600">Réponse moyenne</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Missions Section -->
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-4xl font-bold text-oblink-gray mb-12 text-center font-display">
            🎯 Missions disponibles à
            <?php echo esc_html($ville_nom); ?>
        </h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- Mission Card 1 -->
            <div
                class="bg-gradient-to-br from-orange-50 to-white p-6 rounded-2xl border border-orange-100 hover:shadow-xl transition">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 rounded-full bg-oblink-orange/10 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-oblink-orange text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-oblink-gray">Remplacements congés</h3>
                        <p class="text-sm text-gray-500">
                            <?php echo esc_html($ville_nom); ?> Centre
                        </p>
                    </div>
                </div>
                <p class="text-gray-600 text-sm mb-4">Missions été 2026, durée 2-4 semaines. Équipe sympathique,
                    quartier dynamique.</p>
                <div class="flex items-center justify-between">
                    <span class="text-oblink-orange font-bold">
                        <?php echo esc_html($ville_taux_jour_min); ?>€/jour
                    </span>
                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                        class="text-sm text-oblink-blue hover:underline">
                        Voir détails →
                    </a>
                </div>
            </div>

            <!-- Mission Card 2 -->
            <div
                class="bg-gradient-to-br from-blue-50 to-white p-6 rounded-2xl border border-blue-100 hover:shadow-xl transition">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 rounded-full bg-oblink-blue/10 flex items-center justify-center">
                        <i class="fas fa-briefcase text-oblink-blue text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-oblink-gray">CDD 3-6 mois</h3>
                        <p class="text-sm text-gray-500">
                            <?php echo esc_html($ville_nom); ?>
                            <?php echo esc_html($ville_code); ?>
                        </p>
                    </div>
                </div>
                <p class="text-gray-600 text-sm mb-4">Magasin premium, clientèle haut de gamme. Verres Essilor,
                    lentilles CooperVision.</p>
                <div class="flex items-center justify-between">
                    <span class="text-oblink-blue font-bold">
                        <?php echo esc_html($ville_taux_jour_max); ?>€/jour
                    </span>
                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                        class="text-sm text-oblink-blue hover:underline">
                        Voir détails →
                    </a>
                </div>
            </div>

            <!-- Mission Card 3 -->
            <div
                class="bg-gradient-to-br from-violet-50 to-white p-6 rounded-2xl border border-violet-100 hover:shadow-xl transition">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 rounded-full bg-oblink-violet/10 flex items-center justify-center">
                        <i class="fas fa-clock text-oblink-violet text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-oblink-gray">Missions week-end</h3>
                        <p class="text-sm text-gray-500">Plusieurs arrondissements</p>
                    </div>
                </div>
                <p class="text-gray-600 text-sm mb-4">Samedi et/ou dimanche. Idéal complément activité. Flexibilité
                    horaire.</p>
                <div class="flex items-center justify-between">
                    <span class="text-oblink-violet font-bold">300€/jour</span>
                    <a href="<?php echo home_url('/emploi-opticien'); ?>"
                        class="text-sm text-oblink-blue hover:underline">
                        Voir détails →
                    </a>
                </div>
            </div>
        </div>

        <div class="text-center">
            <a href="<?php echo home_url('/emploi-opticien'); ?>"
                class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white rounded-xl font-bold hover:shadow-xl transition">
                <i class="fas fa-search mr-2"></i>
                Voir toutes les missions à
                <?php echo esc_html($ville_nom); ?>
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Marché Local Section -->
<section class="py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-2 gap-12 items-center">
            <div>
                <h2 class="text-4xl font-bold text-oblink-gray mb-6 font-display">
                    📊 Marché de l'optique à
                    <?php echo esc_html($ville_nom); ?>
                </h2>

                <div class="space-y-6">
                    <div class="flex items-start gap-4">
                        <div
                            class="w-12 h-12 rounded-full bg-oblink-orange/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-store text-oblink-orange text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2">
                                <?php echo esc_html($ville_nb_magasins); ?> magasins d'optique
                            </h3>
                            <p class="text-gray-600">Grande concentration de magasins indépendants et enseignes
                                nationales. Forte demande de professionnels qualifiés.</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-4">
                        <div
                            class="w-12 h-12 rounded-full bg-oblink-blue/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-users text-oblink-blue text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2">
                                <?php echo esc_html($ville_nb_opticiens); ?> opticiens en
                                <?php echo esc_html($ville_region); ?>
                            </h3>
                            <p class="text-gray-600">Marché dynamique avec de nombreuses opportunités pour opticiens
                                freelances et indépendants.</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-euro-sign text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2">Taux journalier moyen :
                                <?php echo esc_html($ville_taux_jour_min); ?>-
                                <?php echo esc_html($ville_taux_jour_max); ?>€/jour
                            </h3>
                            <p class="text-gray-600">Rémunération attractive, parmi les plus élevées de France. Nombreux
                                quartiers premium.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
                <h3 class="text-2xl font-bold text-oblink-gray mb-6">Secteurs recherchés</h3>
                <div class="grid grid-cols-2 gap-4">
                    <?php
                    // Quartiers populaires par défaut (peut être personnalisé par ville)
                    $quartiers = ['Centre', 'Nord', 'Sud', 'Est', 'Ouest', 'Périphérie'];
                    foreach ($quartiers as $quartier):
                        ?>
                        <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                            <i class="fas fa-map-marker-alt text-oblink-orange"></i>
                            <span class="font-semibold">
                                <?php echo esc_html($ville_nom); ?>
                                <?php echo esc_html($quartier); ?>
                            </span>
                        </div>
                    <?php endforeach; ?>
                </div>
                <p class="text-sm text-gray-500 mt-6">+ Banlieue proche et département
                    <?php echo esc_html($ville_code); ?>
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Pourquoi OBLINK Section -->
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-4xl font-bold text-oblink-gray mb-12 text-center font-display">
            💼 Pourquoi choisir OBLINK à
            <?php echo esc_html($ville_nom); ?> ?
        </h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="bg-gradient-to-br from-orange-50 to-white p-6 rounded-2xl border border-orange-100 text-center">
                <div class="w-16 h-16 rounded-full bg-oblink-orange/10 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-building text-oblink-orange text-2xl"></i>
                </div>
                <h3 class="font-bold text-lg mb-2">Meilleures enseignes</h3>
                <p class="text-gray-600 text-sm">Accès aux magasins premium de
                    <?php echo esc_html($ville_nom); ?>
                </p>
            </div>

            <div class="bg-gradient-to-br from-blue-50 to-white p-6 rounded-2xl border border-blue-100 text-center">
                <div class="w-16 h-16 rounded-full bg-oblink-blue/10 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-map-marked-alt text-oblink-blue text-2xl"></i>
                </div>
                <h3 class="font-bold text-lg mb-2">Tous arrondissements</h3>
                <p class="text-gray-600 text-sm">Missions dans toute la ville et périphérie</p>
            </div>

            <div class="bg-gradient-to-br from-violet-50 to-white p-6 rounded-2xl border border-violet-100 text-center">
                <div class="w-16 h-16 rounded-full bg-oblink-violet/10 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-handshake text-oblink-violet text-2xl"></i>
                </div>
                <h3 class="font-bold text-lg mb-2">Accompagnement local</h3>
                <p class="text-gray-600 text-sm">Support transport & hébergement si besoin</p>
            </div>

            <div class="bg-gradient-to-br from-green-50 to-white p-6 rounded-2xl border border-green-100 text-center">
                <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-bolt text-green-600 text-2xl"></i>
                </div>
                <h3 class="font-bold text-lg mb-2">Paiement rapide</h3>
                <p class="text-gray-600 text-sm">Règlement sous 48h après mission</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Final -->
<section class="py-24 bg-gradient-to-br from-oblink-gray via-gray-800 to-gray-900 text-white relative overflow-hidden">
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-oblink-violet rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
        <h2 class="text-4xl md:text-5xl font-bold mb-6 font-display">
            Prêt à trouver votre prochaine mission à
            <?php echo esc_html($ville_nom); ?> ?
        </h2>
        <p class="text-xl text-gray-300 mb-10">
            Rejoignez +500 professionnels de l'optique qui font confiance à OBLINK pour trouver les meilleures
            opportunités.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="<?php echo home_url('/inscription-opticien'); ?>"
                class="px-8 py-4 bg-oblink-orange text-white rounded-lg font-bold hover:bg-oblink-orange/90 transition shadow-lg">
                <i class="fas fa-user-plus mr-2"></i>Créer mon profil gratuit
            </a>
            <a href="<?php echo home_url('/emploi-opticien'); ?>"
                class="px-8 py-4 bg-white text-oblink-gray rounded-lg font-bold hover:bg-gray-100 transition">
                <i class="fas fa-search mr-2"></i>Parcourir les missions
            </a>
        </div>

        <p class="text-gray-400 text-sm mt-8">
            <i class="fas fa-lock mr-1"></i> Inscription 100% gratuite • Sans engagement • Validation en 48h
        </p>
    </div>
</section>

<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-emploi-opticien-v2.php ---
<?php
/*
Template Name: Emploi Opticien V2 (Premium UI)
Description: Matching Dashboard with Job Cards, TJM focus, and Real-time filters.
*/
include 'header-inc.php';
?>

<style>
    /* Gradient Text */
    .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-image: linear-gradient(90deg, #FF6600, #9A48D0);
    }

    /* Glassmorphism Cards */
    .job-card-glass {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .job-card-glass:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        border-color: rgba(255, 102, 0, 0.3);
    }

    /* Soft Badge */
    .badge-soft {
        padding: 4px 12px;
        border-radius: 9999px;
        font-weight: 700;
        font-size: 0.75rem;
        letter-spacing: 0.025em;
    }

    /* Filter Chips */
    .filter-chip {
        transition: all 0.2s;
    }

    .filter-chip:hover {
        transform: translateY(-1px);
    }

    .filter-chip.active {
        background: #303030;
        color: white;
        border-color: #303030;
    }
</style>

<div class="min-h-screen bg-gray-50/50 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- HEADER: Matching Dashboard -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
            <div>
                <span
                    class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-xs mb-3 uppercase tracking-wider">
                    <i class="fas fa-bolt mr-1"></i> Live Matching
                </span>
                <h1 class="text-3xl md:text-5xl font-black text-oblink-gray">
                    Missions <span class="text-gradient">Compatibles</span>
                </h1>
                <p class="text-gray-500 mt-2 font-medium">
                    24 missions correspondent à votre profil "Expert Cosium" à <span
                        class="text-oblink-gray font-bold">Paris</span> (30km).
                </p>
            </div>

            <!-- ZONE C: Flash Post Button (Pour les recruteurs en vue inversée, ou CTA général) -->
            <div class="flex gap-3">
                <a href="<?php echo home_url('/publier-offre'); ?>"
                    class="group relative px-6 py-4 bg-oblink-gray text-white rounded-2xl font-bold shadow-lg shadow-gray-200 overflow-hidden transition-all hover:scale-105">
                    <div
                        class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:animate-shimmer">
                    </div>
                    <span class="relative flex items-center gap-2">
                        <i class="fas fa-plus-circle text-oblink-orange"></i>
                        Déposer une mission Flash
                    </span>
                </a>
            </div>
        </div>

        <!-- ZONE A: FILTRES INTELLIGENTS (Métiers) -->
        <div
            class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 mb-10 sticky top-24 z-30 backdrop-blur-md bg-white/90">
            <div class="flex flex-col md:flex-row gap-6 items-center justify-between">

                <!-- Logiciels -->
                <div class="flex flex-wrap gap-2 items-center">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wide mr-2">Logiciels :</span>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue active"
                        data-filter="software" data-value="all">Tous</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="Cosium">Cosium</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="Ivoirnet">Ivoirnet</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="WinOptics">WinOptics</button>
                </div>

                <div class="w-px h-8 bg-gray-200 hidden md:block"></div>

                <!-- Urgence & Type -->
                <div class="flex flex-wrap gap-2 items-center">
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-red-100 text-red-500 font-bold text-sm bg-red-50/50 hover:bg-red-500 hover:text-white transition-colors"
                        data-filter="urgent" data-value="true">
                        <i class="fas fa-fire mr-1"></i> Urgent (24h)
                    </button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white"
                        data-filter="type" data-value="remplacement">Remplacement</button>
                </div>

            </div>
        </div>

        <!-- ZONE B: LES CARTES D'ANNONCES (Grid) -->
        <div id="jobs-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Jobs injected via JS -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center mt-12 gap-2"></div>

    </div>
</div>

<script>
    // --- 15-20 REALISTIC MOCK MISSIONS ---
    const MISSIONS = [
        { id: 1, title: "Remplacement Opticien Diplômé", company: "Optic 2000", city: "Paris 15", software: "Cosium", tjm: 450, urgent: true, expert_required: true, type: "Remplacement", date: "Demain" },
        { id: 2, title: "Renfort Samedi Vente", company: "Afflelou", city: "Boulogne-Billancourt", software: "Cosium", tjm: 350, urgent: true, expert_required: false, type: "Intérim", date: "Samedi" },
        { id: 3, title: "Responsable Atelier (1 semaine)", company: "Krys", city: "Lyon 2", software: "Ivoirnet", tjm: 500, urgent: false, expert_required: true, type: "Remplacement", date: "22 Jan" },
        { id: 4, title: "Opticien Réfractionniste", company: "Indépendant", city: "Bordeaux", software: "WinOptics", tjm: 550, urgent: false, expert_required: true, type: "Audit", date: "25 Jan" },
        { id: 5, title: "Remplacement Congé Maladie", company: "Grand Optical", city: "Paris 08", software: "Cosium", tjm: 480, urgent: true, expert_required: true, type: "Remplacement", date: "Aujourd'h." },
        { id: 6, title: "Vendeur Lunettier", company: "Jimmy Fairly", city: "Lille", software: "PVO", tjm: 320, urgent: false, expert_required: false, type: "Intérim", date: "01 Fév" },
        { id: 7, title: "Expert Contactologie", company: "Lissac", city: "Strasbourg", software: "Ivoirnet", tjm: 600, urgent: false, expert_required: true, type: "Expertise", date: "10 Fév" },
        { id: 8, title: "Opticien Collaborateur", company: "Optical Center", city: "Toulouse", software: "WinOptics", tjm: 400, urgent: false, expert_required: false, type: "CDD Court", date: "15 Fév" },
        { id: 9, title: "Mission Urgente 3 jours", company: "Indépendant", city: "Marseille", software: "Cosium", tjm: 500, urgent: true, expert_required: true, type: "Remplacement", date: "Ce jeudi" },
        { id: 10, title: "Audit Tiers-Payant", company: "Réseau Santé", city: "Nantes", software: "Ivoirnet", tjm: 450, urgent: false, expert_required: true, type: "Audit", date: "Mars" },
        { id: 11, title: "Remplacement Directeur", company: "Atol", city: "Nice", software: "Cosium", tjm: 650, urgent: false, expert_required: true, type: "Management", date: "Avril" },
        { id: 12, title: "Vente Solaire Renfort", company: "Solaris", city: "Cannes", software: "PVO", tjm: 300, urgent: false, expert_required: false, type: "Saisonnier", date: "Mai" },
        { id: 13, title: "Optométriste Confirmé", company: "Santé Clair", city: "Paris 11", software: "WinOptics", tjm: 580, urgent: false, expert_required: true, type: "Consulting", date: "Juin" },
        { id: 14, title: "Remplacement maternité", company: "Ecouter Voir", city: "Rennes", software: "Cosium", tjm: 420, urgent: false, expert_required: true, type: "Remplacement", date: "Sept" },
        { id: 15, title: "Formateur en Magasin", company: "Zeiss", city: "Toute France", software: "Cosium", tjm: 700, urgent: false, expert_required: true, type: "Formation", date: "Oct" }
    ];

    let activeFilters = {
        software: 'all',
        urgent: false,
        type: 'all'
    };

    function renderJobs() {
        const container = document.getElementById('jobs-container');
        container.innerHTML = '';

        const filtered = MISSIONS.filter(m => {
            if (activeFilters.software !== 'all' && m.software !== activeFilters.software) return false;
            if (activeFilters.urgent && !m.urgent) return false;
            // Type filter logic matches on "string contains" for demo simplicity
            if (activeFilters.type !== 'all' && !m.type.toLowerCase().includes(activeFilters.type.toLowerCase())) return false;
            return true;
        });

        if (filtered.length === 0) {
            container.innerHTML = `<div class="col-span-3 text-center py-20">
                <div class="text-6xl mb-4">🤷‍♂️</div>
                <h3 class="text-xl font-bold text-gray-400">Aucune mission ne correspond.</h3>
                <button onclick="resetFilters()" class="mt-4 text-oblink-blue font-bold hover:underline">Réinitialiser les filtres</button>
            </div>`;
            return;
        }

        filtered.forEach(job => {
            const card = document.createElement('div');
            card.className = 'job-card-glass rounded-3xl p-6 relative flex flex-col h-full group cursor-pointer'; // Added cursor-pointer
            card.onclick = () => { // Add onclick handler
                window.location.href = '<?php echo home_url('/mission-detail'); ?>?id=' + job.id;
            };

            // Badge Software Color
            let softColor = "bg-gray-100 text-gray-600";
            if (job.software === "Cosium") softColor = "bg-blue-50 text-blue-600 border border-blue-100";
            if (job.software === "Ivoirnet") softColor = "bg-purple-50 text-purple-600 border border-purple-100";
            if (job.software === "WinOptics") softColor = "bg-orange-50 text-orange-600 border border-orange-100";

            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <span class="badge-soft ${softColor} flex items-center gap-1">
                        <i class="fas fa-desktop text-xs"></i> ${job.software}
                    </span>
                    ${job.urgent ? `
                    <span class="badge-soft bg-red-500 text-white animate-pulse shadow-red-200 shadow-lg">
                        <i class="fas fa-bolt mr-1"></i> Urgent
                    </span>` : `<span class="text-xs font-bold text-gray-400">${job.date}</span>`}
                </div>

                <div class="mb-auto">
                    <h3 class="font-bold text-xl text-oblink-gray mb-1 group-hover:text-oblink-orange transition-colors">${job.title}</h3>
                    <p class="text-sm text-gray-500 font-medium flex items-center gap-2">
                        <i class="fas fa-map-marker-alt text-gray-300"></i> ${job.city}
                        <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                        ${job.company}
                    </p>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-100 flex items-end justify-between">
                    <div>
                        <div class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">TJM PROPOSÉ</div>
                        <div class="text-3xl font-black text-oblink-gray group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-oblink-orange group-hover:to-oblink-violet transition-all">
                            ${job.tjm}€<span class="text-sm text-gray-400 font-medium ml-1">/j</span>
                        </div>
                    </div>
                    
                    ${job.expert_required ? `
                        <div class="flex flex-col items-end">
                             <div class="w-10 h-10 rounded-full bg-gradient-to-br from-oblink-orange to-oblink-violet flex items-center justify-center text-white shadow-lg tooltip-trigger" title="Certification Expert Requise">
                                <i class="fas fa-certificate"></i>
                             </div>
                             <span class="text-[10px] font-bold text-oblink-gray mt-1">Expert Only</span>
                        </div>
                    ` : `
                        <button class="w-10 h-10 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center group-hover:bg-oblink-blue group-hover:text-white transition-all">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    `}
                </div>
            `;
            container.appendChild(card);
        });
    }

    // Filter Logic
    document.querySelectorAll('.filter-chip').forEach(btn => {
        btn.addEventListener('click', function () {
            const filterType = this.dataset.filter;
            const value = this.dataset.value;

            // Update UI
            if (filterType === 'software') {
                document.querySelectorAll('[data-filter="software"]').forEach(b => b.classList.remove('active', 'bg-oblink-gray', 'text-white', 'border-transparent'));
                // Reset generic style on all
                document.querySelectorAll('[data-filter="software"]').forEach(b => b.classList.add('bg-white', 'text-gray-600', 'border-gray-200'));

                // Active Style
                this.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                this.classList.add('active', 'bg-oblink-gray', 'text-white', 'border-transparent');
                activeFilters.software = value;
            }

            if (filterType === 'urgent') {
                this.classList.toggle('ring-2');
                this.classList.toggle('ring-red-300');
                activeFilters.urgent = !activeFilters.urgent;
            }

            if (filterType === 'type') {
                // Simple toggle for demo
                activeFilters.type = activeFilters.type === 'remplacement' ? 'all' : 'remplacement';
                this.classList.toggle('bg-gray-100');
            }

            renderJobs();
        });
    });

    function resetFilters() {
        activeFilters = { software: 'all', urgent: false, type: 'all' };
        document.querySelectorAll('.filter-chip').forEach(b => {
            // Reset UI styles... simplified for demo
            b.classList.remove('active', 'ring-2', 'ring-red-300', 'bg-oblink-gray', 'text-white');
            if (b.dataset.filter === 'software' && b.dataset.value === 'all') b.classList.add('active', 'bg-oblink-gray', 'text-white');
        });
        renderJobs();
    }

    // Init
    document.addEventListener('DOMContentLoaded', renderJobs);

</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-emploi-opticien.php ---
<?php
/**
 * Template Name: Offres Emploi Opticien
 */

include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- OBSERVATOIRE BANNER -->
        <div class="max-w-5xl mx-auto mb-10">
            <a href="<?php echo home_url('/observatoire'); ?>"
                class="block bg-gradient-to-r from-gray-900 to-oblink-gray rounded-2xl p-6 shadow-lg text-white group hover:shadow-xl transition relative overflow-hidden">
                <div class="absolute right-0 top-0 bottom-0 w-64 bg-oblink-blue/10 skew-x-12 transform translate-x-10">
                </div>
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-2xl">
                            <i class="fas fa-chart-pie text-oblink-orange"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Consultez le Baromètre 2026</h3>
                            <p class="text-gray-400 text-sm">Avant de postuler, vérifiez les salaires du marché.</p>
                        </div>
                    </div>
                    <span
                        class="px-4 py-2 bg-white text-oblink-gray font-bold rounded-lg text-sm group-hover:bg-oblink-orange group-hover:text-white transition">
                        Voir l'étude <i class="fas fa-arrow-right ml-1"></i>
                    </span>
                </div>
            </a>
        </div>

        <!-- HEADER SECTION -->
        <div class="text-center mb-12">
            <div
                class="inline-block px-3 py-1 bg-oblink-orange/10 text-oblink-orange font-bold rounded-full text-xs uppercase tracking-wider mb-3">
                Sélection Hebdomadaire</div>
            <h1 class="text-4xl font-black font-display text-gray-900 mb-4 tracking-tight">
                Les Pépites <span class="text-oblink-blue">Oblink</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-2xl mx-auto">
                Nous sélectionnons à la main les meilleures offres du marché (Salaire, Ambiance, Avantages).
            </p>
        </div>

        <!-- FILTERS SECTION -->
        <div class="max-w-5xl mx-auto mb-8">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-gray-900 flex items-center gap-2">
                        <i class="fas fa-filter text-oblink-blue"></i>
                        Filtrer les offres
                    </h3>
                    <button id="reset-filters"
                        class="text-sm text-oblink-blue hover:text-oblink-blue/80 font-semibold transition hidden">
                        <i class="fas fa-redo mr-1"></i>
                        Réinitialiser
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-4">
                    <!-- Contract Type Filter -->
                    <div>
                        <label for="filter-contract" class="block text-sm font-semibold text-gray-700 mb-2">
                            Type de contrat
                        </label>
                        <select id="filter-contract"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Tous les contrats</option>
                            <option value="cdi">CDI</option>
                            <option value="cdd">CDD / Remplacement</option>
                            <option value="freelance">Freelance</option>
                            <option value="vacation">Vacation</option>
                        </select>
                    </div>

                    <!-- City Filter -->
                    <div>
                        <label for="filter-city" class="block text-sm font-semibold text-gray-700 mb-2">
                            Ville
                        </label>
                        <input type="text" id="filter-city" placeholder="Ex: Paris, Lyon..."
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                    </div>

                    <!-- Region Filter (optional) -->
                    <div>
                        <label for="filter-region" class="block text-sm font-semibold text-gray-700 mb-2">
                            Région
                        </label>
                        <select id="filter-region"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Toutes les régions</option>
                            <option value="ile-de-france">Île-de-France</option>
                            <option value="auvergne-rhone-alpes">Auvergne-Rhône-Alpes</option>
                            <option value="provence-alpes-cote-azur">Provence-Alpes-Côte d'Azur</option>
                            <option value="occitanie">Occitanie</option>
                            <option value="nouvelle-aquitaine">Nouvelle-Aquitaine</option>
                            <option value="hauts-de-france">Hauts-de-France</option>
                            <option value="grand-est">Grand Est</option>
                            <option value="pays-de-la-loire">Pays de la Loire</option>
                            <option value="bretagne">Bretagne</option>
                            <option value="normandie">Normandie</option>
                            <option value="bourgogne-franche-comte">Bourgogne-Franche-Comté</option>
                            <option value="centre-val-de-loire">Centre-Val de Loire</option>
                        </select>
                    </div>
                </div>

                <!-- Results Counter -->
                <div id="results-counter"
                    class="mt-4 pt-4 border-t border-gray-100 text-sm text-gray-600 font-medium hidden">
                    <i class="fas fa-search mr-2"></i>
                    <span id="counter-text">0 offre trouvée</span>
                </div>
            </div>
        </div>

        <!-- LOADING STATE -->
        <div id="loading-state" class="text-center py-12">
            <i class="fas fa-circle-notch fa-spin text-4xl text-oblink-blue mb-4"></i>
            <p class="text-gray-500">Recherche des meilleures missions...</p>
        </div>

        <!-- JOBS LIST CONTAINER -->
        <div id="jobs-container" class="grid gap-6 max-w-4xl mx-auto hidden">
            <!-- Jobs will be injected here via JS -->
        </div>

        <!-- EMPTY STATE -->
        <div id="empty-state" class="hidden text-center py-12 max-w-2xl mx-auto">
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">🧐
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Aucune offre pour le moment</h3>
                <p class="text-gray-500">Revenez plus tard, de nouvelles missions sont ajoutées chaque jour.</p>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loadingState = document.getElementById('loading-state');
        const jobsContainer = document.getElementById('jobs-container');
        const emptyState = document.getElementById('empty-state');

        // Check if we have a job_id parameter (single job view)
        const urlParams = new URLSearchParams(window.location.search);
        const singleJobId = urlParams.get('job_id');

        if (singleJobId) {
            // Redirect to mission detail page
            window.location.href = '<?php echo home_url('/mission-detail'); ?>?id=' + singleJobId;
            return;
        }

        let currentUser = null;

        let allJobs = []; // Store all jobs for filtering
        
        try {
            // Get Current User
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            currentUser = session?.user || null;

            // Fetch Offers (Simplified Query)
            const { data: jobs, error } = await window.oblinkSupabase
                .from('offers')
                .select('*')
                .eq('status', 'active')
                .order('created_at', { ascending: false });

            console.log('Jobs fetched:', jobs, 'Error:', error);

            if (error) {
                console.error('Supabase Error:', error.message, error.details, error.hint);
                throw error;
            }

            // Hide loading
            loadingState.classList.add('hidden');

            if (!jobs || jobs.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            // Store all jobs for filtering
            allJobs = jobs;

            // Render all jobs initially
            renderJobs(allJobs);

            // Initialize filters
            setupFilters();

            // Check application status for logged user
            if (currentUser) {
                checkApplications(currentUser.id, jobs);
            }

        } catch (err) {
            console.error('Error loading jobs:', err);
            loadingState.innerHTML = `<p class="text-red-500">Erreur: ${err.message || 'Chargement impossible.'}</p><p class="text-xs text-gray-400 mt-2">Vérifiez la console (F12) pour plus de détails.</p>`;
        }

        // --- Filter Setup ---
        function setupFilters() {
            const filterContract = document.getElementById('filter-contract');
            const filterCity = document.getElementById('filter-city');
            const filterRegion = document.getElementById('filter-region');
            const resetBtn = document.getElementById('reset-filters');

            // Add event listeners
            filterContract.addEventListener('change', applyFilters);
            filterCity.addEventListener('input', applyFilters);
            filterRegion.addEventListener('change', applyFilters);
            resetBtn.addEventListener('click', resetFilters);
        }

        function applyFilters() {
            const contractValue = document.getElementById('filter-contract').value.toLowerCase();
            const cityValue = document.getElementById('filter-city').value.toLowerCase().trim();
            const regionValue = document.getElementById('filter-region').value.toLowerCase();

            // Filter jobs
            const filteredJobs = allJobs.filter(job => {
                let matches = true;

                // Contract filter
                if (contractValue && job.contract_type.toLowerCase() !== contractValue) {
                    matches = false;
                }

                // City filter (partial match)
                if (cityValue && !(job.city || '').toLowerCase().includes(cityValue)) {
                    matches = false;
                }

                // Region filter (you may need to add region field to offers table)
                // For now, we'll skip region filtering as it's not in the schema
                // if (regionValue && job.region?.toLowerCase() !== regionValue) {
                //     matches = false;
                // }

                return matches;
            });

            // Render filtered jobs
            renderJobs(filteredJobs);

            // Update UI
            updateFilterUI(filteredJobs.length);
        }

        function resetFilters() {
            // Clear all filters
            document.getElementById('filter-contract').value = '';
            document.getElementById('filter-city').value = '';
            document.getElementById('filter-region').value = '';

            // Render all jobs
            renderJobs(allJobs);

            // Hide reset button and counter
            document.getElementById('reset-filters').classList.add('hidden');
            document.getElementById('results-counter').classList.add('hidden');
        }

        function renderJobs(jobs) {
            if (jobs.length === 0) {
                jobsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100 inline-block">
                            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">🔍</div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Aucune offre ne correspond</h3>
                            <p class="text-gray-500">Essayez de modifier vos filtres</p>
                        </div>
                    </div>
                `;
                jobsContainer.classList.remove('hidden');
            } else {
                jobsContainer.innerHTML = jobs.map(job => renderJobCard(job)).join('');
                jobsContainer.classList.remove('hidden');
                jobsContainer.classList.add('grid', 'md:grid-cols-2', 'gap-6');

                // Re-check applications if user is logged in
                if (currentUser) {
                    checkApplications(currentUser.id, jobs);
                }
            }
        }

        function updateFilterUI(count) {
            const resetBtn = document.getElementById('reset-filters');
            const counter = document.getElementById('results-counter');
            const counterText = document.getElementById('counter-text');

            // Show/hide reset button
            const hasFilters = 
                document.getElementById('filter-contract').value ||
                document.getElementById('filter-city').value ||
                document.getElementById('filter-region').value;

            if (hasFilters) {
                resetBtn.classList.remove('hidden');
                counter.classList.remove('hidden');
                
                // Update counter text
                if (count === 0) {
                    counterText.textContent = 'Aucune offre trouvée';
                } else if (count === 1) {
                    counterText.textContent = '1 offre trouvée';
                } else {
                    counterText.textContent = `${count} offres trouvées sur ${allJobs.length}`;
                }
            } else {
                resetBtn.classList.add('hidden');
                counter.classList.add('hidden');
            }
        }

        // --- Render Function ---
        function renderJobCard(job) {
            // Format dates
            const startDate = new Date(job.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' });
            const contractLabel = job.contract_type === 'cdd' ? 'CDD / Remplacement' : job.contract_type.toUpperCase();
            const salary = job.daily_rate ? `${job.daily_rate}€ / jour` : 'Salaire non affiché';

            // Random logo letter & color
            const letter = job.company?.company_name?.charAt(0) || 'O';
            const colors = ['bg-blue-100 text-blue-600', 'bg-purple-100 text-purple-600', 'bg-orange-100 text-orange-600'];
            const colorClass = colors[job.title.length % 3];

            return `
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition group relative overflow-hidden job-card cursor-pointer" 
                     data-job-id="${job.id}"
                     onclick="window.location.href='<?php echo home_url('/emploi-opticien'); ?>?job_id=${job.id}'">
                    <div class="flex flex-col gap-4">
                        <!-- LOGO -->
                        <div class="w-12 h-12 rounded-xl flex-shrink-0 flex items-center justify-center text-lg font-bold border border-gray-200 ${colorClass}">
                            ${letter}
                        </div>

                        <!-- CONTENT -->
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-blue transition flex-1">
                                    ${job.title}
                                </h3>
                            </div>

                            <div class="flex flex-wrap gap-2 text-xs text-gray-600 mb-3">
                                <span class="flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-1 rounded font-semibold">
                                    <i class="fas fa-map-marker-alt"></i> ${job.city || 'Ville inconnue'}
                                </span>
                                <span class="flex items-center gap-1 bg-gray-100 text-gray-700 px-2 py-1 rounded font-medium">
                                    <i class="fas fa-file-contract"></i> ${contractLabel}
                                </span>
                                <span class="flex items-center gap-1 bg-green-50 text-green-700 px-2 py-1 rounded font-bold">
                                    <i class="fas fa-euro-sign"></i> ${salary}
                                </span>
                            </div>

                            <p class="text-sm text-gray-500 line-clamp-2 mb-4">
                                ${job.description || 'Aucune description disponible.'}
                            </p>

                            <!-- ACTION BUTTONS -->
                            <div class="flex items-center gap-3">
                                ${currentUser ?
                    `<button onclick="event.stopPropagation(); applyToJob(this, '${job.id}')"
                                        class="apply-btn flex-1 px-4 py-2.5 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition shadow-md flex items-center justify-center gap-2">
                                        <i class="fas fa-paper-plane"></i> Postuler
                                    </button>` :
                    `<a href="<?php echo home_url('/login'); ?>?redirect=${encodeURIComponent(window.location.pathname)}"
                                        onclick="event.stopPropagation()"
                                        class="flex-1 px-4 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-gray-800 transition shadow-md flex items-center justify-center gap-2">
                                        <i class="fas fa-lock"></i> Connectez-vous pour postuler
                                    </a>`
                }
                                <button onclick="event.stopPropagation(); window.location.href='<?php echo home_url('/emploi-opticien'); ?>?job_id=${job.id}'" 
                                        class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Apply Function ---
        window.applyToJob = async function (btn, jobId) {
            if (btn.disabled) return;

            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi...';
            btn.disabled = true;
            btn.classList.add('opacity-75');

            try {
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                if (!session) throw new Error("Non connecté");

                // Check if already applied (double check)
                const { data: existing } = await window.oblinkSupabase
                    .from('applications')
                    .select('id')
                    .eq('offer_id', jobId)
                    .eq('opticien_id', session.user.id)
                    .single();

                if (existing) {
                    throw new Error("Vous avez déjà postulé à cette offre.");
                }

                // Insert Application
                const { error } = await window.oblinkSupabase
                    .from('applications')
                    .insert([{
                        offer_id: jobId,
                        opticien_id: session.user.id,
                        status: 'pending'
                    }]);

                if (error) throw error;

                // Success UI
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Candidature envoyée';
                btn.classList.remove('bg-oblink-blue', 'text-white', 'hover:bg-blue-600', 'shadow-blue-100');
                btn.classList.add('bg-green-100', 'text-green-700', 'cursor-default');

                // Toast
                if (typeof showToast === 'function') {
                    showToast('Candidature envoyée avec succès !', 'success');
                }

            } catch (err) {
                console.error('Apply error:', err);
                
                // Show error in a better way (not alert)
                btn.innerHTML = '<i class="fas fa-exclamation-circle"></i> Erreur';
                btn.classList.add('bg-red-100', 'text-red-700');
                
                // Reset after 3 seconds
                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                    btn.classList.remove('opacity-75', 'bg-red-100', 'text-red-700');
                }, 3000);
            }
        }

        // --- Check Existing Applications ---
        async function checkApplications(userId, jobs) {
            const jobIds = jobs.map(j => j.id);
            if (jobIds.length === 0) return;

            const { data: applications } = await window.oblinkSupabase
                .from('applications')
                .select('offer_id')
                .eq('opticien_id', userId)
                .in('offer_id', jobIds);

            if (applications) {
                applications.forEach(app => {
                    const card = document.querySelector(`.job-card[data-job-id="${app.offer_id}"]`);
                    if (card) {
                        const btn = card.querySelector('.apply-btn');
                        if (btn) {
                            btn.innerHTML = '<i class="fas fa-check-circle"></i> Déjà postulé';
                            btn.classList.remove('bg-oblink-blue', 'text-white', 'hover:bg-blue-600', 'shadow-blue-100');
                            btn.classList.add('bg-gray-100', 'text-gray-500', 'cursor-default');
                            btn.disabled = true;
                        }
                    }
                });
            }
        }
    });
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-profil-opticien.php ---
<?php
/*
Template Name: Profil Opticien Public
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-28 pb-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-20">
            <i class="fas fa-circle-notch fa-spin text-4xl text-oblink-blue mb-4"></i>
            <p class="text-gray-500">Chargement du profil...</p>
        </div>

        <!-- Profile Content (Hidden until loaded) -->
        <div id="profile-content" class="hidden">

            <!-- Main Card -->
            <div class="bg-white rounded-3xl shadow-lg overflow-hidden border border-gray-100">

                <!-- Header Banner -->
                <div class="h-32 bg-gradient-to-r from-oblink-blue to-oblink-violet relative">
                    <div class="absolute -bottom-12 left-8">
                        <div id="profile-avatar"
                            class="w-24 h-24 rounded-2xl bg-white border-4 border-white shadow-lg flex items-center justify-center text-3xl font-bold text-oblink-gray">
                            <!-- Initials or Avatar -->
                        </div>
                    </div>
                </div>

                <!-- Profile Info -->
                <div class="pt-16 px-8 pb-8">
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
                        <div>
                            <h1 id="profile-name" class="text-2xl font-bold text-gray-900 mb-1">Chargement...</h1>
                            <p id="profile-location" class="text-gray-500 flex items-center gap-2">
                                <i class="fas fa-map-marker-alt text-oblink-orange"></i>
                                <span>Ville</span>
                            </p>
                        </div>
                        <div class="flex gap-3">
                            <span id="profile-status"
                                class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-bold">
                                <i class="fas fa-circle text-xs mr-1"></i> Disponible
                            </span>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-4 mb-8 p-4 bg-gray-50 rounded-2xl">
                        <div class="text-center">
                            <div id="profile-rate" class="text-2xl font-bold text-oblink-orange">--</div>
                            <div class="text-xs text-gray-500">€ / heure</div>
                        </div>
                        <div class="text-center border-x border-gray-200">
                            <div id="profile-experience" class="text-2xl font-bold text-oblink-blue">--</div>
                            <div class="text-xs text-gray-500">Expérience</div>
                        </div>
                        <div class="text-center">
                            <div id="profile-mobility" class="text-2xl font-bold text-oblink-violet">--</div>
                            <div class="text-xs text-gray-500">km mobilité</div>
                        </div>
                    </div>

                    <!-- Bio -->
                    <div class="mb-8">
                        <h2 class="text-lg font-bold text-gray-900 mb-3">À propos</h2>
                        <p id="profile-bio" class="text-gray-600 leading-relaxed">
                            Aucune bio renseignée.
                        </p>
                    </div>

                    <!-- Skills -->
                    <div class="mb-8">
                        <h2 class="text-lg font-bold text-gray-900 mb-3">Compétences</h2>
                        <div id="profile-skills" class="flex flex-wrap gap-2">
                            <!-- Skills tags -->
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-100">
                        <button id="contact-btn"
                            class="flex-1 px-6 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition shadow-lg shadow-blue-200 flex items-center justify-center gap-2">
                            <i class="fas fa-envelope"></i> Contacter
                        </button>
                        <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                            class="px-6 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition flex items-center justify-center gap-2">
                            <i class="fas fa-arrow-left"></i> Retour à la carte
                        </a>
                    </div>
                </div>
            </div>

        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden text-center py-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">😕
            </div>
            <h2 class="text-xl font-bold text-gray-900 mb-2">Profil introuvable</h2>
            <p class="text-gray-500 mb-6">Cet opticien n'existe pas ou son profil est privé.</p>
            <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                class="px-6 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition inline-block">
                Retour à la recherche
            </a>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loadingState = document.getElementById('loading-state');
        const profileContent = document.getElementById('profile-content');
        const errorState = document.getElementById('error-state');

        // Get ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const profileId = urlParams.get('id');

        if (!profileId) {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            return;
        }

        try {
            // Fetch Profile from Supabase
            const { data: profile, error } = await window.oblinkSupabase
                .from('profiles')
                .select('*')
                .eq('id', profileId)
                .eq('user_type', 'opticien')
                .single();

            if (error || !profile) throw new Error('Profile not found');

            // Populate UI
            document.getElementById('profile-name').textContent = `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || 'Opticien';
            document.getElementById('profile-location').querySelector('span').textContent = profile.city || 'France';
            document.getElementById('profile-bio').textContent = profile.bio || profile.bio_short || 'Aucune bio renseignée.';
            document.getElementById('profile-rate').textContent = profile.hourly_rate || '--';
            document.getElementById('profile-experience').textContent = formatExperience(profile.experience);
            document.getElementById('profile-mobility').textContent = profile.mobility_km || '30';

            // Avatar
            const avatar = document.getElementById('profile-avatar');
            if (profile.avatar_url) {
                avatar.innerHTML = `<img src="${profile.avatar_url}" class="w-full h-full object-cover rounded-2xl" alt="Avatar">`;
            } else {
                const initials = (profile.first_name?.charAt(0) || '') + (profile.last_name?.charAt(0) || '');
                avatar.textContent = initials || 'O';
            }

            // Status
            const statusEl = document.getElementById('profile-status');
            if (profile.available) {
                statusEl.className = 'px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-bold';
                statusEl.innerHTML = '<i class="fas fa-circle text-xs mr-1"></i> Disponible';
            } else {
                statusEl.className = 'px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm font-bold';
                statusEl.innerHTML = '<i class="fas fa-circle text-xs mr-1"></i> Occupé';
            }

            // Skills
            const skillsContainer = document.getElementById('profile-skills');
            const skills = profile.skills || [];
            if (skills.length > 0) {
                skillsContainer.innerHTML = skills.map(skill =>
                    `<span class="px-3 py-1.5 bg-oblink-blue/10 text-oblink-blue rounded-full text-sm font-medium">${formatSkill(skill)}</span>`
                ).join('');
            } else {
                skillsContainer.innerHTML = '<span class="text-gray-400 text-sm">Aucune compétence renseignée</span>';
            }

            // Contact Button
            document.getElementById('contact-btn').addEventListener('click', async () => {
                // Check if logged in
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                if (!session) {
                    alert('Connectez-vous pour contacter cet opticien.');
                    window.location.href = '<?php echo home_url("/login"); ?>';
                    return;
                }
                // Open messaging modal if exists, or redirect to messaging
                if (typeof openContactModal === 'function') {
                    openContactModal(profileId, `${profile.first_name} ${profile.last_name}`);
                } else {
                    alert('Fonctionnalité de messagerie en cours de développement.');
                }
            });

            // Show Content
            loadingState.classList.add('hidden');
            profileContent.classList.remove('hidden');

        } catch (err) {
            console.error('Error loading profile:', err);
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        // Helpers
        function formatExperience(exp) {
            const map = {
                'junior': '0-2 ans',
                'confirme': '3-5 ans',
                'senior': '5-10 ans',
                'expert': '10+ ans'
            };
            return map[exp] || exp || '--';
        }

        function formatSkill(skill) {
            const map = {
                'contactologie': 'Contactologie',
                'basse_vision': 'Basse Vision',
                'pediatrie': 'Pédiatrie',
                'optometrie': 'Optométrie',
                'vente': 'Vente',
                'atelier': 'Atelier',
                'luxe': 'Luxe',
                'sport': 'Optique Sport',
                'management': 'Management'
            };
            return map[skill] || skill;
        }
    });
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-facture.php ---
<?php
/*
Template Name: Facture
*/
include 'header-inc.php';
?>

<div class="max-w-5xl mx-auto px-4 pt-32 pb-32">
    <!-- Back Link (Simulating the specific nav's intent) -->
    <div class="mb-6">
        <a href="<?php echo home_url('/dashboard'); ?>"
            class="text-oblink-blue font-semibold hover:underline inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Retour au tableau de bord
        </a>
    </div>

    <div class="glass-card bg-white rounded-2xl shadow-xl p-8 md:p-12">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-oblink-gray mb-3" style="font-family: 'Montserrat', sans-serif;">
                <i class="fas fa-file-invoice text-oblink-orange mr-3"></i>
                Créer une <span class="text-oblink-orange">Facture</span>
            </h1>
            <p class="text-oblink-gray/70">Facture électronique conforme aux normes françaises</p>
            <div
                class="inline-flex items-center px-4 py-2 bg-green-50 border-2 border-green-500 text-green-700 rounded-lg mt-4">
                <i class="fas fa-check-circle mr-2"></i>
                <span class="text-sm font-semibold">Conforme à la facturation électronique obligatoire</span>
            </div>
        </div>

        <form id="invoice-form" data-validate class="space-y-8">
            <!-- Invoice Info -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-info-circle text-oblink-orange mr-3"></i>
                    Informations générales
                </h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Numéro de facture <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="invoiceNumber" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="FACT-2025-001" value="FACT-2025-001">
                        <p class="text-xs text-oblink-gray/60 mt-1">Numérotation chronologique obligatoire</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Date d'émission <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="issueDate" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            value="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Date d'échéance <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="dueDate" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition">
                        <p class="text-xs text-oblink-gray/60 mt-1">Selon conditions de paiement</p>
                    </div>
                </div>
            </div>

            <!-- Emetteur (From) -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-user text-oblink-blue mr-3"></i>
                    Émetteur (Vous)
                </h2>
                <div class="bg-oblink-blue/5 p-6 rounded-xl space-y-4">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Nom complet <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fromName" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="Sarah Dubois" value="Sarah Dubois">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                SIRET <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fromSIRET" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="123 456 789 00012" value="123 456 789 00012">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Adresse complète <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="fromAddress" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="123 rue de la République, 75001 Paris"
                            value="123 rue de la République, 75001 Paris">
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Email
                            </label>
                            <input type="email" name="fromEmail"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="sarah.dubois@email.com" value="sarah.dubois@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Téléphone
                            </label>
                            <input type="tel" name="fromPhone"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="06 12 34 56 78" value="06 12 34 56 78">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            N° TVA Intracommunautaire
                        </label>
                        <input type="text" name="fromVAT"
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="FR12 345 678 901 (si applicable)">
                        <div class="flex items-start mt-3 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-2 mt-1"></i>
                            <p class="text-sm text-yellow-800">
                                <strong>Franchise en base de TVA :</strong> Si vous bénéficiez du régime de franchise en
                                base,
                                laissez ce champ vide et la mention "TVA non applicable, art. 293 B du CGI" sera
                                automatiquement ajoutée.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Destinataire (Client) -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-building text-oblink-violet mr-3"></i>
                    Destinataire (Client)
                </h2>
                <div class="bg-oblink-violet/5 p-6 rounded-xl space-y-4">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Nom de l'entreprise <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="toName" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="Optique Martin">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                SIRET <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="toSIRET" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="987 654 321 00012">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Adresse complète <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="toAddress" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="45 avenue de la République, 33000 Bordeaux">
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Email du contact
                            </label>
                            <input type="email" name="toEmail"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="contact@optiquemartin.fr">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                N° TVA Intracommunautaire
                            </label>
                            <input type="text" name="toVAT"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="FR98 765 432 109">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services/Lines -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-list text-oblink-orange mr-3"></i>
                    Prestations facturées
                </h2>
                <div id="services-container" class="space-y-4">
                    <!-- Service Line 1 -->
                    <div class="service-line border-2 border-oblink-beige rounded-xl p-6">
                        <div class="grid md:grid-cols-12 gap-4 items-start">
                            <div class="md:col-span-5">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Description détaillée <span class="text-red-500">*</span>
                                </label>
                                <textarea name="serviceDesc[]" required rows="3"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                    placeholder="Mission de remplacement du 15/01/2025 au 17/01/2025 - Examen de vue, adaptation lentilles de contact, conseils clientèle"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Quantité <span class="text-red-500">*</span>
                                </label>
                                <input type="number" name="serviceQty[]" required min="1" value="3"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition service-qty"
                                    placeholder="1">
                                <p class="text-xs text-oblink-gray/60 mt-1">Jours</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Prix unitaire HT (€) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" name="servicePrice[]" required min="0" step="0.01" value="280"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition service-price"
                                    placeholder="100.00">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Total HT (€)
                                </label>
                                <div
                                    class="px-4 py-3 bg-oblink-beige/50 rounded-lg font-bold text-oblink-orange text-lg service-total">
                                    840,00 €
                                </div>
                            </div>
                            <div class="md:col-span-1 flex items-end">
                                <button type="button"
                                    class="remove-service px-3 py-3 text-red-500 hover:bg-red-50 rounded-lg transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" id="add-service"
                    class="mt-4 px-6 py-3 border-2 border-oblink-blue text-oblink-blue rounded-lg hover:bg-oblink-blue hover:text-white transition font-semibold">
                    <i class="fas fa-plus mr-2"></i>Ajouter une ligne
                </button>
            </div>

            <!-- Totals -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-calculator text-oblink-violet mr-3"></i>
                    Totaux
                </h2>
                <div class="bg-oblink-beige/30 p-6 rounded-xl space-y-4">
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-semibold">Total HT</span>
                        <span class="text-2xl font-bold text-oblink-blue" id="total-ht">840,00 €</span>
                    </div>
                    <div class="flex justify-between items-center text-sm text-oblink-gray/70">
                        <span>TVA (Non assujetti - Franchise en base)</span>
                        <span class="font-semibold">0,00 €</span>
                    </div>
                    <div class="border-t-2 border-oblink-gray pt-4 flex justify-between items-center">
                        <span class="text-2xl font-bold">Total TTC</span>
                        <span class="text-4xl font-bold text-oblink-orange" id="total-ttc">840,00 €</span>
                    </div>
                    <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Mention obligatoire :</strong> "TVA non applicable, article 293 B du CGI"
                            sera automatiquement ajoutée à la facture si vous êtes en franchise en base.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Payment Terms & Legal Info -->
            <div class="pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-euro-sign text-oblink-blue mr-3"></i>
                    Conditions de paiement et mentions légales
                </h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Délai de paiement <span class="text-red-500">*</span>
                        </label>
                        <select name="paymentTerms" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition">
                            <option value="30">Paiement à 30 jours</option>
                            <option value="0">Paiement comptant</option>
                            <option value="15">Paiement à 15 jours</option>
                            <option value="45">Paiement à 45 jours (dérogation légale requise)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Moyens de paiement acceptés <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-2">
                            <label
                                class="flex items-center p-3 border-2 border-oblink-beige rounded-lg hover:border-oblink-orange cursor-pointer transition">
                                <input type="checkbox" name="paymentMethods" value="virement" checked
                                    class="mr-3 w-5 h-5 text-oblink-orange">
                                <span>Virement bancaire</span>
                            </label>
                            <div class="ml-8 grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-oblink-gray mb-1">
                                        IBAN <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="iban" required
                                        class="w-full px-3 py-2 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition text-sm"
                                        placeholder="FR76 1234 5678 9012 3456 7890 123"
                                        value="FR76 1234 5678 9012 3456 7890 123">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-oblink-gray mb-1">
                                        BIC <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="bic" required
                                        class="w-full px-3 py-2 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition text-sm"
                                        placeholder="BNPAFRPPXXX" value="BNPAFRPPXXX">
                                </div>
                            </div>
                            <label
                                class="flex items-center p-3 border-2 border-oblink-beige rounded-lg hover:border-oblink-orange cursor-pointer transition">
                                <input type="checkbox" name="paymentMethods" value="cheque"
                                    class="mr-3 w-5 h-5 text-oblink-orange">
                                <span>Chèque à l'ordre de : <input type="text" name="chequeName"
                                        placeholder="Sarah Dubois"
                                        class="ml-2 px-2 py-1 border-b-2 border-oblink-beige focus:border-oblink-orange focus:outline-none"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Mentions légales obligatoires -->
                    <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                        <h3 class="font-bold text-red-800 mb-4 flex items-center text-lg">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Mentions obligatoires (automatiquement ajoutées)
                        </h3>
                        <div class="space-y-3 text-sm text-red-700">
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Pénalités de retard :</strong> En cas de retard de paiement, des pénalités de
                                retard calculées
                                au taux de <strong>3 fois le taux d'intérêt légal</strong> seront exigibles de plein
                                droit,
                                conformément à l'article L441-10 du Code de commerce.
                            </div>
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Indemnité forfaitaire :</strong> Une indemnité forfaitaire de <strong>40
                                    euros</strong>
                                pour frais de recouvrement sera due de plein droit en cas de retard de paiement
                                (articles D441-5 et L441-10 du Code de commerce).
                            </div>
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Escompte :</strong> Aucun escompte n'est accordé en cas de paiement anticipé
                                (sauf mention contraire ci-dessous).
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-semibold text-red-800 mb-2">
                                Escompte pour paiement anticipé (optionnel)
                            </label>
                            <input type="text" name="discount"
                                class="w-full px-4 py-3 border-2 border-red-200 rounded-lg focus:border-red-400 focus:outline-none transition"
                                placeholder="Ex: 2% pour paiement sous 8 jours">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Notes / Commentaires
                        </label>
                        <textarea name="notes" rows="4"
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="Merci pour votre confiance. N'hésitez pas à me recontacter pour vos prochains besoins."></textarea>
                    </div>
                </div>
            </div>

            <!-- Signature -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-signature text-oblink-blue mr-3"></i>
                    Signature et Validation
                </h2>
                <div class="bg-gray-50 rounded-xl p-6 border-2 border-dashed border-gray-300">
                    <p class="text-sm font-semibold text-gray-500 mb-2">Signature de l'émetteur (Vous)</p>
                    <canvas id="signature-pad"
                        class="bg-white border border-gray-200 rounded-lg shadow-sm w-full h-40 cursor-crosshair"></canvas>
                    <div class="flex justify-between mt-2">
                        <button type="button" id="clear-signature"
                            class="text-xs text-red-500 hover:text-red-700 underline">
                            Effacer la signature
                        </button>
                        <span class="text-xs text-green-600 hidden" id="sig-status"><i
                                class="fas fa-check mr-1"></i>Signé</span>
                    </div>
                    <input type="hidden" name="signatureData" id="signature-data">
                </div>
                <div class="mt-4 flex items-start p-3 bg-blue-50 text-blue-800 rounded-lg text-sm">
                    <i class="fas fa-lock mt-1 mr-2"></i>
                    <p>En signant, vous certifiez l'exactitude des informations. Un certificat numérique sera apposé au
                        PDF final.</p>
                </div>
            </div>

            <!-- Submit -->
            <div class="flex gap-4">
                <a href="<?php echo home_url('/dashboard/invoices'); ?>"
                    class="flex-1 px-6 py-4 border-2 border-oblink-gray text-oblink-gray text-center rounded-lg hover:bg-oblink-gray/5 transition font-semibold">
                    Annuler
                </a>
                <button type="button"
                    onclick="alert('Fonctionnalité simulée: Facture envoyée à votre email (compta@entreprise.com)')"
                    class="flex-1 px-6 py-4 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition font-semibold">
                    <i class="fas fa-envelope-open-text mr-2"></i>Envoyer au comptable
                </button>
                <button type="submit"
                    class="flex-1 px-6 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition font-semibold shadow-lg">
                    <i class="fas fa-paper-plane mr-2"></i>Émettre & Envoyer
                </button>
            </div>
        </form>
    </div>

    <!-- Legal Compliance Info -->
    <div class="mt-8 bg-green-50 border-2 border-green-500 rounded-xl p-6">
        <h3 class="font-bold text-green-800 mb-3 flex items-center text-lg">
            <i class="fas fa-check-circle text-green-600 mr-2"></i>
            Facture électronique conforme à la réglementation française
        </h3>
        <div class="text-sm text-green-700 space-y-3">
            <p><strong>Votre facture inclura automatiquement toutes les mentions légales obligatoires :</strong></p>
            <div class="grid md:grid-cols-2 gap-4">
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li>Numéro de facture unique et chronologique</li>
                    <li>Date d'émission et date d'échéance</li>
                    <li>Identité complète émetteur (SIRET, adresse)</li>
                    <li>Identité complète client (SIRET, adresse)</li>
                    <li>Description détaillée des prestations</li>
                    <li>Prix unitaires HT et quantités</li>
                    <li>Total HT, TVA et Total TTC</li>
                </ul>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li>Mention TVA si franchise en base (Art. 293B CGI)</li>
                    <li>Conditions de règlement</li>
                    <li>Coordonnées bancaires (IBAN/BIC)</li>
                    <li>Pénalités de retard (3x taux légal)</li>
                    <li>Indemnité forfaitaire de 40€</li>
                    <li>Escompte si paiement anticipé</li>
                    <li>Format archivable (PDF/A-3 avec XML)</li>
                </ul>
            </div>
            <div class="mt-4 p-4 bg-white rounded-lg border-l-4 border-green-600">
                <p class="font-semibold text-green-800 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>Facturation électronique obligatoire depuis 2024
                </p>
                <p class="text-green-700">
                    Conformément à la réforme de la facturation électronique, toutes les factures entre professionnels
                    (B2B)
                    doivent être émises et transmises au format électronique via une plateforme de dématérialisation
                    certifiée
                    ou via le portail public de facturation (PPF). OBLINK vous aide à rester conforme.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Signature Logic ---
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Resize canvas
    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        ctx.scale(ratio, ratio);
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas(); // Initial call happens fast, might need delay if element not visible yet

    // Draw
    function draw(e) {
        if (!isDrawing) return;

        // precise coordinates
        const rect = canvas.getBoundingClientRect();
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
        const scaleX = canvas.width / rect.width / (window.devicePixelRatio || 1); // Adjust for logical size

        const x = (clientX - rect.left);
        const y = (clientY - rect.top);

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        [lastX, lastY] = [x, y];

        document.getElementById('sig-status').classList.remove('hidden');
    }

    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        lastX = e.clientX - rect.left;
        lastY = e.clientY - rect.top;
    });
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        lastX = e.touches[0].clientX - rect.left;
        lastY = e.touches[0].clientY - rect.top;
    });
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        draw(e);
    });
    canvas.addEventListener('touchend', () => isDrawing = false);

    // Clear
    document.getElementById('clear-signature').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('sig-status').classList.add('hidden');
    });


    // --- Existing Calculator Logic ---

    // Calculate totals
    function calculateTotals() {
        let total = 0;
        document.querySelectorAll('.service-line').forEach(line => {
            const qty = parseFloat(line.querySelector('.service-qty').value) || 0;
            const price = parseFloat(line.querySelector('.service-price').value) || 0;
            const lineTotal = qty * price;
            line.querySelector('.service-total').textContent = lineTotal.toFixed(2).replace('.', ',') + ' €';
            total += lineTotal;
        });
        document.getElementById('total-ht').textContent = total.toFixed(2).replace('.', ',') + ' €';
        document.getElementById('total-ttc').textContent = total.toFixed(2).replace('.', ',') + ' €';
    }

    // Add service line
    document.getElementById('add-service').addEventListener('click', function () {
        const template = document.querySelector('.service-line').cloneNode(true);
        template.querySelectorAll('input, textarea').forEach(input => input.value = '');
        template.querySelector('.service-qty').value = '1';
        template.querySelector('.service-price').value = '';
        template.querySelector('.service-total').textContent = '0,00 €';
        document.getElementById('services-container').appendChild(template);
        attachEventListeners();
    });

    // Remove service line
    function attachEventListeners() {
        document.querySelectorAll('.remove-service').forEach(btn => {
            btn.onclick = function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    calculateTotals();
                } else {
                    alert('Vous devez avoir au moins une prestation');
                }
            };
        });

        document.querySelectorAll('.service-qty, .service-price').forEach(input => {
            input.addEventListener('input', calculateTotals);
        });
    }

    // URL Params Pre-fill (V51)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('from') === 'devis') {
        if (urlParams.get('client')) document.querySelector('input[name="toName"]').value = urlParams.get('client');
        if (urlParams.get('address')) document.querySelector('input[name="toAddress"]').value = urlParams.get('address');

        // Add a notification toast (simulated)
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-4 rounded-xl shadow-xl z-50 animate-bounce';
        toast.innerHTML = '<i class="fas fa-magic mr-2"></i>Données du devis importées !';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // Form submission
    document.getElementById('invoice-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // Check if signed
        const hasSignature = !document.getElementById('sig-status').classList.contains('hidden');
        if (!hasSignature) {
            alert('Veuillez signer la facture avant de l\'émettre.');
            return;
        }

        const clientName = document.querySelector('input[name="toName"]').value;
        alert(`Facture émise avec succès !\n\n1. Copie envoyée à ${clientName} (Email)\n2. Copie archivée dans le grimoire numérique.`);

        // Redirect to dashboard after success
        setTimeout(() => {
            window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
        }, 1000);
    });

    attachEventListeners();
    calculateTotals();
    // Re-trigger resize after small delay to ensure container is rendered
    setTimeout(resizeCanvas, 100);
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-simulateur.php ---
<?php
/*
Template Name: Page Simulateur v3 - Advanced
*/
include 'header-inc.php';
require_once get_template_directory() . '/inc/simulator-email.php';
?>


<!-- Simulator Hero -->
<div
    class="absolute top-0 right-0 w-1/3 h-full bg-gradient-to-l from-oblink-orange/5 to-transparent skew-x-12 transform pointer-events-none">
</div>
<div class="absolute bottom-0 left-0 w-64 h-64 bg-oblink-violet/5 rounded-full filter blur-3xl pointer-events-none">
</div>

<div class="max-w-6xl mx-auto px-4 relative z-10">

    <!-- Header Section -->
    <div class="text-center mb-12">
        <span
            class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
            Simulateur Opticien
        </span>
        <h1 class="text-4xl md:text-6xl font-black font-display text-oblink-gray mb-6">
            Calculez votre <span
                class="bg-gradient-to-r from-oblink-orange to-oblink-violet bg-clip-text text-transparent">net
                réel</span>
        </h1>
        <p class="text-xl text-oblink-gray/70 max-w-2xl mx-auto font-body">
            Mission freelance ou salaire en contrat : découvrez combien vous toucherez réellement.
        </p>
    </div>

    <!-- Mode Toggle -->
    <div class="flex justify-center mb-8">
        <div class="inline-flex rounded-xl bg-white p-1 shadow-lg border border-gray-100">
            <button id="mode-freelance" class="mode-toggle-btn active px-6 py-3 rounded-lg font-bold transition-all">
                <i class="fas fa-briefcase mr-2"></i>
                Freelance
            </button>
            <button id="mode-contrat" class="mode-toggle-btn px-6 py-3 rounded-lg font-bold transition-all">
                <i class="fas fa-file-contract mr-2"></i>
                Contrat/Salarié
            </button>
        </div>
    </div>

    <!-- Simulator Container -->
    <div class="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-white/50 backdrop-blur-xl md:flex min-h-[600px]"
        id="simulator-app">

        <!-- Left Panel: Inputs -->
        <div class="w-full md:w-1/2 p-8 md:p-12 border-r border-gray-100">
            <h2 class="text-2xl font-bold font-display text-oblink-gray mb-8 flex items-center gap-3">
                <span
                    class="flex items-center justify-center w-10 h-10 rounded-full bg-oblink-orange text-white text-lg">1</span>
                <span id="panel-title">Paramètres Mission</span>
            </h2>

            <!-- Freelance Inputs -->
            <div id="freelance-inputs">
                <div class="mb-10 relative">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Taux Journalier (TJM)
                    </label>
                    <div class="flex items-center gap-4 mb-2">
                        <span class="text-3xl font-black text-oblink-orange" id="tjm-display">350 €</span>
                    </div>
                    <input type="range" id="tjm-slider" min="200" max="800" step="10" value="350"
                        class="w-full h-4 bg-gray-200 rounded-full appearance-none cursor-pointer range-slider accent-oblink-orange">
                    <div class="flex justify-between text-xs text-gray-400 mt-2 font-body">
                        <span>200€</span>
                        <span>800€</span>
                    </div>
                </div>

                <div class="mb-10 relative">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Durée de la mission (Jours)
                    </label>
                    <div class="flex items-center gap-4 mb-2">
                        <span class="text-3xl font-black text-oblink-blue" id="days-display">5</span>
                        <span class="text-sm text-gray-500 font-medium">jours</span>
                    </div>
                    <input type="range" id="days-slider" min="1" max="30" step="1" value="5"
                        class="w-full h-4 bg-gray-200 rounded-full appearance-none cursor-pointer range-slider-blue accent-oblink-blue">
                    <div class="flex justify-between text-xs text-gray-400 mt-2 font-body">
                        <span>1 jour</span>
                        <span>1 mois (30j)</span>
                    </div>
                </div>

                <div class="mb-8">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Statut Juridique
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="status-btn active group" data-status="micro">
                            <span class="block font-bold">Micro-Ent.</span>
                            <span class="text-xs opacity-70">Remplaçant ponctuel</span>
                        </button>
                        <button class="status-btn group" data-status="eurl">
                            <span class="block font-bold">Société (EURL)</span>
                            <span class="text-xs opacity-70">Remplaçant régulier</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Contrat Inputs -->
            <div id="contrat-inputs" class="hidden">
                <div class="mb-10 relative">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Salaire Brut Mensuel
                    </label>
                    <div class="flex items-center gap-4 mb-2">
                        <span class="text-3xl font-black text-oblink-orange" id="salaire-display">2500 €</span>
                    </div>
                    <input type="range" id="salaire-slider" min="1500" max="5000" step="50" value="2500"
                        class="w-full h-4 bg-gray-200 rounded-full appearance-none cursor-pointer range-slider accent-oblink-orange">
                    <div class="flex justify-between text-xs text-gray-400 mt-2 font-body">
                        <span>1500€</span>
                        <span>5000€</span>
                    </div>
                </div>

                <!-- Cadre / Non-Cadre -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Statut
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="cadre-btn group" data-cadre="false">
                            <span class="block font-bold">Non-Cadre</span>
                            <span class="text-xs opacity-70">~22% charges</span>
                        </button>
                        <button class="cadre-btn active group" data-cadre="true">
                            <span class="block font-bold">Cadre</span>
                            <span class="text-xs opacity-70">~25% charges</span>
                        </button>
                    </div>
                </div>

                <!-- Heures/semaine -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Temps de travail
                    </label>
                    <div class="grid grid-cols-3 gap-2">
                        <button class="heures-btn active group" data-heures="35">
                            <span class="block font-bold">35h</span>
                            <span class="text-xs opacity-70">Temps plein</span>
                        </button>
                        <button class="heures-btn group" data-heures="39">
                            <span class="block font-bold">39h</span>
                            <span class="text-xs opacity-70">Heures sup</span>
                        </button>
                        <button class="heures-btn group" data-heures="forfait">
                            <span class="block font-bold">Forfait</span>
                            <span class="text-xs opacity-70">Cadre</span>
                        </button>
                    </div>
                </div>

                <!-- Vue Entreprise Toggle -->
                <div class="mb-8">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="vue-entreprise"
                            class="w-5 h-5 text-oblink-orange rounded focus:ring-oblink-orange">
                        <span class="text-sm font-bold text-oblink-gray">
                            👔 Vue Entreprise (Coût employeur)
                        </span>
                    </label>
                </div>

                <!-- Type Contrat -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-oblink-gray mb-4 uppercase tracking-wide">
                        Type de Contrat
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="contrat-btn active group" data-type="cdd">
                            <span class="block font-bold">CDD</span>
                            <span class="text-xs opacity-70">Durée déterminée</span>
                        </button>
                        <button class="contrat-btn group" data-type="cdi">
                            <span class="block font-bold">CDI</span>
                            <span class="text-xs opacity-70">Indéterminée</span>
                        </button>
                    </div>
                </div>
            </div>

            <button id="calculate-btn"
                class="w-full py-4 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white font-black text-lg rounded-xl shadow-lg hover:shadow-2xl hover:scale-[1.02] transition-all transform flex items-center justify-center gap-2">
                <span id="btn-text">Calculer mon Net</span>
                <i class="fas fa-calculator"></i>
            </button>
        </div>

        <!-- Right Panel: Results -->
        <div
            class="w-full md:w-1/2 bg-oblink-gray text-white p-8 md:p-12 flex flex-col justify-center relative overflow-hidden">
            <div class="absolute top-10 right-10 w-32 h-32 bg-oblink-orange rounded-full filter blur-[80px] opacity-20">
            </div>
            <div
                class="absolute bottom-10 left-10 w-40 h-40 bg-oblink-blue rounded-full filter blur-[100px] opacity-20">
            </div>

            <h2 class="text-2xl font-bold font-display mb-8 text-center md:text-left text-white/90">
                <span
                    class="w-10 h-10 rounded-full bg-white/10 inline-flex items-center justify-center mr-2 text-sm backdrop-blur">2</span>
                Vos Résultats
            </h2>

            <!-- Email Gate -->
            <div id="email-gate" class="hidden mb-6">
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
                    <p class="text-center text-white font-bold mb-4">
                        <i class="fas fa-lock mr-2"></i>
                        Entrez votre email pour voir vos résultats
                    </p>
                    <input type="email" id="user-email" placeholder="votre.email@exemple.com"
                        class="w-full px-4 py-3 rounded-lg bg-white/90 text-oblink-gray font-medium placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-oblink-orange mb-3">
                    <button id="reveal-btn"
                        class="w-full py-3 bg-oblink-orange text-white font-bold rounded-lg hover:bg-oblink-orange/90 transition">
                        Dévoiler les Résultats 🔓
                    </button>
                    <p class="text-xs text-white/50 text-center mt-2">
                        Vous recevrez aussi vos résultats par email
                    </p>
                </div>
            </div>

            <!-- Results Container -->
            <div id="results-container">
                <div class="glass-dark rounded-3xl p-8 mb-8 text-center border border-white/10 shadow-2xl transform transition-all duration-500"
                    id="result-card">
                    <p class="text-oblink-orange font-bold uppercase tracking-widest text-sm mb-2">Net dans votre poche
                    </p>
                    <div class="text-6xl md:text-7xl font-black font-display mb-2 tracking-tight text-white"
                        id="net-monthly">-- €</div>
                    <p class="text-white/50 text-sm" id="result-subtitle">Calculez pour voir</p>
                </div>

                <!-- Details Grid -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                        <p class="text-xs uppercase text-gray-400 font-bold mb-1" id="label-1">Total Facturé</p>
                        <p class="text-xl font-bold font-display" id="gross-value">-- €</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                        <p class="text-xs uppercase text-gray-400 font-bold mb-1">Charges</p>
                        <p class="text-xl font-bold font-display text-red-400" id="total-charges">-- €</p>
                    </div>
                </div>

                <!-- Taux Horaires (Hidden for Freelance, shown for Contrat) -->
                <div id="taux-horaires" class="hidden mb-6">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                        <p class="text-xs uppercase text-gray-400 font-bold mb-2">Taux Horaires</p>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm">Brut/heure</span>
                            <span class="font-bold" id="taux-brut-h">-- €</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Net/heure</span>
                            <span class="font-bold text-oblink-orange" id="taux-net-h">-- €</span>
                        </div>
                    </div>
                </div>

                <!-- Coût Employeur (Hidden unless vue entreprise) -->
                <div id="cout-employeur" class="hidden mb-6">
                    <div class="bg-white/10 p-4 rounded-xl border border-white/20">
                        <p class="text-xs uppercase text-gray-400 font-bold mb-2">👔 Coût Total Employeur</p>
                        <div class="text-3xl font-black text-white mb-1" id="cout-total">-- €</div>
                        <p class="text-xs text-white/60">Charges patronales incluses (+42%)</p>
                    </div>
                </div>

                <!-- CTA Results -->
                <div class="mt-auto">
                    <p class="text-center text-white/60 text-sm mb-4">Intéressé par ce revenu ?</p>
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="w-full py-3 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange-claire hover:text-oblink-orange transition-colors flex items-center justify-center gap-2">
                        <i class="fas fa-user-plus"></i>
                        M'inscrire comme Opticien
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
</section>

<style>
    .range-slider {
        -webkit-appearance: none;
        height: 12px;
        background: #EAEBC4;
        border-radius: 10px;
        outline: none;
    }

    .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #FF6600;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(255, 102, 0, 0.4);
        border: 4px solid white;
        transition: transform 0.1s;
    }

    .range-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }

    .range-slider-blue::-webkit-slider-thumb {
        background: #0099FF;
        box-shadow: 0 4px 10px rgba(0, 153, 255, 0.4);
    }

    .status-btn,
    .contrat-btn,
    .cadre-btn,
    .heures-btn,
    .mode-toggle-btn {
        padding: 1rem;
        border-radius: 1rem;
        border: 2px solid #f3f4f6;
        background: white;
        text-align: left;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        color: #303030;
    }

    .heures-btn {
        padding: 0.75rem 0.5rem;
        text-align: center;
    }

    .mode-toggle-btn {
        border: none;
        color: #9CA3AF;
    }

    .mode-toggle-btn.active {
        background: #FF6600;
        color: white;
        box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
    }

    .status-btn:hover,
    .contrat-btn:hover,
    .cadre-btn:hover,
    .heures-btn:hover {
        border-color: #EAEBC4;
        background: #FFF7ed;
        transform: translateY(-2px);
    }

    .status-btn.active,
    .contrat-btn.active,
    .cadre-btn.active,
    .heures-btn.active {
        border-color: #FF6600;
        background: #FFF7ed;
        box-shadow: 0 4px 15px rgba(255, 102, 0, 0.15);
        color: #FF6600;
    }

    .blur-results {
        filter: blur(8px);
        pointer-events: none;
        user-select: none;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Elements
        const modeFreelance = document.getElementById('mode-freelance');
        const modeContrat = document.getElementById('mode-contrat');
        const freelanceInputs = document.getElementById('freelance-inputs');
        const contratInputs = document.getElementById('contrat-inputs');
        const panelTitle = document.getElementById('panel-title');
        const calculateBtn = document.getElementById('calculate-btn');
        const btnText = document.getElementById('btn-text');
        const emailGate = document.getElementById('email-gate');
        const resultsContainer = document.getElementById('results-container');
        const revealBtn = document.getElementById('reveal-btn');
        const userEmailInput = document.getElementById('user-email');

        // Freelance
        const tjmSlider = document.getElementById('tjm-slider');
        const tjmDisplay = document.getElementById('tjm-display');
        const daysSlider = document.getElementById('days-slider');
        const daysDisplay = document.getElementById('days-display');
        const statusBtns = document.querySelectorAll('.status-btn');

        // Contrat
        const salaireSlider = document.getElementById('salaire-slider');
        const salaireDisplay = document.getElementById('salaire-display');
        const contratBtns = document.querySelectorAll('.contrat-btn');
        const cadreBtns = document.querySelectorAll('.cadre-btn');
        const heuresBtns = document.querySelectorAll('.heures-btn');
        const vueEntrepriseCheckbox = document.getElementById('vue-entreprise');

        // Results
        const netMonthly = document.getElementById('net-monthly');
        const grossValue = document.getElementById('gross-value');
        const totalCharges = document.getElementById('total-charges');
        const resultSubtitle = document.getElementById('result-subtitle');
        const label1 = document.getElementById('label-1');
        const tauxHoraires = document.getElementById('taux-horaires');
        const tauxBrutH = document.getElementById('taux-brut-h');
        const tauxNetH = document.getElementById('taux-net-h');
        const coutEmployeur = document.getElementById('cout-employeur');
        const coutTotal = document.getElementById('cout-total');

        let currentMode = 'freelance';
        let currentStatus = 'micro';
        let currentContrat = 'cdd';
        let currentCadre = true;
        let currentHeures = 35;
        let vueEntreprise = false;
        let calculatedResults = null;
        let hasCalculated = false;
        let emailSubmitted = false;

        // Mode Toggle
        modeFreelance.addEventListener('click', () => switchMode('freelance'));
        modeContrat.addEventListener('click', () => switchMode('contrat'));

        function switchMode(mode) {
            currentMode = mode;

            if (mode === 'freelance') {
                modeFreelance.classList.add('active');
                modeContrat.classList.remove('active');
                freelanceInputs.classList.remove('hidden');
                contratInputs.classList.add('hidden');
                panelTitle.textContent = 'Paramètres Mission';
                label1.textContent = 'Total Facturé (HT)';
                tauxHoraires.classList.add('hidden');
                coutEmployeur.classList.add('hidden');
            } else {
                modeContrat.classList.add('active');
                modeFreelance.classList.remove('active');
                contratInputs.classList.remove('hidden');
                freelanceInputs.classList.add('hidden');
                panelTitle.textContent = 'Paramètres Salaire';
                label1.textContent = 'Salaire Brut';
                tauxHoraires.classList.remove('hidden');
            }

            resetResults();
            hasCalculated = false;
            emailSubmitted = false;
        }

        // Freelance listeners
        tjmSlider.addEventListener('input', function () {
            tjmDisplay.textContent = this.value + ' €';
            if (hasCalculated && !emailSubmitted) calculate(true);
        });

        daysSlider.addEventListener('input', function () {
            daysDisplay.textContent = this.value;
            if (hasCalculated && !emailSubmitted) calculate(true);
        });

        statusBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                statusBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentStatus = this.getAttribute('data-status');
                if (hasCalculated && !emailSubmitted) calculate(true);
            });
        });

        // Contrat listeners
        salaireSlider.addEventListener('input', function () {
            salaireDisplay.textContent = this.value + ' €';
            if (hasCalculated && !emailSubmitted) calculate(true);
        });

        contratBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                contratBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentContrat = this.getAttribute('data-type');
                if (hasCalculated && !emailSubmitted) calculate(true);
            });
        });

        cadreBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                cadreBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentCadre = this.getAttribute('data-cadre') === 'true';
                if (hasCalculated && !emailSubmitted) calculate(true);
            });
        });

        heuresBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                heuresBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const heures = this.getAttribute('data-heures');
                currentHeures = heures === 'forfait' ? 'forfait' : parseInt(heures);
                if (hasCalculated && !emailSubmitted) calculate(true);
            });
        });

        vueEntrepriseCheckbox.addEventListener('change', function () {
            vueEntreprise = this.checked;
            if (vueEntreprise) {
                coutEmployeur.classList.remove('hidden');
            } else {
                coutEmployeur.classList.add('hidden');
            }
            if (hasCalculated && !emailSubmitted) calculate(true);
        });

        // Calculate Button
        calculateBtn.addEventListener('click', () => {
            if (!hasCalculated) {
                calculate(false);
                hasCalculated = true;
                showEmailGate();
            } else if (!emailSubmitted) {
                showEmailGate();
            }
        });

        // Reveal Button
        revealBtn.addEventListener('click', async () => {
            const email = userEmailInput.value.trim();
            if (!email || !validateEmail(email)) {
                alert('Veuillez entrer une adresse email valide');
                return;
            }

            // Save lead & send email
            await saveLead(email);

            // Reveal results
            emailSubmitted = true;
            emailGate.classList.add('hidden');
            resultsContainer.classList.remove('blur-results');
            btnText.textContent = 'Recalculer';
        });

        function showEmailGate() {
            emailGate.classList.remove('hidden');
            resultsContainer.classList.add('blur-results');
            btnText.textContent = 'Voir les Résultats 🔓';
        }

        function calculate(silent = false) {
            let results = {};

            if (currentMode === 'freelance') {
                results = calculateFreelance();
            } else {
                results = calculateContrat();
            }

            calculatedResults = results;

            if (!silent) {
                updateDisplay(results);
            } else {
                netMonthly.textContent = Math.floor(results.net).toLocaleString('fr-FR') + ' €';
                grossValue.textContent = Math.floor(results.gross).toLocaleString('fr-FR') + ' €';
                totalCharges.textContent = '-' + Math.floor(results.charges).toLocaleString('fr-FR') + ' €';

                if (currentMode === 'contrat') {
                    tauxBrutH.textContent = results.tauxHoraireBrut.toFixed(2) + ' €';
                    tauxNetH.textContent = results.tauxHoraireNet.toFixed(2) + ' €';
                    if (vueEntreprise && results.coutEmployeur) {
                        coutTotal.textContent = Math.floor(results.coutEmployeur).toLocaleString('fr-FR') + ' €';
                    }
                }
            }
        }

        function calculateFreelance() {
            const tjm = parseInt(tjmSlider.value);
            const days = parseInt(daysSlider.value);
            const ca = tjm * days;

            let rateSocial = currentStatus === 'micro' ? 0.22 : 0.35;
            let rateTax = currentStatus === 'micro' ? 0.02 : 0.05;

            const totalSocial = ca * rateSocial;
            const totalTax = ca * rateTax;
            const totalCost = totalSocial + totalTax;
            const netPocket = ca - totalCost;

            return {
                gross: ca,
                charges: totalCost,
                net: netPocket,
                subtitle: `Pour ${days} jours de travail`
            };
        }

        function calculateContrat() {
            const salaireBrut = parseInt(salaireSlider.value);

            // Charges salariales selon cadre/non-cadre
            const tauxChargesSalariales = currentCadre ? 0.25 : 0.22;
            const chargesSalariales = salaireBrut * tauxChargesSalariales;
            const salaireNet = salaireBrut - chargesSalariales;

            // Impôt simplifié
            let tauxImpot = 0.10;
            if (salaireNet > 2000) tauxImpot = 0.12;
            if (salaireNet > 3000) tauxImpot = 0.15;

            const impot = salaireNet * tauxImpot;
            const netApresImpot = salaireNet - impot;

            // Taux horaires
            let heuresMois = currentHeures === 'forfait' ? 151.67 : (currentHeures * 4.33);
            const tauxHoraireBrut = salaireBrut / heuresMois;
            const tauxHoraireNet = netApresImpot / heuresMois;

            // Coût employeur (charges patronales ~42%)
            const chargesPatronales = salaireBrut * 0.42;
            const coutEmployeur = salaireBrut + chargesPatronales;

            return {
                gross: salaireBrut,
                charges: chargesSalariales + impot,
                net: netApresImpot,
                subtitle: 'Net après impôt (mensuel)',
                tauxHoraireBrut,
                tauxHoraireNet,
                coutEmployeur: vueEntreprise ? coutEmployeur : null
            };
        }

        function updateDisplay(results) {
            animateValue(netMonthly, results.net, ' €');
            grossValue.textContent = Math.floor(results.gross).toLocaleString('fr-FR') + ' €';
            totalCharges.textContent = '-' + Math.floor(results.charges).toLocaleString('fr-FR') + ' €';
            resultSubtitle.textContent = results.subtitle;

            if (currentMode === 'contrat') {
                tauxBrutH.textContent = results.tauxHoraireBrut.toFixed(2) + ' €';
                tauxNetH.textContent = results.tauxHoraireNet.toFixed(2) + ' €';

                if (vueEntreprise && results.coutEmployeur) {
                    coutTotal.textContent = Math.floor(results.coutEmployeur).toLocaleString('fr-FR') + ' €';
                }
            }
        }

        function animateValue(obj, end, suffix) {
            let startTimestamp = null;
            const duration = 500;
            const start = parseFloat(obj.textContent.replace(/[^\d.-]/g, '')) || 0;

            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString('fr-FR') + suffix;
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        function resetResults() {
            netMonthly.textContent = '-- €';
            grossValue.textContent = '-- €';
            totalCharges.textContent = '-- €';
            resultSubtitle.textContent = 'Calculez pour voir';
            emailGate.classList.add('hidden');
            resultsContainer.classList.remove('blur-results');
            btnText.textContent = 'Calculer mon Net';
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        async function saveLead(email) {
            const leadData = {
                email: email,
                type: 'simulateur',
                mode: currentMode,
                data: currentMode === 'freelance'
                    ? { tjm: tjmSlider.value, days: daysSlider.value, status: currentStatus }
                    : { salaire: salaireSlider.value, contrat: currentContrat, cadre: currentCadre, heures: currentHeures },
                resultat: calculatedResults.net,
                created_at: new Date().toISOString()
            };

            // Send to WordPress endpoint to save & email
            try {
                const response = await fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'save_simulator_lead',
                        email: email,
                        mode: currentMode,
                        data: JSON.stringify(leadData.data),
                        results: JSON.stringify(calculatedResults)
                    })
                });

                const result = await response.json();
                if (result.success) {
                    console.log('Lead saved and email sent!');
                }
            } catch (error) {
                console.error('Error saving lead:', error);
            }
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/footer-content.php ---
<!-- GLOBAL HARDCODED FOOTER -->
<footer id="main-footer" class="bg-gray-900 text-white pt-20 pb-10 relative z-10"
    style="background-color: #1F2937 !important; color: #FFFFFF !important; border-top: 4px solid #FF6600; display: block !important;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
            <!-- Brand -->
            <div class="space-y-6">
                <a href="<?php echo home_url('/'); ?>" class="inline-block text-2xl font-black tracking-tight"
                    style="font-family: 'Overpass', sans-serif; text-decoration: none;">
                    <span style="color:#FFF">OB</span><span style="color:#FF6600">LINK</span><span
                        style="color:#0099FF">.</span>
                </a>
                <p class="text-sm leading-relaxed" style="color: #9CA3AF;">La plateforme des Opticiens Freelances.</p>
            </div>
            <!-- Links Candidates -->
            <div>
                <h3 class="text-lg font-bold mb-6" style="color:#FFF;">Pour les Opticiens</h3>
                <ul class="space-y-3 text-sm" style="color: #9CA3AF;">
                    <li><a href="<?php echo home_url('/inscription-opticien'); ?>" style="color:inherit">Inscription
                            Freelance</a></li>
                    <li><a href="<?php echo home_url('/simulateur'); ?>" style="color:inherit">Simulateur Revenus</a>
                    </li>
                    <li><a href="<?php echo home_url('/formation-erp'); ?>" style="color:inherit">Formation
                            Logiciels</a></li>
                    <li><a href="<?php echo home_url('/emploi-opticien'); ?>" style="color:inherit">Offres de
                            mission</a></li>
                </ul>
            </div>
            <!-- Links Companies -->
            <div>
                <h3 class="text-lg font-bold mb-6" style="color:#FFF;">Pour les Magasins</h3>
                <ul class="space-y-3 text-sm" style="color: #9CA3AF;">
                    <li><a href="<?php echo home_url('/inscription-entreprise'); ?>" style="color:inherit">Recruter un
                            Freelance</a></li>
                    <li><a href="<?php echo home_url('/abonnements'); ?>" style="color:inherit">Nos Tarifs</a></li>
                    <li><a href="<?php echo home_url('/recherche-opticiens'); ?>" style="color:inherit">CV-thèque</a>
                    </li>
                    <li><a href="<?php echo home_url('/generateur-de-contrat'); ?>" style="color:inherit">Générateur de
                            Contrat</a>
                    </li>
                </ul>
            </div>
            <!-- Legal -->
            <div>
                <h3 class="text-lg font-bold mb-6" style="color:#FFF;">Informations</h3>
                <ul class="space-y-3 text-sm" style="color: #9CA3AF;">
                    <li><a href="<?php echo home_url('/a-propos'); ?>" style="color:inherit">À propos</a></li>
                    <li><a href="mailto:contact@oblink.fr" style="color:inherit">Contact & Support</a></li>
                    <li><a href="<?php echo home_url('/mentions-legales'); ?>" style="color:inherit">Mentions
                            Légales</a></li>
                    <li><a href="<?php echo home_url('/cgu'); ?>" style="color:inherit">CGU / CGV</a></li>
                </ul>
            </div>
        </div>
        <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs"
            style="border-top-color: #374151; color: #6B7280;">
            <div class="flex flex-col md:flex-row items-center gap-4">
                <p>&copy; <?php echo date('Y'); ?> OBLINK. Tous droits réservés.</p>
                <div class="flex items-center gap-4">
                    <!-- Social Links -->
                    <a href="#" class="text-gray-400 hover:text-white transition"><i
                            class="fab fa-linkedin-in text-lg"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i
                            class="fab fa-instagram text-lg"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i
                            class="fab fa-facebook-f text-lg"></i></a>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500"
                    style="background-color: #10B981; display:inline-block"></span>
                <span>Système Opérationnel - <?php echo date('d/m/Y'); ?></span>
            </div>
        </div>
    </div>
    </div>
</footer>

<!-- GLOBAL TOAST NOTIFICATION SYSTEM -->
<div id="toast-container" class="fixed top-24 right-4 z-50 flex flex-col gap-2 pointer-events-none">
    <!-- Toasts will be injected here by JS -->
</div>

<script>
    function showToast(message, type = 'success') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');

        // Colors
        const colors = {
            'success': 'bg-white border-l-4 border-green-500 text-gray-800',
            'error': 'bg-white border-l-4 border-red-500 text-gray-800',
            'info': 'bg-white border-l-4 border-oblink-blue text-gray-800'
        };

        // Icons
        const icons = {
            'success': '<i class="fas fa-check-circle text-green-500 text-xl"></i>',
            'error': '<i class="fas fa-exclamation-circle text-red-500 text-xl"></i>',
            'info': '<i class="fas fa-info-circle text-oblink-blue text-xl"></i>'
        };

        toast.className = `transform translate-x-full transition-transform duration-300 ease-out flex items-center gap-4 px-6 py-4 rounded-lg shadow-xl cursor-pointer pointer-events-auto min-w-[300px] max-w-md ${colors[type]}`;
        toast.innerHTML = `
        ${icons[type]}
        <div>
            <h4 class="font-bold text-sm">${type === 'error' ? 'Erreur' : (type === 'info' ? 'Information' : 'Succès')}</h4>
            <p class="text-xs text-gray-500">${message}</p>
        </div>
    `;

        container.appendChild(toast);

        // Animate In
        requestAnimationFrame(() => {
            toast.classList.remove('translate-x-full');
        });

        // Auto Dismiss
        setTimeout(() => {
            toast.classList.add('translate-x-full');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 4000); // 4 seconds
    }

    // Check URL Params for Feedback (e.g. ?success=job_posted)
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'job_posted') {
            showToast('Votre offre a été publiée et soumise à validation.', 'success');

            // Clean URL
            const url = new URL(window.location);
            url.searchParams.delete('success');
            window.history.replaceState({}, '', url);
        }
    });
</script>

<!-- OBLINK ASSIST WIDGET -->
<div id="oblink-chat-widget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none">

    <!-- Chat Window (Hidden by default) -->
    <div id="chat-window"
        class="bg-white w-[350px] h-[500px] rounded-2xl shadow-2xl border border-gray-200 mb-4 flex flex-col hidden pointer-events-auto overflow-hidden animate-fade-in-up">
        <!-- Header -->
        <div class="bg-gradient-to-r from-gray-900 to-gray-800 p-4 text-white flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-lg">🤖</div>
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-gray-900 rounded-full">
                    </div>
                </div>
                <div>
                    <h4 class="font-bold text-sm">Oblink Assist</h4>
                    <p class="text-xs text-gray-400">Support 24/7 • IA Expert</p>
                </div>
            </div>
            <button onclick="toggleChat()" class="text-gray-400 hover:text-white transition"><i
                    class="fas fa-times"></i></button>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 bg-gray-50">
            <!-- Intro Message -->
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs">🤖</div>
                <div
                    class="bg-white border border-gray-200 p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700">
                    Bonjour ! Je suis l'intelligence artificielle d'OBLINK. Je peux répondre à vos questions sur les
                    certifications, les tarifs ou la réforme 2026.
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-100">
            <form onsubmit="sendMessage(event)" class="relative">
                <input type="text" id="chat-input"
                    class="w-full bg-gray-100 border-0 rounded-full pl-4 pr-12 py-3 text-sm focus:ring-2 focus:ring-oblink-blue focus:bg-white transition"
                    placeholder="Posez votre question..." autocomplete="off">
                <button type="submit" id="chat-submit"
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 w-8 h-8 bg-oblink-blue text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition">
                    <i class="fas fa-paper-plane text-xs"></i>
                </button>
            </form>
            <p class="text-[10px] text-center text-gray-400 mt-2">IA générative. Vérifiez les infos contractuelles.</p>
        </div>
    </div>

    <!-- Toggle Button -->
    <button onclick="toggleChat()"
        class="pointer-events-auto bg-oblink-blue hover:bg-blue-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl transition transform hover:scale-110 relative group">
        <i class="fas fa-comment-alt"></i>
        <!-- Notification Badge -->
        <span
            class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse border-2 border-white"></span>
        <!-- Tooltip -->
        <span
            class="absolute right-16 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap">Besoin
            d'aide ?</span>
    </button>
</div>

<script>
    function toggleChat() {
        const chatWindow = document.getElementById('chat-window');
        chatWindow.classList.toggle('hidden');
        if (!chatWindow.classList.contains('hidden')) {
            document.getElementById('chat-input').focus();
        }
    }

    async function sendMessage(e) {
        e.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;

        // Add User Message
        addMessage(message, 'user');
        input.value = '';
        document.getElementById('chat-submit').disabled = true;

        // Show Typing Indicator
        const typingId = addTypingIndicator();

        try {
            // Call API
            // Note: Since api-chat.php is in the same folder as footer, we assume root relative path works or adjust accordingly.
            // In WordPress theme context, we usually need the full path or ajaxurl.
            // Using a relative path strategy for this static-ish structure:
            const response = await fetch('<?php echo get_template_directory_uri(); ?>/api-chat.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: message })
            });

            const data = await response.json();

            // Remove Typing
            removeMessage(typingId);

            if (data.response) {
                addMessage(data.response.replace(/\n/g, '<br>'), 'bot');
            } else if (data.error) {
                addMessage("Désolé, je rencontre un problème de connexion (" + data.error + ").", 'bot');
            }

        } catch (err) {
            removeMessage(typingId);
            addMessage("Erreur réseau. Veuillez réessayer.", 'bot');
            console.error(err);
        }

        document.getElementById('chat-submit').disabled = false;
    }

    function addMessage(html, sender) {
        const container = document.getElementById('chat-messages');
        const div = document.createElement('div');

        if (sender === 'bot') {
            div.className = "flex items-start gap-3 animate-fade-in-up";
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs flex-shrink-0">🤖</div>
                <div class="bg-white border border-gray-200 p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700 leading-relaxed">
                    ${html}
                </div>
            `;
        } else {
            div.className = "flex items-center justify-end animate-fade-in-up";
            div.innerHTML = `
                <div class="bg-oblink-blue text-white p-3 rounded-2xl rounded-tr-none shadow-sm text-sm">
                    ${html}
                </div>
            `;
        }

        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
        return div.id; // Not really using IDs here
    }

    function addTypingIndicator() {
        const container = document.getElementById('chat-messages');
        const id = 'typing-' + Date.now();
        const div = document.createElement('div');
        div.id = id;
        div.className = "flex items-start gap-3 animate-pulse";
        div.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs">🤖</div>
            <div class="bg-gray-100 p-3 rounded-2xl rounded-tl-none text-gray-400 text-xs flex gap-1">
                <span class="w-1 h-1 bg-gray-400 rounded-full animate-bounce"></span>
                <span class="w-1 h-1 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                <span class="w-1 h-1 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
            </div>
        `;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
        return id;
    }

    function removeMessage(id) {
        const el = document.getElementById(id);
        if (el) el.remove();
    }
</script>--- FILE: theme/front-page.php ---
<?php
/*
Template Name: Accueil (Front Page)
*/
include 'header-inc.php';
?>

<!-- Hero Section with Glassmorphism -->
<section class="pt-24 md:pt-32 pb-12 md:pb-20 relative overflow-hidden" id="hero">
    <!-- Background gradient orbs -->
    <div class="hero-bg"></div>
    <div class="hero-gradient-orb orb-1"></div>
    <div class="hero-gradient-orb orb-2"></div>
    <div class="hero-gradient-orb orb-3"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center">
            <div class="inline-flex items-center px-4 py-2 bg-white rounded-full shadow-sm mb-6 animate-fade-in-down">
                <span class="w-2 h-2 bg-green-500 rounded-full mr-2 pulse-animation"></span>
                <span class="text-sm text-oblink-gray">+500 candidats actifs • +200 magasins partenaires</span>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold mb-6 animate-fade-in"
                style="font-family: 'Montserrat', sans-serif;">
                <span class="text-oblink-orange">L'Optique</span><br />
                <span class="text-oblink-gray">en un clin d'œil</span>
            </h1>
            <p class="text-xl text-oblink-gray/80 mb-12 max-w-3xl mx-auto animate-fade-in-up">
                OBLINK connecte <strong>tous les professionnels de l'optique</strong> (opticiens, vendeurs, monteurs,
                audioprothésistes, VRP...) aux magasins qui recrutent.
                Simple, rapide, fiable.
            </p>

            <!-- CTA Cards with Glassmorphism and Characters -->
            <div class="flex flex-col md:flex-row gap-8 justify-center items-stretch max-w-6xl mx-auto">
                <a href="<?php echo home_url('/opticien-2'); ?>"
                    class="cta-card-glass group w-full md:w-1/2 animate-scale-in" style="animation-delay: 0.2s">
                    <div class="cta-card-content flex-col md:flex-row">
                        <img src="<?php echo get_template_directory_uri(); ?>/images/optician.png" alt="Opticien"
                            class="cta-character animate-float">
                        <div class="cta-info">
                            <span class="cta-badge cta-badge-optician">
                                <i class="fas fa-user-tie mr-2"></i>CANDIDAT
                            </span>
                            <h3 class="text-2xl md:text-3xl font-bold text-oblink-gray mb-3">
                                Je cherche des missions
                            </h3>
                            <p class="text-oblink-gray/70 mb-6">
                                Opticien, vendeur, commercial ? Accédez à des missions qualifiées partout en France.
                            </p>
                            <div class="flex items-center text-oblink-blue font-semibold">
                                Créer mon profil
                                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"></i>
                            </div>
                        </div>
                    </div>
                </a>

                <a href="<?php echo home_url('/pour-entreprise'); ?>"
                    class="cta-card-glass group w-full md:w-1/2 animate-scale-in" style="animation-delay: 0.4s">
                    <div class="cta-card-content flex-col md:flex-row">
                        <img src="<?php echo get_template_directory_uri(); ?>/images/company.png" alt="Entreprise"
                            class="cta-character animate-float" style="animation-delay: 1s">
                        <div class="cta-info">
                            <span class="cta-badge cta-badge-company">
                                <i class="fas fa-store mr-2"></i>ENTREPRISE
                            </span>
                            <h3 class="text-2xl md:text-3xl font-bold text-oblink-gray mb-3">
                                Je recrute des talents
                            </h3>
                            <p class="text-oblink-gray/70 mb-6">
                                Trouvez rapidement des opticiens qualifiés et pré-validés. Économisez jusqu'à 40%.
                            </p>
                            <div class="flex items-center text-oblink-orange font-semibold">
                                Publier une offre
                                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"></i>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section with Glassmorphism -->
<section class="py-10 md:py-20 relative">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="stat-card-glass text-center animate-fade-in-up" style="animation-delay: 0.1s">
                <div class="stat-number"><span class="counter" data-target="8.3">0</span> Md€</div>
                <div class="text-sm text-oblink-gray/70 font-medium">Marché optique français</div>
            </div>
            <div class="stat-card-glass text-center animate-fade-in-up" style="animation-delay: 0.2s">
                <div class="stat-number">+<span class="counter" data-target="13000">0</span></div>
                <div class="text-sm text-oblink-gray/70 font-medium">Magasins d'optique</div>
            </div>
            <div class="stat-card-glass text-center animate-fade-in-up" style="animation-delay: 0.3s">
                <div class="stat-number">+<span class="counter" data-target="44000">0</span></div>
                <div class="text-sm text-oblink-gray/70 font-medium">Professionnels actifs</div>
            </div>
            <div class="stat-card-glass text-center animate-fade-in-up" style="animation-delay: 0.4s">
                <div class="stat-number">+<span class="counter" data-target="15">0</span>%</div>
                <div class="text-sm text-oblink-gray/70 font-medium">Croissance freelancing</div>
            </div>
        </div>
    </div>
</section>

<!-- How it works with 3D Carousel - Optimized -->
<section id="comment-ca-marche" class="py-10 md:py-20 pb-16 md:pb-32 relative">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12 animate-fade-in">
            <h2 class="text-4xl md:text-5xl font-bold text-oblink-gray mb-4"
                style="font-family: 'Montserrat', sans-serif;">
                Comment ça marche ?
            </h2>
            <p class="text-xl text-oblink-gray/70">Simple, rapide, efficace</p>
        </div>

        <!-- 3D Carousel Container -->
        <div class="carousel-3d-container">
            <div class="carousel-3d" id="processCarousel">
                <!-- Slide 1 -->
                <div class="carousel-3d-item active" data-index="0">
                    <div class="process-card-glass">
                        <div class="process-number">
                            <span class="text-oblink-orange">1</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-oblink-gray">Créez votre profil</h3>
                        <p class="text-oblink-gray/80 leading-relaxed">Inscrivez-vous en quelques minutes et
                            complétez
                            votre profil professionnel avec vos diplômes, expériences et disponibilités.</p>
                    </div>
                </div>

                <!-- Slide 2 -->
                <div class="carousel-3d-item next" data-index="1">
                    <div class="process-card-glass">
                        <div class="process-number">
                            <span class="text-oblink-blue">2</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-oblink-gray">Validation 4 étapes</h3>
                        <p class="text-oblink-gray/80 leading-relaxed">Votre profil est validé par notre équipe :
                            diplômes, expérience, test de connaissances et entretien vidéo.</p>
                    </div>
                </div>

                <!-- Slide 3 -->
                <div class="carousel-3d-item prev" data-index="2">
                    <div class="process-card-glass">
                        <div class="process-number">
                            <span class="text-oblink-violet">3</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-oblink-gray">Connectez & Travaillez</h3>
                        <p class="text-oblink-gray/80 leading-relaxed">Recevez des propositions de missions adaptées
                            ou
                            postulez directement. Gérez tout depuis votre dashboard.</p>
                    </div>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="carousel-controls">
                <button class="carousel-btn" id="carousel-prev" aria-label="Précédent">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="carousel-btn" id="carousel-next" aria-label="Suivant">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Indicators -->
            <div class="carousel-indicators">
                <div class="carousel-indicator active" data-slide="0"></div>
                <div class="carousel-indicator" data-slide="1"></div>
                <div class="carousel-indicator" data-slide="2"></div>
            </div>
        </div>
    </div>
    </div>
</section>

<!-- OBLINK ACADEMIE SECTION (New Injection) -->
<section class="py-16 md:py-24 relative overflow-hidden bg-gray-900 border-y border-gray-800">
    <!-- Background Effects -->
    <div
        class="absolute inset-0 bg-[url('<?php echo get_template_directory_uri(); ?>/images/grid-pattern.png')] opacity-5">
    </div>
    <div
        class="absolute top-0 right-0 w-[500px] h-[500px] bg-oblink-orange/10 rounded-full blur-[100px] pointer-events-none">
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center mb-16">
            <span
                class="inline-flex items-center px-4 py-1 rounded-full bg-oblink-orange/20 text-oblink-orange font-bold text-sm mb-6 border border-oblink-orange/20 uppercase tracking-wider">
                <i class="fas fa-bolt mr-2"></i> Nouveau
            </span>
            <h2 class="text-4xl md:text-5xl font-black text-white mb-6 font-display tracking-tight">
                OBLINK ACADÉMIE
            </h2>
            <p class="text-2xl md:text-3xl text-gray-300 font-bold mb-6">
                Ne jouez pas votre BTS OL 2026 aux dés.
            </p>
            <div class="w-24 h-1 bg-gradient-to-r from-oblink-orange to-oblink-violet mx-auto rounded-full mb-8"></div>
            <p class="text-lg text-gray-400 max-w-3xl mx-auto leading-relaxed">
                La réforme 2026 change la donne. Les coefficients U4 et U5 sont plus exigeants que jamais.
                Ne perdez plus de temps avec des annales floues. Accédez à <strong>l'unique Professeur Virtuel</strong>
                capable d'analyser vos erreurs en temps réel.
            </p>
        </div>

        <!-- 3 Pillars Grid -->
        <div class="grid md:grid-cols-3 gap-8 mb-16">
            <!-- Pillar 1 -->
            <div
                class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl hover:bg-gray-800 transition duration-300 group">
                <div
                    class="w-16 h-16 rounded-2xl bg-blue-500/10 text-blue-400 flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition">
                    <i class="fas fa-robot"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-4">Correcteur Intelligent</h3>
                <p class="text-gray-400 leading-relaxed">
                    Prenez en photo votre copie. Notre IA (Gemini 2.0 Flash) détecte vos erreurs de signe, vos tracés de
                    rayons et vous note selon le barème officiel.
                </p>
            </div>

            <!-- Pillar 2 -->
            <div
                class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl hover:bg-gray-800 transition duration-300 group">
                <div
                    class="w-16 h-16 rounded-2xl bg-orange-500/10 text-oblink-orange flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-4">Annales 2005-2025</h3>
                <p class="text-gray-400 leading-relaxed">
                    20 ans d'examens décortiqués. Posez n'importe quelle question sur un sujet passé : l'IA vous
                    explique la logique, pas juste la réponse.
                </p>
            </div>

            <!-- Pillar 3 -->
            <div
                class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl hover:bg-gray-800 transition duration-300 group">
                <div
                    class="w-16 h-16 rounded-2xl bg-purple-500/10 text-purple-400 flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition">
                    <i class="fas fa-microchip"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-4">Simulateur Réforme 2026</h3>
                <p class="text-gray-400 leading-relaxed">
                    Quiz adaptatifs sur les nouvelles épreuves U41, U42 et U5. L'IA identifie vos points faibles et
                    génère vos fiches de révision sur-mesure.
                </p>
            </div>
        </div>

        <!-- Offer Highlight Box -->
        <div class="bg-gradient-to-br from-oblink-orange to-oblink-violet rounded-3xl p-1">
            <div class="bg-gray-900 rounded-[22px] p-8 md:p-12 relative overflow-hidden">
                <div class="grid md:grid-cols-2 gap-12 items-center relative z-10">
                    <div>
                        <h3 class="text-3xl font-bold text-white mb-2">Le Pass Examen OBLINK</h3>
                        <p class="text-gray-400 mb-8">Votre coach personnel, disponible 24h/24.</p>

                        <ul class="space-y-4 mb-8">
                            <li class="flex items-center text-gray-300">
                                <i class="fas fa-check-circle text-green-400 mr-3 text-lg"></i>
                                Accès illimité au Professeur Virtuel
                            </li>
                            <li class="flex items-center text-gray-300">
                                <i class="fas fa-check-circle text-green-400 mr-3 text-lg"></i>
                                Bibliothèque de quiz & Fiches "Spécial VAE"
                            </li>
                            <li class="flex items-center text-gray-300">
                                <i class="fas fa-check-circle text-green-400 mr-3 text-lg"></i>
                                Correction de copies illimitée par IA
                            </li>
                            <li class="flex items-center text-white font-bold">
                                <i class="fas fa-shield-alt text-oblink-orange mr-3 text-lg"></i>
                                Garantie conformité Réforme 2026
                            </li>
                        </ul>
                    </div>
                    <div class="text-center bg-white/5 rounded-2xl p-8 border border-white/10 backdrop-blur-sm">
                        <div class="text-sm text-gray-400 uppercase tracking-widest mb-2">Offre de Lancement</div>
                        <div class="text-5xl font-black text-white mb-2">29 €</div>
                        <div class="text-gray-400 mb-8">Accès total • 6 mois</div>

                        <a href="<?php echo home_url('/pass-examen'); ?>"
                            class="block w-full py-4 bg-oblink-orange hover:bg-orange-600 text-white font-bold rounded-xl shadow-lg hover:shadow-orange-500/25 transition transform hover:scale-105 uppercase tracking-wide">
                            🚀 Activer mon Pass Examen
                        </a>
                        <p class="text-xs text-gray-500 mt-4">Satisfait ou remboursé sous 14 jours</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- SECTION PREVIOUSLY ENDED HERE -->


<!-- For Opticians Section -->
<section id="pour-opticiens" class="py-10 md:py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-2 gap-12 items-center">
            <div class="feature-content">
                <span
                    class="inline-block px-4 py-2 bg-oblink-blue/10 text-oblink-blue rounded-full text-sm font-semibold mb-4">
                    POUR LES OPTICIENS
                </span>
                <h2 class="text-4xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
                    Trouvez des missions en toute <span class="text-oblink-orange">liberté</span>
                </h2>
                <p class="text-lg text-oblink-gray/70 mb-8">
                    Que vous soyez en transition vers l'indépendance ou opticien établi, OBLINK vous donne accès à
                    un
                    vivier de missions qualifiées partout en France.
                </p>

                <div class="space-y-4 mb-8">
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Missions adaptées à votre profil</h4>
                            <p class="text-oblink-gray/70">Filtrez par localisation, spécialité et disponibilités
                            </p>
                        </div>
                    </div>
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Accompagnement complet</h4>
                            <p class="text-oblink-gray/70">Portage salarial, assurance RC, formations continues</p>
                        </div>
                    </div>
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Paiements sécurisés</h4>
                            <p class="text-oblink-gray/70">Facturation simplifiée et paiements garantis</p>
                        </div>
                    </div>
                </div>

                <!-- FIXED LINK: Redirects to Inscription -->
                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                    class="inline-block px-8 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition shadow-lg transform hover:scale-105">
                    Créer mon profil d'opticien <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>

            <div class="relative animate-scale-in" style="animation-delay: 0.3s">
                <div class="feature-image-wrapper">
                    <img src="<?php echo get_template_directory_uri(); ?>/images/optician.png"
                        alt="Opticien professionnel" class="feature-character">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- For Companies Section -->
<section id="pour-entreprises" class="py-10 md:py-20 bg-oblink-beige/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-2 gap-12 items-center">
            <div class="relative order-2 md:order-1 animate-scale-in" style="animation-delay: 0.3s">
                <div class="feature-image-wrapper">
                    <img src="<?php echo get_template_directory_uri(); ?>/images/company.png"
                        alt="Gestionnaire entreprise" class="feature-character" style="animation-delay: 1s">
                </div>
            </div>

            <div class="order-1 md:order-2 feature-content">
                <span
                    class="inline-block px-4 py-2 bg-oblink-orange/10 text-oblink-orange rounded-full text-sm font-semibold mb-4">
                    POUR LES ENTREPRISES
                </span>
                <h2 class="text-4xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
                    Recrutez des talents <span class="text-oblink-orange">validés</span>
                </h2>
                <p class="text-lg text-oblink-gray/70 mb-8">
                    Trouvez rapidement des opticiens qualifiés pour vos remplacements urgents, missions ponctuelles
                    ou
                    recrutements permanents.
                </p>

                <div class="space-y-4 mb-8">
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Profils pré-validés</h4>
                            <p class="text-oblink-gray/70">Processus de validation en 4 étapes pour garantir la
                                qualité
                            </p>
                        </div>
                    </div>
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Réponse en 48h</h4>
                            <p class="text-oblink-gray/70">Trouvez un remplaçant rapidement pour vos urgences</p>
                        </div>
                    </div>
                    <div class="flex items-start feature-item">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-4 mt-1"></i>
                        <div>
                            <h4 class="font-semibold mb-1">Économisez jusqu'à 40%</h4>
                            <p class="text-oblink-gray/70">Par rapport aux agences d'intérim traditionnelles</p>
                        </div>
                    </div>
                </div>

                <!-- FIXED LINK: Redirects to Inscription -->
                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="inline-block px-8 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition shadow-lg transform hover:scale-105">
                    Publier une offre <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Services Section - Compact Liquid Glass -->
<section class="py-12 bg-gradient-to-br from-slate-50 via-blue-50 to-violet-50 relative overflow-hidden">
    <!-- Liquid Glass Background Effects -->
    <div class="absolute inset-0 pointer-events-none">
        <div class="liquid-glass-blob blob-1"></div>
        <div class="liquid-glass-blob blob-2"></div>
        <div class="liquid-glass-blob blob-3"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center mb-8">
            <h2 class="text-3xl md:text-4xl font-bold text-oblink-gray mb-2"
                style="font-family: 'Montserrat', sans-serif;">
                Écosystème <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">360°</span>
            </h2>
            <p class="text-sm text-oblink-gray/70">Plus qu'une plateforme, un accompagnement complet</p>
        </div>

        <!-- Grid horizontal scrollable mobile -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <div class="service-card-liquid group" data-delay="0.1">
                <div class="service-icon-mini"><i class="fas fa-shield-alt"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">RC Pro</h3>
            </div>

            <div class="service-card-liquid group" data-delay="0.2">
                <div class="service-icon-mini"><i class="fas fa-briefcase"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">Portage</h3>
            </div>

            <div class="service-card-liquid group" data-delay="0.3">
                <div class="service-icon-mini"><i class="fas fa-graduation-cap"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">Formation</h3>
            </div>

            <div class="service-card-liquid group" data-delay="0.4">
                <div class="service-icon-mini"><i class="fas fa-gavel"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">Juridique</h3>
            </div>

            <div class="service-card-liquid group" data-delay="0.5">
                <div class="service-icon-mini"><i class="fas fa-file-invoice"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">Facturation</h3>
            </div>

            <div class="service-card-liquid group" data-delay="0.6">
                <div class="service-icon-mini"><i class="fas fa-users"></i></div>
                <h3 class="text-sm font-bold text-oblink-gray">Communauté</h3>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials - Compact Liquid Glass -->
<section class="py-12 bg-white relative overflow-hidden">
    <!-- Animated particles background -->
    <div class="absolute inset-0 pointer-events-none">
        <div class="particle-container" id="particles-testimonials"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center mb-8">
            <h2 class="text-3xl md:text-4xl font-bold text-oblink-gray" style="font-family: 'Montserrat', sans-serif;">
                <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange via-oblink-violet to-oblink-blue">4.9/5</span>
                sur 180+ avis
            </h2>
        </div>

        <!-- Horizontal scroll on mobile, grid on desktop -->
        <div
            class="flex md:grid md:grid-cols-2 gap-4 md:gap-6 overflow-x-auto md:overflow-visible snap-x snap-mandatory md:snap-none pb-4 md:pb-0 -mx-4 px-4 md:mx-0">
            <div class="testimonial-card-liquid snap-center flex-shrink-0 w-[85vw] md:w-auto" data-delay="0.2">
                <div class="flex items-center mb-3">
                    <div class="testimonial-avatar-mini">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="ml-3">
                        <h4 class="font-bold text-oblink-gray text-sm">Sarah D.</h4>
                        <p class="text-xs text-oblink-gray/70">Opticienne freelance</p>
                    </div>
                    <div class="flex text-yellow-400 text-xs ml-auto">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <p class="text-oblink-gray/80 text-sm leading-relaxed">
                    "J'ai trouvé mes premières missions en moins d'une semaine. L'accompagnement administratif est
                    vraiment précieux."
                </p>
            </div>

            <div class="testimonial-card-liquid snap-center flex-shrink-0 w-[85vw] md:w-auto" data-delay="0.4">
                <div class="flex items-center mb-3">
                    <div class="testimonial-avatar-mini">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="ml-3">
                        <h4 class="font-bold text-oblink-gray text-sm">Pierre M.</h4>
                        <p class="text-xs text-oblink-gray/70">Gérant magasin</p>
                    </div>
                    <div class="flex text-yellow-400 text-xs ml-auto">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <p class="text-oblink-gray/80 text-sm leading-relaxed">
                    "Profils validés, réponse en 48h max. Économies importantes par rapport aux agences d'intérim."
                </p>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Shield Section (New) -->
<section class="py-16 bg-white relative">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-oblink-gray mb-4"
                style="font-family: 'Montserrat', sans-serif;">
                Questions <span class="text-oblink-orange">Fréquentes</span>
            </h2>
            <p class="text-lg text-gray-500">Tout ce que vous devez savoir avant de commencer.</p>
        </div>

        <div class="space-y-4">
            <!-- Question 1 -->
            <div class="bg-gray-50 rounded-2xl p-6 hover:bg-white hover:shadow-lg transition duration-300 border border-transparent hover:border-gray-100 group cursor-pointer"
                onclick="this.classList.toggle('active')">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-orange transition">Est-ce que le
                        contenu est à jour pour la réforme BTS OL 2026 ?</h3>
                    <i
                        class="fas fa-chevron-down text-gray-400 transform transition-transform group-[.active]:rotate-180"></i>
                </div>
                <div class="text-gray-600 leading-relaxed hidden group-[.active]:block animate-fade-in">
                    <strong class="text-gray-900">Oui.</strong> Notre IA est entraînée sur le nouveau référentiel.
                    Chaque question générée prend en compte les dernières évolutions techniques et réglementaires du
                    secteur.
                </div>
            </div>

            <!-- Question 2 -->
            <div class="bg-gray-50 rounded-2xl p-6 hover:bg-white hover:shadow-lg transition duration-300 border border-transparent hover:border-gray-100 group cursor-pointer"
                onclick="this.classList.toggle('active')">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-orange transition">OBLINK est-il
                        une agence d'intérim ?</h3>
                    <i
                        class="fas fa-chevron-down text-gray-400 transform transition-transform group-[.active]:rotate-180"></i>
                </div>
                <div class="text-gray-600 leading-relaxed hidden group-[.active]:block animate-fade-in">
                    <strong class="text-gray-900">Non.</strong> Nous sommes une plateforme de mise en relation directe.
                    Cela nous permet de supprimer les intermédiaires et d'offrir des TJM plus élevés aux freelances et
                    des coûts réduits aux magasins.
                </div>
            </div>

            <!-- Question 3 -->
            <div class="bg-gray-50 rounded-2xl p-6 hover:bg-white hover:shadow-lg transition duration-300 border border-transparent hover:border-gray-100 group cursor-pointer"
                onclick="this.classList.toggle('active')">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-orange transition">Comment mon
                        profil est-il certifié ?</h3>
                    <i
                        class="fas fa-chevron-down text-gray-400 transform transition-transform group-[.active]:rotate-180"></i>
                </div>
                <div class="text-gray-600 leading-relaxed hidden group-[.active]:block animate-fade-in">
                    Votre profil devient <strong class="text-green-600">"Certifié OBLINK"</strong> dès que vous
                    réussissez nos tests d'expertise (Logiciel ERP, Réfraction, Gestion). C'est ce badge qui garantit
                    votre visibilité auprès des recruteurs.
                </div>
            </div>

            <!-- Question 4 -->
            <div class="bg-gray-50 rounded-2xl p-6 hover:bg-white hover:shadow-lg transition duration-300 border border-transparent hover:border-gray-100 group cursor-pointer"
                onclick="this.classList.toggle('active')">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-orange transition">Puis-je
                        utiliser mon compte sur plusieurs appareils ?</h3>
                    <i
                        class="fas fa-chevron-down text-gray-400 transform transition-transform group-[.active]:rotate-180"></i>
                </div>
                <div class="text-gray-600 leading-relaxed hidden group-[.active]:block animate-fade-in">
                    Pour garantir la sécurité de vos données et la rentabilité du service, l'accès est limité à <strong
                        class="text-gray-900">deux appareils</strong> (ex: votre mobile et votre ordinateur).
                </div>
            </div>

            <!-- Question 5 -->
            <div class="bg-gray-50 rounded-2xl p-6 hover:bg-white hover:shadow-lg transition duration-300 border border-transparent hover:border-gray-100 group cursor-pointer"
                onclick="this.classList.toggle('active')">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-orange transition">Comment sont
                        sécurisés mes paiements ?</h3>
                    <i
                        class="fas fa-chevron-down text-gray-400 transform transition-transform group-[.active]:rotate-180"></i>
                </div>
                <div class="text-gray-600 leading-relaxed hidden group-[.active]:block animate-fade-in">
                    Tous les flux financiers sont gérés par <strong class="text-purple-600">Stripe</strong>, le leader
                    mondial du paiement sécurisé. OBLINK n'a jamais accès à vos coordonnées bancaires.
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Blog Section -->
<section class="py-10 md:py-20 bg-white relative">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <span
                class="inline-block px-4 py-2 bg-oblink-orange/10 text-oblink-orange rounded-full text-sm font-semibold mb-4">
                <i class="fas fa-newspaper mr-2"></i>BLOG OBLINK
            </span>
            <h2 class="text-4xl md:text-5xl font-bold text-oblink-gray mb-4"
                style="font-family: 'Montserrat', sans-serif;">
                Conseils & <span class="text-oblink-orange">Actualités</span>
            </h2>
            <p class="text-xl text-oblink-gray/70 max-w-2xl mx-auto">
                Guides pratiques, témoignages et actualités pour réussir en tant qu'opticien indépendant
            </p>
        </div>

        <div class="grid md:grid-cols-3 gap-8 mb-12">
            <?php
            // Query latest 3 posts
            $args = array(
                'posts_per_page' => 3,
                'post_status' => 'publish',
                'orderby' => 'date',
                'order' => 'DESC'
            );
            $latest_posts = new WP_Query($args);

            if ($latest_posts->have_posts()):
                while ($latest_posts->have_posts()):
                    $latest_posts->the_post();
                    $thumb_url = get_the_post_thumbnail_url(get_the_ID(), 'medium_large');
                    if (!$thumb_url) {
                        // Fallback image if no featured image
                        $thumb_url = 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=800';
                    }
                    ?>
                    <article class="group">
                        <a href="<?php the_permalink(); ?>" class="block">
                            <div class="relative overflow-hidden rounded-2xl mb-4 h-56">
                                <img src="<?php echo esc_url($thumb_url); ?>" alt="<?php the_title_attribute(); ?>"
                                    class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500">
                                <div class="absolute inset-0 bg-gradient-to-t from-oblink-gray/80 to-transparent"></div>
                                <div class="absolute bottom-4 left-4 right-4">
                                    <span
                                        class="inline-block px-3 py-1 bg-oblink-orange text-white rounded-full text-xs font-semibold mb-2">
                                        <?php
                                        $cats = get_the_category();
                                        echo !empty($cats) ? esc_html($cats[0]->name) : 'Actualité';
                                        ?>
                                    </span>
                                    <div class="flex items-center gap-3 text-white/80 text-xs">
                                        <span><i class="fas fa-calendar mr-1"></i><?php echo get_the_date('d M Y'); ?></span>
                                        <span><i class="fas fa-clock mr-1"></i>5 min</span>
                                    </div>
                                </div>
                            </div>
                            <h3
                                class="text-xl font-bold text-oblink-gray mb-2 group-hover:text-oblink-orange transition line-clamp-2">
                                <?php the_title(); ?>
                            </h3>
                            <p class="text-oblink-gray/70 text-sm line-clamp-3 mb-3">
                                <?php echo wp_trim_words(get_the_excerpt(), 20, '...'); ?>
                            </p>
                            <span
                                class="inline-flex items-center text-oblink-orange font-semibold text-sm group-hover:underline">
                                Lire l'article <i
                                    class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                            </span>
                        </a>
                    </article>
                    <?php
                endwhile;
                wp_reset_postdata();
            else:
                // Fallback content if no posts exist (so the section isn't empty in dev)
                ?>
                <div class="col-span-3 text-center text-gray-400 py-10">
                    <p>Aucun article publié pour le moment.</p>
                </div>
                <?php
            endif;
            ?>
        </div>

        <!-- CTA vers le blog -->
        <div class="text-center">
            <a href="<?php echo home_url('/blog'); ?>"
                class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white rounded-xl font-semibold hover:shadow-xl transition transform hover:scale-105">
                <i class="fas fa-newspaper mr-2"></i>
                Découvrir tous les articles
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Community Newsletter Section -->
<section class="py-8 md:py-16 pb-16 md:pb-32 mb-20 relative overflow-hidden">
    <!-- Background with gradient and mesh -->
    <div class="absolute inset-0 bg-gray-900">
        <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-oblink-gray opacity-90"></div>
        <!-- Abstract Shapes -->
        <div
            class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2">
        </div>
        <div
            class="absolute bottom-0 left-0 w-96 h-96 bg-oblink-violet/20 rounded-full blur-3xl transform -translate-x-1/2 translate-y-1/2">
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
        <span
            class="inline-block px-4 py-1.5 rounded-full bg-white/10 text-white/90 text-sm font-semibold mb-4 border border-white/20 backdrop-blur-sm">
            <i class="fas fa-star text-oblink-orange mr-2"></i>Rejoignez l'élite de l'optique
        </span>

        <h2 class="text-4xl md:text-5xl font-bold text-white mb-4 tracking-tight"
            style="font-family: 'Overpass', sans-serif;">
            Ne manquez aucune <span
                class="bg-gradient-to-r from-oblink-orange to-oblink-orange/80 bg-clip-text text-transparent">opportunité</span>.
        </h2>

        <p class="text-xl text-gray-300 mb-6 max-w-2xl mx-auto leading-relaxed">
            Recevez en exclusivité les dernières missions, les actualités du secteur et nos conseils d'experts. Pas de
            spam, juste de la valeur.
        </p>

        <form class="max-w-lg mx-auto relative group"
            onsubmit="event.preventDefault(); showToast('Merci ! Vous faites désormais partie du cercle.', 'success');">
            <div
                class="absolute -inset-1 bg-gradient-to-r from-oblink-orange to-oblink-violet rounded-xl blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200">
            </div>
            <div class="relative flex items-center bg-white rounded-xl p-1.5 shadow-2xl">
                <div class="flex-shrink-0 pl-4 pr-2 text-gray-400">
                    <i class="fas fa-envelope"></i>
                </div>
                <input type="email" placeholder="Votre email professionnel" required
                    class="flex-1 p-3 text-gray-900 placeholder-gray-400 bg-transparent border-none focus:ring-0 focus:outline-none w-full">
                <button type="submit"
                    class="px-6 py-3 bg-oblink-gray text-white font-bold rounded-lg hover:bg-gray-800 transition-all duration-200 shadow-md whitespace-nowrap">
                    Rejoindre le cercle
                </button>
            </div>
            <p class="text-gray-500 text-xs mt-4">
                <i class="fas fa-lock mr-1"></i> Vos données sont protégées. Désinscription à tout moment.
            </p>
        </form>
    </div>
</section>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-observatoire.php ---
<?php
/*
Template Name: Observatoire
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-24 pb-12">

    <!-- Hero Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
        <div class="text-center max-w-3xl mx-auto">
            <span class="text-oblink-orange font-bold tracking-wider uppercase text-sm mb-2 block">Market
                Intelligence</span>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">Baromètre du Marché <span
                    class="text-oblink-blue">2026</span></h1>
            <p class="text-xl text-gray-500 mb-8">Les chiffres clés de l'optique pour négocier vos tarifs et choisir vos
                missions. Données mises à jour mensuellement.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#tjm"
                    class="px-6 py-3 bg-white text-oblink-gray font-bold rounded-xl border border-gray-200 hover:border-oblink-blue hover:text-oblink-blue transition">
                    <i class="fas fa-chart-line mr-2"></i>Voir les TJM
                </a>
                <a href="#roi"
                    class="px-6 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-500/30">
                    <i class="fas fa-calculator mr-2"></i>Calculateur ROI
                </a>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- TJM Section -->
        <div id="tjm" class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <!-- PRIX MOYEN -->
            <div
                class="bg-white rounded-3xl p-8 shadow-lg shadow-gray-200/50 border border-gray-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-6 opacity-10">
                    <i class="fas fa-euro-sign text-8xl text-oblink-orange"></i>
                </div>
                <h2 class="text-2xl font-bold font-display text-oblink-gray mb-6">Taux Journalier Moyen (TJM)</h2>

                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-bold text-gray-600">Île-de-France</span>
                            <span class="font-bold text-oblink-orange">380 € / jour</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3">
                            <div class="bg-oblink-orange h-3 rounded-full" style="width: 85%"></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Varie de 350€ à 450€ selon urgence</p>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-bold text-gray-600">Province (Grandes Villes)</span>
                            <span class="font-bold text-oblink-blue">320 € / jour</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3">
                            <div class="bg-oblink-blue h-3 rounded-full" style="width: 70%"></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Lyon, Bordeaux, Nantes... (+ Frais souvent inclus)</p>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-bold text-gray-600">Zones Rurales</span>
                            <span class="font-bold text-oblink-violet">400 € / jour</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3">
                            <div class="bg-oblink-violet h-3 rounded-full" style="width: 90%"></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Prime à la mobilité forte</p>
                    </div>
                </div>
            </div>

            <!-- LOGICIELS -->
            <div class="bg-white rounded-3xl p-8 shadow-lg shadow-gray-200/50 border border-gray-100">
                <h2 class="text-2xl font-bold font-display text-oblink-gray mb-6">Logiciels les plus demandés</h2>
                <div class="space-y-4">
                    <div class="flex items-center gap-4">
                        <div class="w-16 text-right font-bold text-gray-400">60%</div>
                        <div
                            class="flex-1 bg-gray-100 rounded-r-xl h-10 flex items-center px-4 relative overflow-hidden group">
                            <div
                                class="absolute left-0 top-0 bottom-0 bg-oblink-gray/10 w-[60%] group-hover:bg-oblink-gray/20 transition">
                            </div>
                            <span class="relative z-10 font-bold text-oblink-gray">Cosium</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-16 text-right font-bold text-gray-400">25%</div>
                        <div
                            class="flex-1 bg-gray-100 rounded-r-xl h-10 flex items-center px-4 relative overflow-hidden group">
                            <div
                                class="absolute left-0 top-0 bottom-0 bg-oblink-blue/10 w-[25%] group-hover:bg-oblink-blue/20 transition">
                            </div>
                            <span class="relative z-10 font-bold text-oblink-gray">Montéeristo</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-16 text-right font-bold text-gray-400">10%</div>
                        <div
                            class="flex-1 bg-gray-100 rounded-r-xl h-10 flex items-center px-4 relative overflow-hidden group">
                            <div
                                class="absolute left-0 top-0 bottom-0 bg-oblink-orange/10 w-[10%] group-hover:bg-oblink-orange/20 transition">
                            </div>
                            <span class="relative z-10 font-bold text-oblink-gray">WinOptics</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-16 text-right font-bold text-gray-400">5%</div>
                        <div
                            class="flex-1 bg-gray-100 rounded-r-xl h-10 flex items-center px-4 relative overflow-hidden group">
                            <div
                                class="absolute left-0 top-0 bottom-0 bg-gray-200 w-[5%] group-hover:bg-gray-300 transition">
                            </div>
                            <span class="relative z-10 font-bold text-oblink-gray">Autres</span>
                        </div>
                    </div>
                </div>
                <div class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100 flex gap-3 text-sm text-blue-800">
                    <i class="fas fa-lightbulb mt-1"></i>
                    <p><strong>Conseil :</strong> Formez-vous à Cosium pour accéder à 6 missions sur 10. <a
                            href="<?php echo home_url('/formation-erp'); ?>" class="underline font-bold">Voir la
                            formation.</a></p>
                </div>
            </div>
        </div>

        <!-- ROI Calculator -->
        <div id="roi"
            class="bg-oblink-gray text-white rounded-3xl p-8 lg:p-12 shadow-2xl mb-12 relative overflow-hidden">
            <div
                class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-[100px] pointer-events-none">
            </div>

            <div class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-3xl font-bold font-display mb-4">Salarié vs Freelance ?</h2>
                    <p class="text-gray-400 mb-8">Ne comparez pas des pommes et des poires. Calculez votre "Liberté
                        Financière" en comparant votre salaire net actuel avec le potentiel freelance.</p>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-400 mb-2">Votre Salaire Net Mensuel
                                (CDI)</label>
                            <div class="relative">
                                <input type="number" id="roi-salary" value="2200"
                                    class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white font-bold focus:outline-none focus:border-oblink-orange transition">
                                <span class="absolute right-4 top-3 text-gray-400">€</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-400 mb-2">Votre TJM Estimé
                                (Freelance)</label>
                            <div class="relative">
                                <input type="number" id="roi-tjm" value="350"
                                    class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white font-bold focus:outline-none focus:border-oblink-blue transition">
                                <span class="absolute right-4 top-3 text-gray-400">€</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-8 border border-white/10 text-center">
                    <p class="text-lg font-medium text-gray-300 mb-2">Pour gagner la même chose, vous devez travailler :
                    </p>
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <span id="roi-days" class="text-6xl font-black text-oblink-orange">6.3</span>
                        <span class="text-xl text-left leading-tight font-bold text-gray-400">Jours<br>par mois</span>
                    </div>
                    <p class="text-sm text-gray-400 mb-6">Soit <span class="text-white font-bold"
                            id="roi-rest">15</span> jours de temps libre en plus (ou de gain supplémentaire).</p>

                    <button onclick="window.location.href='<?php echo home_url('/inscription-opticien'); ?>'"
                        class="w-full py-3 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange hover:text-white transition">
                        Devenir Freelance
                    </button>
                </div>
            </div>
        </div>

        <!-- Lead Magnet -->
        <div class="bg-gradient-to-r from-oblink-blue to-blue-600 rounded-3xl p-8 lg:p-12 text-white text-center">
            <div class="max-w-2xl mx-auto">
                <i class="fas fa-file-pdf text-4xl mb-4 text-blue-200"></i>
                <h2 class="text-3xl font-bold font-display mb-4">Téléchargez l'Étude Complète 2026</h2>
                <p class="text-blue-100 mb-8">Accédez aux détails par région, aux grilles de salaires détaillées et aux
                    prévisions de recrutement des grandes enseignes.</p>

                <form onsubmit="event.preventDefault(); alert('L\'étude vous a été envoyée par email !');"
                    class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto">
                    <input type="email" placeholder="Votre email pro" required
                        class="flex-1 px-4 py-3 rounded-xl text-gray-800 focus:outline-none focus:ring-4 focus:ring-white/30">
                    <button type="submit"
                        class="px-6 py-3 bg-oblink-orange font-bold rounded-xl hover:bg-orange-500 transition shadow-lg">
                        Recevoir le PDF
                    </button>
                </form>
                <p class="text-xs text-blue-200 mt-4"><i class="fas fa-lock mr-1"></i> Vos données restent
                    confidentielles.</p>
            </div>
        </div>

    </div>
</div>

<script>
    // Simple ROI Logic
    const salaryInput = document.getElementById('roi-salary');
    const tjmInput = document.getElementById('roi-tjm');
    const daysDisplay = document.getElementById('roi-days');
    const restDisplay = document.getElementById('roi-rest');

    function calculateROI() {
        const salary = parseFloat(salaryInput.value) || 0;
        const tjm = parseFloat(tjmInput.value) || 1;

        // Calcul simpliste : Salaire Net / (TJM * 0.76 pour approx charges micro-social/frais) 
        // Ou brut pour brut. 
        // Pour simplifier l'argumentaire freelance : on va dire que le TJM affiché est ce qui rentre avant impôt, 
        // et le salaire est net. Un Raccourci marketing assumé pour l'instant, ou on compare Brut vs CA.
        // LE PLUS PARLANT : Combien de jours de facturation pour égaler le salaire NET ?
        // Hypothèse : 25% charges URSSAF en micro. Donc Net = TJM * 0.75.

        const netPerDay = tjm * 0.75;
        const daysNeeded = salary / netPerDay;
        const workingDaysInMonth = 21; // Approx

        daysDisplay.innerText = daysNeeded.toFixed(1);

        const rest = workingDaysInMonth - daysNeeded;
        restDisplay.innerText = rest > 0 ? rest.toFixed(1) : 0;
    }

    salaryInput.addEventListener('input', calculateROI);
    tjmInput.addEventListener('input', calculateROI);

    // Init
    calculateROI();
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-debug-auth.php ---
<?php
/*
Template Name: Debug Auth
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20 px-4">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-oblink-gray mb-6">🔍 Diagnostic Authentification</h1>

            <div id="auth-debug-output" class="space-y-4">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-oblink-orange"></div>
                <p class="text-gray-500">Chargement des informations...</p>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200">
                <button onclick="location.reload()"
                    class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold mr-3">
                    🔄 Rafraîchir
                </button>
                <button onclick="clearAndLogout()"
                    class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold">
                    🗑️ Déconnexion Complète
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    async function clearAndLogout() {
        if (confirm('Ceci va te déconnecter et vider toutes les données. Continuer ?')) {
            try {
                await window.oblinkSupabase.auth.signOut();
                localStorage.clear();
                sessionStorage.clear();
                alert('✅ Déconnexion réussie ! Refresh de la page...');
                window.location.href = '<?php echo home_url('/'); ?>';
            } catch (err) {
                alert('Erreur : ' + err.message);
            }
        }
    }

    async function runDiagnostic() {
        const output = document.getElementById('auth-debug-output');

        try {
            // Check if Supabase is loaded
            if (!window.oblinkSupabase) {
                output.innerHTML = `
                <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">❌ Supabase non chargé</h3>
                    <p class="text-red-600">Le client Supabase n'est pas initialisé.</p>
                </div>
            `;
                return;
            }

            // Get session
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                output.innerHTML = `
                <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">❌ Erreur Session</h3>
                    <p class="text-red-600">${error.message}</p>
                </div>
            `;
                return;
            }

            if (!session) {
                output.innerHTML = `
                <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                    <h3 class="font-bold text-yellow-800 mb-2">⚠️ Non connecté</h3>
                    <p class="text-yellow-700">Aucune session active détectée.</p>
                    <a href="<?php echo home_url('/login'); ?>" class="inline-block mt-3 px-4 py-2 bg-oblink-orange text-white rounded-lg">
                        Se connecter
                    </a>
                </div>
            `;
                return;
            }

            // Session exists - show details
            const user = session.user;
            const userType = user.user_metadata?.user_type;
            const correctDashboard = userType === 'entreprise' ? '/dashboard-entreprise' : '/dashboard-opticien';

            output.innerHTML = `
            <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4">
                <h3 class="font-bold text-green-800 mb-3">✅ Session Active</h3>
                <dl class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <dt class="font-semibold text-gray-700">Email:</dt>
                        <dd class="text-gray-900">${user.email}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="font-semibold text-gray-700">User ID:</dt>
                        <dd class="text-gray-900 font-mono text-xs">${user.id}</dd>
                    </div>
                    <div class="flex justify-between items-center">
                        <dt class="font-semibold text-gray-700">Type utilisateur:</dt>
                        <dd class="px-3 py-1 rounded-full text-xs font-bold ${userType === 'entreprise' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}">
                            ${userType || 'NON DÉFINI'}
                        </dd>
                    </div>
                </dl>
            </div>

            <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                <h3 class="font-bold text-blue-800 mb-3">📊 Métadonnées Complètes</h3>
                <pre class="bg-white p-3 rounded overflow-auto text-xs">${JSON.stringify(user.user_metadata, null, 2)}</pre>
            </div>

            <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-4">
                <h3 class="font-bold text-purple-800 mb-3">🎯 Dashboard Recommandé</h3>
                <p class="text-purple-700 mb-3">Selon ton type (<strong>${userType}</strong>), tu devrais accéder à :</p>
                <a href="<?php echo home_url(); ?>${correctDashboard}" 
                   class="inline-block px-6 py-3 ${userType === 'entreprise' ? 'bg-oblink-blue' : 'bg-oblink-orange'} text-white rounded-lg font-semibold hover:opacity-90">
                    ${userType === 'entreprise' ? '🏢' : '👤'} Aller au Dashboard ${userType === 'entreprise' ? 'Entreprise' : 'Opticien'}
                </a>
            </div>
        `;

        } catch (err) {
            output.innerHTML = `
            <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                <h3 class="font-bold text-red-800 mb-2">❌ Erreur Diagnostic</h3>
                <p class="text-red-600">${err.message}</p>
            </div>
        `;
        }
    }

    // Run on load
    document.addEventListener('DOMContentLoaded', runDiagnostic);
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-a-propos.php ---
<?php
/*
Template Name: À Propos
*/
include 'header-inc.php';
?>

<div class="max-w-4xl mx-auto px-4 py-32">
    <h1 class="text-5xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
        À propos d'<span class="text-oblink-orange">OBLINK</span>
    </h1>

    <div class="prose prose-lg max-w-none">
        <p class="text-xl text-oblink-gray/80 mb-8">
            OBLINK est la première plateforme de mise en relation spécialisée dans le secteur de l'optique en France.
        </p>

        <div class="glass p-8 mb-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-oblink-gray mb-4">Notre Mission</h2>
            <p class="text-oblink-gray/80">
                Connecter instantanément les opticiens et vendeurs indépendants aux magasins et entreprises d'optique.
                Nous croyons en un secteur où la flexibilité, la confiance et la simplicité sont les maîtres mots.
            </p>
        </div>

        <h2 class="text-3xl font-bold text-oblink-gray mb-4">Notre Histoire</h2>
        <p class="text-oblink-gray/80 mb-6">
            L'idée d'OBLINK est née d'une observation simple : la mise en relation entre opticiens et entreprises reste
            archaïque dans un secteur pourtant moderne.
            Après avoir observé les difficultés des opticiens indépendants à trouver des missions et des magasins à
            recruter rapidement,
            nous avons décidé de créer la solution qui manquait au marché.
        </p>

        <div class="grid md:grid-cols-3 gap-6 my-12">
            <div class="glass p-6 text-center border-2 border-oblink-orange rounded-xl">
                <div class="text-4xl font-bold text-oblink-orange mb-2">2025</div>
                <div class="text-oblink-gray/70">Année de création</div>
            </div>
            <div class="glass p-6 text-center border-2 border-oblink-blue rounded-xl">
                <div class="text-4xl font-bold text-oblink-blue mb-2">500+</div>
                <div class="text-oblink-gray/70">Opticiens actifs</div>
            </div>
            <div class="glass p-6 text-center border-2 border-oblink-violet rounded-xl">
                <div class="text-4xl font-bold text-oblink-violet mb-2">200+</div>
                <div class="text-oblink-gray/70">Entreprises partenaires</div>
            </div>
        </div>

        <h2 class="text-3xl font-bold text-oblink-gray mb-4">Nos Valeurs</h2>
        <div class="space-y-6 mb-8">
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-bolt text-oblink-orange text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Rapidité</h3>
                    <p class="text-oblink-gray/80">Une mise en relation instantanée, des réponses en moins de 48h</p>
                </div>
            </div>
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-shield-alt text-oblink-blue text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Confiance</h3>
                    <p class="text-oblink-gray/80">Validation rigoureuse en 4 étapes, profils vérifiés et authentifiés
                    </p>
                </div>
            </div>
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-hands-helping text-oblink-violet text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Transparence</h3>
                    <p class="text-oblink-gray/80">Tarification claire, pas de frais cachés, rémunération équitable</p>
                </div>
            </div>
        </div>

        <div class="glass p-8 text-center rounded-2xl">
            <h2 class="text-2xl font-bold text-oblink-gray mb-4">Rejoignez l'aventure !</h2>
            <p class="text-oblink-gray/80 mb-6">Que vous soyez opticien ou entreprise, OBLINK vous accompagne</p>
            <div class="flex gap-4 justify-center flex-wrap">
                <a href="<?php echo home_url('/register?type=opticien'); ?>"
                    class="px-6 py-3 bg-oblink-orange text-white rounded-lg font-semibold hover:bg-oblink-orange/90 transition">
                    Je suis opticien
                </a>
                <a href="<?php echo home_url('/register?type=entreprise'); ?>"
                    class="px-6 py-3 bg-oblink-violet text-white rounded-lg font-semibold hover:bg-oblink-violet/90 transition">
                    Je suis une entreprise
                </a>
            </div>
        </div>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>