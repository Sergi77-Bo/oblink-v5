--- PART 2a: PAGES (A-M) ---
--- FILE: theme/page-admin-dashboard.php ---
<?php
/**
 * Template Name: Admin Dashboard
 * 
 * A Real-time BI Dashboard for OBLINK Académie.
 * Tracks: Cache Hit Ratio (Margin), Conversion (Sales), Quarantine (Quality).
 */

// Basic Security (In prod, use strict role check)
// if (!current_user_can('manage_options')) { wp_redirect(home_url()); exit; }

get_header();

// 1. Fetch Stats from JSON (Mocking a DB query)
$stats_file = get_template_directory() . '/../academie/stats.json';
$quarantine_file = get_template_directory() . '/../academie/questions_quarantine.json';

$stats = ['global' => ['cache_hits' => 0, 'api_calls' => 0]];
$quarantine_count = 0;

if (file_exists($stats_file)) {
    $stats = json_decode(file_get_contents($stats_file), true);
}
if (file_exists($quarantine_file)) {
    $q_data = json_decode(file_get_contents($quarantine_file), true);
    $quarantine_count = count($q_data);
}

// 2. Calculate KPIs
$total_requests = ($stats['global']['cache_hits'] ?? 0) + ($stats['global']['api_calls'] ?? 0);
$cache_hit_ratio = $total_requests > 0 ? round(($stats['global']['cache_hits'] / $total_requests) * 100, 1) : 0;

// Conversion Mock (Simulated logic for demo)
$unique_visitors = 1250; // Analytics API
$sales_count = 58;
$conversion_rate = round(($sales_count / $unique_visitors) * 100, 1);

// Quarantine Rate
// Assuming we track 'total_generated' roughly equal to api_calls over time (simplified)
$total_generated = $stats['global']['api_calls'] ?? 1;
$quarantine_rate = round(($quarantine_count / max($total_generated, 1)) * 100, 1);

?>

<div class="pt-32 pb-20 bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-10 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-black text-gray-900 mb-2">Pilotage Académie</h1>
                <p class="text-gray-500">Business Intelligence & Santé de l'IA</p>
            </div>
            <div class="text-right">
                <span class="block text-sm text-gray-400">Revenus (Mois en cours)</span>
                <span class="block text-3xl font-bold text-green-600">1 682,00 €</span>
            </div>
        </div>

        <!-- KPI Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">

            <!-- KPI 1: Marge Technique (Cache Hit) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $cache_hit_ratio > 85 ? 'border-green-500' : 'border-yellow-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-server text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Marge Technique</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $cache_hit_ratio; ?>%
                    </span>
                    <span class="text-sm text-gray-500">Cache Hit Ratio</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    <?php if ($cache_hit_ratio > 85): ?>
                        <span class="text-green-600 font-bold"><i class="fas fa-check"></i> Excellent.</span> Coûts API
                        minimes.
                    <?php else: ?>
                        <span class="text-yellow-600 font-bold"><i class="fas fa-exclamation-triangle"></i>
                            Attention.</span> L'IA travaille trop.
                    <?php endif; ?>
                </p>
            </div>

            <!-- KPI 2: Conversion (Tunnel) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $conversion_rate >= 4 ? 'border-green-500' : 'border-red-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-funnel-dollar text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Efficacité Vente</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $conversion_rate; ?>%
                    </span>
                    <span class="text-sm text-gray-500">CVR (Sim -> Achat)</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    Basé sur
                    <?php echo $sales_count; ?> ventes pour
                    <?php echo $unique_visitors; ?> visiteurs.
                    <?php if ($conversion_rate < 3): ?>
                        <br><a href="#" class="text-oblink-orange font-bold hover:underline">Optimiser le Hook</a>
                    <?php endif; ?>
                </p>
            </div>

            <!-- KPI 3: Santé Produit (Quarantine) -->
            <div
                class="bg-white p-8 rounded-2xl shadow-lg border-l-4 <?php echo $quarantine_rate < 2 ? 'border-green-500' : 'border-red-500'; ?> relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-heartbeat text-6xl"></i>
                </div>
                <h3 class="text-gray-400 font-bold uppercase tracking-wider text-xs mb-2">Qualité IA</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black text-gray-900">
                        <?php echo $quarantine_rate; ?>%
                    </span>
                    <span class="text-sm text-gray-500">Taux de Rejet</span>
                </div>
                <p class="mt-4 text-sm text-gray-600">
                    <?php echo $quarantine_count; ?> questions en quarantaine.
                    <?php if ($quarantine_rate > 5): ?>
                        <span class="block mt-1 text-red-600 font-bold animate-pulse">ALERTE CRITIQUE : Vérifier
                            Prompt.</span>
                    <?php endif; ?>
                </p>
            </div>
        </div>

        <!-- Actions Rapides -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-8 rounded-2xl shadow-sm">
                <h3 class="font-bold text-lg mb-4">Actions Techniques</h3>
                <div class="space-y-3">
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Lancer le nettoyage du cache</span>
                        <i class="fas fa-broom text-gray-400 group-hover:text-oblink-orange"></i>
                    </button>
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Voir les questions en quarantaine</span>
                        <i class="fas fa-file-medical-alt text-gray-400 group-hover:text-red-500"></i>
                    </button>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-sm">
                <h3 class="font-bold text-lg mb-4">Actions Commerciales</h3>
                <div class="space-y-3">
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Envoyer Promo "J-30 Examen"</span>
                        <i class="fas fa-paper-plane text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                    <button
                        class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg flex justify-between items-center group transition">
                        <span class="font-medium text-gray-700">Configurer Stripe (En attente)</span>
                        <i class="fas fa-cog text-gray-400 group-hover:text-gray-600"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<?php get_footer(); ?>--- FILE: theme/page-guide-creation-entreprise.php ---
<?php
/*
Template Name: Guide Création Entreprise
*/

include 'header-inc.php';
?>

<style>
    .sticky-toc {
        position: sticky;
        top: 100px;
    }
</style>

<!-- Hero -->
<section class="bg-gradient-to-br from-oblink-blue/10 to-oblink-violet/10 pt-32 pb-16">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="inline-flex items-center px-4 py-2 bg-white rounded-full shadow-sm mb-6">
            <i class="fas fa-rocket text-oblink-orange mr-2"></i>
            <span class="text-sm font-semibold text-oblink-gray">GUIDE COMPLET</span>
        </div>
        <h1 class="text-5xl font-bold mb-6 text-oblink-gray" style="font-family: 'Montserrat', sans-serif;">
            Guide de Création d'Entreprise<br />
            <span class="text-oblink-orange">pour Opticiens Freelances</span>
        </h1>
        <p class="text-xl text-oblink-gray/70 max-w-3xl mx-auto">
            Tout ce que vous devez savoir pour devenir opticien indépendant : statut juridique, démarches
            administratives,
            comptabilité, assurances et accompagnement
        </p>
    </div>
</section>

<!-- Content -->
<div class="max-w-7xl mx-auto px-4 py-16">
    <div class="grid lg:grid-cols-4 gap-8">
        <!-- Table of Contents (Sticky) -->
        <aside class="lg:col-span-1">
            <nav class="sticky-toc bg-white border-2 border-oblink-beige rounded-xl p-6">
                <h2 class="font-bold text-oblink-gray mb-4 flex items-center">
                    <i class="fas fa-list text-oblink-orange mr-2"></i>
                    Sommaire
                </h2>
                <ul class="space-y-2 text-sm">
                    <li><a href="#introduction"
                            class="text-oblink-gray hover:text-oblink-orange transition">Introduction</a></li>
                    <li><a href="#statut-juridique" class="text-oblink-gray hover:text-oblink-orange transition">1.
                            Statut juridique</a></li>
                    <li><a href="#demarches" class="text-oblink-gray hover:text-oblink-orange transition">2. Démarches
                            administratives</a></li>
                    <li><a href="#comptabilite" class="text-oblink-gray hover:text-oblink-orange transition">3.
                            Comptabilité & Fiscalité</a></li>
                    <li><a href="#assurances" class="text-oblink-gray hover:text-oblink-orange transition">4. Assurances
                            obligatoires</a></li>
                    <li><a href="#tarification" class="text-oblink-gray hover:text-oblink-orange transition">5.
                            Tarification</a></li>
                    <li><a href="#facturation" class="text-oblink-gray hover:text-oblink-orange transition">6.
                            Facturation</a></li>
                    <li><a href="#developpement" class="text-oblink-gray hover:text-oblink-orange transition">7.
                            Développement</a></li>
                    <li><a href="#accompagnement" class="text-oblink-gray hover:text-oblink-orange transition">8.
                            Accompagnement OBLINK</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="lg:col-span-3">
            <!-- Introduction -->
            <section id="introduction" class="mb-16">
                <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet text-white p-8 rounded-2xl mb-8">
                    <h2 class="text-3xl font-bold mb-4" style="font-family: 'Montserrat', sans-serif;">
                        <i class="fas fa-info-circle mr-2"></i>
                        Bienvenue dans votre parcours entrepreneurial
                    </h2>
                    <p class="text-lg opacity-90">
                        Ce guide complet vous accompagne pas à pas dans la création de votre activité d'opticien
                        indépendant.
                        De la sélection du statut juridique jusqu'à la gestion quotidienne, découvrez toutes les étapes
                        et les meilleures pratiques pour réussir votre lancement.
                    </p>
                </div>
            </section>

            <!-- 1. Statut Juridique -->
            <section id="statut-juridique" class="mb-16 scroll-mt-24">
                <h2 class="text-4xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
                    <span class="text-oblink-orange">1.</span> Choisir son statut juridique
                </h2>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-xl mb-8">
                    <h3 class="font-bold text-yellow-800 mb-2 flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>
                        Point clé
                    </h3>
                    <p class="text-yellow-700">
                        Le choix du statut juridique est la première décision stratégique. Il détermine votre protection
                        sociale,
                        votre fiscalité et votre responsabilité.
                    </p>
                </div>

                <!-- Auto-entrepreneur -->
                <div
                    class="bg-white border-2 border-oblink-beige rounded-xl p-8 mb-6 hover:border-oblink-orange transition">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-oblink-gray mb-2">
                                <i class="fas fa-user text-oblink-blue mr-2"></i>
                                Auto-entrepreneur (Micro-entreprise)
                            </h3>
                            <p class="text-oblink-gray/70">Le statut le plus simple pour débuter</p>
                        </div>
                        <span class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                            <i class="fas fa-star mr-1"></i>Recommandé débutants
                        </span>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-bold text-green-600 mb-3 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>Avantages
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Création rapide et gratuite</li>
                                <li>Comptabilité simplifiée</li>
                                <li>Pas de TVA jusqu'à 600€</li>
                                <li>Charges sociales proportionnelles au CA</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-red-500 mb-3 flex items-center">
                                <i class="fas fa-times-circle mr-2"></i>Limites
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Plafond de CA (77 700€ / an)</li>
                                <li>Pas de déduction des charges réelles</li>
                                <li>Responsabilité illimitée (sauf EIRL)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- EURL / SASU -->
                <div
                    class="bg-white border-2 border-oblink-beige rounded-xl p-8 mb-6 hover:border-oblink-orange transition">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-oblink-gray mb-2">
                                <i class="fas fa-building text-oblink-violet mr-2"></i>
                                Société (EURL / SASU)
                            </h3>
                            <p class="text-oblink-gray/70">Pour les projets ambitieux</p>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-green-600 mb-3 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>Avantages
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Pas de plafond de chiffre d'affaires</li>
                                <li>Déduction des charges réelles</li>
                                <li>Responsabilité limitée aux apports</li>
                                <li>Crédibilité auprès des banques</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-red-500 mb-3 flex items-center">
                                <i class="fas fa-times-circle mr-2"></i>Limites
                            </h4>
                            <ul class="space-y-2 text-sm text-oblink-gray/80">
                                <li>Formalités de création plus lourdes</li>
                                <li>Comptabilité complexe obligatoire</li>
                                <li>Coûts de gestion plus élevés</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Tarification -->
            <section id="tarification" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">5. Définir votre stratégie de tarification
                </h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    La tarification est l'un des aspects les plus délicats de l'indépendance. Plusieurs facteurs entrent
                    en jeu :
                </p>

                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="border-2 border-oblink-beige rounded-xl p-6">
                        <h3 class="font-bold text-oblink-gray mb-3 flex items-center">
                            <i class="fas fa-map-marker-alt text-oblink-orange mr-2"></i>
                            Localisation géographique
                        </h3>
                        <p class="text-oblink-gray/70">
                            Île-de-France : 35-45€/h<br>
                            Grandes métropoles : 30-40€/h<br>
                            Villes moyennes : 25-35€/h
                        </p>
                    </div>
                    <div class="border-2 border-oblink-beige rounded-xl p-6">
                        <h3 class="font-bold text-oblink-gray mb-3 flex items-center">
                            <i class="fas fa-star text-oblink-blue mr-2"></i>
                            Niveau d'expérience
                        </h3>
                        <p class="text-oblink-gray/70">
                            Junior (0-3 ans) : 25-30€/h<br>
                            Confirmé (3-10 ans) : 30-40€/h<br>
                            Expert (10+ ans) : 40-50€/h
                        </p>
                    </div>
                </div>
            </section>

            <!-- 3. Assurances -->
            <section id="assurances" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">4. Sécuriser votre activité avec les bonnes
                    assurances</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    L'assurance Responsabilité Civile Professionnelle (RC Pro) est <strong>obligatoire</strong> pour les
                    opticiens.
                    Elle couvre les dommages causés à vos clients dans l'exercice de votre activité.
                </p>

                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6 mb-8">
                    <h3 class="font-bold text-red-800 mb-3 flex items-center text-xl">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Attention : RC Pro obligatoire !
                    </h3>
                    <p class="text-red-700 mb-4">
                        Sans assurance RC Pro, vous ne pouvez légalement pas exercer. Le coût moyen varie entre 300€ et
                        600€/an
                        selon votre chiffre d'affaires et vos spécialités.
                    </p>
                    <a href="#"
                        class="inline-block px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                        Comparer les assurances RC Pro
                    </a>
                </div>
            </section>

            <!-- 4. Réseau -->
            <section id="developpement" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">7. Construire votre réseau professionnel</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    Le réseau est votre meilleur atout pour trouver des missions régulières. Voici comment le développer
                    efficacement :
                </p>

                <ul class="space-y-3 mb-8">
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Inscrivez-vous sur des plateformes spécialisées</strong>
                            <p class="text-oblink-gray/70">OBLINK, RemplacementOptique.fr, JobOptique.com</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Participez aux salons professionnels</strong>
                            <p class="text-oblink-gray/70">Silmo, Optique Paris, congrès de l'AOF</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Rejoignez des groupes LinkedIn</strong>
                            <p class="text-oblink-gray/70">Groupes d'opticiens, réseaux de freelances</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-oblink-orange text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="text-oblink-gray">Contactez directement les magasins</strong>
                            <p class="text-oblink-gray/70">Email de présentation, visite de courtoisie</p>
                        </div>
                    </li>
                </ul>
            </section>

            <!-- 5. Gestion Quotidienne -->
            <section id="accompagnement" class="mb-16 scroll-mt-24">
                <h2 class="text-3xl font-bold text-oblink-gray mb-4 mt-8">5. Gérer votre activité au quotidien</h2>
                <p class="text-lg text-oblink-gray/80 mb-6 leading-relaxed">
                    La réussite de votre activité dépend aussi de votre organisation administrative et comptable :
                </p>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-file-invoice text-4xl text-oblink-orange mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Facturation</h3>
                        <p class="text-sm text-oblink-gray/70">Utilisez des outils conformes à la facturation
                            électronique obligatoire</p>
                    </div>
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-calculator text-4xl text-oblink-blue mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Comptabilité</h3>
                        <p class="text-sm text-oblink-gray/70">Suivez vos revenus et charges, préparez vos déclarations
                        </p>
                    </div>
                    <div class="bg-white border-2 border-oblink-beige rounded-xl p-6 text-center">
                        <i class="fas fa-calendar-check text-4xl text-oblink-violet mb-4"></i>
                        <h3 class="font-bold text-oblink-gray mb-2">Planning</h3>
                        <p class="text-sm text-oblink-gray/70">Gérez vos missions, disponibilités et prospection</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet text-white p-8 rounded-2xl mt-12">
                    <h3 class="text-2xl font-bold mb-4">Prêt à vous lancer ?</h3>
                    <p class="text-lg mb-6 opacity-90">
                        Rejoignez OBLINK et accédez immédiatement à des centaines de missions partout en France,
                        avec un accompagnement complet pour réussir votre indépendance.
                    </p>
                    <a href="<?php echo home_url('/inscription-opticien'); ?>"
                        class="inline-block px-8 py-4 bg-white text-oblink-orange rounded-lg font-semibold hover:bg-gray-100 transition shadow-lg">
                        Créer mon profil gratuitement <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </section>

        </main>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-blog.php ---
<?php
/**
 * Template Name: Blog
 */

include 'header-inc.php';
?>

<div class="container mx-auto px-4 py-8 pt-32 min-h-screen">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4 font-display text-oblink-gray">Le Blog <span
                class="text-oblink-orange">OBLINK</span></h1>
        <p class="text-lg text-gray-500">Conseils, guides pratiques et actualités pour les opticiens indépendants et les
            entreprises d'optique</p>
    </div>

    <!-- FILTRES PAR CATÉGORIE -->
    <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button class="category-filter active px-6 py-2.5 rounded-full font-bold transition-all duration-300"
            data-category="all">
            Tous
        </button>
        <?php
        $categories = get_categories(array(
            'orderby' => 'name',
            'order' => 'ASC',
            'hide_empty' => true,
        ));

        foreach ($categories as $category):
            if ($category->slug !== 'non-classe'):
                ?>
                <button class="category-filter px-6 py-2.5 rounded-full font-bold transition-all duration-300"
                    data-category="<?php echo esc_attr($category->slug); ?>">
                    <?php echo esc_html($category->name); ?>
                </button>
                <?php
            endif;
        endforeach;
        ?>
    </div>

    <style>
        .category-filter {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
        }

        .category-filter:hover {
            border-color: #FF6600;
            color: #FF6600;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.2);
        }

        .category-filter.active {
            background: #FF6600;
            color: white;
            border-color: #FF6600;
            box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
        }

        .article-card {
            transition: opacity 0.3s, transform 0.3s;
        }

        .article-card.hidden {
            display: none;
        }
    </style>

    <?php if (have_posts()): ?>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="articles-grid">
            <?php
            // Custom query to pagination work correctly on a static page used as blog
            $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
            $args = array(
                'post_type' => 'post',
                'posts_per_page' => 9,
                'paged' => $paged
            );
            $the_query = new WP_Query($args);

            if ($the_query->have_posts()):
                while ($the_query->have_posts()):
                    $the_query->the_post();

                    // Get post categories
                    $post_categories = get_the_category();
                    $category_slugs = array();
                    if ($post_categories) {
                        foreach ($post_categories as $cat) {
                            $category_slugs[] = $cat->slug;
                        }
                    }
                    $categories_data = implode(' ', $category_slugs);
                    ?>
                    <article id="post-<?php the_ID(); ?>"
                        class="article-card <?php echo implode(' ', array_map(function ($slug) {
                            return 'cat-' . $slug;
                        }, $category_slugs)); ?> bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-gray-100 flex flex-col h-full"
                        data-categories="<?php echo esc_attr($categories_data); ?>">
                        <?php if (has_post_thumbnail()): ?>
                            <a href="<?php the_permalink(); ?>" class="block overflow-hidden relative h-56">
                                <?php the_post_thumbnail('medium_large', ['class' => 'w-full h-full object-cover transform hover:scale-105 transition-transform duration-500']); ?>
                            </a>
                        <?php else: ?>
                            <a href="<?php the_permalink(); ?>"
                                class="block overflow-hidden relative h-56 bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-image text-gray-300 text-4xl"></i>
                            </a>
                        <?php endif; ?>

                        <div class="p-6 flex-1 flex flex-col">
                            <div class="mb-3 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-oblink-orange">
                                <?php
                                $categories = get_the_category();
                                if (!empty($categories)) {
                                    echo esc_html($categories[0]->name);
                                } else {
                                    echo 'Article';
                                }
                                ?>
                            </div>

                            <h2 class="text-xl font-bold mb-3 font-display leading-tight">
                                <a href="<?php the_permalink(); ?>"
                                    class="text-oblink-gray hover:text-oblink-blue transition-colors">
                                    <?php the_title(); ?>
                                </a>
                            </h2>

                            <div class="text-gray-600 mb-4 text-sm flex-1 line-clamp-3">
                                <?php the_excerpt(); ?>
                            </div>

                            <div class="mt-auto flex items-center justify-between pt-4 border-t border-gray-100">
                                <div class="text-xs text-gray-400">
                                    <i class="far fa-calendar-alt mr-1"></i> <?php echo get_the_date(); ?>
                                </div>
                                <a href="<?php the_permalink(); ?>"
                                    class="text-sm font-bold text-oblink-blue hover:text-oblink-violet transition-colors flex items-center gap-1">
                                    Lire <i class="fas fa-arrow-right text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                    <?php
                endwhile;

                // Pagination
                echo '<div class="mt-12 col-span-full">';
                echo '<style>
                    .pagination {
                        display: flex;
                        justify-content: center;
                        gap: 8px;
                        align-items: center;
                    }
                    .pagination a,
                    .pagination span {
                        display: inline-block;
                        padding: 10px 16px;
                        background: white;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        color: #4b5563;
                        font-weight: 600;
                        text-decoration: none;
                        transition: all 0.3s ease;
                    }
                    .pagination a:hover {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .current {
                        background: #FF6600;
                        color: white;
                        border-color: #FF6600;
                        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
                    }
                    .pagination .dots {
                        border: none;
                        background: transparent;
                        color: #9ca3af;
                    }
                </style>';
                echo '<div class="pagination">';
                echo paginate_links(array(
                    'total' => $the_query->max_num_pages,
                    'current' => $paged,
                    'prev_text' => 'Précédent',
                    'next_text' => 'Suivant',
                    'mid_size' => 2,
                    'type' => 'plain',
                ));
                echo '</div>';
                echo '</div>';

                wp_reset_postdata();
            else:
                ?>
                <div class="col-span-full text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-300">
                    <i class="far fa-newspaper text-4xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-400">Aucun article publié pour le moment.</h3>
                    <p class="text-gray-400 mt-2">Revenez bientôt pour découvrir nos actualités.</p>
                </div>
                <?php
            endif;
            ?>
        </div>
    <?php endif; ?>
</div>

<script>
    // Système de filtrage des articles par catégorie
    document.addEventListener('DOMContentLoaded', function () {
        const filterButtons = document.querySelectorAll('.category-filter');
        const articles = document.querySelectorAll('.article-card');

        filterButtons.forEach(button => {
            button.addEventListener('click', function () {
                const selectedCategory = this.dataset.category;

                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // Filter articles
                articles.forEach(article => {
                    if (selectedCategory === 'all') {
                        article.classList.remove('hidden');
                    } else {
                        const articleCategories = article.dataset.categories.split(' ');
                        if (articleCategories.includes(selectedCategory)) {
                            article.classList.remove('hidden');
                        } else {
                            article.classList.add('hidden');
                        }
                    }
                });
            });
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-abonnements.php ---
<?php
/*
Template Name: Page Abonnements
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">
                Des tarifs simples et <span class="text-oblink-blue">transparents</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Que vous soyez Opticien ou Magasin, choisissez la formule adaptée à vos besoins. Sans engagement,
                annulable à tout moment.
            </p>

            <!-- Toggle Switch (Visual Only for now) -->
            <div class="flex justify-center mt-10">
                <div class="bg-white p-1 rounded-xl border border-gray-200 inline-flex shadow-sm">
                    <button
                        class="px-6 py-2 rounded-lg bg-oblink-gray text-white font-bold text-sm shadow-md transition">Pour
                        Magasins</button>
                    <button
                        class="px-6 py-2 rounded-lg text-gray-500 font-bold text-sm hover:bg-gray-50 transition">Pour
                        Opticiens</button>
                </div>
            </div>
        </div>

        <!-- Pricing Cards -->
        <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto items-center">

            <!-- Plan Découverte -->
            <div
                class="bg-white rounded-3xl p-8 border border-gray-100 shadow-xl hover:shadow-2xl transition hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-gray-50 rounded-bl-full -mr-16 -mt-16 z-0"></div>

                <h3 class="text-2xl font-bold text-oblink-gray mb-2 relative z-10">Découverte</h3>
                <p class="text-gray-400 text-sm mb-6 relative z-10">Pour tester la plateforme.</p>

                <div class="flex items-baseline mb-8 relative z-10">
                    <span class="text-5xl font-black text-oblink-gray">0€</span>
                </div>

                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="block w-full py-3 bg-gray-100 text-oblink-gray font-bold text-center rounded-xl hover:bg-gray-200 transition mb-8">
                    Commencer
                </a>

                <ul class="space-y-4 text-sm text-gray-600 relative z-10">
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>1 Offre d'emploi active</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>Visibilité standard</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-green-500"></i>
                        <span>Commission standard (15%)</span>
                    </li>
                    <li class="flex items-center gap-3 text-gray-400">
                        <i class="fas fa-times"></i>
                        <span class="line-through">Accès CV-thèque</span>
                    </li>
                    <li class="flex items-center gap-3 text-gray-400">
                        <i class="fas fa-times"></i>
                        <span class="line-through">Support prioritaire</span>
                    </li>
                </ul>
            </div>

            <!-- Plan Premium (Featured) -->
            <div
                class="bg-oblink-gray text-white rounded-3xl p-8 border border-oblink-gray shadow-2xl relative transform md:scale-110 z-10">
                <div
                    class="absolute top-0 right-0 bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-bl-xl uppercase tracking-wider">
                    Populaire</div>

                <h3 class="text-2xl font-bold mb-2">Premium</h3>
                <p class="text-white/60 text-sm mb-6">Pour les recrutements réguliers.</p>

                <div class="flex items-baseline mb-8">
                    <span class="text-6xl font-black text-white">49€</span>
                    <span class="text-white/60 ml-2">/mois</span>
                </div>

                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="block w-full py-4 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold text-center rounded-xl hover:shadow-lg transition hover:scale-105 mb-8">
                    Choisir Premium
                </a>

                <ul class="space-y-4 text-sm text-gray-300">
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span class="font-bold text-white">Offres Illimitées</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span class="font-bold text-white">Accès complet CV-thèque</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Commission réduite (10%)</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Badge "Recruteur Vérifié"</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-oblink-blue flex items-center justify-center text-xs"><i
                                class="fas fa-check text-white"></i></div>
                        <span>Support dédié 7j/7</span>
                    </li>
                </ul>
            </div>

            <!-- Plan Corporate -->
            <div
                class="bg-white rounded-3xl p-8 border border-gray-100 shadow-xl hover:shadow-2xl transition hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-32 h-32 bg-oblink-blue/5 rounded-br-full -ml-16 -mt-16 z-0"></div>

                <h3 class="text-2xl font-bold text-oblink-gray mb-2 relative z-10">Corporate</h3>
                <p class="text-gray-400 text-sm mb-6 relative z-10">Pour les réseaux > 5 magasins.</p>

                <div class="flex items-baseline mb-8 relative z-10">
                    <span class="text-4xl font-black text-oblink-gray">Sur Mesure</span>
                </div>

                <a href="<?php echo home_url('/contact'); ?>"
                    class="block w-full py-3 bg-white border-2 border-oblink-gray text-oblink-gray font-bold text-center rounded-xl hover:bg-oblink-gray hover:text-white transition mb-8">
                    Contactez-nous
                </a>

                <ul class="space-y-4 text-sm text-gray-600 relative z-10">
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Compte Multi-utilisateurs</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Facturation centralisée</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>API de connexion RH</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-oblink-blue"></i>
                        <span>Account Manager dédié</span>
                    </li>
                </ul>
            </div>

        </div>

    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-contactologie.php ---
<?php
/*
Template Name: Calculateur Contactologie
*/
include 'header-inc.php';

// -----------------------------------------------------------------------------
// 1. DATA SOURCE (V40 Style + Expanded)
// -----------------------------------------------------------------------------
$lenses_db = [
    // === ALCON ===
    ['make' => 'Alcon', 'name' => 'Dailies Total 1', 'type' => 'daily', 'h2o' => '33%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Confort ultime. Matériau à gradient d\'eau (>80% surf).'],
    ['make' => 'Alcon', 'name' => 'Precision 1', 'type' => 'daily', 'h2o' => '51%', 'modality' => 'daily', 'bc' => [8.3, 8.7], 'toric' => true, 'multifocal' => false, 'dry_eye' => false, 'desc' => 'Excellent rapport qualité/prix.'],
    ['make' => 'Alcon', 'name' => 'Dailies AquaComfort Plus', 'type' => 'daily', 'h2o' => '69%', 'modality' => 'daily', 'bc' => [8.7], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'Entrée de gamme hydrogel.'],
    ['make' => 'Alcon', 'name' => 'Air Optix Plus HydraGlyde', 'type' => 'monthly', 'h2o' => '33%', 'modality' => 'monthly', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Résiste aux dépôts.'],

    // === JOHNSON & JOHNSON ===
    ['make' => 'J&J', 'name' => 'Acuvue Oasys 1-Day', 'type' => 'daily', 'h2o' => '38%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => false, 'dry_eye' => true, 'desc' => 'Technologie HydraLuxe. Top écrans.'],
    ['make' => 'J&J', 'name' => 'Acuvue Moist 1-Day', 'type' => 'daily', 'h2o' => '58%', 'modality' => 'daily', 'bc' => [8.5, 9.0], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'L\'entrée de gamme multifocale historique.'],
    ['make' => 'J&J', 'name' => 'Acuvue Oasys', 'type' => 'biweekly', 'h2o' => '38%', 'modality' => 'biweekly', 'bc' => [8.4, 8.8], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Le standard mondial.'],

    // === COOPERVISION ===
    ['make' => 'Cooper', 'name' => 'MyDay', 'type' => 'daily', 'h2o' => '54%', 'modality' => 'daily', 'bc' => [8.4], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'Smart Silicone. Très souple.'],
    ['make' => 'Cooper', 'name' => 'Biofinity', 'type' => 'monthly', 'h2o' => '48%', 'modality' => 'monthly', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'La référence absolue. Gamme XR dispo.'],
    ['make' => 'Cooper', 'name' => 'Clariti 1 Day', 'type' => 'daily', 'h2o' => '56%', 'modality' => 'daily', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => false, 'desc' => 'SiHy abordable.'],

    // === BAUSCH ===
    ['make' => 'B&L', 'name' => 'Biotrue ONEday', 'type' => 'daily', 'h2o' => '78%', 'modality' => 'daily', 'bc' => [8.6], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'Bio-inspirée. 78% d\'eau.'],
    ['make' => 'B&L', 'name' => 'Ultra', 'type' => 'monthly', 'h2o' => '46%', 'modality' => 'monthly', 'bc' => [8.5], 'toric' => true, 'multifocal' => true, 'dry_eye' => true, 'desc' => 'MoistureSeal Technology.'],
];


// -----------------------------------------------------------------------------
// 2. OPTICAL ENGINE (Expert Mode)
// -----------------------------------------------------------------------------
function calculate_vertex($pwr)
{
    if (abs($pwr) < 4.00)
        return $pwr;
    return $pwr / (1 - (0.012 * $pwr)); // Precision calc
}

function process_eye_expert($sphere, $cyl, $axe, $add, $k1, $k2, $modality, $dry, $db)
{
    if ($sphere === '')
        return null;

    $S = floatval($sphere);
    $C = floatval($cyl);
    $A = intval($axe);
    $Add = floatval($add);
    $K1 = floatval($k1);
    $K2 = floatval($k2);

    // --- 1. DESIGN TYPE ---
    $is_multifocal = ($Add >= 0.75);
    $is_toric = (abs($C) >= 0.75);

    $design_label = 'Sphérique';
    if ($is_toric)
        $design_label = 'Torique';
    if ($is_multifocal)
        $design_label = ($is_toric ? 'Torique ' : '') . 'Multifocale';

    // --- 2. POWER CALCULATION ---
    $final_sphere = 0;
    $final_cyl = 0;

    if ($is_toric) {
        // FULL TORIC CALCULATION (Vertex on both meridians)
        $M1 = $S; // First meridian power
        $M2 = $S + $C; // Second meridian power

        $M1_v = calculate_vertex($M1);
        $M2_v = calculate_vertex($M2);

        $final_sphere = round($M1_v * 4) / 4; // Round to 0.25
        $final_cyl = round(($M2_v - $M1_v) * 4) / 4; // Cyl is diff
    } else {
        // SPHERICAL EQUIVALENT (Low Astigmatism)
        // Rule: Sphere + (Cyl / 2) -> Then Vertex
        $SE = $S + ($C / 2);
        $final_sphere = round(calculate_vertex($SE) * 4) / 4;
        $final_cyl = 0;
    }

    // --- 3. BC CALCULATION ---
    $bc_target = 8.6;
    if ($K1 && $K2) {
        $avg_k = ($K1 + $K2) / 2;
        $bc_target = round($avg_k + 0.8, 1);
    }

    // --- 4. FILTERING ---
    $picks = [];
    foreach ($db as $lens) {
        if ($lens['modality'] !== $modality)
            continue;

        // STRICT CAPABILITY CHECK
        if ($is_toric && !$lens['toric'])
            continue;
        if ($is_multifocal && !$lens['multifocal'])
            continue;

        // BC FIT
        $fit = false;
        foreach ($lens['bc'] as $b) {
            if (abs($b - $bc_target) <= 0.35)
                $fit = true;
        }
        if (!$fit)
            continue;

        // Scoring
        $score = 10;
        if ($dry && $lens['dry_eye'])
            $score += 20;
        $lens['score'] = $score;
        $picks[] = $lens;
    }

    usort($picks, function ($a, $b) {
        return $b['score'] <=> $a['score'];
    });

    return [
        'pwr_display' => ($final_sphere > 0 ? '+' : '') . number_format($final_sphere, 2),
        'cyl_display' => $is_toric ? number_format($final_cyl, 2) : null,
        'axe_display' => $is_toric ? $A : null,
        'is_se' => (!$is_toric && abs($C) > 0), // Flag: Is Spherical Equivalent used?
        'bc' => $bc_target,
        'design' => $design_label,
        'picks' => $picks
    ];
}

$od_res = null;
$og_res = null;
$posted = false;

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $posted = true;
    $dry = isset($_POST['dry_eye']);
    $mod = $_POST['modality'];

    // Check if COPY G to D is active (or user clicked "Identique") 
    // Handled by JS on frontend to fill values, but backend processes what it receives.

    $od_res = process_eye_expert($_POST['od_s'], $_POST['od_c'], $_POST['od_a'], $_POST['od_add'], $_POST['od_k1'], $_POST['od_k2'], $mod, $dry, $lenses_db);
    $og_res = process_eye_expert($_POST['og_s'], $_POST['og_c'], $_POST['og_a'], $_POST['og_add'], $_POST['og_k1'], $_POST['og_k2'], $mod, $dry, $lenses_db);
}
?>

<div class="min-h-screen bg-gray-50 pt-28 pb-20">
    <div class="max-w-[1400px] mx-auto px-4">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-3xl font-black font-display text-oblink-gray">
                Calculateur <span class="text-oblink-orange">Lentilles Pro</span>
            </h1>
        </div>

        <!-- FORMULAIRE STYLE OPTIEXPERT -->
        <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100 mb-12 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-oblink-blue to-oblink-orange"></div>

            <form method="POST" action="">
                <!-- CONTROLS TOP -->
                <div class="mb-8 border-b border-gray-100 pb-6 space-y-4">
                    <div class="flex flex-wrap gap-4 items-center">
                        <label
                            class="flex items-center gap-2 cursor-pointer bg-gray-50 px-4 py-2 rounded-lg border border-gray-200 hover:border-oblink-orange transition">
                            <input type="checkbox" name="dry_eye"
                                class="text-oblink-orange focus:ring-oblink-orange rounded" <?php echo isset($_POST['dry_eye']) ? 'checked' : ''; ?>>
                            <span class="font-bold text-gray-700">Sécheresse Oculaire</span>
                        </label>
                        <select name="modality"
                            class="px-4 py-2 bg-gray-50 rounded-lg font-bold border border-gray-200 outline-none focus:border-oblink-orange">
                            <option value="daily" <?php echo ($_POST['modality'] ?? '') === 'daily' ? 'selected' : ''; ?>>
                                Journalières (Daily)</option>
                            <option value="monthly" <?php echo ($_POST['modality'] ?? '') === 'monthly' ? 'selected' : ''; ?>>Mensuelles (Monthly)</option>
                            <option value="biweekly" <?php echo ($_POST['modality'] ?? '') === 'biweekly' ? 'selected' : ''; ?>>Bi-mensuelles</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="w-full md:w-auto bg-oblink-gray text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition transform hover:-translate-y-0.5">
                        Calculer l'équipement
                    </button>
                </div>

                <div class="grid lg:grid-cols-2 gap-16 relative">
                    <!-- SEPARATOR LINE -->
                    <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px bg-gray-100 -ml-px"></div>

                    <!-- OD COL -->
                    <div>
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-10 h-10 rounded-full bg-oblink-blue text-white flex items-center justify-center font-bold text-lg shadow-md shadow-blue-200">
                                D</div>
                            <h3 class="text-xl font-bold text-oblink-blue">Œil Droit</h3>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Sphère</label>
                                    <input type="number" step="0.25" placeholder="-2.00" name="od_s"
                                        value="<?php echo $_POST['od_s'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Cylindre</label>
                                    <input type="number" step="0.25" placeholder="-0.75" name="od_c"
                                        value="<?php echo $_POST['od_c'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Axe °</label>
                                    <input type="number" placeholder="180" name="od_a"
                                        value="<?php echo $_POST['od_a'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-1 border-r border-gray-100 pr-4">
                                    <label
                                        class="text-xs font-bold text-oblink-blue uppercase mb-1 block">Addition</label>
                                    <input type="number" step="0.25" placeholder="+2.00" name="od_add"
                                        value="<?php echo $_POST['od_add'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-blue-50/50 border border-blue-100 rounded-lg text-lg font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K1
                                        (Plat)</label>
                                    <input type="number" step="0.01" placeholder="7.80" name="od_k1"
                                        value="<?php echo $_POST['od_k1'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K2
                                        (Cambré)</label>
                                    <input type="number" step="0.01" placeholder="7.60" name="od_k2"
                                        value="<?php echo $_POST['od_k2'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-blue outline-none transition">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OG COL -->
                    <div>
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-oblink-orange text-white flex items-center justify-center font-bold text-lg shadow-md shadow-orange-200">
                                    G</div>
                                <h3 class="text-xl font-bold text-oblink-orange">Œil Gauche</h3>
                            </div>
                            <label
                                class="flex items-center gap-2 cursor-pointer text-sm text-gray-500 hover:text-oblink-orange">
                                <input type="checkbox" id="copy_od"
                                    class="rounded text-oblink-orange focus:ring-oblink-orange" onclick="copyODtoOG()">
                                Copier OD
                            </label>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Sphère</label>
                                    <input type="number" step="0.25" placeholder="-2.00" name="og_s" id="og_s"
                                        value="<?php echo $_POST['og_s'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Cylindre</label>
                                    <input type="number" step="0.25" placeholder="-0.75" name="og_c" id="og_c"
                                        value="<?php echo $_POST['og_c'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Axe °</label>
                                    <input type="number" placeholder="180" name="og_a" id="og_a"
                                        value="<?php echo $_POST['og_a'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-1 border-r border-gray-100 pr-4">
                                    <label
                                        class="text-xs font-bold text-oblink-orange uppercase mb-1 block">Addition</label>
                                    <input type="number" step="0.25" placeholder="+2.00" name="og_add" id="og_add"
                                        value="<?php echo $_POST['og_add'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-orange-50/50 border border-orange-100 rounded-lg text-lg font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K1
                                        (Plat)</label>
                                    <input type="number" step="0.01" placeholder="7.80" name="og_k1" id="og_k1"
                                        value="<?php echo $_POST['og_k1'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">K2
                                        (Cambré)</label>
                                    <input type="number" step="0.01" placeholder="7.60" name="og_k2" id="og_k2"
                                        value="<?php echo $_POST['og_k2'] ?? ''; ?>"
                                        class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-sm font-mono focus:border-oblink-orange outline-none transition">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <?php if ($posted): ?>
            <div class="grid lg:grid-cols-2 gap-8">

                <!-- RESULT OD -->
                <?php if ($od_res): ?>
                    <div>
                        <div
                            class="bg-oblink-blue/10 rounded-t-2xl p-4 border-b border-oblink-blue/20 flex justify-between items-center">
                            <h3 class="font-black text-oblink-blue text-lg">LENTILLES DROITES (OD)</h3>
                            <div class="flex flex-col items-end">
                                <span class="text-2xl font-mono font-bold text-oblink-blue leading-none">
                                    <?php echo $od_res['pwr_display']; ?>
                                    <?php if ($od_res['cyl_display'])
                                        echo '<span class="text-lg text-gray-600">(' . $od_res['cyl_display'] . ')</span> ' . $od_res['axe_display'] . '°'; ?>
                                </span>
                                <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 mt-1">
                                    BC: <?php echo $od_res['bc']; ?> • <?php echo $od_res['design']; ?>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white rounded-b-2xl shadow-lg border border-gray-100 p-6 space-y-4">
                            <?php if ($od_res['is_se']): ?>
                                <div class="p-3 bg-yellow-50 text-yellow-800 text-xs rounded-lg mb-4 flex gap-2">
                                    <i class="fas fa-info-circle mt-0.5"></i>
                                    <div>Astigmatisme faible (<0.75). La puissance a été convertie en <b>Équivalent Sphérique</b>
                                            (Sph + Cyl/2) pour optimiser la vision.</div>
                                </div>
                            <?php endif; ?>

                            <?php foreach ($od_res['picks'] as $p): ?>
                                <div
                                    class="flex items-start gap-4 p-4 border border-gray-100 rounded-xl hover:shadow-md transition group bg-white">
                                    <div
                                        class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center font-bold text-gray-300 text-xl group-hover:bg-oblink-blue group-hover:text-white transition">
                                        <?php echo substr($p['make'], 0, 1); ?>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800 text-lg"><?php echo $p['name']; ?></h4>
                                        <p class="text-sm text-gray-500 mb-2"><?php echo $p['make']; ?> • <?php echo $p['h2o']; ?>
                                            H2O</p>
                                        <p class="text-xs text-oblink-blue italic bg-blue-50 inline-block px-2 py-1 rounded">
                                            <?php echo $p['desc']; ?>
                                        </p>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endif; ?>

                <!-- RESULT OG -->
                <?php if ($og_res): ?>
                    <div>
                        <div
                            class="bg-oblink-orange/10 rounded-t-2xl p-4 border-b border-oblink-orange/20 flex justify-between items-center">
                            <h3 class="font-black text-oblink-orange text-lg">LENTILLES GAUCHES (OG)</h3>
                            <div class="flex flex-col items-end">
                                <span class="text-2xl font-mono font-bold text-oblink-orange leading-none">
                                    <?php echo $og_res['pwr_display']; ?>
                                    <?php if ($og_res['cyl_display'])
                                        echo '<span class="text-lg text-gray-600">(' . $og_res['cyl_display'] . ')</span> ' . $og_res['axe_display'] . '°'; ?>
                                </span>
                                <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 mt-1">
                                    BC: <?php echo $og_res['bc']; ?> • <?php echo $og_res['design']; ?>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white rounded-b-2xl shadow-lg border border-gray-100 p-6 space-y-4">
                            <?php if ($og_res['is_se']): ?>
                                <div class="p-3 bg-yellow-50 text-yellow-800 text-xs rounded-lg mb-4 flex gap-2">
                                    <i class="fas fa-info-circle mt-0.5"></i>
                                    <div>Astigmatisme faible (<0.75). La puissance a été convertie en <b>Équivalent Sphérique</b>
                                            (Sph + Cyl/2) pour optimiser la vision.</div>
                                </div>
                            <?php endif; ?>

                            <?php foreach ($og_res['picks'] as $p): ?>
                                <div
                                    class="flex items-start gap-4 p-4 border border-gray-100 rounded-xl hover:shadow-md transition group bg-white">
                                    <div
                                        class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center font-bold text-gray-300 text-xl group-hover:bg-oblink-orange group-hover:text-white transition">
                                        <?php echo substr($p['make'], 0, 1); ?>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800 text-lg"><?php echo $p['name']; ?></h4>
                                        <p class="text-sm text-gray-500 mb-2"><?php echo $p['make']; ?> • <?php echo $p['h2o']; ?>
                                            H2O</p>
                                        <p class="text-xs text-oblink-orange italic bg-orange-50 inline-block px-2 py-1 rounded">
                                            <?php echo $p['desc']; ?>
                                        </p>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endif; ?>

            </div>
        <?php endif; ?>
    </div>
</div>

<script>
    function copyODtoOG() {
        if (document.getElementById('copy_od').checked) {
            document.getElementById('og_s').value = document.getElementsByName('od_s')[0].value;
            document.getElementById('og_c').value = document.getElementsByName('od_c')[0].value;
            document.getElementById('og_a').value = document.getElementsByName('od_a')[0].value;
            document.getElementById('og_add').value = document.getElementsByName('od_add')[0].value;
            document.getElementById('og_k1').value = document.getElementsByName('od_k1')[0].value;
            document.getElementById('og_k2').value = document.getElementsByName('od_k2')[0].value;
        }
    }

    // Mobile Accordion Toggle
    const toggleBtn = document.getElementById('toggle-calculator');
    const calcFields = document.getElementById('calculator-fields');
    const toggleIcon = document.getElementById('toggle-icon');

    if (toggleBtn) {
        toggleBtn.addEventListener('click', function () {
            calcFields.classList.toggle('hidden');
            calcFields.classList.toggle('grid');
            toggleIcon.classList.toggle('rotate-180');

            if (calcFields.classList.contains('hidden')) {
                toggleBtn.querySelector('span').textContent = 'Afficher les champs de saisie';
            } else {
                toggleBtn.querySelector('span').textContent = 'Masquer les champs de saisie';
            }
        });
    }
   });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/404.php ---
<?php
/**
 * Template Name: 404 Error Page
 */
include 'header-inc.php';
?>

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">

        <!-- 404 Illustration -->
        <div class="mb-8">
            <div class="inline-flex items-center justify-center w-32 h-32 rounded-full bg-oblink-blue/10 mb-6">
                <svg class="w-16 h-16 text-oblink-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>

            <h1 class="text-6xl md:text-8xl font-bold font-display text-oblink-blue mb-4">404</h1>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4">Page non trouvée</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">
                Désolé, la page que vous recherchez n'existe pas ou a été déplacée.
                Utilisez les liens ci-dessous pour continuer votre navigation.
            </p>
        </div>

        <!-- Quick Navigation Cards -->
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto mb-12">

            <!-- Home -->
            <a href="<?php echo home_url('/'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-oblink-blue transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-oblink-blue/10 flex items-center justify-center mb-4 mx-auto group-hover:bg-oblink-blue/20 transition">
                    <i class="fas fa-home text-oblink-blue text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Accueil</h3>
                <p class="text-sm text-gray-500">Retour à l'accueil</p>
            </a>

            <!-- Job Offers -->
            <a href="<?php echo home_url('/emploi-opticien'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-oblink-orange transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-oblink-orange/10 flex items-center justify-center mb-4 mx-auto group-hover:bg-oblink-orange/20 transition">
                    <i class="fas fa-briefcase text-oblink-orange text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Offres d'Emploi</h3>
                <p class="text-sm text-gray-500">Voir les missions</p>
            </a>

            <!-- Blog -->
            <a href="<?php echo home_url('/blog'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-purple-500 transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center mb-4 mx-auto group-hover:bg-purple-200 transition">
                    <i class="fas fa-newspaper text-purple-600 text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Blog</h3>
                <p class="text-sm text-gray-500">Actualités & conseils</p>
            </a>

            <!-- Contact -->
            <a href="<?php echo home_url('/contact'); ?>"
                class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-green-500 transition-all duration-300">
                <div
                    class="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center mb-4 mx-auto group-hover:bg-green-200 transition">
                    <i class="fas fa-envelope text-green-600 text-xl"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1">Contact</h3>
                <p class="text-sm text-gray-500">Besoin d'aide ?</p>
            </a>
        </div>

        <!-- Search Bar (Optional) -->
        <div class="max-w-xl mx-auto">
            <div class="bg-white rounded-full shadow-sm border border-gray-200 p-2 flex items-center gap-3">
                <i class="fas fa-search text-gray-400 ml-4"></i>
                <input type="text" id="search-404" placeholder="Rechercher sur OBLINK..."
                    class="flex-1 px-2 py-2 text-gray-900 placeholder-gray-400 focus:outline-none" />
                <button onclick="performSearch()"
                    class="px-6 py-2 bg-oblink-blue text-white font-semibold rounded-full hover:bg-oblink-blue/90 transition">
                    Rechercher
                </button>
            </div>
        </div>

        <!-- Back Button -->
        <div class="mt-12">
            <button onclick="history.back()"
                class="inline-flex items-center gap-2 text-oblink-blue hover:text-oblink-blue/80 font-semibold transition">
                <i class="fas fa-arrow-left"></i>
                <span>Retour à la page précédente</span>
            </button>
        </div>
    </div>
</div>

<script>
    function performSearch() {
        const searchInput = document.getElementById('search-404');
        const query = searchInput.value.trim();

        if (query) {
            // Redirect to blog search or homepage with query
            window.location.href = '<?php echo home_url('/blog'); ?>?s=' + encodeURIComponent(query);
        }
    }

    // Allow Enter key to search
    document.getElementById('search-404')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-mission-detail.php ---
<?php
/*
Template Name: Mission Detail
*/
include 'header-inc.php';

// Get job ID from URL parameter
$job_id = isset($_GET['id']) ? sanitize_text_field($_GET['id']) : null;
?>

<!-- Loading State -->
<div id="loading-state" class="min-h-screen bg-gray-50 pt-32 flex items-center justify-center">
    <div class="text-center">
        <i class="fas fa-circle-notch fa-spin text-4xl text-oblink-blue mb-4"></i>
        <p class="text-gray-500">Chargement de l'offre...</p>
    </div>
</div>

<!-- Job Detail Content (Hidden initially) -->
<div id="job-detail" class="min-h-screen bg-gray-50 pt-32 pb-20 hidden">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Back Button -->
        <a href="<?php echo home_url('/emploi-opticien'); ?>"
            class="inline-flex items-center text-gray-600 hover:text-oblink-blue mb-6 transition">
            <i class="fas fa-arrow-left mr-2"></i> Retour aux offres
        </a>

        <!-- Job Card -->
        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">

            <!-- Header with Company -->
            <div class="bg-gradient-to-r from-oblink-blue/10 to-oblink-violet/10 p-8">
                <div class="flex items-start gap-6">
                    <div id="company-logo"
                        class="w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-bold border-2 border-white shadow-lg">
                        <!-- Dynamically filled -->
                    </div>
                    <div class="flex-1">
                        <h1 id="job-title" class="text-3xl font-bold text-oblink-gray mb-2">
                            <!-- Dynamically filled -->
                        </h1>
                        <p id="company-name" class="text-lg text-gray-600">
                            <!-- Dynamically filled -->
                        </p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons (Sticky on scroll) -->
            <div id="action-bar" class="sticky top-20 z-30 bg-white border-b border-gray-100 p-6 flex gap-3">
                <!-- Dynamically filled based on auth -->
            </div>

            <!-- Job Details -->
            <div class="p-8 space-y-8">

                <!-- Key Info Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded-xl">
                        <i class="fas fa-map-marker-alt text-oblink-blue text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Localisation</p>
                        <p id="job-city" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-xl">
                        <i class="fas fa-euro-sign text-green-600 text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Rémunération</p>
                        <p id="job-salary" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-xl">
                        <i class="fas fa-file-contract text-purple-600 text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Type</p>
                        <p id="job-contract" class="font-bold text-oblink-gray">-</p>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-xl">
                        <i class="fas fa-calendar-alt text-oblink-orange text-xl mb-2"></i>
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Début</p>
                        <p id="job-start-date" class="font-bold text-oblink-gray">-</p>
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <h2 class="text-2xl font-bold text-oblink-gray mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-oblink-blue"></i> Description du poste
                    </h2>
                    <div id="job-description" class="prose prose-gray max-w-none text-gray-700 leading-relaxed">
                        <!-- Dynamically filled -->
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-lg text-oblink-gray mb-3">📍 Détails du contrat</h3>
                        <ul class="space-y-2 text-gray-600">
                            <li id="job-duration"><!-- Dynamically filled --></li>
                            <li id="job-hours"><!-- Dynamically filled --></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-oblink-gray mb-3">✨ Avantages</h3>
                        <div id="job-benefits" class="space-y-2 text-gray-600">
                            <!-- Dynamically filled -->
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Contact Section (for messaging later) -->
        <div id="contact-section" class="mt-6 hidden">
            <!-- Will be implemented in v2 -->
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const jobId = '<?php echo $job_id; ?>';
        const loadingState = document.getElementById('loading-state');
        const jobDetail = document.getElementById('job-detail');

        if (!jobId) {
            loadingState.innerHTML = '<p class="text-red-500">ID de mission manquant</p>';
            return;
        }

        try {
            // Get current user
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            const currentUser = session?.user || null;

            // Fetch job details (simplified query - no JOIN)
            const { data: job, error } = await window.oblinkSupabase
                .from('offers')
                .select('*')
                .eq('id', jobId)
                .single();

            if (error) throw error;
            if (!job) throw new Error('Offre introuvable');

            console.log('Job loaded:', job);

            // Populate job details
            document.getElementById('job-title').textContent = job.title;
            document.getElementById('company-name').textContent = job.company_name || 'Entreprise confidentielle';
            document.getElementById('job-city').textContent = job.city || 'Non spécifié';
            document.getElementById('job-salary').textContent = job.daily_rate ? `${job.daily_rate}€/jour` : 'À négocier';
            document.getElementById('job-contract').textContent = job.contract_type?.toUpperCase() || 'Non spécifié';
            document.getElementById('job-start-date').textContent = job.start_date ?
                new Date(job.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) :
                'Dès que possible';
            document.getElementById('job-description').textContent = job.description || 'Aucune description disponible.';

            // Company logo
            const letter = job.company_name?.charAt(0) || 'O';
            const colors = ['bg-blue-100 text-blue-600', 'bg-purple-100 text-purple-600', 'bg-orange-100 text-orange-600'];
            const colorClass = colors[job.title.length % 3];
            document.getElementById('company-logo').className = `w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-bold border-2 border-white shadow-lg ${colorClass}`;
            document.getElementById('company-logo').textContent = letter;

            // Duration & Hours
            document.getElementById('job-duration').innerHTML = `<i class="fas fa-clock text-oblink-blue mr-2"></i> Durée: ${job.duration || 'Indéterminée'}`;
            document.getElementById('job-hours').innerHTML = `<i class="fas fa-hourglass-half text-oblink-blue mr-2"></i> Temps de travail: ${job.work_hours || '35h/semaine'}`;

            // Benefits
            const benefits = job.benefits || 'Avantages standards';
            document.getElementById('job-benefits').innerHTML = `<p>${benefits}</p>`;

            // Action buttons
            const actionBar = document.getElementById('action-bar');
            if (currentUser) {
                // Check if already applied
                const { data: existingApp } = await window.oblinkSupabase
                    .from('applications')
                    .select('id')
                    .eq('offer_id', jobId)
                    .eq('opticien_id', currentUser.id)
                    .single();

                if (existingApp) {
                    actionBar.innerHTML = `
                    <button class="flex-1 px-6 py-4 bg-green-100 text-green-700 font-bold rounded-xl cursor-default flex items-center justify-center gap-2">
                        <i class="fas fa-check-circle"></i> Déjà postulé
                    </button>
                `;
                } else {
                    actionBar.innerHTML = `
                    <button onclick="applyToJob('${jobId}')" 
                            class="flex-1 px-6 py-4 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition shadow-lg flex items-center justify-center gap-2">
                        <i class="fas fa-paper-plane"></i> Postuler maintenant
                    </button>
                    <button onclick="contactCompany()" 
                            class="px-6 py-4 bg-white border-2 border-oblink-blue text-oblink-blue font-bold rounded-xl hover:bg-blue-50 transition flex items-center justify-center gap-2">
                        <i class="fas fa-envelope"></i> Contacter
                    </button>
                `;
                }
            } else {
                actionBar.innerHTML = `
                <a href="<?php echo home_url('/login'); ?>?redirect=/mission-detail?id=${jobId}" 
                   class="flex-1 px-6 py-4 bg-oblink-gray text-white font-bold rounded-xl hover:bg-gray-800 transition shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-lock"></i> Connectez-vous pour postuler
                </a>
            `;
            }

            // Show content
            loadingState.classList.add('hidden');
            jobDetail.classList.remove('hidden');

        } catch (error) {
            console.error('Error loading job:', error);
            loadingState.innerHTML = `<p class="text-red-500">Erreur: ${error.message}</p>`;
        }
    });

    // Apply function
    window.applyToJob = async function (jobId) {
        try {
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            if (!session) throw new Error("Non connecté");

            const { error } = await window.oblinkSupabase
                .from('applications')
                .insert([{
                    offer_id: jobId,
                    opticien_id: session.user.id,
                    status: 'pending'
                }]);

            if (error) throw error;

            alert('✅ Candidature envoyée avec succès !');
            location.reload();

        } catch (error) {
            console.error('Apply error:', error);
            alert('Erreur: ' + error.message);
        }
    }

    // Contact function (placeholder)
    window.contactCompany = function () {
        alert('📧 Fonctionnalité de messagerie disponible prochainement !');
    }
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-contact.php ---
<?php
/**
 * Template Name: Contact
 */
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-12">
            <div
                class="inline-block px-3 py-1 bg-oblink-blue/10 text-oblink-blue font-bold rounded-full text-xs uppercase tracking-wider mb-3">
                Contact & Support
            </div>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Nous sommes là pour vous aider
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Une question ? Besoin d'assistance ? Notre équipe vous répondra dans les plus brefs délais.
            </p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">

            <!-- Contact Form -->
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Envoyez-nous un message</h2>

                <form id="contact-form" class="space-y-5">

                    <!-- Honeypot (Anti-spam) -->
                    <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

                    <!-- Name -->
                    <div class="form-group">
                        <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                            Nom complet <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="name" name="name" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none"
                            placeholder="Jean Dupont" />
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                            Email <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="email" name="email" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none"
                            placeholder="jean.dupont@example.com" />
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Subject -->
                    <div class="form-group">
                        <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">
                            Sujet <span class="text-red-500">*</span>
                        </label>
                        <select id="subject" name="subject" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Choisissez un sujet...</option>
                            <option value="support">Support technique</option>
                            <option value="partnership">Partenariat</option>
                            <option value="billing">Facturation & Abonnements</option>
                            <option value="general">Question générale</option>
                            <option value="feedback">Suggestion / Feedback</option>
                        </select>
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Message -->
                    <div class="form-group">
                        <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">
                            Message <span class="text-red-500">*</span>
                        </label>
                        <textarea id="message" name="message" required rows="6"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none resize-none"
                            placeholder="Décrivez votre demande en détail..."></textarea>
                        <span class="error-message text-red-500 text-sm mt-1 hidden"></span>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submit-btn"
                        class="w-full px-6 py-4 bg-oblink-blue text-white font-bold rounded-xl hover:bg-oblink-blue/90 transition-all duration-300 shadow-lg shadow-oblink-blue/20 flex items-center justify-center gap-2">
                        <span id="btn-text">Envoyer le message</span>
                        <i class="fas fa-paper-plane" id="btn-icon"></i>
                    </button>
                </form>

                <!-- Success/Error Messages -->
                <div id="form-success" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-green-600 text-xl mt-0.5"></i>
                        <div>
                            <h3 class="font-bold text-green-900 mb-1">Message envoyé !</h3>
                            <p class="text-sm text-green-700">Nous vous répondrons dans les 24-48 heures.</p>
                        </div>
                    </div>
                </div>

                <div id="form-error" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-circle text-red-600 text-xl mt-0.5"></i>
                        <div>
                            <h3 class="font-bold text-red-900 mb-1">Erreur d'envoi</h3>
                            <p class="text-sm text-red-700" id="error-text">Une erreur est survenue. Veuillez réessayer.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Info & FAQ -->
            <div class="space-y-6">

                <!-- Contact Info Card -->
                <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Autres moyens de contact</h3>

                    <!-- Email -->
                    <div class="flex items-start gap-4 mb-5">
                        <div
                            class="w-10 h-10 rounded-xl bg-oblink-blue/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-envelope text-oblink-blue"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-1">Email</h4>
                            <a href="mailto:contact@oblink.fr" class="text-oblink-blue hover:underline">
                                contact@oblink.fr
                            </a>
                            <p class="text-sm text-gray-500 mt-1">Réponse sous 24-48h</p>
                        </div>
                    </div>

                    <!-- Support -->
                    <div class="flex items-start gap-4">
                        <div
                            class="w-10 h-10 rounded-xl bg-oblink-orange/10 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-life-ring text-oblink-orange"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-1">Support</h4>
                            <p class="text-gray-600 text-sm">
                                Consultez notre <a href="<?php echo home_url('/blog'); ?>"
                                    class="text-oblink-blue hover:underline">blog</a>
                                pour des guides et tutoriels.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Quick FAQ -->
                <div class="bg-gradient-to-br from-oblink-blue to-blue-600 rounded-3xl p-8 text-white">
                    <h3 class="text-xl font-bold mb-4">Questions fréquentes</h3>

                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-1">Combien de temps pour une réponse ?</h4>
                            <p class="text-sm text-blue-100">Nous répondons sous 24-48 heures ouvrées.</p>
                        </div>

                        <div>
                            <h4 class="font-semibold mb-1">Comment modifier mon abonnement ?</h4>
                            <p class="text-sm text-blue-100">
                                Connectez-vous à votre <a href="<?php echo home_url('/dashboard-entreprise'); ?>"
                                    class="underline hover:text-white">espace entreprise</a>.
                            </p>
                        </div>

                        <div>
                            <h4 class="font-semibold mb-1">Problème de connexion ?</h4>
                            <p class="text-sm text-blue-100">
                                Utilisez la récupération de mot de passe sur la <a
                                    href="<?php echo home_url('/login'); ?>" class="underline hover:text-white">page de
                                    connexion</a>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('contact-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const successMsg = document.getElementById('form-success');
        const errorMsg = document.getElementById('form-error');
        const errorText = document.getElementById('error-text');

        // Real-time validation
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', () => validateField(input));
            input.addEventListener('input', () => {
                if (input.classList.contains('border-red-500')) {
                    validateField(input);
                }
            });
        });

        function validateField(field) {
            const formGroup = field.closest('.form-group');
            const errorSpan = formGroup.querySelector('.error-message');
            let isValid = true;
            let errorMessage = '';

            // Reset styles
            field.classList.remove('border-red-500');
            errorSpan.classList.add('hidden');

            // Check required
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
                errorMessage = 'Ce champ est requis';
            }

            // Email validation
            if (field.type === 'email' && field.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    isValid = false;
                    errorMessage = 'Email invalide';
                }
            }

            // Show error if invalid
            if (!isValid) {
                field.classList.add('border-red-500');
                errorSpan.textContent = errorMessage;
                errorSpan.classList.remove('hidden');
            }

            return isValid;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validate all fields
            let formValid = true;
            inputs.forEach(input => {
                if (input.name !== 'website') { // Skip honeypot
                    if (!validateField(input)) {
                        formValid = false;
                    }
                }
            });

            if (!formValid) return;

            // Check honeypot (anti-spam)
            if (form.querySelector('[name="website"]').value) {
                console.log('Spam detected');
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Envoi en cours...';
            btnIcon.className = 'fas fa-spinner fa-spin';
            successMsg.classList.add('hidden');
            errorMsg.classList.add('hidden');

            // Prepare form data
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value,
            };

            try {
                // Send email via WordPress AJAX
                const response = await fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'send_contact_form',
                        ...formData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Show success message
                    successMsg.classList.remove('hidden');
                    form.reset();

                    // Scroll to success message
                    successMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    throw new Error(result.data?.message || 'Erreur d\'envoi');
                }

            } catch (error) {
                console.error('Contact form error:', error);
                errorText.textContent = error.message || 'Une erreur est survenue. Veuillez réessayer ou nous contacter directement à contact@oblink.fr';
                errorMsg.classList.remove('hidden');
                errorMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'Envoyer le message';
                btnIcon.className = 'fas fa-paper-plane';
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-login.php ---
<?php
/*
Template Name: Connexion
*/

include 'header-inc.php';
?>

<div class="bg-oblink-beige/20 min-h-screen pt-32 pb-20 flex items-center justify-center">
    <!-- Form -->
    <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 max-w-lg w-full">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-oblink-gray mb-3" style="font-family: 'Montserrat', sans-serif;">
                Connexion
            </h1>
            <p class="text-oblink-gray/70">Accédez à votre espace OBLINK</p>
        </div>

        <!-- Contextual Auth Message -->
        <div id="auth-message" class="hidden mb-6 p-4 rounded-xl bg-oblink-blue/10 border border-oblink-blue/20">
            <div class="flex items-start gap-3">
                <i class="fas fa-info-circle text-oblink-blue mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-oblink-gray" id="auth-message-text"></p>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="login-error" class="hidden mb-6 p-4 rounded-xl bg-red-50 border border-red-200">
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-circle text-red-500 mt-0.5"></i>
                <div>
                    <p class="text-sm font-semibold text-red-700" id="login-error-text"></p>
                </div>
            </div>
        </div>

        <form id="supabase-login-form" class="space-y-6">
            <div>
                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                    Email <span class="text-red-500">*</span>
                </label>
                <input type="email" name="email" required
                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                    placeholder="votre@email.com">
            </div>
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-semibold text-oblink-gray">
                        Mot de passe <span class="text-red-500">*</span>
                    </label>
                    <a href="#" id="forgot-password-link" class="text-xs text-oblink-orange hover:underline">Mot de
                        passe oublié ?</a>
                </div>
                <input type="password" name="password" required
                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                    placeholder="••••••••">
            </div>

            <button type="submit"
                class="w-full px-6 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition font-semibold shadow-lg flex justify-center items-center gap-2">
                Se connecter <i class="fas fa-sign-in-alt"></i>
            </button>
        </form>

        <div class="mt-8 pt-6 border-t border-oblink-beige text-center">
            <p class="text-sm text-oblink-gray/70">
                Vous n'avez pas de compte ?<br>
                <a href="<?php echo home_url('/inscription-opticien'); ?>"
                    class="text-oblink-orange font-semibold hover:underline">Inscription Opticien</a>
                <span class="mx-2 text-gray-300">|</span>
                <a href="<?php echo home_url('/inscription-entreprise'); ?>"
                    class="text-oblink-blue font-semibold hover:underline">Inscription Entreprise</a>
            </p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('supabase-login-form');
        const authMessage = document.getElementById('auth-message');
        const authMessageText = document.getElementById('auth-message-text');

        // Check for redirect parameter and show contextual message
        const urlParams = new URLSearchParams(window.location.search);
        const redirect = urlParams.get('redirect');

        if (redirect) {
            const messages = {
                '/publier-offre': '⚠️ Vous devez être connecté pour publier une offre',
                '/dashboard-opticien': '⚠️ Connectez-vous pour accéder à votre tableau de bord opticien',
                '/dashboard-entreprise': '⚠️ Connectez-vous pour accéder à votre espace entreprise',
                '/dashboard': '⚠️ Connectez-vous pour accéder à votre tableau de bord',
                '/parametres': '⚠️ Connectez-vous pour accéder aux paramètres',
            };

            authMessageText.textContent = messages[redirect] || '⚠️ Vous devez être connecté pour accéder à cette page';
            authMessage.classList.remove('hidden');
        }

        // Forgot password handler
        document.getElementById('forgot-password-link').addEventListener('click', function (e) {
            e.preventDefault();
            const errorDiv = document.getElementById('login-error');
            const errorText = document.getElementById('login-error-text');
            errorText.textContent = 'Fonctionnalité de réinitialisation en cours de développement. Contactez contact@oblink.fr';
            errorDiv.classList.remove('hidden');
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const email = form.querySelector('input[name="email"]').value;
            const password = form.querySelector('input[name="password"]').value;

            try {
                console.log('[LOGIN] Starting authentication...');

                // 1. Sign In
                const { data, error } = await window.oblinkSupabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                // 2. Get FRESH session to ensure metadata is loaded
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();

                if (!session) {
                    throw new Error('Session introuvable après connexion');
                }

                const user = session.user;
                const userType = user.user_metadata?.user_type;

                console.log('[LOGIN] ✅ Authentification réussie');
                console.log('[LOGIN] User Type:', userType);
                console.log('[LOGIN] User Metadata:', user.user_metadata);

                // 3. Check for redirect parameter
                const urlParams = new URLSearchParams(window.location.search);
                const redirectTo = urlParams.get('redirect');

                // 4. Determine redirect URL
                let redirectUrl;

                if (redirectTo) {
                    redirectUrl = '<?php echo home_url(); ?>' + redirectTo;
                    console.log('[LOGIN] 🔄 Redirect vers:', redirectUrl);
                } else {
                    if (userType === 'opticien') {
                        redirectUrl = '<?php echo home_url("/dashboard-opticien"); ?>';
                        console.log('[LOGIN] 🔄 Redirect opticien:', redirectUrl);
                    } else if (userType === 'entreprise') {
                        redirectUrl = '<?php echo home_url("/dashboard-entreprise"); ?>';
                        console.log('[LOGIN] 🔄 Redirect entreprise:', redirectUrl);
                    } else {
                        console.warn('[LOGIN] ⚠️ Type utilisateur inconnu:', userType);
                        redirectUrl = '<?php echo home_url("/"); ?>';
                    }
                }

                // 5. Redirect
                window.location.href = redirectUrl;

            } catch (error) {
                console.error('Login Error:', error);

                // Show inline error message instead of alert
                const errorDiv = document.getElementById('login-error');
                const errorText = document.getElementById('login-error-text');
                errorText.textContent = error.message || 'Identifiants incorrects. Veuillez réessayer.';
                errorDiv.classList.remove('hidden');

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');

                // Scroll to error
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-comparatif-verres.php ---
<?php
/*
Template Name: Comparatif Verres 2025
*/
include 'header-inc.php';
?>

<!-- Header Section with Glassmorphism -->
<section class="pt-32 pb-20 relative overflow-hidden bg-white">
    <!-- Background elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0">
        <div class="absolute -top-20 -right-20 w-96 h-96 bg-oblink-orange/5 rounded-full blur-3xl"></div>
        <div class="absolute top-40 -left-20 w-72 h-72 bg-oblink-blue/5 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center max-w-3xl mx-auto">
            <span
                class="inline-block px-4 py-1.5 bg-orange-100 text-oblink-orange rounded-full text-sm font-bold mb-6 animate-fade-in-down">
                MISE À JOUR 2025
            </span>
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-oblink-gray"
                style="font-family: 'Montserrat', sans-serif;">
                Comparatif des Verres <span class="text-oblink-orange">Progressifs & Intérieurs</span>
            </h1>
            <p class="text-xl text-oblink-gray/70 mb-8 leading-relaxed">
                Découvrez le classement de référence pour les opticiens freelances. <br>
                Intégration du nouveau <span class="font-bold text-oblink-gray">Score 10</span> (IA Générative) et mise
                à jour des gammes MDD.
            </p>
        </div>
    </div>
</section>

<!-- Score 10 Highlight Section -->
<section class="py-12 bg-gradient-to-br from-slate-50 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-10 flex items-center justify-between">
            <h2 class="text-2xl font-bold text-oblink-gray flex items-center">
                <span
                    class="w-10 h-10 rounded-full bg-oblink-orange text-white flex items-center justify-center font-bold mr-3 text-lg">10</span>
                Les Nouveautés Premium+ (Score 10)
            </h2>
            <span
                class="hidden md:inline-block text-sm text-gray-500 bg-white px-3 py-1 rounded-md border border-gray-100 shadow-sm">
                <i class="fas fa-robot mr-2 text-oblink-blue"></i>Technologies IA intégrées
            </span>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Essilor -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">ESSILOR</span>
                </div>
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded">FLAGSHIP
                        2025</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-orange mb-2">Varilux XR Series</h3>
                <p class="text-sm text-gray-500 mb-4">La référence absolue pilotée par IA comportementale.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Gravure
                        nasale spécifique</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Volume
                        de vision instantané</li>
                </ul>
            </div>

            <!-- Zeiss -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">ZEISS</span>
                </div>
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded">SMARTVIEW
                        2.0</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-blue mb-2">SmartLife Individual 3</h3>
                <p class="text-sm text-gray-500 mb-4">Optimisation dynamique pour les vies connectées.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Intelligence
                        augmentée</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Adaptation
                        morphologique</li>
                </ul>
            </div>

            <!-- Hoya -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">HOYA</span>
                </div>
                <div class="mb-4">
                    <span
                        class="inline-block px-2 py-1 bg-purple-50 text-purple-600 text-xs font-bold rounded">BINOCULAR
                        HARMONIZATION</span>
                </div>
                <h3 class="text-xl font-bold text-oblink-violet mb-2">Hoyalux iD MySelf</h3>
                <p class="text-sm text-gray-500 mb-4">La personnalisation extrême par Hoya.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Gestion
                        des anisotropies</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Confort
                        digital</li>
                </ul>
            </div>

            <!-- Nikon -->
            <div
                class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition transform hover:-translate-y-1 group">
                <div class="h-12 flex items-center mb-4">
                    <span class="font-bold text-lg text-oblink-gray">NIKON</span>
                </div>
                <div class="mb-4">
                    <span
                        class="inline-block px-2 py-1 bg-yellow-50 text-yellow-600 text-xs font-bold rounded">Z-CONTRAST</span>
                </div>
                <h3 class="text-xl font-bold text-yellow-600 mb-2">Z Suite (Ultimate/Master)</h3>
                <p class="text-sm text-gray-500 mb-4">La haute définition japonaise repensée.</p>
                <ul class="text-sm space-y-2 text-gray-600">
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Contraste
                        optimisé</li>
                    <li class="flex items-start"><i
                            class="fas fa-check text-green-500 mt-1 mr-2 opacity-0 group-hover:opacity-100 transition"></i>Vision
                        nocturne améliorée</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- Table Section: Comparison MDD & Private Labels -->
<section class="py-12 pb-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-oblink-gray mb-2">
                Mise à jour Marques Enseignes (2024-2025)
            </h2>
            <p class="text-gray-500">Pour identifier rapidement les verres en magasin lors de vos missions.</p>
        </div>

        <div class="overflow-x-auto rounded-xl shadow-lg border border-gray-100">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                        <th class="p-4 font-bold border-b">Enseigne</th>
                        <th class="p-4 font-bold border-b">Gamme</th>
                        <th class="p-4 font-bold border-b">Désignation 2025</th>
                        <th class="p-4 font-bold border-b">Équivalence Verrier</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 text-sm">
                    <!-- KRYS -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-oblink-blue">KRYS</td>
                        <td class="p-4">Progressif Premium</td>
                        <td class="p-4 font-bold">KALYSTÉ 2.0 Full HD</td>
                        <td class="p-4 text-gray-500">Codir / Hoya (Variable selon fournisseur)</td>
                    </tr>
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-oblink-blue">KRYS</td>
                        <td class="p-4">Intérieur (Proxi)</td>
                        <td class="p-4 font-bold">KALYSTÉ 2.0 My Proxi ID</td>
                        <td class="p-4 text-gray-500">Dégressif optimisé</td>
                    </tr>

                    <!-- OPTIC 2000 -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-green-600">OPTIC 2000</td>
                        <td class="p-4">Progressif Haut de Gamme</td>
                        <td class="p-4 font-bold">INFINIGLASS</td>
                        <td class="p-4 text-gray-500">Equivalent BBGR Haut de Gamme</td>
                    </tr>

                    <!-- AFFLELOU -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-gray-800">AFFLELOU</td>
                        <td class="p-4">Progressif</td>
                        <td class="p-4 font-bold">CENT POUR CENT / EGO</td>
                        <td class="p-4 text-gray-500">BBGR / Shamir (Souvent gravé "CP")</td>
                    </tr>

                    <!-- GRAND OPTICAL -->
                    <tr class="hover:bg-orange-50/30 transition">
                        <td class="p-4 font-bold text-gray-800">GRAND OPTICAL</td>
                        <td class="p-4">Progressif</td>
                        <td class="p-4 font-bold">VARIVIEW HD</td>
                        <td class="p-4 text-gray-500">Seiko / Hoya</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-8 text-center bg-blue-50 p-6 rounded-xl border border-blue-100">
            <h3 class="text-lg font-bold text-oblink-blue mb-2">Besoin de la base de données complète ?</h3>
            <p class="text-sm text-gray-600 mb-4">Téléchargez le fichier CSV complet avec plus de 200 références de
                verres (Mise à jour 2025).</p>
            <a href="<?php echo get_template_directory_uri(); ?>/comparatif-verres-2025.csv" download
                class="inline-block px-6 py-3 bg-oblink-blue text-white rounded-lg font-bold shadow-md hover:bg-oblink-blue/90 transition">
                <i class="fas fa-download mr-2"></i> Télécharger le Comparatif Complet (CSV)
            </a>
            <p class="text-xs text-gray-400 mt-2">Mise à jour : Janvier 2025</p>
        </div>
    </div>
</section>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-formation-erp-v2.php ---
<?php
/*
Template Name: Marketplace Formations V2 (Premium)
Description: Modern course marketplace with filters, ratings, wishlist, quick view
*/
include 'header-inc.php';
?>

<style>
    /* Premium Card Hover Effects */
    .course-card {
        transition: all 0.3s ease;
    }

    .course-card:hover {
        transform: translateY(-8px);
    }

    /* Quick View Modal */
    .modal-backdrop {
        backdrop-filter: blur(8px);
        background: rgba(0, 0, 0, 0.6);
    }

    /* Rating Stars */
    .rating-stars {
        color: #FCD34D;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-50 via-violet-50/30 to-orange-50/20 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-12">
            <span
                class="inline-block py-1 px-4 rounded-full bg-oblink-violet/10 text-oblink-violet font-bold text-sm mb-4 uppercase">
                <i class="fas fa-graduation-cap mr-2"></i>Académie OBLINK
            </span>
            <h1 class="text-4xl md:text-6xl font-black text-oblink-gray mb-6">
                L'Académie <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                <strong class="text-oblink-violet">47 formations</strong> pour booster votre carrière en optique
            </p>
        </div>

        <div class="grid lg:grid-cols-4 gap-8">

            <!-- SIDEBAR FILTERS -->
            <aside class="lg:col-span-1 space-y-6">

                <!-- Search -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <input type="text" id="search-courses" placeholder="Rechercher une formation..."
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 transition">
                </div>

                <!-- Filter: Category -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-layer-group text-oblink-violet"></i>Catégorie
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="all"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet" checked>
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Toutes</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="logiciels"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Logiciels
                                ERP</span>
                            <span class="ml-auto text-xs text-gray-400">12</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="clinique"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Expertise
                                Clinique</span>
                            <span class="ml-auto text-xs text-gray-400">18</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="vente"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Vente &
                                Management</span>
                            <span class="ml-auto text-xs text-gray-400">10</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="category" value="certif"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <span
                                class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Certifications</span>
                            <span class="ml-auto text-xs text-gray-400">7</span>
                        </label>
                    </div>
                </div>

                <!-- Filter: Price -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-euro-sign text-oblink-orange"></i>Prix
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="free"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Gratuit</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="0-50"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">Moins de
                                50€</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="50-150"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">50€ -
                                150€</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" value="150+"
                                class="filter-price w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-700 group-hover:text-oblink-violet transition">150€+</span>
                        </label>
                    </div>
                </div>

                <!-- Filter: Rating -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-star text-yellow-400"></i>Note minimum
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="all"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet" checked>
                            <span class="text-sm text-gray-700">Toutes</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="4"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <div class="rating-stars text-sm">★★★★☆ et plus</div>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="radio" name="rating" value="4.5"
                                class="w-5 h-5 text-oblink-violet focus:ring-oblink-violet">
                            <div class="rating-stars text-sm">★★★★★ 4.5+</div>
                        </label>
                    </div>
                </div>

                <!-- Reset -->
                <button id="reset-filters-courses"
                    class="w-full px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition">
                    <i class="fas fa-redo mr-2"></i>Réinitialiser
                </button>

            </aside>

            <!-- MAIN CONTENT -->
            <main class="lg:col-span-3">

                <!-- Toolbar -->
                <div
                    class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6 flex items-center justify-between">
                    <p class="text-sm text-gray-600"><span id="courses-count"
                            class="font-bold text-oblink-violet">47</span> formations trouvées</p>

                    <select id="sort-courses"
                        class="px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 transition text-sm">
                        <option value="popular">Les plus populaires</option>
                        <option value="rating">Mieux notées</option>
                        <option value="price-asc">Prix croissant</option>
                        <option value="price-desc">Prix décroissant</option>
                        <option value="newest">Plus récentes</option>
                    </select>
                </div>

                <!-- Courses Grid -->
                <div id="courses-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Courses will be injected here -->
                </div>

            </main>

        </div>

    </div>
</div>

<!-- Quick View Modal -->
<div id="quick-view-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop"
    onclick="closeQuickView()">
    <div class="bg-white rounded-3xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto"
        onclick="event.stopPropagation()">
        <div id="modal-content" class="p-8">
            <!-- Content injected dynamically -->
        </div>
    </div>
</div>

<script>
    // MOCK DATA
    const MOCK_COURSES = [
        { id: 1, title: "Maîtriser Cosium Optic", instructor: "Team Cosium", category: "logiciels", price: 0, rating: 4.9, students: 1247, duration: "2h30", image: "cosium", bestseller: true, certified: false },
        { id: 2, title: "Réfraction Complexe : Le Cas par Cas", instructor: "Dr. Marc L.", category: "clinique", price: 159, rating: 4.9, students: 523, duration: "8h", image: "refraction", bestseller: true, certified: true },
        { id: 3, title: "Adaptation Lentilles Rigides", instructor: "Sarah B.", category: "clinique", price: 129, rating: 4.8, students: 387, duration: "6h", image: "lentilles", bestseller: false, certified: true },
        { id: 4, title: "Ivoirnet : L'essentiel", instructor: "Team Ivoirnet", category: "logiciels", price: 0, rating: 4.7, students: 892, duration: "1h45", image: "ivoirnet", bestseller: false, certified: false },
        { id: 5, title: "Vente Consultative en Optique", instructor: "Julie M.", category: "vente", price: 89, rating: 4.6, students: 654, duration: "4h", image: "vente", bestseller: false, certified: false },
        { id: 6, title: "Initiation Basse Vision", instructor: "Jean V.", category: "clinique", price: 89, rating: 4.5, students: 234, duration: "5h", image: "basse-vision", bestseller: false, certified: true },
        { id: 7, title: "WinOptics Start", instructor: "Win Academy", category: "logiciels", price: 0, rating: 4.8, students: 743, duration: "1h", image: "winoptics", bestseller: false, certified: false },
        { id: 8, title: "Manager une Équipe Optique", instructor: "Pierre D.", category: "vente", price: 119, rating: 4.7, students: 421, duration: "7h", image: "management", bestseller: false, certified: false },
        { id: 9, title: "Certification Contactologie Avancée", instructor: "Dr. Anne P.", category: "certif", price: 199, rating: 4.9, students: 178, duration: "12h", image: "certif-contact", bestseller: false, certified: true },
    ];

    let allCourses = [...MOCK_COURSES];
    let filteredCourses = [...MOCK_COURSES];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        renderCourses();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Search
        document.getElementById('search-courses').addEventListener('input', applyFilters);

        // Category filter
        document.querySelectorAll('input[name="category"]').forEach(radio => {
            radio.addEventListener('change', applyFilters);
        });

        // Price filters
        document.querySelectorAll('.filter-price').forEach(cb => {
            cb.addEventListener('change', applyFilters);
        });

        // Rating filter
        document.querySelectorAll('input[name="rating"]').forEach(radio => {
            radio.addEventListener('change', applyFilters);
        });

        // Sort
        document.getElementById('sort-courses').addEventListener('change', () => {
            sortCourses();
            renderCourses();
        });

        // Reset
        document.getElementById('reset-filters-courses').addEventListener('click', resetFilters);
    }

    function applyFilters() {
        const searchTerm = document.getElementById('search-courses').value.toLowerCase();
        const selectedCategory = document.querySelector('input[name="category"]:checked').value;
        const selectedPrices = Array.from(document.querySelectorAll('.filter-price:checked')).map(cb => cb.value);
        const selectedRating = document.querySelector('input[name="rating"]:checked').value;

        filteredCourses = allCourses.filter(course => {
            // Search
            const matchesSearch = !searchTerm || course.title.toLowerCase().includes(searchTerm) || course.instructor.toLowerCase().includes(searchTerm);

            // Category
            const matchesCategory = selectedCategory === 'all' || course.category === selectedCategory;

            // Price
            let matchesPrice = selectedPrices.length === 0;
            if (selectedPrices.includes('free') && course.price === 0) matchesPrice = true;
            if (selectedPrices.includes('0-50') && course.price > 0 && course.price <= 50) matchesPrice = true;
            if (selectedPrices.includes('50-150') && course.price > 50 && course.price <= 150) matchesPrice = true;
            if (selectedPrices.includes('150+') && course.price > 150) matchesPrice = true;

            // Rating
            const matchesRating = selectedRating === 'all' || course.rating >= parseFloat(selectedRating);

            return matchesSearch && matchesCategory && matchesPrice && matchesRating;
        });

        sortCourses();
        renderCourses();
    }

    function sortCourses() {
        const sortValue = document.getElementById('sort-courses').value;

        filteredCourses.sort((a, b) => {
            switch (sortValue) {
                case 'popular':
                    return b.students - a.students;
                case 'rating':
                    return b.rating - a.rating;
                case 'price-asc':
                    return a.price - b.price;
                case 'price-desc':
                    return b.price - a.price;
                case 'newest':
                    return b.id - a.id;
                default:
                    return 0;
            }
        });
    }

    function renderCourses() {
        const container = document.getElementById('courses-container');
        document.getElementById('courses-count').textContent = filteredCourses.length;

        if (filteredCourses.length === 0) {
            container.innerHTML = '<div class="col-span-3 text-center py-12"><p class="text-gray-500 text-lg">Aucune formation trouvée</p></div>';
            return;
        }

        container.innerHTML = filteredCourses.map(course => `
        <div class="course-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group">
            <!-- Thumbnail -->
            <div class="relative h-48 bg-gradient-to-br ${getGradient(course.image)} flex items-center justify-center overflow-hidden">
                <i class="fas ${getIcon(course.category)} text-6xl text-white/20 group-hover:scale-110 transition"></i>
                ${course.bestseller ? '<span class="absolute top-3 left-3 bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-full">🔥 BEST SELLER</span>' : ''}
                ${course.certified ? '<span class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full"><i class="fas fa-certificate mr-1"></i>CERTIFIÉ</span>' : ''}
                <button onclick="addToWishlist(${course.id}); event.stopPropagation();" class="absolute bottom-3 right-3 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center hover:bg-oblink-orange hover:text-white transition shadow-lg">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
            
            <!-- Content -->
            <div class="p-5" onclick="showQuickView(${course.id})">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1 text-yellow-400 text-sm">
                        ${'★'.repeat(Math.floor(course.rating))}${'☆'.repeat(5 - Math.floor(course.rating))}
                        <span class="text-gray-600 ml-1 font-semibold">${course.rating}</span>
                    </div>
                    <span class="text-xs text-gray-500"><i class="fas fa-users mr-1"></i>${course.students}</span>
                </div>
                
                <h3 class="font-bold text-lg text-oblink-gray mb-2 group-hover:text-oblink-violet transition line-clamp-2">${course.title}</h3>
                
                <div class="flex items-center gap-2 mb-4 text-xs text-gray-500">
                    <img src="https://randomuser.me/api/portraits/men/${course.id}.jpg" class="w-6 h-6 rounded-full">
                    <span>${course.instructor}</span>
                    <span>·</span>
                    <span><i class="fas fa-clock mr-1"></i>${course.duration}</span>
                </div>
                
                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <span class="font-black text-2xl text-oblink-gray">${course.price === 0 ? '<span class="text-green-600">GRATUIT</span>' : course.price + '€'}</span>
                    <button onclick="buyCourse(${course.id}); event.stopPropagation();" class="px-4 py-2 bg-oblink-violet hover:bg-oblink-violet/90 text-white font-semibold rounded-lg transition">
                        ${course.price === 0 ? 'Voir' : 'Acheter'}
                    </button>
                </div>
            </div>
        </div>
    `).join('');
    }

    function getGradient(image) {
        const gradients = {
            cosium: 'from-gray-900 to-gray-700',
            refraction: 'from-indigo-900 to-indigo-700',
            lentilles: 'from-teal-800 to-teal-600',
            ivoirnet: 'from-emerald-800 to-emerald-600',
            vente: 'from-orange-700 to-orange-500',
            'basse-vision': 'from-gray-800 to-gray-600',
            winoptics: 'from-orange-700 to-orange-500',
            management: 'from-blue-800 to-blue-600',
            'certif-contact': 'from-violet-800 to-violet-600',
        };
        return gradients[image] || 'from-gray-700 to-gray-500';
    }

    function getIcon(category) {
        const icons = {
            logiciels: 'fa-laptop-code',
            clinique: 'fa-microscope',
            vente: 'fa-chart-line',
            certif: 'fa-certificate',
        };
        return icons[category] || 'fa-book';
    }

    function showQuickView(courseId) {
        const course = allCourses.find(c => c.id === courseId);
        const modal = document.getElementById('quick-view-modal');
        const content = document.getElementById('modal-content');

        content.innerHTML = `
        <button onclick="closeQuickView()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 text-2xl">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="grid md:grid-cols-2 gap-8">
            <div>
                <div class="h-64 rounded-2xl bg-gradient-to-br ${getGradient(course.image)} flex items-center justify-center mb-6">
                    <i class="fas ${getIcon(course.category)} text-8xl text-white/30"></i>
                </div>
                ${course.bestseller ? '<span class="inline-block bg-oblink-orange text-white text-xs font-bold px-3 py-1 rounded-full mb-3">🔥 BEST SELLER</span>' : ''}
            </div>
            
            <div>
                <h2 class="text-3xl font-black text-oblink-gray mb-4">${course.title}</h2>
                
                <div class="flex items-center gap-2 mb-4">
                    <div class="flex items-center gap-1 text-yellow-400 text-lg">
                        ${'★'.repeat(Math.floor(course.rating))}${'☆'.repeat(5 - Math.floor(course.rating))}
                        <span class="text-gray-600 ml-2 font-bold">${course.rating}</span>
                    </div>
                    <span class="text-gray-500">·</span>
                    <span class="text-sm text-gray-600"><i class="fas fa-users mr-1"></i>${course.students} étudiants</span>
                </div>
                
                <div class="flex items-center gap-3 mb-6">
                    <img src="https://randomuser.me/api/portraits/men/${course.id}.jpg" class="w-12 h-12 rounded-full border-2 border-oblink-violet">
                    <div>
                        <p class="font-bold text-gray-900">${course.instructor}</p>
                        <p class="text-sm text-gray-500">Expert certifié</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <h4 class="font-bold text-gray-900 mb-3">Ce que vous allez apprendre</h4>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Maîtriser toutes les fonctionnalités</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Gagner du temps au quotidien</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Devenir autonome rapidement</li>
                    </ul>
                </div>
                
                <div class="flex items-center gap-4 mb-6">
                    <span class="text-4xl font-black text-oblink-gray">${course.price === 0 ? '<span class="text-green-600">GRATUIT</span>' : course.price + '€'}</span>
                    <span class="text-sm text-gray-500"><i class="fas fa-clock mr-1"></i>${course.duration}</span>
                </div>
                
                <button onclick="buyCourse(${course.id})" class="w-full px-8 py-4 bg-oblink-violet hover:bg-oblink-violet/90 text-white font-bold rounded-xl transition shadow-lg">
                    ${course.price === 0 ? 'Commencer maintenant' : 'Acheter la formation'}
                </button>
            </div>
        </div>
    `;

        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeQuickView() {
        document.getElementById('quick-view-modal').classList.add('hidden');
        document.getElementById('quick-view-modal').classList.remove('flex');
    }

    function addToWishlist(courseId) {
        alert(`Formation #${courseId} ajoutée aux favoris ! 💜`);
    }

    function buyCourse(courseId) {
        alert(`Redirection vers le paiement pour la formation #${courseId}...`);
    }

    function resetFilters() {
        document.getElementById('search-courses').value = '';
        document.querySelector('input[name="category"][value="all"]').checked = true;
        document.querySelectorAll('.filter-price').forEach(cb => cb.checked = false);
        document.querySelector('input[name="rating"][value="all"]').checked = true;
        applyFilters();
    }
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-formation-erp.php ---
<?php
/*
Template Name: Académie Oblink (Anciennement Formation ERP)
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header: La Vision Académie HUB -->
        <div class="text-center mb-16 relative">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
                <i class="fas fa-graduation-cap mr-2"></i>L'excellence Optique
            </span>
            <h1 class="text-4xl md:text-6xl font-black font-display text-oblink-gray mb-6">
                Académie <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto font-body leading-relaxed mb-12">
                De l'étudiant au professionnel aguerri. Une plateforme unique pour réussir votre diplôme et booster
                votre carrière.
            </p>

            <!-- HUB NAVIGATION CARDS -->
            <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto text-left">

                <!-- Card 1: PASS EXAMEN (New) -->
                <a href="<?php echo home_url('/pass-examen'); ?>"
                    class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-orange/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-oblink-orange/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-orange to-pink-500 text-white flex items-center justify-center text-2xl shadow-lg">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <span
                                class="bg-red-100 text-red-600 font-bold px-3 py-1 rounded-full text-xs">NOUVEAU</span>
                        </div>
                        <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-orange transition">Je
                            passe mon BTS</h3>
                        <p class="text-gray-500 mb-6 font-medium">Annales corrigées, IA prédictive et fiches de révision
                            pour assurer votre diplôme.</p>
                        <div class="flex items-center text-oblink-blue font-bold text-sm">
                            Découvrir le Pass Examen <i
                                class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                        </div>
                    </div>
                </a>

                <!-- Card 2: FORMATIONS PRO (Existing) -->
                <a href="#formations-logiciels"
                    class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-blue/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-blue to-cyan-500 text-white flex items-center justify-center text-2xl shadow-lg">
                                <i class="fas fa-laptop-medical"></i>
                            </div>
                            <span class="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded-full text-xs">PRO</span>
                        </div>
                        <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-blue transition">Je
                            suis Opticien</h3>
                        <p class="text-gray-500 mb-6 font-medium">Maîtrisez les logiciels ERP et développez des
                            compétences cliniques rares.</p>
                        <div class="flex items-center text-oblink-blue font-bold text-sm">
                            Voir les formations <i
                                class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <div id="formations-logiciels" class="pt-12"></div>

        <!-- 5 ARGUMENTS CHOCS SECTION -->
        <div class="mb-20 bg-white rounded-3xl p-8 md:p-12 shadow-xl border border-gray-100 relative overflow-hidden">
            <div
                class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-oblink-blue/5 to-transparent skew-x-12 transform pointer-events-none">
            </div>

            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black text-oblink-gray mb-4">
                    Pourquoi se former ? <span class="text-oblink-blue">Les 5 vérités "Cash"</span>
                </h2>
                <p class="text-lg text-gray-500 font-medium">Ne soyez pas juste un remplaçant. Soyez l'expert que tout
                    le monde s'arrache.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 relative z-10">
                <!-- Argument 1: TJM -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Boostez votre TJM de +15%</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Un expert certifié Cosium facture <strong class="text-oblink-blue">420€/j</strong> contre 350€
                        pour un profil standard. Votre formation est rentabilisée en <span
                            class="underline decoration-green-500 decoration-2">2 jours de mission</span>.
                    </p>
                </div>

                <!-- Argument 2: Zero Onboarding -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-stopwatch"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Zéro Onboarding</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        "Arrivez, connectez-vous, vendez." Les gérants détestent former les remplaçants. Avec le badge
                        <strong class="text-oblink-orange">Certifié ERP</strong>, vous passez en priorité sur toutes les
                        offres.
                    </p>
                </div>

                <!-- Argument 3: Sécurité -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-red-100 text-red-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Zéro Erreur Facturation</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        En 2026, une erreur de télétransmission est fatale. Maîtrisez les pièges du Tiers-Payant pour
                        éviter les rejets. Dormez tranquille, vos dossiers sont carrés.
                    </p>
                </div>

                <!-- Argument 4: Luxe -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20">
                    <div
                        class="w-12 h-12 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-2xl mb-4">
                        <i class="fas fa-gem"></i>
                    </div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">Accès Marché Luxe</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        80% des magasins de prestige ont des ERP complexes. Sans formation, ces portes restent fermées.
                        Travaillez dans les plus beaux magasins.
                    </p>
                </div>

                <!-- Argument 5: IA Efficiency -->
                <div
                    class="bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition duration-300 border border-transparent hover:border-oblink-blue/20 md:col-span-2 lg:col-span-2">
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div>
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center text-2xl mb-4">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="font-bold text-xl text-gray-900 mb-2">L'Avantage IA 2026</h3>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Utilisez l'IA de votre ERP pour automatiser l'administratif. Finissez vos journées à 18h
                                tout en ayant traité <strong class="text-oblink-blue">+20% de dossiers</strong>.
                                Travaillez moins, gagnez plus.
                            </p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-100 w-full md:w-auto">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                                <span class="text-xs font-bold text-gray-400">STATUS: OPTIMISÉ</span>
                            </div>
                            <div class="space-y-2">
                                <div class="h-2 bg-gray-100 rounded-full w-48"></div>
                                <div class="h-2 bg-gray-100 rounded-full w-32"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 1: Logiciels & ERP -->
        <div class="mb-20">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
                    <span
                        class="w-10 h-10 rounded-xl bg-oblink-blue text-white flex items-center justify-center text-lg"><i
                            class="fas fa-laptop-code"></i></span>
                    Formations Certifiantes (ERP)
                </h2>
                <span class="bg-oblink-blue/10 text-oblink-blue font-bold px-3 py-1 rounded-full text-xs animate-pulse">
                    <i class="fas fa-certificate mr-1"></i> BADGE FINAL INCLUS
                </span>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Course Card: Cosium (Premium) -->
                <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer relative">

                    <!-- Free Preview Badge -->
                    <div
                        class="absolute top-4 left-4 z-20 bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/20">
                        <i class="fas fa-eye mr-1"></i> Aperçu Gratuit (2min)
                    </div>

                    <div class="relative h-48 bg-gray-900 overflow-hidden">
                        <!-- YouTube Thumbnail Preview -->
                        <div class="absolute inset-0 flex items-center justify-center bg-gray-900">
                            <h3 class="text-white font-black text-3xl tracking-tighter">
                                COSIUM <span class="text-oblink-blue">EXPERT</span></h3>
                        </div>
                        <div
                            class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                            <i class="fas fa-clock mr-1"></i> 4h00
                        </div>
                        <div
                            class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                            <span
                                class="w-16 h-16 rounded-full bg-white text-oblink-blue flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                                <i class="fas fa-play ml-1"></i>
                            </span>
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-oblink-gray mb-1">Cosium Expert 2026</h3>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Maîtrisez l'IA, le Tiers-Payant complexe et
                            les stocks. Certification incluse.</p>
                        <ul class="text-xs text-gray-500 mb-4 space-y-1">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Badge
                                "Certifié Cosium"</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Accès
                                prioritaire jobs</li>
                        </ul>
                        <div class="flex items-center justify-between border-t border-gray-100 pt-3">
                            <span class="text-2xl font-black text-oblink-gray">99 €</span>
                            <button onclick="event.stopPropagation(); openCourseModal('cosium')"
                                class="bg-oblink-blue text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-oblink-blue/90 transition hover:shadow-lg transform hover:-translate-y-0.5 z-10 relative">
                                Détails & Programme
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Course Card: Osmose (Premium) -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer relative opacity-75 grayscale hover:grayscale-0 hover:opacity-100">
                    <div
                        class="absolute top-4 right-4 z-20 bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform rotate-3">
                        BIENTÔT
                    </div>
                    <div class="relative h-48 bg-emerald-800 overflow-hidden">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <h3 class="text-white font-black text-3xl tracking-tighter">
                                OSMOSE</h3>
                        </div>
                        <div
                            class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                            <i class="fas fa-clock mr-1"></i> 3h30
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-oblink-gray mb-1">Osmose & IA</h3>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Automatisez vos tâches avec l'assistant
                            Osmose. Le futur du métier.</p>
                        <div class="flex items-center justify-between border-t border-gray-100 pt-3">
                            <span class="text-2xl font-black text-oblink-gray">99 €</span>
                            <button
                                class="bg-gray-100 text-gray-400 px-4 py-2 rounded-lg font-bold text-sm cursor-not-allowed">
                                Liste d'attente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Expertise Clinique & Technique (Premium) -->
        <div class="mb-20">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
                    <span
                        class="w-10 h-10 rounded-xl bg-oblink-violet text-white flex items-center justify-center text-lg"><i
                            class="fas fa-microscope"></i></span>
                    Expertise Clinique (Rare)
                </h2>
                <a href="#" class="text-sm font-bold text-gray-400 hover:text-oblink-violet">Tout voir <i
                        class="fas fa-arrow-right ml-1"></i></a>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Course Card: Réfraction -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
                    <div class="relative h-48 bg-indigo-900 flex items-center justify-center overflow-hidden">
                        <i class="fas fa-eye text-6xl text-white/20 group-hover:scale-110 transition"></i>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                            <span class="bg-oblink-orange text-white text-[10px] font-bold px-2 py-1 rounded">BEST
                                SELLER</span>
                        </div>
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-oblink-gray leading-tight">Refraction Complexe : Le Cas
                                par Cas</h3>
                            <div class="flex items-center text-yellow-400 text-xs gap-1">
                                <i class="fas fa-star"></i> 4.9
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Analysez et résolvez 99% des plaintes clients
                            en examen de vue.</p>

                        <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                            <div class="flex items-center gap-2">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg"
                                    class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                                <span class="text-xs font-bold text-gray-600">Dr. Marc L.</span>
                            </div>
                            <span class="font-black text-xl text-oblink-gray">159 €</span>
                        </div>
                    </div>
                </div>

                <!-- Course Card: Contactologie -->
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
                    <div class="relative h-48 bg-teal-800 flex items-center justify-center overflow-hidden">
                        <i class="fas fa-dot-circle text-6xl text-white/20 group-hover:scale-110 transition"></i>
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-oblink-gray leading-tight">Adaptation Lentilles Rigides
                            </h3>
                            <div class="flex items-center text-yellow-400 text-xs gap-1">
                                <i class="fas fa-star"></i> 4.8
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 line-clamp-2">Ne laissez plus partir de clients faute de
                            compétence en rigides.</p>

                        <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                            <div class="flex items-center gap-2">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                    class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                                <span class="text-xs font-bold text-gray-600">Sarah B.</span>
                            </div>
                            <span class="font-black text-xl text-oblink-gray">129 €</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA: Devenir Formateur -->
        <div
            class="bg-gradient-to-br from-oblink-gray to-gray-900 rounded-3xl p-8 md:p-16 relative overflow-hidden text-center md:text-left">
            <!-- Background Decoration -->
            <div
                class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-[100px] pointer-events-none transform translate-x-1/2 -translate-y-1/2">
            </div>

            <div class="relative z-10 grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <span
                        class="inline-block py-1 px-3 rounded-full bg-white/10 text-white font-bold text-xs mb-4 border border-white/20">
                        APPEL AUX EXPERTS
                    </span>
                    <h2 class="text-3xl md:text-4xl font-black text-white font-display mb-6">Monétisez votre expertise
                        optique</h2>
                    <ul class="space-y-4 mb-8 text-gray-300">
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Touchez <strong>70% de commission</strong> sur chaque vente.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Nous gérons le marketing et la plateforme.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-check-circle text-oblink-orange"></i>
                            <span>Accès immédiat à +500 opticiens qualifiés.</span>
                        </li>
                    </ul>
                    <a href="mailto:partenaires@oblink.com?subject=Je veux devenir formateur"
                        class="inline-block px-8 py-4 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange hover:text-white transition shadow-lg transform hover:-translate-y-1">
                        Devenir Formateur Oblink
                    </a>
                </div>
                <div class="relative hidden md:block">
                    <!-- Simuler une carte profil formateur -->
                    <div
                        class="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl transform rotate-3 hover:rotate-0 transition duration-500">
                        <div class="flex items-center gap-4 mb-4">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                class="w-16 h-16 rounded-full border-2 border-oblink-orange">
                            <div>
                                <h4 class="text-white font-bold text-lg">Sarah B.</h4>
                                <p class="text-gray-400 text-sm">Experte Contactologie</p>
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-xl p-4 mb-2">
                            <div class="text-xs text-gray-400 uppercase font-bold mb-1">Revenus ce mois</div>
                            <div class="text-3xl font-black text-white">2 450,00 €</div>
                        </div>
                        <div class="text-xs text-center text-gray-400 mt-2 italic"> * Revenu moyen top formateur</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4"
    onclick="closeVideoModal()">
    <div class="relative w-full max-w-5xl" onclick="event.stopPropagation()">
        <button onclick="closeVideoModal()"
            class="absolute -top-12 right-0 text-white hover:text-oblink-orange transition text-2xl">
            <i class="fas fa-times"></i>
        </button>
        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
            <iframe id="videoIframe" class="absolute top-0 left-0 w-full h-full rounded-xl" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
    </div>
</div>

<script>
    function openVideoModal(videoUrl) {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = videoUrl + '?autoplay=1';
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = '';
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>
<!-- Header: La Vision Académie HUB -->
<div class="text-center mb-16 relative">
    <span
        class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
        <i class="fas fa-graduation-cap mr-2"></i>L'excellence Optique
    </span>
    <h1 class="text-4xl md:text-6xl font-black font-display text-oblink-gray mb-6">
        Académie <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-oblink-orange to-oblink-violet">OBLINK</span>
    </h1>
    <p class="text-xl text-gray-500 max-w-3xl mx-auto font-body leading-relaxed mb-12">
        De l'étudiant au professionnel aguerri. Une plateforme unique pour réussir votre diplôme et booster
        votre carrière.
    </p>

    <!-- HUB NAVIGATION CARDS -->
    <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto text-left">

        <!-- Card 1: PASS EXAMEN (New) -->
        <a href="<?php echo home_url('/pass-examen'); ?>"
            class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-orange/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
            <div
                class="absolute top-0 right-0 w-32 h-32 bg-oblink-orange/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
            </div>
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-orange to-pink-500 text-white flex items-center justify-center text-2xl shadow-lg">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <span class="bg-red-100 text-red-600 font-bold px-3 py-1 rounded-full text-xs">NOUVEAU</span>
                </div>
                <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-orange transition">Je
                    passe mon BTS</h3>
                <p class="text-gray-500 mb-6 font-medium">Annales corrigées, IA prédictive et fiches de révision
                    pour assurer votre diplôme.</p>
                <div class="flex items-center text-oblink-blue font-bold text-sm">
                    Découvrir le Pass Examen <i
                        class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                </div>
            </div>
        </a>

        <!-- Card 2: FORMATIONS PRO (Existing) -->
        <a href="#formations-logiciels"
            class="group block relative overflow-hidden rounded-3xl border border-gray-200 hover:border-oblink-blue/50 transition-all duration-300 shadow-lg hover:shadow-2xl bg-white">
            <div
                class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2">
            </div>
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-oblink-blue to-cyan-500 text-white flex items-center justify-center text-2xl shadow-lg">
                        <i class="fas fa-laptop-medical"></i>
                    </div>
                    <span class="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded-full text-xs">PRO</span>
                </div>
                <h3 class="text-2xl font-black text-gray-900 mb-2 group-hover:text-oblink-blue transition">Je
                    suis Opticien</h3>
                <p class="text-gray-500 mb-6 font-medium">Maîtrisez les logiciels ERP et développez des
                    compétences cliniques rares.</p>
                <div class="flex items-center text-oblink-blue font-bold text-sm">
                    Voir les formations <i
                        class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition"></i>
                </div>
            </div>
        </a>
    </div>
</div>

<div id="formations-logiciels" class="pt-12"></div>


<!-- Section 1: Logiciels & ERP (Gratuit - Partenaires) -->
<div class="mb-20">
    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
        <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
            <span class="w-10 h-10 rounded-xl bg-oblink-blue text-white flex items-center justify-center text-lg"><i
                    class="fas fa-laptop-code"></i></span>
            Maîtriser les Outils (Gratuit)
        </h2>
        <span class="bg-green-100 text-green-700 font-bold px-3 py-1 rounded-full text-xs">OFFERT PAR LES
            ÉDITEURS</span>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Course Card: Cosium -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-gray-900 overflow-hidden">
                <!-- YouTube Thumbnail Preview -->
                <div class="absolute inset-0 flex items-center justify-center bg-gray-900">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        COSIUM</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 2h30
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-oblink-blue flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">Maîtriser Cosium Optic</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">De la création client à la télétransmission.
                    Le guide complet officiel.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">
                            C</div>
                        <span class="text-xs font-bold text-gray-500">Team Cosium</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>

        <!-- Course Card: Ivoirnet -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-emerald-800 overflow-hidden">
                <div class="absolute inset-0 flex items-center justify-center">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        IVOIRNET</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 1h45
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-emerald-600 flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">Ivoirnet : L'essentiel</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Gérer un magasin indépendant avec Ivoirnet.
                    Tiers-payant inclus.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs font-bold">
                            I</div>
                        <span class="text-xs font-bold text-gray-500">Team Ivoirnet</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>

        <!-- Course Card: WinOptics -->
        <div onclick="openVideoModal('https://www.youtube.com/embed/dQw4w9WgXcQ')"
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group cursor-pointer">
            <div class="relative h-48 bg-orange-700 overflow-hidden">
                <div class="absolute inset-0 flex items-center justify-center">
                    <h3 class="text-white font-black text-3xl tracking-tighter">
                        WinOptics</h3>
                </div>
                <div
                    class="absolute top-3 right-3 bg-white/20 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                    <i class="fas fa-clock mr-1"></i> 1h00
                </div>
                <div
                    class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                    <span
                        class="w-16 h-16 rounded-full bg-white text-orange-600 flex items-center justify-center text-2xl shadow-2xl transform group-hover:scale-110 transition">
                        <i class="fas fa-play ml-1"></i>
                    </span>
                </div>
            </div>
            <div class="p-5">
                <h3 class="font-bold text-lg text-oblink-gray mb-1">WinOptics Start</h3>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Prise en main rapide pour les remplacements
                    d'été.</p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-xs font-bold">
                            W</div>
                        <span class="text-xs font-bold text-gray-500">Win Academy</span>
                    </div>
                    <span class="text-oblink-blue font-bold">GRATUIT</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 2: Expertise Clinique & Technique (Premium) -->
<div class="mb-20">
    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
        <h2 class="text-2xl md:text-3xl font-bold text-oblink-gray flex items-center gap-3">
            <span class="w-10 h-10 rounded-xl bg-oblink-violet text-white flex items-center justify-center text-lg"><i
                    class="fas fa-microscope"></i></span>
            Expertise Clinique (Certifiant)
        </h2>
        <a href="#" class="text-sm font-bold text-gray-400 hover:text-oblink-violet">Tout voir <i
                class="fas fa-arrow-right ml-1"></i></a>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Course Card: Réfraction -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-indigo-900 flex items-center justify-center overflow-hidden">
                <i class="fas fa-eye text-6xl text-white/20 group-hover:scale-110 transition"></i>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                    <span class="bg-oblink-orange text-white text-[10px] font-bold px-2 py-1 rounded">BEST
                        SELLER</span>
                </div>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Refraction Complexe : Le Cas
                        par Cas</h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.9
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Analysez et résolvez 99% des plaintes clients
                    en examen de vue.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Dr. Marc L.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">159 €</span>
                </div>
            </div>
        </div>

        <!-- Course Card: Contactologie -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-teal-800 flex items-center justify-center overflow-hidden">
                <i class="fas fa-dot-circle text-6xl text-white/20 group-hover:scale-110 transition"></i>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Adaptation Lentilles Rigides
                    </h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.8
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Ne laissez plus partir de clients faute de
                    compétence en rigides.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Sarah B.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">129 €</span>
                </div>
            </div>
        </div>
        <!-- Course Card: Low Vision -->
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">
            <div class="relative h-48 bg-gray-800 flex items-center justify-center overflow-hidden">
                <i class="fas fa-search-plus text-6xl text-white/20 group-hover:scale-110 transition"></i>
            </div>
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-oblink-gray leading-tight">Initiation Basse Vision</h3>
                    <div class="flex items-center text-yellow-400 text-xs gap-1">
                        <i class="fas fa-star"></i> 4.5
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-4 line-clamp-2">Un marché de niche très rentable. Apprenez
                    les bases.</p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                    <div class="flex items-center gap-2">
                        <img src="https://randomuser.me/api/portraits/men/85.jpg"
                            class="w-8 h-8 rounded-full border border-gray-100" alt="Instructor">
                        <span class="text-xs font-bold text-gray-600">Jean V.</span>
                    </div>
                    <span class="font-black text-xl text-oblink-gray">89 €</span>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- CTA: Devenir Formateur -->
<div
    class="bg-gradient-to-br from-oblink-gray to-gray-900 rounded-3xl p-8 md:p-16 relative overflow-hidden text-center md:text-left">
    <!-- Background Decoration -->
    <div
        class="absolute top-0 right-0 w-96 h-96 bg-oblink-orange/20 rounded-full blur-[100px] pointer-events-none transform translate-x-1/2 -translate-y-1/2">
    </div>

    <div class="relative z-10 grid md:grid-cols-2 gap-12 items-center">
        <div>
            <span
                class="inline-block py-1 px-3 rounded-full bg-white/10 text-white font-bold text-xs mb-4 border border-white/20">
                APPEL AUX EXPERTS
            </span>
            <h2 class="text-3xl md:text-4xl font-black text-white font-display mb-6">Monétisez votre expertise
                optique</h2>
            <ul class="space-y-4 mb-8 text-gray-300">
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Touchez <strong>70% de commission</strong> sur chaque vente.</span>
                </li>
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Nous gérons le marketing et la plateforme.</span>
                </li>
                <li class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-oblink-orange"></i>
                    <span>Accès immédiat à +500 opticiens qualifiés.</span>
                </li>
            </ul>
            <a href="mailto:partenaires@oblink.com?subject=Je veux devenir formateur"
                class="inline-block px-8 py-4 bg-white text-oblink-gray font-bold rounded-xl hover:bg-oblink-orange hover:text-white transition shadow-lg transform hover:-translate-y-1">
                Devenir Formateur Oblink
            </a>
        </div>
        <div class="relative hidden md:block">
            <!-- Simuler une carte profil formateur -->
            <div
                class="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl transform rotate-3 hover:rotate-0 transition duration-500">
                <div class="flex items-center gap-4 mb-4">
                    <img src="https://randomuser.me/api/portraits/women/44.jpg"
                        class="w-16 h-16 rounded-full border-2 border-oblink-orange">
                    <div>
                        <h4 class="text-white font-bold text-lg">Sarah B.</h4>
                        <p class="text-gray-400 text-sm">Experte Contactologie</p>
                    </div>
                </div>
                <div class="bg-black/30 rounded-xl p-4 mb-2">
                    <div class="text-xs text-gray-400 uppercase font-bold mb-1">Revenus ce mois</div>
                    <div class="text-3xl font-black text-white">2 450,00 €</div>
                </div>
                <div class="text-xs text-center text-gray-400 mt-2 italic"> * Revenu moyen top formateur</div>
            </div>
        </div>
    </div>
</div>

</div>
</div>

<!-- Video Modal -->
<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4"
    onclick="closeVideoModal()">
    <div class="relative w-full max-w-5xl" onclick="event.stopPropagation()">
        <button onclick="closeVideoModal()"
            class="absolute -top-12 right-0 text-white hover:text-oblink-orange transition text-2xl">
            <i class="fas fa-times"></i>
        </button>
        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
            <iframe id="videoIframe" class="absolute top-0 left-0 w-full h-full rounded-xl" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
    </div>
</div>

<!-- Course Detail Modal (Expert Cosium) -->
<div id="courseModal" class="fixed inset-0 bg-black/90 z-[9999] hidden items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-3xl w-full max-w-4xl min-h-[50vh] relative animate-fade-in-up flex flex-col"
        onclick="event.stopPropagation()">

        <!-- Modal Header -->
        <div
            class="sticky top-0 bg-white/95 backdrop-blur z-20 border-b border-gray-100 p-6 flex justify-between items-center rounded-t-3xl">
            <div>
                <span
                    class="bg-oblink-blue/10 text-oblink-blue font-bold px-3 py-1 rounded-full text-xs mb-2 inline-block">
                    <i class="fas fa-certificate mr-1"></i> CERTIFIANT
                </span>
                <h2 class="text-2xl md:text-3xl font-black text-oblink-gray">Expert Cosium 2026</h2>
            </div>
            <button onclick="closeCourseModal()"
                class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Scrollable Content -->
        <div class="p-8 md:p-12 overflow-y-auto flex-grow">

            <!-- Intro / Why -->
            <div class="mb-12">
                <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-fire text-orange-500"></i> Pourquoi ce module est indispensable ?
                </h3>
                <p class="text-gray-600 leading-relaxed text-lg">
                    En 2026, la maîtrise superficielle de Cosium ne suffit plus. Entre la généralisation de la
                    facturation électronique et les nouvelles normes de télétransmission, une erreur de saisie peut
                    bloquer des milliers d'euros de trésorerie pour un magasin. Ce module vous apprend à devenir <span
                        class="font-bold text-oblink-gray bg-yellow-100 px-1">l'opticien que les gérants
                        s'arrachent</span> : celui qui fluidifie les ventes sans jamais générer de rejets.
                </p>
            </div>

            <!-- The Technical Program -->
            <div class="mb-12 bg-gray-50 rounded-2xl p-8 border border-gray-100">
                <h3 class="text-xl font-black text-oblink-gray mb-6 uppercase tracking-wider text-center">
                    Le Programme Technique (Expert Grade)
                </h3>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Block 1 -->
                    <div>
                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">1</span>
                            Configuration & Mesures
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2 mb-6">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Intégration colonnes prise de mesures (Activisu...)</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> Gestion
                                historique réfraction & comparatifs</li>
                        </ul>

                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">2</span>
                            Ingénierie Tiers-Payant
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> <span
                                    class="font-bold">PEC Automatisée :</span> Paramétrage conventions</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> <span
                                    class="font-bold">Anti-Rejets :</span> Méthode "Resubmission" (Noémie, LPP erronés)
                            </li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Optimisation des devis mixtes 100% Santé</li>
                        </ul>
                    </div>

                    <!-- Block 2 -->
                    <div>
                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">3</span>
                            Stock & Logistique EDI
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2 mb-6">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Réception EDI & Étiquetage auto</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Inventaire tournant sans fermer le magasin</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i> Relances
                                fournisseurs automatiques</li>
                        </ul>

                        <h4 class="font-bold text-oblink-blue mb-3 flex items-center gap-2">
                            <span
                                class="w-6 h-6 rounded-full bg-oblink-blue text-white flex items-center justify-center text-xs">4</span>
                            Conformité & Sécurité
                        </h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Signature électronique & RGPD</li>
                            <li class="flex items-start gap-2"><i class="fas fa-check text-green-500 mt-1"></i>
                                Facturation électronique (PPF)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- EXAMEN QUIZ SECTION (New) -->
            <div class="mb-12 bg-white rounded-2xl p-8 border-2 border-oblink-blue/10 shadow-lg relative overflow-hidden"
                id="quiz-section">
                <div class="absolute top-0 right-0 w-32 h-32 bg-oblink-blue/5 rounded-full blur-2xl -mr-10 -mt-10">
                </div>

                <h3 class="text-xl font-black text-oblink-gray mb-2 flex items-center gap-2 relative z-10">
                    <i class="fas fa-vial text-oblink-blue"></i> Testez votre niveau "Expert"
                </h3>
                <p class="text-sm text-gray-500 mb-6 relative z-10">Répondez à ces 3 situations critiques pour voir si
                    vous avez besoin de cette formation.</p>

                <!-- Step 1: Start -->
                <div id="quiz-start" class="text-center py-6">
                    <button onclick="startQuiz()"
                        class="bg-oblink-gray text-white font-bold py-3 px-8 rounded-xl hover:bg-black transition transform hover:scale-105 shadow-xl ring-4 ring-oblink-gray/10">
                        <i class="fas fa-play mr-2"></i> Lancer le Test (3 min)
                    </button>
                    <p class="text-xs text-gray-400 mt-3 italic">Réservé aux opticiens diplômés</p>
                </div>

                <!-- Step 2: Questions (Hidden by default) -->
                <div id="quiz-question-container" class="hidden">
                    <div class="mb-4 flex justify-between items-center">
                        <span class="text-xs font-bold text-oblink-blue bg-blue-50 px-2 py-1 rounded">QUESTION <span
                                id="current-q-num">1</span>/3</span>
                        <div class="h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden">
                            <div id="quiz-progress-bar" class="h-full bg-oblink-blue w-1/3 transition-all duration-500">
                            </div>
                        </div>
                    </div>

                    <h4 id="question-text" class="font-bold text-lg text-gray-800 mb-6"></h4>

                    <div class="space-y-3" id="answers-container">
                        <!-- Answers injected via JS -->
                    </div>
                </div>

                <!-- Step 3: Success Result (Hidden) -->
                <div id="quiz-result-success" class="hidden text-center py-6 animate-fade-in-up">
                    <div
                        class="w-16 h-16 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-3xl mx-auto mb-4">
                        <i class="fas fa-check"></i>
                    </div>
                    <h4 class="font-black text-xl text-gray-900 mb-2">Bien joué !</h4>
                    <p class="text-sm text-gray-600 mb-6">Vous avez de bonnes bases, mais le Tiers-Payant 2026 demande
                        une précision chirurgicale. Ce module va vous rendre infaillible.</p>
                    <button onclick="scrollToCTA()" class="text-oblink-blue font-bold underline">Voir l'offre
                        spéciale</button>
                </div>

                <!-- Step 3: Fail Result (Hidden) -->
                <div id="quiz-result-fail" class="hidden text-center py-6 animate-fade-in-up">
                    <div
                        class="w-16 h-16 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-3xl mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h4 class="font-black text-xl text-gray-900 mb-2">Alerte Formation</h4>
                    <p class="text-sm text-gray-600 mb-6">Ces erreurs vous coûteraient cher en magasin réel. Il est
                        urgent de vous mettre à niveau avant de postuler.</p>
                    <button onclick="scrollToCTA()" class="text-oblink-orange font-bold underline">Profiter de la
                        formation (-30%)</button>
                </div>

            </div>

            <!-- Method & Bonus -->
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div
                    class="bg-gradient-to-br from-oblink-violet/10 to-transparent p-6 rounded-2xl border border-oblink-violet/20">
                    <h3 class="font-bold text-lg text-oblink-violet mb-4"><i class="fas fa-brain mr-2"></i> La Méthode
                        OBLINK</h3>
                    <ul class="space-y-3 text-sm text-gray-700">
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Bac à sable Cosium :</strong> Entraînez-vous sans risque.
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Quiz de Validation :</strong> 20 situations critiques à résoudre.
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-violet"></span>
                            <strong>Support IA 24/7 :</strong> Votre "Professeur Virtuel" dédié.
                        </li>
                    </ul>
                </div>

                <div
                    class="bg-gradient-to-br from-oblink-orange/10 to-transparent p-6 rounded-2xl border border-oblink-orange/20">
                    <h3 class="font-bold text-lg text-oblink-orange mb-4"><i class="fas fa-gift mr-2"></i> Bonus :
                        Survival Kit</h3>
                    <ul class="space-y-3 text-sm text-gray-700">
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-orange"></span>
                            Checklist "Prise de Poste" (Check-up magasin)
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-oblink-orange"></span>
                            Guide Codes LPP 2026 (Imprimable)
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Sticky CTA Mobile / Bottom -->
            <div id="modal-cta" class="text-center pt-8 border-t border-gray-100">
                <div
                    class="flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-900 text-white p-4 rounded-xl">
                    <div class="text-left">
                        <div class="text-sm text-gray-400">Investissement PRO</div>
                        <div class="text-3xl font-black">99 € <span
                                class="text-xs font-normal text-gray-500">(Déductible frais pro)</span></div>
                    </div>
                    <button
                        class="w-full md:w-auto px-8 py-4 bg-oblink-orange text-white font-bold rounded-xl hover:bg-white hover:text-oblink-orange transition transform hover:scale-105 shadow-lg">
                        🚀 M'INSCRIRE MAINTENANT
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-4">Accès immédiat • Satisfait ou Remboursé 14j</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Video Modal
    function openVideoModal(videoUrl) {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = videoUrl + '?autoplay=1';
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        iframe.src = '';
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }

    // Course Modal
    function openCourseModal(courseId) {
        const modal = document.getElementById('courseModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeCourseModal() {
        const modal = document.getElementById('courseModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }

    function scrollToCTA() {
        document.getElementById('modal-cta').scrollIntoView({ behavior: 'smooth' });
    }

    // --- QUIZ LOGIC (Static Expert Questions) ---
    const quizData = [
        {
            question: "Rejet Tiers-Payant 'Droits Incomplets' avec carte valide. Quelle action immédiate ?",
            answers: [
                { text: "Forcer la télétransmission", isCorrect: false },
                { text: "Vérifier code convention & dates PEC", isCorrect: true },
                { text: "Appeler la mutuelle (15 min)", isCorrect: false }
            ]
        },
        {
            question: "Écart de stock -5 montures RayBan. Le magasin est plein. Que faites-vous ?",
            answers: [
                { text: "Inventaire complet (Fermeture)", isCorrect: false },
                { text: "Inventaire partiel + Régul Vol", isCorrect: true },
                { text: "Attendre le prochain bilan", isCorrect: false }
            ]
        },
        {
            question: "Facturation 100% Santé (Classe A) bloquée. Erreur fréquente ?",
            answers: [
                { text: "Code LPP Monture ne matche pas Panier A", isCorrect: true },
                { text: "Le client n'a pas sa carte Vitale", isCorrect: false },
                { text: "Erreur serveur Cosium", isCorrect: false }
            ]
        }
    ];

    let currentQuestion = 0;
    let score = 0;

    function startQuiz() {
        document.getElementById('quiz-start').classList.add('hidden');
        document.getElementById('quiz-question-container').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = quizData[currentQuestion];
        document.getElementById('question-text').innerText = q.question;
        document.getElementById('current-q-num').innerText = currentQuestion + 1;

        // Progress bar
        const progress = ((currentQuestion + 1) / quizData.length) * 100;
        document.getElementById('quiz-progress-bar').style.width = progress + "%";

        const answersDiv = document.getElementById('answers-container');
        answersDiv.innerHTML = '';

        q.answers.forEach(ans => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition flex items-center justify-between group";
            btn.innerHTML = `
                <span class="font-medium text-gray-700 group-hover:text-oblink-blue">${ans.text}</span>
                <i class="fas fa-chevron-right text-gray-300"></i>
            `;
            btn.onclick = () => selectAnswer(ans.isCorrect);
            answersDiv.appendChild(btn);
        });
    }

    function selectAnswer(isCorrect) {
        if (isCorrect) score++;

        if (currentQuestion < quizData.length - 1) {
            currentQuestion++;
            showQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('quiz-question-container').classList.add('hidden');
        if (score >= 2) {
            document.getElementById('quiz-result-success').classList.remove('hidden');
        } else {
            document.getElementById('quiz-result-fail').classList.remove('hidden');
        }
    }

</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-devis.php ---
<?php
/*
Template Name: Devis
*/
include 'header-inc.php';
?>

<div class="max-w-[1600px] mx-auto px-4 pt-32 pb-32">
    <!-- Back Link -->
    <div class="mb-6">
        <a href="<?php echo home_url('/dashboard-opticien'); ?>"
            class="text-oblink-blue font-semibold hover:underline inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Retour au tableau de bord
        </a>
    </div>

    <div class="grid lg:grid-cols-2 gap-8 items-start">

        <!-- LEFT COLUMN: FORM -->
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 h-fit">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-oblink-gray mb-2">
                    <i class="fas fa-file-alt text-oblink-blue mr-2"></i>
                    Éditeur de <span class="text-oblink-blue">Devis</span>
                </h1>
                <p class="text-sm text-oblink-gray/70">Remplissez les champs pour générer votre devis.</p>
            </div>

            <form id="quote-form" data-validate class="space-y-6">
                <!-- Quote Info -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-info-circle text-oblink-blue mr-2"></i> Informations
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Numéro</label>
                            <input type="text" id="input-number" name="quoteNumber"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-oblink-blue outline-none text-sm"
                                value="DEV-2025-001">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date d'émission</label>
                            <input type="date" id="input-date" name="issueDate"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                                value="<?php echo date('Y-m-d'); ?>">
                        </div>
                    </div>
                </div>

                <!-- Mission Dates (New) -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-calendar-alt text-oblink-blue mr-2"></i> Période de Mission
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date de début</label>
                            <input type="date" id="input-start-date" name="startDate"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-oblink-blue outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Date de fin (Optionnel)</label>
                            <input type="date" id="input-end-date" name="endDate"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm">
                        </div>
                    </div>
                </div>

                <!-- Client -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-building text-oblink-violet mr-2"></i> Client
                    </h2>
                    <div class="space-y-3">
                        <input type="text" id="input-client-name" name="toName"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Nom de l'entreprise client">
                        <input type="text" id="input-client-address" name="toAddress"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Adresse complète">
                    </div>
                </div>

                <!-- Prestations -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-list text-oblink-orange mr-2"></i> Prestations
                    </h2>
                    <div id="services-container" class="space-y-4">
                        <!-- Service Line 1 -->
                        <div class="service-line border border-gray-200 rounded-lg p-3 bg-gray-50">
                            <input type="text"
                                class="w-full mb-2 bg-transparent border-b border-gray-300 focus:border-oblink-orange outline-none text-sm font-medium service-desc"
                                placeholder="Description de la mission" value="Mission de remplacement Opticien">
                            <div class="flex gap-3">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-500">Qté (Jours)</label>
                                    <input type="number" class="w-full p-1 border rounded text-sm service-qty" value="3"
                                        min="1">
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-500">Prix Uni. HT</label>
                                    <input type="number" class="w-full p-1 border rounded text-sm service-price"
                                        value="280" min="0">
                                </div>
                                <div class="flex items-end">
                                    <button type="button"
                                        class="text-red-500 hover:bg-red-50 p-2 rounded remove-service"><i
                                            class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="add-service"
                        class="mt-3 text-sm text-oblink-blue font-bold hover:underline">
                        <i class="fas fa-plus-circle"></i> Ajouter une ligne
                    </button>
                </div>

                <!-- Frais -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4 flex items-center justify-between">
                        <span><i class="fas fa-receipt text-green-600 mr-2"></i> Note de Frais</span>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-expenses" class="sr-only peer">
                            <div
                                class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600 relative">
                            </div>
                        </label>
                    </h2>
                    <div id="expenses-section"
                        class="hidden space-y-3 bg-green-50 p-4 rounded-lg border border-green-100">
                        <input type="text" id="input-expense-desc"
                            class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                            placeholder="Description (ex: Déplacement AR Train, Repas midi)"
                            value="Frais de déplacement">
                        <div class="flex items-center gap-2">
                            <input type="number" id="input-expense-amount"
                                class="w-32 px-3 py-2 border rounded-lg outline-none text-sm font-bold text-green-700"
                                placeholder="0.00">
                            <span class="text-sm text-green-700">€ HT</span>
                        </div>
                    </div>
                </div>

                <!-- Options d'envoi (V51) -->
                <div class="border-b border-oblink-beige pb-6">
                    <h2 class="text-lg font-bold text-oblink-gray mb-4">
                        <i class="fas fa-paper-plane text-oblink-blue mr-2"></i> Options d'envoi
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-oblink-gray mb-1">Email du client</label>
                            <input type="email" id="input-client-email" name="clientEmail"
                                class="w-full px-3 py-2 border rounded-lg outline-none text-sm"
                                placeholder="client@exemple.com">
                            <p class="text-[10px] text-gray-400 mt-1">L'email sera pré-rempli si le client est reconnu.
                            </p>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="send-internal" name="sendInternal"
                                class="w-4 h-4 text-oblink-blue rounded border-gray-300 focus:ring-oblink-blue">
                            <label for="send-internal"
                                class="ml-2 text-sm text-gray-600 font-medium cursor-pointer">Envoyer également via la
                                messagerie interne OBLINK</label>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-3 pt-4">
                    <div class="flex gap-4">
                        <button type="submit"
                            class="flex-1 py-3 bg-oblink-orange text-white rounded-xl font-bold hover:bg-oblink-orange/90 shadow-lg shadow-orange-200 transition">
                            <i class="fas fa-save mr-2"></i>Valider & Envoyer
                        </button>
                    </div>

                    <div class="flex gap-4">
                        <a href="<?php echo home_url('/dashboard-opticien'); ?>"
                            class="flex-1 px-4 py-3 border border-gray-300 text-gray-500 text-center rounded-xl hover:bg-gray-50 transition font-semibold text-sm">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </a>
                        <!-- Convert Button -->
                        <button type="button" id="btn-convert-invoice"
                            class="flex-1 px-4 py-3 border-2 border-oblink-blue text-oblink-blue rounded-xl hover:bg-oblink-blue hover:text-white transition font-semibold text-sm">
                            <i class="fas fa-exchange-alt mr-2"></i>Transformer en Facture
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <script>
            // Handle "Transformer en Facture"
            document.getElementById('btn-convert-invoice').addEventListener('click', function () {
                // Collect Data
                const clientName = encodeURIComponent(document.getElementById('input-client-name').value);
                const clientAddress = encodeURIComponent(document.getElementById('input-client-address').value);
                // Simple redirection with basic params for MVP
                const url = `<?php echo home_url('/facture'); ?>?from=devis&client=${clientName}&address=${clientAddress}`;
                window.location.href = url;
            });
        </script>

        <!-- RIGHT COLUMN: PREVIEW (A4 Paper Style) -->
        <div class="hidden lg:block sticky top-24">
            <div class="bg-gray-800 rounded-t-xl py-2 px-4 flex justify-between items-center text-white text-xs">
                <span><i class="fas fa-eye mr-2"></i>Aperçu en direct</span>
                <span>Format A4</span>
            </div>
            <div id="pdf-preview"
                class="bg-white mx-auto shadow-2xl p-8 md:p-12 min-h-[800px] text-xs md:text-sm text-gray-800 relative font-sans"
                style="aspect-ratio: 210/297;">

                <!-- HEADER PREVIEW -->
                <div class="flex justify-between items-start mb-12">
                    <div>
                        <h2 class="text-2xl font-bold text-oblink-blue mb-1">DEVIS</h2>
                        <p class="text-gray-500 font-mono" id="preview-number">DEV-2025-001</p>
                        <p class="text-gray-400 text-[10px] mt-1">Date: <span
                                id="preview-date"><?php echo date('d/m/Y'); ?></span></p>
                        <p class="text-gray-400 text-[10px]">Période: <span id="preview-period"
                                class="font-medium text-gray-600">-</span></p>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-lg mb-1">OPTICIEN FREELANCE</div>
                        <div class="text-gray-500 text-xs">
                            Sarah Dubois<br>
                            123 rue de la République<br>
                            75001 Paris<br>
                            SIRET: 123 456 789 00012
                        </div>
                    </div>
                </div>

                <!-- CLIENT PREVIEW -->
                <div class="mb-12 bg-gray-50 p-4 rounded-lg border border-gray-100 w-1/2 ml-auto">
                    <p class="text-[10px] uppercase text-gray-400 font-bold mb-1">Client</p>
                    <p class="font-bold text-lg text-gray-800" id="preview-client-name">Nom du Client</p>
                    <p class="text-gray-500" id="preview-client-address">Adresse du client...</p>
                </div>

                <!-- TABLE PREVIEW -->
                <table class="w-full mb-8">
                    <thead class="bg-oblink-blue text-white">
                        <tr>
                            <th class="py-2 px-3 text-left rounded-l-md">Description</th>
                            <th class="py-2 px-3 text-right">Qté</th>
                            <th class="py-2 px-3 text-right">Prix Uni.</th>
                            <th class="py-2 px-3 text-right rounded-r-md">Total HT</th>
                        </tr>
                    </thead>
                    <tbody id="preview-lines" class="text-gray-600">
                        <!-- Lines injected via JS -->
                    </tbody>
                    <!-- Expenses Line -->
                    <tbody id="preview-expenses" class="hidden text-green-700 bg-green-50/50">
                        <tr>
                            <td class="py-3 px-3 border-b border-green-100 flex items-center">
                                <i class="fas fa-receipt mr-2 text-xs"></i> <span id="preview-expense-desc">Frais</span>
                            </td>
                            <td class="py-3 px-3 text-right border-b border-green-100">1</td>
                            <td class="py-3 px-3 text-right border-b border-green-100" id="preview-expense-price">0.00 €
                            </td>
                            <td class="py-3 px-3 text-right border-b border-green-100 font-bold"
                                id="preview-expense-total">0.00 €</td>
                        </tr>
                    </tbody>
                </table>

                <!-- TOTALS PREVIEW -->
                <div class="flex justify-end">
                    <div class="w-1/2 space-y-2">
                        <div class="flex justify-between border-b pb-1">
                            <span>Total HT</span>
                            <span class="font-bold" id="preview-total-ht">0,00 €</span>
                        </div>
                        <div class="flex justify-between border-b pb-1 text-gray-400">
                            <span>TVA (0%)</span>
                            <span>0,00 €</span>
                        </div>
                        <div class="flex justify-between pt-1 text-lg font-bold text-oblink-orange">
                            <span>Net à payer</span>
                            <span id="preview-total-ttc">0,00 €</span>
                        </div>
                        <p class="text-[9px] text-gray-400 text-right mt-2">
                            TVA non applicable, art. 293 B du CGI (Franchise en base).
                        </p>
                    </div>
                </div>

                <!-- FOOTER PREVIEW -->
                <div class="absolute bottom-12 left-12 right-12 text-center border-t pt-4 text-[10px] text-gray-400">
                    Conditions de règlement : Paiement à réception de facture. <br>
                    En cas de retard, indemnité forfaitaire de 40€ pour frais de recouvrement.
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        // --- 1. SYNC FUNCTIONS ---
        function updatePreview() {
            // Update Basic Info
            document.getElementById('preview-number').textContent = document.getElementById('input-number').value || 'DEV-XXX';

            const dateVal = document.getElementById('input-date').value;
            if (dateVal) {
                const [y, m, d] = dateVal.split('-');
                document.getElementById('preview-date').textContent = `${d}/${m}/${y}`;
            }

            document.getElementById('preview-client-name').textContent = document.getElementById('input-client-name').value || 'Nom du Client';
            document.getElementById('preview-client-address').textContent = document.getElementById('input-client-address').value || '...';

            // Update Period
            const startRaw = document.getElementById('input-start-date').value;
            const endRaw = document.getElementById('input-end-date').value;
            if (startRaw) {
                const [sy, sm, sd] = startRaw.split('-');
                let periodStr = `Du ${sd}/${sm}/${sy}`;
                if (endRaw) {
                    const [ey, em, ed] = endRaw.split('-');
                    periodStr += ` au ${ed}/${em}/${ey}`;
                }
                document.getElementById('preview-period').textContent = periodStr;
            } else {
                document.getElementById('preview-period').textContent = '-';
            }

            // Lines
            const tbody = document.getElementById('preview-lines');
            tbody.innerHTML = '';
            let total = 0;

            // Service Lines
            document.querySelectorAll('.service-line').forEach(line => {
                const desc = line.querySelector('.service-desc').value;
                const qty = parseFloat(line.querySelector('.service-qty').value) || 0;
                const price = parseFloat(line.querySelector('.service-price').value) || 0;
                const lineTotal = qty * price;
                total += lineTotal;

                if (desc || lineTotal > 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="py-2 px-3 border-b border-gray-50">${desc}</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50">${qty}</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50">${price.toFixed(2)} €</td>
                        <td class="py-2 px-3 text-right border-b border-gray-50 font-medium">${lineTotal.toFixed(2)} €</td>
                    `;
                    tbody.appendChild(tr);
                }
            });

            // Expense Line
            const hasExpense = document.getElementById('toggle-expenses').checked;
            const expenseSection = document.getElementById('preview-expenses');
            if (hasExpense) {
                const expenseDesc = document.getElementById('input-expense-desc').value;
                const expenseAmount = parseFloat(document.getElementById('input-expense-amount').value) || 0;

                document.getElementById('preview-expense-desc').textContent = expenseDesc;
                document.getElementById('preview-expense-price').textContent = expenseAmount.toFixed(2) + ' €';
                document.getElementById('preview-expense-total').textContent = expenseAmount.toFixed(2) + ' €';

                expenseSection.classList.remove('hidden');
                total += expenseAmount;
            } else {
                expenseSection.classList.add('hidden');
            }

            // Totals
            document.getElementById('preview-total-ht').textContent = total.toFixed(2).replace('.', ',') + ' €';
            document.getElementById('preview-total-ttc').textContent = total.toFixed(2).replace('.', ',') + ' €';
        }

        // --- 2. EVENTS ---

        // Live Update on Input
        document.getElementById('quote-form').addEventListener('input', updatePreview);

        // Toggle Expenses
        document.getElementById('toggle-expenses').addEventListener('change', function () {
            const section = document.getElementById('expenses-section');
            if (this.checked) {
                section.classList.remove('hidden');
            } else {
                section.classList.add('hidden');
            }
            updatePreview();
        });

        // Add Service
        document.getElementById('add-service').addEventListener('click', function () {
            const container = document.getElementById('services-container');
            const template = container.querySelector('.service-line').cloneNode(true);
            template.querySelector('.service-desc').value = '';
            template.querySelector('.service-qty').value = 1;
            template.querySelector('.service-price').value = 0;

            // Re-attach delete event
            template.querySelector('.remove-service').addEventListener('click', function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    updatePreview();
                }
            });

            container.appendChild(template);
            updatePreview();
        });

        // Remove Service (Initial)
        document.querySelectorAll('.remove-service').forEach(btn => {
            btn.addEventListener('click', function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    updatePreview();
                }
            });
        });

        // Initialize
        updatePreview();

        // Submit Mock
        document.getElementById('quote-form').addEventListener('submit', function (e) {
            e.preventDefault();
            alert('Devis enregistré et prêt à être envoyé !');
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-dashboard-entreprise.php ---
<?php
/*
Template Name: Page Dashboard Entreprise
*/
include 'header-inc.php';

// 1. DATA SIMULATION (MOCK)
// $user = wp_get_current_user(); <-- Removed for Supabase
$company_name = "Votre Entreprise"; // Placeholder until JS loads

// Offres simulées
?>
<!-- JS AUTH GUARD (Supabase) -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Wait for Supabase to be ready
        if (!window.oblinkSupabase) {
            console.error('Supabase not loaded!');
            // Show content anyway in dev mode
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');
            return;
        }

        try {
            // 2. Check Auth
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                console.error('Auth error:', error);
                const content = document.getElementById('dashboard-content');
                if (content) content.classList.remove('opacity-0');
                return;
            }

            if (!session) {
                window.location.href = '<?php echo home_url("/login"); ?>';
                return;
            }

            // 3. Check User Type
            const userType = session.user.user_metadata?.user_type;
            if (userType && userType !== 'entreprise') {
                // Wrong dashboard -> Show clear message then redirect
                const dashboardContent = document.getElementById('dashboard-content');
                dashboardContent.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="max-w-md text-center p-8 bg-white rounded-2xl shadow-xl border border-gray-100">
                            <div class="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-circle text-red-500 text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-oblink-gray mb-3">Accès Refusé</h2>
                            <p class="text-gray-600 mb-6">
                                Cette page est réservée aux <strong>entreprises</strong>.<br>
                                Vous serez redirigé vers votre tableau de bord...
                            </p>
                            <div class="animate-pulse text-sm text-gray-400">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Redirection en cours
                            </div>
                        </div>
                    </div>
                `;
                dashboardContent.classList.remove('opacity-0');

                // Redirect after 2 seconds
                setTimeout(() => {
                    if (userType === 'opticien') window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                    else window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }, 2000);
                return;
            }

            // 4. Inject Company Info
            const companyNameElement = document.querySelector('.text-oblink-blue');
            if (companyNameElement) {
                companyNameElement.textContent = session.user.user_metadata?.company_name || 'Entreprise';
            }

            // 5. Show Content
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');

        } catch (err) {
            console.error('Dashboard auth error:', err);
            // Show content anyway to avoid blank page
            const content = document.getElementById('dashboard-content');
            if (content) content.classList.remove('opacity-0');
        }
    });
</script>
<?php

// 1. DATA SIMULATION (MOCK)
$company_name = "Votre Entreprise"; // Placeholder until JS loads

// Offres simulées
$jobs = [
    [
        'title' => 'Remplacement Été (Juillet/Août)',
        'date' => 'Juillet - Août 2025',
        'type' => 'CDD',
        'salary' => '350€ /j',
        'views' => 45,
        'status' => 'Active',
        'candidates_count' => 3
    ],
    [
        'title' => 'Opticien Collaborateur Samedi',
        'date' => 'Dès que possible',
        'type' => 'CDI Partiel',
        'salary' => 'Selon profil',
        'views' => 124,
        'status' => 'Active',
        'candidates_count' => 8
    ]
];

// Si on vient de poster une offre (simulation : on l'ajoute en tête)
if (isset($_GET['success']) && $_GET['success'] === 'job_posted') {
    array_unshift($jobs, [
        'title' => 'Nouvelle Mission (Postée à l\'instant)',
        'date' => 'À définir',
        'type' => 'CDD',
        'salary' => 'À définir',
        'views' => 0,
        'status' => 'Active',
        'candidates_count' => 0
    ]);
}

// KPI Calculés
$active_jobs_count = count($jobs);
$total_candidates = 14;
$confirmed_missions = 5;
?>

<div id="dashboard-content" class="min-h-screen bg-gray-50 pt-24 pb-12 transition-opacity duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Verification Banner (Account Only) -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 rounded-r-xl shadow-sm relative group">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                        <span class="font-bold">Compte en attente de certification.</span>
                        Votre profil a bien été enregistré. Un membre de l'équipe OBLINK va vous contacter (sous 24h)
                        pour certifier votre établissement.
                    </p>
                </div>
                <!-- Mock Close Button -->
                <button class="absolute top-2 right-2 text-yellow-400 hover:text-yellow-600"
                    onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- GRID LAYOUT -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- LEFT COLUMN -->
            <div class="lg:col-span-2 space-y-8">

                <!-- Welcome Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-3xl font-bold font-display text-oblink-gray">Espace Recruteur <span
                                class="text-oblink-blue">
                                <?php echo esc_html($company_name); ?>
                            </span></h1>
                        <p class="text-gray-500">Gérez vos recrutements (CDI/CDD) et missions freelance au même endroit.
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <a href="<?php echo home_url('/parametres'); ?>"
                            class="px-4 py-2 bg-white border border-gray-200 rounded-xl font-semibold text-gray-600 hover:border-oblink-blue hover:text-oblink-blue transition flex items-center gap-2">
                            <i class="fas fa-cog"></i> Paramètres
                        </a>
                        <a href="<?php echo home_url('/publier-offre'); ?>"
                            class="px-4 py-2 bg-oblink-blue text-white rounded-xl font-bold hover:bg-oblink-gray transition flex items-center gap-2 shadow-lg shadow-blue-200">
                            <i class="fas fa-plus-circle"></i> Publier une annonce
                        </a>
                    </div>
                </div>

                <!-- KPI Cards -->
                <!-- ... (Skipping KPI changes for brevity unless requested) ... -->

                <!-- ... -->

                <!-- Vos Offres -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">Vos Annonces (Emploi & Missions)
                        </h2>
                        <a href="#" class="text-sm font-semibold text-oblink-blue hover:underline">Gérer tout</a>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <?php foreach ($jobs as $job):
                            $status_color = ($job['status'] === 'Active') ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700';
                            $type_badge_color = (strpos($job['type'], 'CDD') !== false) ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700';
                            ?>
                            <div
                                class="p-5 border border-gray-200 rounded-2xl hover:border-oblink-blue transition cursor-pointer relative">
                                <span
                                    class="absolute top-5 right-5 <?php echo $type_badge_color; ?> text-[10px] font-bold px-2 py-0.5 rounded-full uppercase">
                                    <?php echo $job['type']; ?>
                                </span>

                                <div class="flex justify-between items-start mb-2">
                                    <span class="<?php echo $status_color; ?> text-xs font-bold px-2 py-1 rounded-full">
                                        <?php echo $job['status']; ?>
                                    </span>
                                </div>
                                <h3 class="font-bold text-oblink-gray mb-1 pr-12">
                                    <?php echo $job['title']; ?>
                                </h3>
                                <p class="text-sm text-gray-500 mb-3"><i class="far fa-clock mr-1"></i>
                                    <?php echo $job['date']; ?>
                                </p>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="font-bold text-oblink-blue">
                                        <?php echo $job['salary']; ?>
                                    </span>
                                    <span class="text-gray-400">
                                        <?php echo $job['views']; ?> Vues
                                    </span>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>

                <!-- CANDIDATURES (New Section) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">
                            <i class="fas fa-users text-oblink-violet mr-2"></i>Dernières Candidatures
                        </h2>
                        <a href="#" class="text-sm font-semibold text-oblink-blue hover:underline">Voir tout</a>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="text-xs text-gray-400 border-b border-gray-100">
                                    <th class="py-3 font-semibold uppercase">Candidat</th>
                                    <th class="py-3 font-semibold uppercase">Offre</th>
                                    <th class="py-3 font-semibold uppercase">Date</th>
                                    <th class="py-3 font-semibold uppercase">Statut</th>
                                    <th class="py-3 font-semibold uppercase text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-candidatures-body" class="text-sm text-gray-600">
                                <!-- Dynamic Content -->
                                <tr>
                                    <td colspan="5" class="py-8 text-center text-gray-400">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p>Chargement des candidatures...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', async () => {
                        const tbody = document.getElementById('dashboard-candidatures-body');
                        const currentUserId = '<?php echo get_current_user_id(); ?>'; // We need Supabase ID, not WP ID. Assuming they are linked or we use Supabase Auth session.

                        // Actually, better to rely on Supabase session since we are client-side
                        const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                        if (!session) {
                            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-400">Non connecté à Supabase</td></tr>';
                            return;
                        }
                        const user = session.user;

                        try {
                            // 1. Get my offers IDs first (recursive approach or direct join if RLS allows)
                            // More efficient: Fetch applications where offer.company_id = me.
                            // Supabase filtered query on foreign table is easier.

                            const { data: applications, error } = await window.oblinkSupabase
                                .from('applications')
                                .select(`
                                *,
                                opticien:profiles!opticien_id (
                                    id, first_name, last_name, full_name
                                ),
                                offer:offers!offer_id (
                                    id, title
                                )
                            `)
                                // We need to filter by offers owned by THIS company.
                                // RLS 'Companies can view applications for own offers' should handle this implicitly if set up correctly?
                                // Let's rely on RLS or specific filter.
                                // Ideally: .eq('offer.company_id', user.id) -> Supabase JS supports filtering on joined tables.
                                .eq('offer.company_id', user.id)
                                .order('created_at', { ascending: false })
                                .limit(5);

                            /* 
                               NOTE: If the RLS on 'applications' table is set to:
                               USING (offer_id IN (SELECT id FROM offers WHERE company_id = auth.uid()))
                               Then a simple select() is enough, no need for explicit .eq() filter on joined table if RLS enforces it.
                               However, explicit filter is safer for logic if RLS is 'true' for some reason.
                               Supabase JS filtering on joined resource: .eq('offers.company_id', user.id) might be tricky depending on version.
                               Let's try standard select first, expecting RLS to filter results to only mine.
                            */

                            if (error) throw error;

                            if (!applications || applications.length === 0) {
                                tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-400">Aucune candidature reçue pour le moment.</td></tr>';
                                return;
                            }

                            // Render rows
                            tbody.innerHTML = applications.map(app => {
                                const date = new Date(app.created_at).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });

                                // Initials
                                const initials = (app.opticien?.first_name?.[0] || '') + (app.opticien?.last_name?.[0] || '');

                                // Status Badge
                                let statusBadge = '';
                                switch (app.status) {
                                    case 'pending': statusBadge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">À contacter</span>'; break;
                                    case 'viewed': statusBadge = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">Vue</span>'; break;
                                    case 'interview': statusBadge = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Entretien</span>'; break;
                                    case 'rejected': statusBadge = '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold">Refusée</span>'; break;
                                    default: statusBadge = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-bold">En attente</span>';
                                }

                                return `
                            <tr class="border-b border-gray-50 hover:bg-gray-50 transition">
                                <td class="py-4 flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 uppercase">
                                        ${initials || '?'}
                                    </div>
                                    <span class="font-semibold text-gray-800">${app.opticien?.full_name || 'Candidat inconnu'}</span>
                                </td>
                                <td class="py-4">${app.offer?.title || 'Offre supprimée'}</td>
                                <td class="py-4 text-gray-400">${date}</td>
                                <td class="py-4">${statusBadge}</td>
                                <td class="py-4 text-right">
                                    <button class="contact-candidate-btn text-oblink-blue hover:bg-blue-50 p-2 rounded-lg transition" 
                                        data-candidate-id="${app.opticien?.id}" 
                                        data-candidate-name="${app.opticien?.full_name}">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </td>
                            </tr>
                            `;
                            }).join('');

                            // Re-attach event listeners for the dynamic buttons
                            // Since we just replaced innerHTML, we need to re-bind the 'click' events for contact modal
                            // Or better: Use event delegation on the body or container.
                            // For now, let's just re-run the binding logic if it was defined globally, 
                            // BUT since the modal logic is likely defined in 'DOMContentLoaded', it ran BEFORE we injected this HTML.
                            // We must MANUALLY trigger the binding logic again or change how it's bound.

                            // Let's assume we need to re-bind. 
                            const newContactBtns = document.querySelectorAll('.contact-candidate-btn');
                            const contactModal = document.getElementById('contact-modal');
                            const contactIdInput = document.getElementById('contact-id');
                            const contactNameSpan = document.getElementById('contact-name');

                            newContactBtns.forEach(btn => {
                                btn.addEventListener('click', function () {
                                    const candidateId = this.dataset.candidateId;
                                    const candidateName = this.dataset.candidateName;
                                    contactIdInput.value = candidateId;
                                    contactNameSpan.textContent = candidateName;
                                    contactModal.classList.remove('hidden');
                                    contactModal.classList.add('flex');
                                });
                            });

                        } catch (err) {
                            console.error('Error loading applications:', err);
                            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Erreur chargement.</td></tr>';
                        }
                    });
                </script>

                <!-- MESSAGERIE (Recruteur V62) -->
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100"
                    id="messagerie-section">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-xl font-bold font-display text-oblink-gray flex items-center gap-2">
                            <i class="fas fa-comment-dots text-oblink-blue"></i> Messagerie Candidats
                        </h2>
                    </div>
                    <div class="flex h-[400px]">
                        <!-- Sidebar Conversations -->
                        <div class="w-1/3 border-r border-gray-100 bg-gray-50 overflow-y-auto" id="conversation-list">
                            <?php
                            // Initial load
                            $convs = oblink_get_conversations();
                            if ($convs) {
                                foreach ($convs as $c) {
                                    $contact_name = "Candidat #" . $c->contact_id; // TO DO: Get Real Name
                                    ?>
                                    <div class="p-4 border-b border-gray-100 hover:bg-white cursor-pointer transition conversation-item"
                                        data-contact-id="<?php echo $c->contact_id; ?>">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-violet text-white flex items-center justify-center font-bold text-sm">
                                                <?php echo substr($contact_name, 0, 1); ?>
                                            </div>
                                            <div class="overflow-hidden">
                                                <h4 class="font-bold text-sm text-gray-800 truncate">
                                                    <?php echo $contact_name; ?>
                                                </h4>
                                                <p class="text-xs text-gray-500 truncate">
                                                    <?php echo $c->message; ?>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-4 text-xs text-gray-400 text-center mt-10">Aucune conversation active</div>';
                            }
                            ?>
                        </div>
                        <!-- Chat Area -->
                        <div class="w-2/3 flex flex-col bg-white">
                            <div class="flex-1 p-6 overflow-y-auto space-y-4" id="chat-messages">
                                <div class="flex flex-col items-center justify-center h-full text-gray-400">
                                    <i class="fas fa-comments text-4xl mb-4 text-gray-200"></i>
                                    <p class="text-sm">Sélectionnez un candidat pour échanger</p>
                                </div>
                            </div>
                            <!-- Input -->
                            <div class="p-4 border-t border-gray-100 bg-gray-50 hidden" id="chat-input-area">
                                <form id="send-message-form" class="flex gap-2">
                                    <input type="hidden" id="current-contact-id" value="">
                                    <input type="text" id="message-input"
                                        class="flex-1 rounded-xl border-gray-200 text-sm focus:ring-oblink-blue focus:border-oblink-blue"
                                        placeholder="Écrivez votre message...">
                                    <button type="submit"
                                        class="w-10 h-10 rounded-xl bg-oblink-blue text-white hover:bg-blue-600 transition flex items-center justify-center">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GESTION FINANCIERE (New) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">
                            <i class="fas fa-file-invoice-dollar text-oblink-orange mr-2"></i>Gestion Financière
                        </h2>
                        <div class="flex gap-2">
                            <a href="<?php echo home_url('/facture'); ?>"
                                class="text-xs font-bold text-white bg-oblink-blue px-3 py-2 rounded-lg hover:bg-blue-700 transition flex items-center">
                                <i class="fas fa-plus mr-1"></i> Facturer
                            </a>
                            <button
                                class="text-xs font-bold text-gray-500 bg-gray-100 px-3 py-2 rounded-lg hover:bg-gray-200 transition">Tout
                                voir</button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <!-- Devis à valider -->
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-orange-50 border border-orange-100 rounded-xl">
                            <div class="flex items-center gap-4 mb-3 sm:mb-0">
                                <div
                                    class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center">
                                    <i class="fas fa-file-signature"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">Devis #DEV-2025-089</h4>
                                    <p class="text-xs text-orange-700 font-medium">En attente de signature - 840,00 €
                                    </p>
                                    <p class="text-xs text-gray-500">Remplacement Sarah D.</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <a href="<?php echo home_url('/facture'); ?>"
                                    class="px-4 py-2 bg-orange-500 text-white text-xs font-bold rounded-lg hover:bg-orange-600 transition shadow-sm">
                                    <i class="fas fa-pen-nib mr-1"></i> Signer
                                </a>
                            </div>
                        </div>

                        <!-- Facture à payer -->
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-white border border-gray-200 rounded-xl">
                            <div class="flex items-center gap-4 mb-3 sm:mb-0">
                                <div
                                    class="w-10 h-10 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">Facture #FACT-2025-042</h4>
                                    <p class="text-xs text-red-500 font-medium">À payer avant le 15/02 - 450,00 €</p>
                                    <p class="text-xs text-gray-500">Frais de service OBLINK</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="alert('Simulation: Facture envoyée à compta@votre-entreprise.com')"
                                    class="px-3 py-2 bg-gray-100 text-gray-600 text-xs font-bold rounded-lg hover:bg-gray-200 transition">
                                    <i class="fas fa-envelope mr-1"></i> Comptable
                                </button>
                                <button
                                    class="px-3 py-2 bg-oblink-blue text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition">
                                    <i class="fas fa-credit-card mr-1"></i> Payer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div> <!-- END LEFT COLUMN -->

        <!-- RIGHT COLUMN (Sidebar) -->
        <div class="space-y-8">

            <!-- Quick Search -->
            <div class="bg-gradient-to-br from-oblink-blue to-oblink-violet rounded-3xl p-6 text-white shadow-xl">
                <h2 class="text-xl font-bold font-display mb-2">Besoin d'un remplaçant urgent ?</h2>
                <p class="text-white/80 text-sm mb-6">Accédez à la CV-thèque et contactez directement les opticiens
                    disponibles.</p>
                <a href="<?php echo home_url('/recherche-opticiens'); ?>"
                    class="block w-full py-3 bg-white text-oblink-blue font-bold text-center rounded-xl hover:bg-gray-50 transition shadow-lg">
                    <i class="fas fa-search mr-2"></i> Rechercher
                </a>
            </div>

            <!-- Latest Messages Removed (Replaced by Main Module) -->

            <!-- Statistiques -->
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-lg font-bold font-display text-oblink-gray mb-4">Statistiques</h2>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">Vues du profil</span>
                        <span class="font-bold text-oblink-gray">145</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5">
                        <div class="bg-oblink-orange h-1.5 rounded-full" style="width: 70%"></div>
                    </div>

                    <div class="flex justify-between text-sm mt-2">
                        <span class="text-gray-500">Taux de réponse</span>
                        <span class="font-bold text-oblink-gray">90%</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5">
                        <div class="bg-green-500 h-1.5 rounded-full" style="width: 90%"></div>
                    </div>
                </div>
            </div>

        </div>

    </div> <!-- END SIDEBAR -->

</div> <!-- END GRID -->

</div>
</div>

<!-- MESSAGING JAVASCRIPT -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const conversationItems = document.querySelectorAll('.conversation-item');
        const chatMessages = document.getElementById('chat-messages');
        const chatInputArea = document.getElementById('chat-input-area');
        const currentContactIdInput = document.getElementById('current-contact-id');
        const sendMessageForm = document.getElementById('send-message-form');
        const messageInput = document.getElementById('message-input');

        // Load chat when clicking a conversation
        conversationItems.forEach(item => {
            item.addEventListener('click', function () {
                const contactId = this.dataset.contactId;
                currentContactIdInput.value = contactId;

                // Highlight selected
                conversationItems.forEach(c => c.classList.remove('bg-white', 'ring-2', 'ring-oblink-blue'));
                this.classList.add('bg-white', 'ring-2', 'ring-oblink-blue');

                // Show input area
                chatInputArea.classList.remove('hidden');

                // Load messages via AJAX
                loadChat(contactId);
            });
        });

        function loadChat(contactId) {
            chatMessages.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-spinner fa-spin mr-2"></i> Chargement...</div>';

            fetch(`<?php echo admin_url('admin-ajax.php'); ?>?action=oblink_load_chat&contact_id=${contactId}&nonce=${oblink_vars.nonce}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        chatMessages.innerHTML = data.data.html || '<p class="text-center text-gray-400 text-sm">Aucun message</p>';
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur chargement</p>';
                    }
                })
                .catch(() => {
                    chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur réseau</p>';
                });
        }

        // Send message
        if (sendMessageForm) {
            sendMessageForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const message = messageInput.value.trim();
                const receiverId = currentContactIdInput.value;

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            messageInput.value = '';
                            loadChat(receiverId); // Reload chat
                        } else {
                            alert('Erreur: ' + (data.data?.message || 'Envoi impossible'));
                        }
                    })
                    .catch(() => alert('Erreur réseau'));
            });
        }

        // ===== NEW: CONTACT MODAL FUNCTIONALITY =====
        const contactModal = document.getElementById('contact-modal');
        const contactForm = document.getElementById('contact-form');
        const contactBtns = document.querySelectorAll('.contact-candidate-btn');
        const closeModalBtn = document.getElementById('close-contact-modal');
        const contactNameSpan = document.getElementById('contact-name');
        const contactIdInput = document.getElementById('contact-id');

        // Open modal
        contactBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const candidateId = this.dataset.candidateId;
                const candidateName = this.dataset.candidateName;
                contactIdInput.value = candidateId;
                contactNameSpan.textContent = candidateName;
                contactModal.classList.remove('hidden');
                contactModal.classList.add('flex');
            });
        });

        // Close modal
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                contactModal.classList.add('hidden');
                contactModal.classList.remove('flex');
            });
        }

        // Submit contact form
        if (contactForm) {
            contactForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                const receiverId = contactIdInput.value;
                const message = document.getElementById('contact-message').value.trim();

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                try {
                    const res = await fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();

                    if (data.success) {
                        showToast('Message envoyé ! La conversation est maintenant dans votre messagerie.', 'success');
                        contactModal.classList.add('hidden');
                        contactForm.reset();
                        // Reload page to show new conversation
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast('Erreur: ' + (data.data?.message || 'Envoi impossible'), 'error');
                    }
                } catch (err) {
                    showToast('Erreur réseau', 'error');
                }
            });
        }
    });
</script>

<!-- CONTACT MODAL -->
<div id="contact-modal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden">
        <div class="bg-gradient-to-r from-oblink-blue to-oblink-violet p-6 text-white">
            <h3 class="text-lg font-bold">Contacter <span id="contact-name">le candidat</span></h3>
            <p class="text-sm text-white/80">Envoyez votre premier message</p>
        </div>
        <form id="contact-form" class="p-6">
            <input type="hidden" id="contact-id" value="">
            <div class="mb-4">
                <label class="block text-sm font-bold text-gray-700 mb-2">Votre message</label>
                <textarea id="contact-message" rows="4" required
                    class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition resize-none"
                    placeholder="Bonjour, votre profil correspond à notre offre..."></textarea>
            </div>
            <div class="flex gap-3">
                <button type="button" id="close-contact-modal"
                    class="flex-1 px-4 py-3 border border-gray-200 text-gray-600 font-semibold rounded-xl hover:bg-gray-50 transition">
                    Annuler
                </button>
                <button type="submit"
                    class="flex-1 px-4 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition flex items-center justify-center gap-2">
                    <i class="fas fa-paper-plane"></i> Envoyer
                </button>
            </div>
        </form>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-cgu.php ---
<?php
/*
Template Name: CGU / CGV
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header Section -->
        <div class="text-center mb-16">
            <span
                class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-sm mb-4 uppercase tracking-wider">
                Juridique
            </span>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">Conditions Générales</h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Dernière mise à jour : <?php echo date('d/m/Y'); ?>. <br>
                L'utilisation de la plateforme OBLINK implique l'acceptation pleine et entière des présentes conditions.
            </p>
        </div>

        <!-- Navigation Tabs (Fake Tabs for Visual Structure) -->
        <div class="flex flex-col md:flex-row gap-4 mb-12 border-b border-gray-200 pb-4">
            <a href="#cgu" class="px-6 py-2 bg-oblink-orange text-white rounded-lg font-bold">1. CGU (Pour Tous)</a>
            <a href="#cgv"
                class="px-6 py-2 bg-white border border-gray-200 text-oblink-gray rounded-lg font-bold hover:bg-gray-50">2.
                CGV (Pour Magasins)</a>
            <a href="#responsabilite"
                class="px-6 py-2 bg-white border border-gray-200 text-oblink-gray rounded-lg font-bold hover:bg-gray-50">3.
                Responsabilité</a>
        </div>

        <div class="grid md:grid-cols-3 gap-12">

            <!-- Main Content -->
            <div class="md:col-span-2 space-y-12 prose prose-lg text-gray-600">

                <!-- SECTION 1 : CGU -->
                <section id="cgu" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-oblink-orange pl-4">1.
                        Conditions Générales d'Utilisation (CGU)</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables à tous les utilisateurs (Opticiens
                        Freelances et Magasins d'Optique).</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.1. Rôle de la plateforme</h3>
                    <p>OBLINK agit exclusivement en qualité d'intermédiaire technique de mise en relation. OBLINK n'est
                        ni l'employeur des opticiens freelances, ni le mandataire des magasins d'optique. La plateforme
                        ne saurait être tenue responsable de la qualité des prestations (examens de vue, montages)
                        réalisées.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.2. Vérification des profils</h3>
                    <p>L'utilisateur Freelance certifie l'exactitude des informations fournies (Diplômes BTS/Licence,
                        Numéro ADELI/RPPS, Assurance RC Pro). OBLINK procède à des vérifications mais l'utilisateur
                        reste seul responsable en cas de fausse déclaration. Tout manquement entraînera la suspension
                        immédiate du compte.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">1.3. Modération</h3>
                    <p>OBLINK se réserve le droit de modérer ou supprimer tout contenu (avis, commentaires, descriptions
                        de mission) jugé diffamatoire, injurieux ou contraire à l'éthique de la profession.</p>
                </section>

                <hr class="border-gray-200">

                <!-- SECTION 2 : CGV -->
                <section id="cgv" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-oblink-blue pl-4">2.
                        Conditions Générales de Vente (CGV)</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables aux clients Magasins souscrivant aux
                        services payants.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.1. Modèle Économique</h3>
                    <p>L'accès à la CV-thèque et la publication d'offres sont soumis à la souscription d'un abonnement
                        (Pack Découverte, Premium ou Corporate). Les tarifs sont indiqués en euros HT. La commission de
                        mise en relation est facturée en sus au magasin donneur d'ordre.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.2. Paiement et Séquestre</h3>
                    <p>Les paiements sont sécurisés et gérés par notre prestataire de services de paiement (PSP) agréé
                        (Stripe Connect). OBLINK n'encaisse pas les fonds pour compte de tiers ; les flux financiers
                        transitent directement via les comptes de cantonnement sécurisés.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.3. Absence de Droit de Rétractation (B2B)</h3>
                    <p>Conformément au Code de Commerce, le droit de rétractation de 14 jours ne s'applique pas aux
                        transactions réalisées entre professionnels (B2B) dans le cadre de leur activité principale.</p>

                    <h3 class="text-xl font-bold text-oblink-gray">2.4. Lutte contre le travail dissimulé</h3>
                    <p>Le magasin est tenu de vérifier, via la plateforme, la conformité légale du freelance
                        (Attestation de vigilance URSSAF, Kbis) lors de la contractualisation et tous les 6 mois.</p>
                </section>

                <hr class="border-gray-200">

                <!-- SECTION 3 : NON CONTOURNEMENT -->
                <section id="responsabilite" class="scroll-mt-32">
                    <div class="bg-red-50 border border-red-100 rounded-2xl p-8">
                        <h2 class="text-2xl font-bold text-red-600 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-3"></i> 3. Clause de Non-Intermédiation
                        </h2>
                        <p class="font-bold mb-4">La pérennité d'OBLINK repose sur le respect de cette clause.</p>
                        <p>Il est strictement interdit aux utilisateurs (Magasins et Freelances) de contourner la
                            plateforme pour contractualiser en direct une mission initialement proposée via OBLINK.</p>
                        <p class="mb-0">En cas d'embauche directe ou de collaboration hors plateforme d'un freelance
                            présenté par OBLINK dans les 12 mois suivant la mise en relation, une <strong>indemnité
                                compensatrice forfaitaire</strong> sera facturée au magasin (voir grille tarifaire en
                            vigueur).</p>
                    </div>
                </section>

                </section>

                <hr class="border-gray-200">

                <!-- SECTION 4 : OBLINK ACADEMIE -->
<!-- SECTION 4 : OBLINK ACADEMIE (PASS REVISION) -->
                <section id="academie-conditions" class="scroll-mt-32">
                    <h2 class="text-3xl font-bold text-oblink-gray mb-6 border-l-4 border-purple-600 pl-4">4. Conditions Spécifiques - Pass Révision</h2>
                    <p class="italic text-sm text-gray-400 mb-6">Applicables à tout achat du "Pass Révision" ou "Pass Examen".</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.1. Objet du Service</h3>
                    <p>Le Pass Révision donne un accès personnel et non exclusif à la plateforme OBLINK Académie, incluant la base de quiz et le générateur d'exercices par Intelligence Artificielle.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.2. Accès et Sécurité (Fair Use)</h3>
                    <ul class="list-disc pl-5 mb-4 space-y-2">
                        <li><strong>Limite d'appareils :</strong> L'accès est strictement personnel. Il est limité à <strong>deux (2) appareils simultanés</strong> (ex: un smartphone et un ordinateur). Toute détection de partage de compte entraînera une suspension immédiate sans remboursement.</li>
                        <li><strong>Quota IA :</strong> OBLINK applique une politique d'usage raisonnable ("Fair Use"). L'accès est limité à 50 nouvelles générations de questions par jour. Les questions déjà présentes en cache restent accessibles en illimité.</li>
                    </ul>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.3. Absence de Garantie de Résultat</h3>
                    <p>OBLINK est un outil d'accompagnement. L'entreprise <strong>ne garantit pas la réussite aux examens</strong> du BTS OL. L'utilisateur reste seul responsable de l'assimilation de ses connaissances.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.4. Responsabilité liée à l'IA</h3>
                    <p>Le contenu est généré ou assisté par Intelligence Artificielle. Bien que nous appliquions des filtres de contrôle, OBLINK ne peut être tenu responsable d'éventuelles erreurs factuelles isolées. Un système de "Signalement" permet de corriger toute imprécision sous 48h.</p>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.5. Droit de Rétractation et Remboursement (Article L221-28)</h3>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 mb-4">
                        <p class="font-bold text-purple-900 mb-2">Attention : Renoncement au droit de rétractation</p>
                        <p class="text-sm text-purple-800">Conformément à l'article L221-28 du Code de la consommation, le droit de rétractation ne peut être exercé pour les contenus numériques fournis sur un support non matériel dont l'exécution a commencé après accord préalable exprès du consommateur. <strong>En validant l'achat du Pass, l'utilisateur accepte l'accès immédiat au service et renonce expressément à son droit de rétractation.</strong></p>
                    </div>

                    <h3 class="text-xl font-bold text-oblink-gray mb-3">4.6. Protection des Données</h3>
                    <p>Les données collectées (Email, résultats de quiz) servent uniquement à l'amélioration de l'expérience utilisateur et au suivi de progression. Elles ne sont jamais revendues à des tiers.</p>
                </section>

                <hr class="border-gray-200">

                <section>
                    <h3 class="text-xl font-bold text-oblink-gray">5. Propriété Intellectuelle</h3>
                    <p>La marque OBLINK, le logo, la charte graphique et le code source de la plateforme sont la
                        propriété exclusive de la société OBLINK SAS. Toute reproduction totale ou partielle est
                        interdite.</p>
                </section>

            </div>

            <!-- Sidebar Sticky -->
            <div class="hidden md:block">
                <div class="sticky top-32 space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                        <h3 class="font-bold text-oblink-gray mb-4">Besoin d'aide ?</h3>
                        <p class="text-sm text-gray-500 mb-4">Notre équipe juridique est disponible pour répondre à vos
                            questions sur le fonctionnement de la plateforme.</p>
                        <a href="mailto:contact@oblink.fr"
                            class="block text-center w-full py-3 bg-oblink-blue/10 text-oblink-blue font-bold rounded-lg hover:bg-oblink-blue hover:text-white transition">Contact
                            Support</a>
                    </div>

                    <div class="bg-oblink-gray p-6 rounded-2xl text-white">
                        <h3 class="font-bold mb-2">RGPD & Données</h3>
                        <p class="text-xs text-gray-400 mb-4">Consultez notre politique de confidentialité concernant
                            les données de santé et personnelles.</p>
                        <a href="<?php echo home_url('/confidentialite'); ?>"
                            class="text-oblink-orange text-sm font-bold underline">Voir la politique RGPD</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- GLOBAL HARDCODED FOOTER REUSE -->
<div class="footer-wrapper">
    <?php include get_template_directory() . '/footer-content.php'; ?>
</div>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-certificate.php ---
<?php
/*
Template Name: OBLINK Certificate
*/

// Security Check: Ensure valid access (normally checked via UUID in URL)
$cert_id = get_query_var('cert_id', 'DEMO-123456');
$student_name = isset($_GET['student']) ? sanitize_text_field($_GET['student']) : 'Étudiant OBLINK';
$score = isset($_GET['score']) ? intval($_GET['score']) : 100;
$date = date('d/m/Y');

?>
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificat de Réussite -
        <?php echo $student_name; ?>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for "Diploma" look -->
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        .font-diploma {
            font-family: 'Cinzel', serif;
        }

        .font-serif-body {
            font-family: 'Playfair Display', serif;
        }

        .watermark {
            background-image: url('https://www.svgrepo.com/show/499664/certificate.svg');
            /* Placeholder icon */
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.03;
        }

        .border-fancy {
            border: 8px double #1e3a8a;
            /* oblink-blue approx */
            padding: 4px;
        }

        .border-fancy-inner {
            border: 2px solid #ea580c;
            /* oblink-orange approx */
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Actions Bar -->
    <div class="mb-8 flex gap-4 no-print">
        <button onclick="downloadPDF()"
            class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            Télécharger le PDF
        </button>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=<?php echo urlencode(home_url('/verify/' . $cert_id)); ?>"
            target="_blank"
            class="bg-[#0077b5] text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-[#006396] transition flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
            Partager sur LinkedIn
        </a>
    </div>

    <!-- CERTIFICATE CONTAINER -->
    <div id="certificate"
        class="bg-white w-[297mm] h-[210mm] shadow-2xl relative flex p-10 mx-auto text-gray-800 watermark">
        <div class="border-fancy w-full h-full p-2">
            <div class="border-fancy-inner w-full h-full relative flex flex-col items-center justify-between p-12">

                <!-- Header -->
                <div class="text-center w-full">
                    <div class="flex items-center justify-center gap-2 mb-2 text-oblink-blue">
                        <!-- Logo Placeholder -->
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-orange-500 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xs">
                            OB</div>
                        <span class="font-bold tracking-[0.2em] text-gray-400 text-sm">OBLINK ACADEMY</span>
                    </div>
                    <h1 class="font-diploma text-5xl md:text-6xl text-gray-900 mb-2 mt-4 uppercase tracking-widest">
                        Certificat de Réussite</h1>
                    <h2 class="font-serif-body text-2xl text-orange-600 italic">Expert ERP Optique (Cosium 2026)</h2>
                </div>

                <!-- Body -->
                <div class="text-center w-3/4 mx-auto my-6">
                    <p class="font-serif-body text-xl text-gray-500 mb-4">Le présent certificat est délivré à</p>
                    <div
                        class="font-diploma text-4xl text-gray-900 border-b-2 border-gray-300 pb-2 mb-6 inline-block min-w-[300px]">
                        <?php echo $student_name; ?>
                    </div>
                    <p class="font-serif-body text-lg text-gray-600 leading-relaxed">
                        Pour avoir complété avec succès le parcours de formation avancée et validé l'examen de
                        certification <strong class="text-gray-900">"Cosium Expert : Flux Métiers & Optimisation
                            Tiers-Payant"</strong> avec un score d'excellence de <strong class="text-blue-600">
                            <?php echo $score; ?>%
                        </strong>.
                    </p>
                </div>

                <!-- Skills -->
                <div class="w-full grid grid-cols-2 gap-8 my-4 px-12">
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Ingénierie Tiers-Payant</strong>
                                (Flux AMC/DRE)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Conformité 2026</strong> (100%
                                Santé & Devis)</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Logistique EDI</strong> (Appro &
                                Stocks)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-blue-600"></span>
                            <span class="font-serif-body text-sm text-gray-700"><strong>Performance</strong> (Pilotage
                                Marge & Dossiers)</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="w-full flex items-end justify-between mt-8 border-t border-gray-200 pt-8">
                    <div class="text-left">
                        <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Date de délivrance</p>
                        <p class="font-diploma text-lg">
                            <?php echo $date; ?>
                        </p>
                        <p class="text-[10px] text-gray-400 mt-2">ID:
                            <?php echo $cert_id; ?>
                        </p>
                    </div>

                    <div class="text-center">
                        <!-- Simplified Seal -->
                        <div
                            class="w-24 h-24 border-4 border-orange-500 rounded-full flex items-center justify-center p-1 rotate-[-10deg] opacity-80">
                            <div
                                class="w-full h-full border border-orange-500 rounded-full flex flex-col items-center justify-center text-orange-600 pb-1">
                                <span class="text-[8px] font-bold uppercase tracking-widest">Officiel</span>
                                <span class="font-diploma text-xl font-black">OBLINK</span>
                                <span class="text-[8px] font-bold uppercase tracking-widest">Academy</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-right flex flex-col items-end">
                        <p class="text-xs text-gray-400 uppercase tracking-wider mb-2">Vérifier l'authenticité</p>
                        <div id="qrcode" class="mb-2"></div>
                        <p class="font-diploma text-sm text-gray-900">Le Comité Pédagogique</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Generate QR Code
        const verifyUrl = "<?php echo home_url('/verify/' . $cert_id); ?>";
        new QRCode(document.getElementById("qrcode"), {
            text: verifyUrl,
            width: 80,
            height: 80,
            colorDark: "#1f2937",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        // PDF Generation
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('certificate');

            // Adjust scale for better quality
            html2canvas(element, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape, A4
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();

                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save("Certificat-Oblink-<?php echo $cert_id; ?>.pdf");
            });
        }
    </script>
</body>

</html>--- FILE: theme/page-mentions-legales.php ---
<?php
/*
Template Name: Mentions Légales
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl font-bold font-display text-oblink-gray mb-8">Mentions Légales</h1>

        <div class="prose prose-lg text-gray-500">
            <h3>1. Éditeur du site</h3>
            <p>Le site OBLINK est édité par la société OBLINK SAS, au capital de 10 000 euros, immatriculée au Registre
                du Commerce et des Sociétés de Paris sous le numéro 123 456 789.</p>
            <p><strong>Siège social :</strong> 10 Rue de la Paix, 75000 Paris, France.</p>
            <p><strong>Email :</strong> contact@oblink.fr</p>

            <h3>2. Directeur de publication</h3>
            <p>Monsieur Sergio Sandoval.</p>

            <h3>3. Hébergement</h3>
            <p>Le site est hébergé par OVH SAS, 2 rue Kellermann - 59100 Roubaix - France.</p>

            <h3>4. Propriété intellectuelle</h3>
            <p>L'ensemble de ce site relève de la législation française et internationale sur le droit d'auteur et la
                propriété intellectuelle. Tous les droits de reproduction sont réservés.</p>
        </div>
    </div>
</div>

<!-- HARDCODED FOOTER REUSE -->
<?php include get_template_directory() . "/footer-content.php"; ?>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-inscription-opticien.php ---
<?php
/*
Template Name: Page Inscription Opticien
*/
include 'header-inc.php';
?>

<!-- Auth Protection: Redirect if already logged in -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        if (window.oblinkSupabase) {
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            if (session) {
                // Already logged in, redirect to appropriate dashboard
                const userType = session.user.user_metadata?.user_type;
                if (userType === 'opticien') {
                    window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                } else if (userType === 'entreprise') {
                    window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                } else {
                    window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }
            }
        }
    });
</script>

<div class="min-h-screen bg-oblink-orange-claire/30 pt-32 pb-20 relative overflow-hidden">

    <!-- Background Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-10 w-64 h-64 bg-oblink-orange/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 left-10 w-80 h-80 bg-oblink-blue/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-4 relative z-10">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Devenez Opticien <span class="text-oblink-orange">Partenaire</span>
            </h1>
            <p class="text-lg text-oblink-gray/70 max-w-xl mx-auto font-body">
                Rejoignez la première communauté d'opticiens freelances. Trouvez des missions, gérez votre emploi du
                temps et boostez vos revenus.
            </p>
        </div>

        <!-- Multi-step Form Container -->
        <div class="bg-white rounded-[2rem] shadow-2xl border border-white/50 backdrop-blur-xl overflow-hidden">

            <!-- Progress Bar -->
            <div class="bg-gray-50 px-8 py-6 border-b border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-oblink-gray uppercase tracking-wider">Progression</span>
                    <span class="text-xs font-bold text-oblink-orange" id="progress-text">Étape 1 sur 3</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-oblink-orange to-oblink-violet h-2 rounded-full transition-all duration-500"
                        style="width: 33%" id="progress-bar"></div>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-green-50 border border-green-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-check-circle text-green-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-green-700" id="success-text"></p>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-red-50 border border-red-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-red-700" id="error-text"></p>
                    </div>
                </div>
            </div>

            <form id="opticien-register-form" class="p-8 md:p-12">

                <!-- STEP 1: Identité -->
                <div class="form-step active" data-step="1">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-orange/20 text-oblink-orange flex items-center justify-center text-sm font-bold">1</span>
                        Créez votre compte
                    </h2>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Prénom</label>
                            <input type="text" name="first_name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="Jean" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nom</label>
                            <input type="text" name="last_name"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="Dupont" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email professionnel</label>
                        <div class="relative">
                            <i
                                class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="email" name="email"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="jean.dupont@email.com" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Type de poste recherché <span
                                class="text-red-500">*</span></label>
                        <select name="job_type" required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition">
                            <option value="">Sélectionnez votre profil...</option>
                            <optgroup label="💼 En Magasin">
                                <option value="Opticien collaborateur H/F">Opticien collaborateur H/F</option>
                                <option value="Opticien remplaçant H/F">Opticien remplaçant H/F</option>
                                <option value="Opticien en alternance H/F">Opticien en alternance H/F</option>
                                <option value="Opticien directeur, gérant ou responsable H/F">Opticien directeur/gérant
                                    H/F</option>
                                <option value="Opticien tiers payant H/F">Opticien tiers payant H/F</option>
                                <option value="Vendeur H/F">Vendeur H/F</option>
                                <option value="Monteur H/F">Monteur H/F</option>
                                <option value="Monteur-vendeur H/F">Monteur-vendeur H/F</option>
                                <option value="Conseiller vendeur de solaires H/F">Conseiller solaires H/F</option>
                                <option value="Audioprothésiste H/F">Audioprothésiste H/F</option>
                                <option value="Assistant audioprothésiste H/F">Assistant audioprothésiste H/F</option>
                                <option value="Adaptateur de lentilles H/F">Adaptateur de lentilles H/F</option>
                            </optgroup>
                            <optgroup label="🚗 Nomades / Terrain">
                                <option value="Opticien à domicile H/F">Opticien à domicile H/F</option>
                                <option value="Agent - Commercial - VRP H/F">Agent VRP H/F</option>
                                <option value="Animateur réseau H/F">Animateur réseau H/F</option>
                                <option value="Responsable de secteur H/F">Responsable de secteur H/F</option>
                            </optgroup>
                            <optgroup label="👔 Experts / Management">
                                <option value="Responsable technique H/F">Responsable technique H/F</option>
                                <option value="Optométriste H/F">Optométriste H/F</option>
                                <option value="Directeur des ventes H/F">Directeur des ventes H/F</option>
                                <option value="Chef de produits H/F">Chef de produits H/F</option>
                            </optgroup>
                            <optgroup label="🩺 Autres Professions">
                                <option value="Orthoptiste H/F">Orthoptiste H/F</option>
                                <option value="AMO (Assistant médical ophta) H/F">AMO (Assistant médical ophta) H/F
                                </option>
                                <option value="Enseignant H/F">Enseignant optique H/F</option>
                                <option value="Autre en magasin H/F">Autre en magasin H/F</option>
                                <option value="Autre H/F">Autre profession H/F</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mot de passe</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="password" name="password"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-orange focus:ring-2 focus:ring-oblink-orange/20 outline-none transition"
                                placeholder="••••••••" required>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Au moins 8 caractères, une majuscule et un chiffre.</p>
                    </div>

                    <div class="flex justify-end">
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-orange transition-all flex items-center gap-2">
                            Continuer <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Profil Pro -->
                <div class="form-step hidden" data-step="2">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-blue/20 text-oblink-blue flex items-center justify-center text-sm font-bold">2</span>
                        Votre profil pro
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Niveau de diplôme</label>
                        <select name="diploma"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition">
                            <option value="bts">BTS Opticien Lunetier</option>
                            <option value="licence">Licence Pro d'Optique</option>
                            <option value="master">Master Sciences de la Vision</option>
                            <option value="etudiant">Étudiant (Stage/Alternance)</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Années d'expérience</label>
                        <div class="flex gap-4">
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="junior" class="hidden peer" checked>
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">0-2 ans</span>
                                    <span class="text-xs text-gray-500">Junior</span>
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="confirme" class="hidden peer">
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">3-7 ans</span>
                                    <span class="text-xs text-gray-500">Confirmé</span>
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="expert" class="hidden peer">
                                <div
                                    class="p-4 rounded-xl border-2 border-gray-100 text-center peer-checked:border-oblink-blue peer-checked:bg-oblink-blue/5 transition">
                                    <span class="block font-bold text-oblink-gray">8+ ans</span>
                                    <span class="text-xs text-gray-500">Expert</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">CV & Diplômes (Optionnel)</label>
                        <div
                            class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-oblink-blue transition cursor-pointer bg-gray-50">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                            <p class="font-medium text-gray-600">Glissez vos fichiers ici ou <span
                                    class="text-oblink-blue underline">cliquez pour parcourir</span></p>
                            <p class="text-xs text-gray-400 mt-2">PDF, JPG, PNG (Max 5Mo)</p>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-blue transition-all flex items-center gap-2">
                            Suivant <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Préférences -->
                <div class="form-step hidden" data-step="3">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-violet/20 text-oblink-violet flex items-center justify-center text-sm font-bold">3</span>
                        Vos préférences
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Ville principale</label>
                        <div class="relative">
                            <i
                                class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="city"
                                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-violet focus:ring-2 focus:ring-oblink-violet/20 outline-none transition"
                                placeholder="Paris, Lyon, Bordeaux..." required>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mobilité</label>
                        <input type="range"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-oblink-violet"
                            min="0" max="100" step="10" value="20">
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span>0 km</span>
                            <span>50 km</span>
                            <span>100 km+</span>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" required
                                class="w-5 h-5 rounded border-gray-300 text-oblink-violet focus:ring-oblink-violet">
                            <span class="text-sm text-gray-600">J'accepte les <a href="#"
                                    class="underline text-oblink-violet">Conditions Générales d'Utilisation</a> et la
                                Politique de Confidentialité.</span>
                        </label>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-oblink-orange to-oblink-violet text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2">
                            Valider mon inscription <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <div class="text-center mt-8">
            <p class="text-gray-500">Déjà inscrit ? <a href="<?php echo home_url('/login'); ?>"
                    class="font-bold text-oblink-orange hover:underline">Connexion</a></p>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('opticien-register-form');
        const steps = document.querySelectorAll('.form-step');
        const nextBtns = document.querySelectorAll('.next-step-btn');
        const prevBtns = document.querySelectorAll('.prev-step-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        let currentStep = 1;

        function updateStep(step) {
            steps.forEach(s => s.classList.add('hidden'));
            steps.forEach(s => s.classList.remove('active'));
            const activeStep = document.querySelector(`.form-step[data-step="${step}"]`);
            activeStep.classList.remove('hidden');

            const percentage = (step / 3) * 100;
            progressBar.style.width = percentage + '%';
            progressText.textContent = `Étape ${step} sur 3`;
            document.querySelector('.bg-white').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        nextBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep < 3) {
                    const inputs = steps[currentStep - 1].querySelectorAll('input[required]');
                    let valid = true;
                    inputs.forEach(input => {
                        if (!input.value) {
                            valid = false;
                            input.classList.add('border-red-500');
                        } else {
                            input.classList.remove('border-red-500');
                        }
                    });

                    if (valid) {
                        currentStep++;
                        updateStep(currentStep);
                    }
                }
            });
        });

        prevBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateStep(currentStep);
                }
            });
        });

        // SUPABASE SUBMISSION (Updated)
        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const formData = new FormData(form);
            const email = formData.get('email');
            const password = formData.get('password');
            const firstName = formData.get('first_name');
            const lastName = formData.get('last_name');

            // Metadata for Profile
            const metaData = {
                first_name: firstName,
                last_name: lastName,
                full_name: `${firstName} ${lastName}`,
                user_type: 'opticien',
                diploma: formData.get('diploma'),
                experience: formData.get('experience'),
                city: formData.get('city')
            };

            try {
                // 1. Sign Up
                const { data, error } = await window.oblinkSupabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: metaData
                    }
                });

                if (error) throw error;

                // 2. Wait for session to be fully established (fix race condition)
                let sessionReady = false;
                let attempts = 0;

                while (!sessionReady && attempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                    if (session) {
                        sessionReady = true;
                    }
                    attempts++;
                }

                if (!sessionReady) {
                    throw new Error("Session non établie. Veuillez vous reconnecter.");
                }

                // 3. Success - redirect with active session
                const successDiv = document.getElementById('success-message');
                const successText = document.getElementById('success-text');
                successText.textContent = '✅ Compte créé avec succès ! Redirection vers votre tableau de bord...';
                successDiv.classList.remove('hidden');
                successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
                }, 1500);

            } catch (error) {
                console.error('Supabase Error:', error);

                // Show inline error
                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : ' + error.message;
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-confidentialite.php ---
<?php
/*
Template Name: Politique de Confidentialité (RGPD)
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-white pt-32 pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <div class="text-center mb-16">
            <span
                class="inline-block py-1 px-3 rounded-full bg-blue-50 text-oblink-blue font-bold text-sm mb-4 uppercase tracking-wider">
                Données Personnelles
            </span>
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-6">Politique de Confidentialité
            </h1>
            <p class="text-xl text-gray-500 max-w-3xl mx-auto">
                Vos données sont précieuses. Voici comment OBLINK les protège, conformément au RGPD.
            </p>
        </div>

        <div class="prose prose-lg text-gray-600 mx-auto">

            <h3>1. Collecte des données</h3>
            <p>Dans le cadre de l'utilisation de la plateforme, OBLINK est amené à collecter les données suivantes :</p>
            <ul>
                <li><strong>Identité :</strong> Nom, Prénom, Email, Téléphone.</li>
                <li><strong>Professionnelles :</strong> Diplômes, Numéro ADELI / RPPS, CV, Expérience.</li>
                <li><strong>Financières :</strong> RIB, Données de facturation (traitées par Stripe).</li>
                <li><strong>Connexion :</strong> Adresse IP, logs de connexion.</li>
            </ul>

            <h3>2. Données de Santé</h3>
            <p>OBLINK n'héberge <strong>aucune donnée de santé</strong> relative aux patients des opticiens
                (ordonnances, mesures de vue). Ces données restent exclusivement dans le logiciel métier du magasin et
                ne transitent pas par la plateforme.</p>

            <h3>3. Utilisation des données</h3>
            <p>Les données sont collectées pour les finalités suivantes :</p>
            <ul>
                <li>Mise en relation entre Opticiens et Magasins.</li>
                <li>Vérification des qualifications professionnelles.</li>
                <li>Gestion des paiements et de la facturation.</li>
                <li>Envoi de notifications liées aux missions.</li>
            </ul>

            <h3>4. Partage des données</h3>
            <p>Vos données ne sont jamais vendues à des tiers. Elles sont transmises uniquement :</p>
            <ul>
                <li>Aux magasins (pour les profils freelances) dans le cadre d'une candidature.</li>
                <li>À notre prestataire de paiement (Stripe) pour les obligations légales KYC (Know Your Customer).</li>
                <li>Aux autorités compétentes en cas de réquisition judiciaire.</li>
            </ul>

            <h3>5. Sécurité</h3>
            <p>OBLINK met en œuvre toutes les mesures techniques (chiffrement SSL, serveurs sécurisés) pour protéger vos
                données contre l'accès non autorisé.</p>

            <h3>6. Vos Droits</h3>
            <p>Conformément au RGPD, vous disposez d'un droit d'accès, de rectification, de portabilité et d'effacement
                de vos données. Pour exercer ce droit, contactez notre DPO à : <a
                    href="mailto:dpo@oblink.fr">dpo@oblink.fr</a>.</p>
        </div>

    </div>
</div>

<!-- GLOBAL HARDCODED FOOTER REUSE -->
<div class="footer-wrapper">
    <?php include get_template_directory() . '/footer-content.php'; ?>
</div>
<?php wp_footer(); ?>
</body>

</html>--- FILE: theme/page-dashboard-etudiant.php ---
<?php
/*
Template Name: Dashboard Etudiant
*/
/*
Template Name: Dashboard Etudiant
*/
include 'header-inc.php';

// Verification simple de connexion (à renforcer)
if (!is_user_logged_in()) {
    echo '<script>window.location.href="' . home_url('/connexion') . '";</script>';
    exit;
}
$current_user = wp_get_current_user();
?>

<div class="bg-gray-50 min-h-screen pb-20 font-sans">

    <!-- Top Bar -->
    <div class="bg-white border-b border-gray-200 sticky top-16 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-graduation-cap text-oblink-orange mr-3"></i>
                    Mon Espace Académie
                </h1>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex items-center text-sm text-gray-500">
                        <span class="mr-2">Crédits IA:</span>
                        <span class="font-bold text-gray-900">500 / 500</span>
                    </div>
                    <button
                        class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 transition">
                        <i class="fas fa-play mr-2"></i>Nouveau Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Welcome Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Bonjour,
                <?php echo esc_html($current_user->display_name); ?> 👋
            </h2>
            <p class="text-gray-500">Prêt à sécuriser des points pour l'examen ?</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">

            <!-- Left Column: Stats & Progress -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Progress Card -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4">Progression Globale</h3>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-500">Analyse de la Vision</span>
                            <span class="font-bold text-oblink-orange">42%</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-oblink-orange rounded-full" style="width: 42%"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-500">Optique Géométrique</span>
                            <span class="font-bold text-oblink-blue">15%</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-oblink-blue rounded-full" style="width: 15%"></div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-yellow-500 shadow-sm border border-gray-100">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 text-transform uppercase font-bold">Points forts</p>
                                <p class="text-sm font-bold text-gray-900">Hypermétropie, Prismes</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-4">Outils Rapides</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-file-pdf text-2xl text-red-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Annales</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-robot text-2xl text-oblink-violet mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Coach IA</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-calculator text-2xl text-green-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Formules</p>
                        </a>
                        <a href="#" class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition text-center group">
                            <i
                                class="fas fa-users text-2xl text-blue-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xs font-bold text-gray-700">Forum</p>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Column: Activity Feed / Simulations -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Banner -->
                <div
                    class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-6 text-white relative overflow-hidden shadow-lg">
                    <div class="absolute right-0 top-0 h-full w-1/3 bg-white/5 skew-x-12 transform translate-x-12">
                    </div>
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold mb-2">Simulateur d'Examen 2026</h3>
                        <p class="text-gray-300 mb-4 text-sm max-w-md">Entraînez-vous sur des sujets probables générés
                            par IA en fonction des tendances des 5 dernières années.</p>
                        <button
                            class="bg-white text-gray-900 px-5 py-2 rounded-lg text-sm font-bold hover:bg-gray-100 transition">
                            Lancer une simulation (1h)
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <!-- Recent Activity (DYNAMIC FROM RAG) -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                            <h3 class="font-bold text-gray-900">Quiz du Jour (Basé sur vos Annales)</h3>
                            <span class="text-xs font-bold bg-oblink-orange/10 text-oblink-orange px-2 py-1 rounded">IA
                                Generated</span>
                        </div>
                        <div class="divide-y divide-gray-100">
                            <?php
                            // Load RAG Database from theme folder (embedded in zip)
                            $json_path = get_template_directory() . '/rag_database.json';

                            $rag_data = null;
                            if (file_exists($json_path)) {
                                $rag_data = json_decode(file_get_contents($json_path), true);
                            }

                            if ($rag_data && !empty($rag_data['exams'])) {
                                // Flatten concepts to get a random list
                                $all_concepts = [];
                                foreach ($rag_data['exams'] as $exam) {
                                    foreach ($exam['concepts'] as $concept) {
                                        $concept['year'] = $exam['year'];
                                        $concept['subject_name'] = $exam['subject'];
                                        $all_concepts[] = $concept;
                                    }
                                }

                                // Take 2 random concepts
                                shuffle($all_concepts);
                                $todays_quiz = array_slice($all_concepts, 0, 2);

                                foreach ($todays_quiz as $index => $q) {
                                    $unique_id = 'quiz-' . $index;
                                    ?>
                                    <div class="p-6 hover:bg-gray-50 transition group">
                                        <div class="flex items-start gap-4 mb-4">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-blue/10 text-oblink-blue flex items-center justify-center shrink-0 font-bold">
                                                <?php echo substr($q['subject_name'], 0, 1); ?>
                                            </div>
                                            <div class="flex-1">
                                            <div class="flex justify-between mb-1 relative pr-8">
                                                <h4 class="font-bold text-gray-900 text-sm">
                                                    <?php echo esc_html($q['topic']); ?> <span
                                                        class="text-gray-400 font-normal">•
                                                        <?php echo esc_html($q['year']); ?></span>
                                                    <?php if (isset($q['year']) && $q['year'] >= 2024): ?>
                                                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 text-purple-800 border border-purple-200">
                                                            Réforme 2024
                                                        </span>
                                                    <?php endif; ?>
                                                </h4>
                                                
                                                <!-- Close Button -->
                                                <button onclick="this.closest('.group').style.display='none'" class="absolute -top-1 -right-1 text-gray-300 hover:text-red-500 transition p-1">
                                                    <i class="fas fa-times"></i>
                                                </button>

                                                <!-- Difficulty (moved via flex but kept structure) -->
                                                <!-- <span class="text-xs text-gray-400">Difficulté: <?php echo str_repeat('★', $q['difficulty']); ?></span> -->
                                            </div>
                                            <div class="flex justify-between mb-3">
                                                <span class="text-xs text-gray-400">Difficulté: <?php echo str_repeat('★', $q['difficulty']); ?></span>
                                            </div>
                                                <p class="text-sm text-gray-800 font-medium mb-3">
                                                    "<?php echo esc_html($q['question_snippet']); ?>"
                                                </p>

                                                <!-- Hidden Answer -->
                                                <div id="<?php echo $unique_id; ?>"
                                                    class="hidden mt-3 p-4 bg-green-50 rounded-xl border border-green-100 text-sm">
                                                    <p class="font-bold text-green-800 mb-1"><i
                                                            class="fas fa-check-circle mr-2"></i>Réponse Officielle :</p>
                                                    <p class="text-gray-700 mb-2">
                                                        <?php echo esc_html($q['official_answer_snippet']); ?>
                                                    </p>

                                                    <?php if (!empty($q['common_mistakes'])): ?>
                                                        <div class="mt-2 pt-2 border-t border-green-200">
                                                            <p class="text-xs font-bold text-red-500 uppercase mb-1">⚠️ Pièges à
                                                                éviter :</p>
                                                            <ul class="list-disc list-inside text-xs text-gray-600">
                                                                <?php foreach ($q['common_mistakes'] as $mistake): ?>
                                                                    <li><?php echo esc_html($mistake); ?></li>
                                                                <?php endforeach; ?>
                                                            </ul>
                                                        </div>
                                                    <?php endif; ?>
                                                </div>

                                                <button
                                                    onclick="document.getElementById('<?php echo $unique_id; ?>').classList.toggle('hidden')"
                                                    class="text-xs text-white bg-oblink-blue px-3 py-1.5 rounded-lg font-bold hover:bg-blue-700 transition">
                                                    <i class="fas fa-eye mr-1"></i> Voir la correction
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-6 text-center text-gray-500">Aucune donnée de quiz disponible. Lancez l\'extraction IA.</div>';
                            }
                            ?>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <?php
    include get_template_directory() . "/footer-content.php";
    wp_footer();
    ?>--- FILE: theme/page-dashboard-opticien.php ---
<?php
/*
Template Name: Page Dashboard Opticien
*/
include 'header-inc.php';
?>

<!-- JS AUTH GUARD (Supabase) -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Wait for Supabase to be ready
        if (!window.oblinkSupabase) {
            console.error('Supabase not loaded!');
            // Show content anyway in dev mode
            document.getElementById('dashboard-content').classList.remove('opacity-0');
            return;
        }

        try {
            // 2. Check Auth
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                console.error('Auth error:', error);
                document.getElementById('dashboard-content').classList.remove('opacity-0');
                return;
            }

            if (!session) {
                // Not logged in -> Redirect Login
                window.location.href = '<?php echo home_url("/login"); ?>';
                return;
            }

            // 3. Check User Type (Security)
            const userType = session.user.user_metadata?.user_type;
            if (userType && userType !== 'opticien') {
                // Wrong dashboard -> Show clear message then redirect
                const dashboardContent = document.getElementById('dashboard-content');
                dashboardContent.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="max-w-md text-center p-8 bg-white rounded-2xl shadow-xl border border-gray-100">
                            <div class="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-circle text-red-500 text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-oblink-gray mb-3">Accès Refusé</h2>
                            <p class="text-gray-600 mb-6">
                                Cette page est réservée aux <strong>opticiens</strong>.<br>
                                Vous serez redirigé vers votre tableau de bord...
                            </p>
                            <div class="animate-pulse text-sm text-gray-400">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Redirection en cours
                            </div>
                        </div>
                    </div>
                `;
                dashboardContent.classList.remove('opacity-0');

                // Redirect after 2 seconds
                setTimeout(() => {
                    if (userType === 'entreprise') window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                    else window.location.href = '<?php echo home_url("/dashboard"); ?>';
                }, 2000);
                return;
            }

            // 4. Inject User Name
            const userNameElement = document.getElementById('dashboard-username');
            if (userNameElement) {
                userNameElement.textContent = session.user.user_metadata?.first_name || 'Partenaire';
            }

            // 5. Show Content
            document.getElementById('dashboard-content').classList.remove('opacity-0');

        } catch (err) {
            console.error('Dashboard auth error:', err);
            // Show content anyway to avoid blank page
            document.getElementById('dashboard-content').classList.remove('opacity-0');
        }
    });
</script>

<!-- Main Content (Always Visible) -->
<div id="dashboard-content" class="min-h-screen bg-gray-50 pt-24 pb-12 transition-opacity duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Welcome Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-bold font-display text-oblink-gray">Bonjour, <span class="text-oblink-orange"
                        id="dashboard-username">...</span> 👋</h1>
                <p class="text-gray-500">Voici ce qui se passe aujourd'hui sur votre espace.</p>
            </div>
            <div class="flex gap-3">
                <a href="<?php echo home_url('/emploi-opticien'); ?>"
                    class="px-6 py-3 bg-gradient-to-r from-oblink-orange to-red-500 text-white rounded-full font-bold hover:shadow-xl transition-all flex items-center gap-2 shadow-lg">
                    <i class="fas fa-search"></i> Voir les offres
                </a>
                <a href="<?php echo home_url('/devis'); ?>"
                    class="px-4 py-2 bg-oblink-gray text-white rounded-xl font-bold hover:bg-oblink-orange transition flex items-center gap-2">
                    <i class="fas fa-file-invoice"></i> Nouveau Devis
                </a>
                <a href="<?php echo home_url('/parametres'); ?>"
                    class="px-4 py-2 bg-white border border-gray-200 rounded-xl font-semibold text-gray-600 hover:border-oblink-orange hover:text-oblink-orange transition flex items-center gap-2">
                    <i class="fas fa-cog"></i> Paramètres
                </a>
            </div>
        </div>

        <!-- KPI Cards (MOCKS STATIQUES POUR L'INSTANT) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- CA Mensuel -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-orange/10 flex items-center justify-center text-oblink-orange">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <span class="text-xs text-green-500 font-bold bg-green-50 px-2 py-1 rounded-full">+12%</span>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">
                    1 400 €
                </h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">CA Confirmé (Jan)</p>
            </div>

            <!-- Missions -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-blue/10 flex items-center justify-center text-oblink-blue">
                        <i class="fas fa-briefcase"></i>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">3</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Missions proposées</p>
            </div>

            <!-- Candidatures -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div
                        class="w-10 h-10 rounded-full bg-oblink-violet/10 flex items-center justify-center text-oblink-violet">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <span class="text-xs text-oblink-orange font-bold bg-orange-50 px-2 py-1 rounded-full">2 news</span>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">5</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Candidatures en cours</p>
            </div>

            <!-- Note -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-oblink-gray mb-1">4.9/5</h3>
                <p class="text-xs text-gray-400 uppercase font-semibold tracking-wider">Note Moyenne</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- LEFT COLUMN (Main Content) -->
            <div class="lg:col-span-2 space-y-8">

                <!-- MESSAGERIE (Full Implementation) -->
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100"
                    id="messagerie-section">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-xl font-bold font-display text-oblink-gray flex items-center gap-2">
                            <i class="fas fa-comment-dots text-oblink-orange"></i> Messagerie
                        </h2>
                    </div>
                    <div class="flex h-[350px]">
                        <!-- Sidebar Conversations -->
                        <div class="w-1/3 border-r border-gray-100 bg-gray-50 overflow-y-auto" id="conversation-list">
                            <?php
                            $convs = oblink_get_conversations();
                            if ($convs) {
                                foreach ($convs as $c) {
                                    $contact = get_userdata($c->contact_id);
                                    $contact_name = $contact ? $contact->display_name : "Entreprise #" . $c->contact_id;
                                    ?>
                                    <div class="p-4 border-b border-gray-100 hover:bg-white cursor-pointer transition conversation-item"
                                        data-contact-id="<?php echo $c->contact_id; ?>">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-oblink-blue text-white flex items-center justify-center font-bold text-sm">
                                                <?php echo strtoupper(substr($contact_name, 0, 1)); ?>
                                            </div>
                                            <div class="overflow-hidden">
                                                <h4 class="font-bold text-sm text-gray-800 truncate">
                                                    <?php echo esc_html($contact_name); ?>
                                                </h4>
                                                <p class="text-xs text-gray-500 truncate">
                                                    <?php echo esc_html(substr($c->message, 0, 40)); ?>...
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }
                            } else {
                                echo '<div class="p-4 text-xs text-gray-400 text-center mt-10">Aucune conversation active</div>';
                            }
                            ?>
                        </div>
                        <!-- Chat Area -->
                        <div class="w-2/3 flex flex-col bg-white">
                            <div class="flex-1 p-6 overflow-y-auto space-y-4" id="chat-messages">
                                <div class="flex flex-col items-center justify-center h-full text-gray-400">
                                    <i class="fas fa-comments text-4xl mb-4 text-gray-200"></i>
                                    <p class="text-sm">Sélectionnez une conversation</p>
                                </div>
                            </div>
                            <!-- Input -->
                            <div class="p-4 border-t border-gray-100 bg-gray-50 hidden" id="chat-input-area">
                                <form id="send-message-form" class="flex gap-2">
                                    <input type="hidden" id="current-contact-id" value="">
                                    <input type="text" id="message-input"
                                        class="flex-1 rounded-xl border-gray-200 text-sm focus:ring-oblink-orange focus:border-oblink-orange"
                                        placeholder="Écrivez votre message...">
                                    <button type="submit"
                                        class="w-10 h-10 rounded-xl bg-oblink-orange text-white hover:bg-orange-600 transition flex items-center justify-center">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Missions (DYNAMIC) -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold font-display text-oblink-gray">Missions récentes</h2>
                        <a href="<?php echo home_url('/emploi-opticien'); ?>"
                            class="text-sm font-semibold text-oblink-blue hover:underline">Voir tout</a>
                    </div>

                    <div id="dashboard-offers-container" class="space-y-4">
                        <!-- Loading State -->
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Chargement des offres...</p>
                        </div>
                    </div>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', async () => {
                        const container = document.getElementById('dashboard-offers-container');

                        try {
                            // Fetch active offers
                            const { data: offers, error } = await window.oblinkSupabase
                                .from('offers')
                                .select(`
                                *,
                                company:profiles!company_id (
                                    company_name,
                                    company_city
                                )
                            `)
                                .eq('status', 'active')
                                .order('created_at', { ascending: false })
                                .limit(5);

                            if (error) throw error;

                            if (!offers || offers.length === 0) {
                                container.innerHTML = '<div class="p-4 text-center text-gray-500">Aucune offre disponible pour le moment.</div>';
                                return;
                            }

                            // Render offers
                            container.innerHTML = offers.map(offer => {
                                const startDate = new Date(offer.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                                const endDate = offer.end_date ? new Date(offer.end_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }) : '';
                                const dateDisplay = endDate ? `${startDate} - ${endDate}` : `À partir du ${startDate}`;

                                // Determine color based on title first letter (randomish)
                                const letter = offer.company?.company_name?.charAt(0) || 'O';
                                const colors = ['oblink-blue', 'oblink-violet', 'oblink-orange'];
                                const colorClass = colors[offer.title.length % 3];

                                return `
                            <div class="flex flex-col md:flex-row md:items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100 hover:border-oblink-blue/30 transition group cursor-pointer" onclick="window.location.href='<?php echo home_url('/emploi-opticien'); ?>?id=${offer.id}'">
                                <div class="flex items-center gap-4 mb-4 md:mb-0">
                                    <div class="w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center text-xl font-bold ${colorClass}">
                                        ${letter}
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-oblink-gray group-hover:text-oblink-blue transition">
                                            ${offer.title}
                                        </h3>
                                        <p class="text-sm text-gray-500">
                                            <span class="font-semibold text-gray-700">${offer.company?.company_name || 'Entreprise confidentielle'}</span> • 
                                            <i class="far fa-calendar ml-1 mr-1"></i> ${dateDisplay}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="text-right">
                                        <span class="block font-bold text-oblink-gray">${offer.daily_rate} €/j</span>
                                        <span class="text-xs text-gray-500">${offer.city}</span>
                                    </div>
                                </div>
                            </div>
                            `;
                            }).join('');

                        } catch (err) {
                            console.error('Error loading offers:', err);
                            container.innerHTML = '<div class="text-red-500 text-center py-4">Impossible de charger les offres.</div>';
                        }
                    });
                </script>

                <!-- Available Missions Suggestions -->
                <div
                    class="bg-gradient-to-br from-oblink-gray to-black rounded-3xl p-6 md:p-8 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-oblink-orange/20 rounded-full blur-[80px]"></div>

                    <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                        <div>
                            <h2 class="text-xl font-bold font-display mb-2">3 nouvelles missions correspondent à votre
                                profil</h2>
                            <p class="text-white/60 text-sm">Basé sur vos préférences : Paris, >300€/j</p>
                        </div>
                        <a href="<?php echo home_url('/emploi-opticien'); ?>"
                            class="whitespace-nowrap px-6 py-3 bg-oblink-orange text-white font-bold rounded-xl hover:bg-white hover:text-oblink-orange transition shadow-lg shadow-oblink-orange/30">
                            Voir les offres
                        </a>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN (Sidebar) -->
            <div class="space-y-8">
                <!-- Quick Actions -->
                <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                    <h2 class="text-lg font-bold font-display text-oblink-gray mb-4">Accès Rapide</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="<?php echo home_url('/facture'); ?>"
                            class="p-4 rounded-xl bg-orange-100 hover:bg-orange-200 text-center transition group">
                            <i
                                class="fas fa-file-invoice-dollar text-2xl text-oblink-orange mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Nouvelle Facture</span>
                        </a>
                        <a href="<?php echo home_url('/generateur-contrat'); ?>"
                            class="p-4 rounded-xl bg-blue-50 hover:bg-blue-100 text-center transition group">
                            <i
                                class="fas fa-file-contract text-2xl text-oblink-blue mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Générateur Contrat</span>
                        </a>
                        <a href="<?php echo home_url('/formation-erp'); ?>"
                            class="p-4 rounded-xl bg-purple-50 hover:bg-purple-100 text-center transition group">
                            <i
                                class="fas fa-graduation-cap text-2xl text-oblink-violet mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Formation</span>
                        </a>
                        <a href="<?php echo home_url('/simulateur'); ?>"
                            class="p-4 rounded-xl bg-gray-50 hover:bg-gray-100 text-center transition group">
                            <i
                                class="fas fa-calculator text-2xl text-gray-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="block text-xs font-bold text-oblink-gray">Simulateur</span>
                        </a>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<!-- MESSAGING JAVASCRIPT -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const conversationItems = document.querySelectorAll('.conversation-item');
        const chatMessages = document.getElementById('chat-messages');
        const chatInputArea = document.getElementById('chat-input-area');
        const currentContactIdInput = document.getElementById('current-contact-id');
        const sendMessageForm = document.getElementById('send-message-form');
        const messageInput = document.getElementById('message-input');

        // Load chat when clicking a conversation
        conversationItems.forEach(item => {
            item.addEventListener('click', function () {
                const contactId = this.dataset.contactId;
                currentContactIdInput.value = contactId;

                // Highlight selected
                conversationItems.forEach(c => c.classList.remove('bg-white', 'ring-2', 'ring-oblink-orange'));
                this.classList.add('bg-white', 'ring-2', 'ring-oblink-orange');

                // Show input area
                chatInputArea.classList.remove('hidden');

                // Load messages via AJAX
                loadChat(contactId);
            });
        });

        function loadChat(contactId) {
            chatMessages.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-spinner fa-spin mr-2"></i> Chargement...</div>';

            fetch(`<?php echo admin_url('admin-ajax.php'); ?>?action=oblink_load_chat&contact_id=${contactId}&nonce=${oblink_vars.nonce}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        chatMessages.innerHTML = data.data.html || '<p class="text-center text-gray-400 text-sm">Aucun message</p>';
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur chargement</p>';
                    }
                })
                .catch(() => {
                    chatMessages.innerHTML = '<p class="text-center text-red-500 text-sm">Erreur réseau</p>';
                });
        }

        // Send message
        if (sendMessageForm) {
            sendMessageForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const message = messageInput.value.trim();
                const receiverId = currentContactIdInput.value;

                if (!message || !receiverId) return;

                const formData = new FormData();
                formData.append('action', 'oblink_send_msg');
                formData.append('receiver_id', receiverId);
                formData.append('message', message);
                formData.append('nonce', oblink_vars.nonce);

                fetch('<?php echo admin_url("admin-ajax.php"); ?>', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            messageInput.value = '';
                            loadChat(receiverId); // Reload chat
                        } else {
                            alert('Erreur: ' + (data.data?.message || 'Envoi impossible'));
                        }
                    })
                    .catch(() => alert('Erreur réseau'));
            });
        }
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-inscription-entreprise.php ---
<?php
/*
Template Name: Page Inscription Entreprise
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-oblink-blue/5 pt-32 pb-20 relative overflow-hidden">

    <!-- Background Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-10 w-96 h-96 bg-oblink-blue/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 left-10 w-64 h-64 bg-oblink-violet/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-4 relative z-10">

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold font-display text-oblink-gray mb-4">
                Recrutez vos <span class="text-oblink-blue">Opticiens</span>
            </h1>
            <p class="text-lg text-oblink-gray/70 max-w-xl mx-auto font-body">
                Inscrivez votre magasin en 2 minutes et accédez instantanément à notre vivier d'opticiens vérifiés.
            </p>
        </div>

        <!-- Multi-step Form Container -->
        <div class="bg-white rounded-[2rem] shadow-2xl border border-white/50 backdrop-blur-xl overflow-hidden">

            <!-- Progress Bar -->
            <div class="bg-gray-50 px-8 py-6 border-b border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-oblink-gray uppercase tracking-wider">Progression</span>
                    <span class="text-xs font-bold text-oblink-blue" id="progress-text">Étape 1 sur 3</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-oblink-blue to-oblink-violet h-2 rounded-full transition-all duration-500"
                        style="width: 33%" id="progress-bar"></div>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-green-50 border border-green-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-check-circle text-green-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-green-700" id="success-text"></p>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mx-8 mt-6 p-4 rounded-xl bg-red-50 border border-red-200">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5"></i>
                    <div>
                        <p class="text-sm font-semibold text-red-700" id="error-text"></p>
                    </div>
                </div>
            </div>

            <form id="entreprise-register-form" class="p-8 md:p-12">

                <!-- STEP 1: Entreprise -->
                <div class="form-step active" data-step="1">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-blue/20 text-oblink-blue flex items-center justify-center text-sm font-bold">1</span>
                        Votre Entreprise
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Raison Sociale / Nom du
                            Magasin</label>
                        <input type="text" name="company_name"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="Ex: Optic 2000 - Centre Villagio" required>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Numéro SIRET</label>
                        <input type="text" name="siret"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="14 chiffres" required>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Adresse Principale</label>
                        <div class="relative">
                            <i
                                class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="address" id="entreprise-address"
                                class="w-full pl-12 pr-16 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Commencez à taper votre adresse..." required>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button type="button"
                            class="next-step-btn px-8 py-3 bg-oblink-gray text-white font-bold rounded-xl hover:bg-oblink-blue transition-all flex items-center gap-2">
                            Continuer <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Contact Admin -->
                <div class="form-step hidden" data-step="2">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-violet/20 text-oblink-violet flex items-center justify-center text-sm font-bold">2</span>
                        Administrateur du compte
                    </h2>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Prénom</label>
                            <input type="text" name="admin_firstname"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Marie" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nom</label>
                            <input type="text" name="admin_lastname"
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                                placeholder="Curie" required>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email de connexion</label>
                        <input type="email" name="admin_email"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="marie@optic2000.com" required>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" name="password"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 outline-none transition"
                            placeholder="••••••••" required>
                    </div>

                    <div class="flex justify-between">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit" id="submit-btn"
                            class="px-8 py-3 bg-oblink-blue text-white font-bold rounded-xl hover:bg-oblink-gray transition-all flex items-center gap-2">
                            <i class="fas fa-check mr-2"></i> Créer mon compte
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Offre (TEMPORAIREMENT MASQUÉ) -->
                <div class="form-step hidden" data-step="3" style="display: none !important;">
                    <h2 class="text-2xl font-bold text-oblink-gray mb-6 font-display flex items-center gap-3">
                        <span
                            class="w-8 h-8 rounded-full bg-oblink-orange/20 text-oblink-orange flex items-center justify-center text-sm font-bold">3</span>
                        Choisissez votre formule
                    </h2>

                    <div class="grid md:grid-cols-2 gap-4 mb-8">
                        <!-- Plan Gratuit -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="plan" value="free" class="hidden peer" checked>
                            <div
                                class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-gray-50 transition-all shadow-sm">
                                <h3 class="text-xl font-bold text-oblink-gray mb-2">Découverte</h3>
                                <p class="text-3xl font-black text-oblink-gray mb-4">0 €<span
                                        class="text-sm font-normal text-gray-500">/mois</span></p>
                                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> 1
                                        Offre d'emploi</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i>
                                        Visibilité standard</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i>
                                        Commission standard</li>
                                </ul>
                            </div>
                            <div
                                class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-oblink-gray flex items-center justify-center transition-colors">
                                <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                            </div>
                        </label>

                        <!-- Plan Premium -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="plan" value="premium" class="hidden peer">
                            <div
                                class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-oblink-blue peer-checked:border-oblink-blue peer-checked:bg-blue-50/50 transition-all shadow-sm">
                                <div
                                    class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-oblink-blue text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">
                                    Recommandé</div>
                                <h3 class="text-xl font-bold text-oblink-blue mb-2">Premium</h3>
                                <p class="text-3xl font-black text-oblink-gray mb-4">49 €<span
                                        class="text-sm font-normal text-gray-500">/mois</span></p>
                                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Offres illimitées</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Accès CV-thèque</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-oblink-blue"></i>
                                        Commission réduite</li>
                                </ul>
                            </div>
                            <div
                                class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-blue peer-checked:bg-oblink-blue flex items-center justify-center transition-colors">
                                <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                            </div>
                            <!-- Plan Corporate -->
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="plan" value="corporate" class="hidden peer">
                                <div
                                    class="h-full p-6 rounded-2xl border-2 border-gray-200 bg-white hover:border-oblink-gray peer-checked:border-oblink-gray peer-checked:bg-gray-50 transition-all shadow-sm">
                                    <h3 class="text-xl font-bold text-oblink-gray mb-2">Corporate</h3>
                                    <p class="text-2xl font-black text-oblink-gray mb-4">Sur Mesure</p>
                                    <ul class="text-sm text-gray-600 space-y-2 mb-4">
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            Multi-comptes</li>
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            API RH</li>
                                        <li class="flex items-center gap-2"><i
                                                class="fas fa-check text-oblink-blue"></i>
                                            Facturation centralisée</li>
                                    </ul>
                                </div>
                                <div
                                    class="absolute top-4 right-4 w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-oblink-gray peer-checked:bg-oblink-gray flex items-center justify-center transition-colors">
                                    <i class="fas fa-check text-white text-xs opacity-0 peer-checked:opacity-100"></i>
                                </div>
                            </label>
                    </div>

                    <!-- Payment Details (Conditional) -->
                    <div id="payment-section" class="hidden border-t border-gray-100 pt-6 mb-8 animated fadeIn">
                        <h4 class="font-bold text-oblink-gray mb-4">Paiement Sécurisé</h4>
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <div class="flex items-center gap-3 mb-4">
                                <i class="fas fa-credit-card text-gray-400"></i>
                                <input type="text" placeholder="Numéro de carte"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" placeholder="MM/AA"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                                <input type="text" placeholder="CVC"
                                    class="bg-white w-full px-3 py-2 rounded-lg border border-gray-200 text-sm">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <button type="button"
                            class="prev-step-btn px-6 py-3 text-gray-500 font-bold hover:text-oblink-gray transition">
                            Retour
                        </button>
                        <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2">
                            Créer mon compte Entreprise <i class="fas fa-building"></i>
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <div class="text-center mt-8">
            <p class="text-gray-500">Vous avez déjà un compte ? <a href="<?php echo home_url('/login'); ?>"
                    class="font-bold text-oblink-blue hover:underline">Connectez-vous</a></p>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Reuse the same logic as opticien form for stepper
        const steps = document.querySelectorAll('.form-step');
        const nextBtns = document.querySelectorAll('.next-step-btn');
        const prevBtns = document.querySelectorAll('.prev-step-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        let currentStep = 1;

        function updateStep(step) {
            steps.forEach(s => s.classList.add('hidden'));
            steps.forEach(s => s.classList.remove('active'));

            const activeStep = document.querySelector(`.form-step[data-step="${step}"]`);
            activeStep.classList.remove('hidden');

            const percentage = (step / 3) * 100;
            progressBar.style.width = percentage + '%';
            progressText.textContent = `Étape ${step} sur 3`;

            document.querySelector('form').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        nextBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Add validation here if needed
                if (currentStep < 3) {
                    currentStep++;
                    updateStep(currentStep);
                }
            });
        });

        prevBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateStep(currentStep);
                }
            });
        });

        // PAYMENT LOGIC
        const planInputs = document.querySelectorAll('input[name="plan"]');
        const paymentSection = document.getElementById('payment-section');

        function updatePaymentVisibility() {
            const selectedPlan = document.querySelector('input[name="plan"]:checked')?.value;
            if (selectedPlan === 'premium') {
                paymentSection.classList.remove('hidden');
                // Auto scroll to payment if visible
                setTimeout(() => {
                    paymentSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            } else {
                paymentSection.classList.add('hidden');
            }
        }

        planInputs.forEach(input => {
            input.addEventListener('change', updatePaymentVisibility);
        });

        // Init
        updatePaymentVisibility();

        // SUPABASE SUBMISSION (Updated with DEBUG)
        const form = document.getElementById('entreprise-register-form');

        console.log('DEBUG: Form element:', form);

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('DEBUG: Submit event fired!');

            const btn = form.querySelector('button[type="submit"]');
            console.log('DEBUG: Submit button:', btn);

            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const formData = new FormData(form);
            const email = formData.get('admin_email');
            const password = formData.get('password');
            const firstName = formData.get('admin_firstname');
            const lastName = formData.get('admin_lastname');

            console.log('DEBUG: Form values:', { email, firstName, lastName });

            // CHECK IF SUPABASE CLIENT EXISTS
            if (typeof window.oblinkSupabase === 'undefined') {
                console.error('ERREUR CRITIQUE: window.oblinkSupabase n\'existe pas!');

                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : Le système d\'authentification n\'est pas initialisé. Rechargez la page.';
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
                return;
            }

            console.log('DEBUG: Supabase client exists:', window.oblinkSupabase);

            // Metadata for Profile (Entreprise)
            const metaData = {
                first_name: firstName,
                last_name: lastName,
                full_name: `${firstName} ${lastName}`,
                company_name: formData.get('company_name'),
                siret: formData.get('siret'),
                address: formData.get('address'),
                user_type: 'entreprise',
                plan: formData.get('plan')
            };

            console.log('DEBUG: Metadata:', metaData);

            try {
                console.log('DEBUG: Calling signUp...');
                // 1. Sign Up
                const { data, error } = await window.oblinkSupabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: metaData
                    }
                });

                console.log('DEBUG: signUp response:', { data, error });

                if (error) throw error;

                // 2. Success
                const successDiv = document.getElementById('success-message');
                const successText = document.getElementById('success-text');
                successText.textContent = '✅ Compte entreprise créé avec succès ! Redirection...';
                successDiv.classList.remove('hidden');
                successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
                }, 1500);

            } catch (error) {
                console.error('Supabase Error:', error);

                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = 'Erreur : ' + (error.message || error);
                errorDiv.classList.remove('hidden');
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        });
    });
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-dashboard.php ---
<?php
/*
Template Name: Dashboard
*/
include 'header-inc.php';
?>

<!-- JS AUTH GUARD & ROUTER -->
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        // 1. Check Auth
        const { data: { session } } = await window.oblinkSupabase.auth.getSession();

        if (!session) {
            window.location.href = '<?php echo home_url("/login"); ?>';
            return;
        }

        // 2. Redirect based on User Type
        const userType = session.user.user_metadata.user_type;
        if (userType === 'opticien') {
            window.location.href = '<?php echo home_url("/dashboard-opticien"); ?>';
        } else if (userType === 'entreprise') {
            window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
        }
    });
</script>

<div class="max-w-7xl mx-auto px-4 py-32 min-h-screen">
    <!-- Header -->
    <div class="flex justify-between items-center mb-12">
        <div>
            <h1 class="text-4xl font-bold text-oblink-gray mb-2" style="font-family: 'Montserrat', sans-serif;">
                Tableau de bord
            </h1>
            <p class="text-oblink-gray/70">Bienvenue sur votre espace OBLINK</p>
        </div>
        <div class="flex gap-4">
            <a href="<?php echo home_url('/devis'); ?>"
                class="px-6 py-3 border-2 border-oblink-blue text-oblink-blue rounded-lg font-semibold hover:bg-oblink-blue hover:text-white transition">
                <i class="fas fa-file-alt mr-2"></i>Nouveau Devis
            </a>
            <a href="<?php echo home_url('/facture'); ?>"
                class="px-6 py-3 bg-oblink-orange text-white rounded-lg font-semibold hover:bg-oblink-orange/90 transition shadow-lg">
                <i class="fas fa-plus mr-2"></i>Nouvelle Facture
            </a>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="grid md:grid-cols-4 gap-6 mb-12">
        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-orange">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Chiffre d'affaires</div>
                    <div class="text-2xl font-bold text-oblink-gray">12 450 €</div>
                </div>
                <div
                    class="w-10 h-10 bg-oblink-orange/10 rounded-lg flex items-center justify-center text-oblink-orange">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="text-green-500 text-sm flex items-center">
                <i class="fas fa-arrow-up mr-1"></i> +15% ce mois
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-blue">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Missions réalisées</div>
                    <div class="text-2xl font-bold text-oblink-gray">24</div>
                </div>
                <div class="w-10 h-10 bg-oblink-blue/10 rounded-lg flex items-center justify-center text-oblink-blue">
                    <i class="fas fa-check-circle"></i>
                </div>
            </div>
            <div class="text-oblink-gray/60 text-sm">
                Depuis le début de l'année
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-oblink-violet">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Factures en attente</div>
                    <div class="text-2xl font-bold text-oblink-gray">3</div>
                </div>
                <div
                    class="w-10 h-10 bg-oblink-violet/10 rounded-lg flex items-center justify-center text-oblink-violet">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="text-oblink-blue text-sm font-semibold">
                840 € à encaisser
            </div>
        </div>

        <div class="glass-card bg-white p-6 rounded-2xl shadow-lg border-l-4 border-green-500">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-oblink-gray/60 text-sm font-semibold mb-1">Taux de réponse</div>
                    <div class="text-2xl font-bold text-oblink-gray">98%</div>
                </div>
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="text-green-500 text-sm flex items-center">
                Top profil
            </div>
        </div>
    </div>

    <!-- Recent Activity / Missions -->
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Missions List -->
        <div class="lg:col-span-2 space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-oblink-gray">Missions récentes</h2>
                <a href="#" class="text-oblink-orange font-semibold hover:underline">Tout voir</a>
            </div>

            <div class="bg-white rounded-2xl shadow-xl overflow-hidden glass-card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50/50 border-b border-gray-100">
                            <tr>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Entreprise</th>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Date/Lieu</th>
                                <th class="text-left py-4 px-6 text-sm font-semibold text-gray-600">Statut</th>
                                <th class="text-right py-4 px-6 text-sm font-semibold text-gray-600">Montant</th>
                                <th class="py-4 px-6"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Optique Martin</div>
                                    <div class="text-xs text-gray-500">SIRET: 123...456</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">15 Jan - 17 Jan</div>
                                    <div class="text-xs text-gray-500">Bordeaux (33)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Terminé
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    840 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Alain Afflelou</div>
                                    <div class="text-xs text-gray-500">Mérignac Soleil</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">20 Jan - 25 Jan</div>
                                    <div class="text-xs text-gray-500">Mérignac (33)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        Confirmé
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    1 680 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition">
                                <td class="py-4 px-6">
                                    <div class="font-bold text-gray-800">Krys</div>
                                    <div class="text-xs text-gray-500">Centre Ville</div>
                                </td>
                                <td class="py-4 px-6">
                                    <div class="text-sm font-medium">05 Fév</div>
                                    <div class="text-xs text-gray-500">Paris (75)</div>
                                </td>
                                <td class="py-4 px-6">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        En attente
                                    </span>
                                </td>
                                <td class="py-4 px-6 text-right font-bold text-oblink-gray">
                                    280 €
                                </td>
                                <td class="py-4 px-6 text-right">
                                    <button class="text-gray-400 hover:text-oblink-blue transition">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sidebar / Tools -->
        <div class="space-y-6">
            <h2 class="text-2xl font-bold text-oblink-gray">Outils rapides</h2>

            <div class="bg-white p-6 rounded-2xl shadow-xl glass-card">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fas fa-file-invoice-dollar text-oblink-orange mr-2"></i>Facturation
                </h3>
                <div class="space-y-3">
                    <a href="<?php echo home_url('/facture'); ?>"
                        class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition group">
                        <div
                            class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 group-hover:bg-green-200 transition">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="ml-3">
                            <div class="font-semibold text-gray-800">Nouvelle facture</div>
                            <div class="text-xs text-gray-500">Éditer une facture conforme</div>
                        </div>
                    </a>
                    <a href="<?php echo home_url('/devis'); ?>"
                        class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition group">
                        <div
                            class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 group-hover:bg-blue-200 transition">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="ml-3">
                            <div class="font-semibold text-gray-800">Nouveau devis</div>
                            <div class="text-xs text-gray-500">Envoyer une proposition</div>
                        </div>
                    </a>
                </div>
            </div>

            <div class="bg-gradient-to-br from-oblink-orange to-oblink-violet p-6 rounded-2xl shadow-xl text-white">
                <h3 class="font-bold text-lg mb-2">Besoin d'aide ?</h3>
                <p class="text-white/80 text-sm mb-4">Contactez notre support dédié aux opticiens.</p>
                <button
                    class="w-full py-2 bg-white/20 backdrop-blur-md rounded-lg hover:bg-white/30 transition text-sm font-semibold">
                    Contacter le support
                </button>
            </div>
        </div>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-generateur-contrat.php ---
<?php
/*
Template Name: Page Generateur Contrat
*/
include 'header-inc.php';
?>

<!-- CDN pour la génération de PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="text-center mb-12">
            <span class="inline-block py-1 px-3 rounded-full bg-oblink-blue/10 text-oblink-blue font-bold text-sm mb-4 uppercase tracking-wider">
                Outil Juridique Gratuit
            </span>
            <h1 class="text-4xl font-bold font-display text-oblink-gray mb-4">
                Générateur de Contrat <span class="text-oblink-blue">Expert Optique</span>
            </h1>
            <p class="text-lg text-gray-500 max-w-2xl mx-auto">
                Créez une convention de prestation sur-mesure. 
                <span class="text-oblink-orange font-bold block mt-2 text-sm"><i class="fas fa-certificate mr-1"></i> Idéal pour valoriser une expertise spécifique (Vente, Réfraction, Atelier).</span>
            </p>
        </div>

        <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
            <form id="contract-form" class="p-8 md:p-12">
                
                <!-- SECTION 1 : The Parties -->
                <div class="grid md:grid-cols-2 gap-12 mb-12">
                    
                    <!-- Client (Magasin) -->
                    <div>
                        <h3 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                            <i class="fas fa-store text-oblink-blue"></i> Le Client (Magasin)
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Raison Sociale</label>
                                <input type="text" id="client_name" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: SAS Optic Vision" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">SIRET</label>
                                <input type="text" id="client_siret" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="14 chiffres" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Adresse Complète</label>
                                <input type="text" id="client_address" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="10 rue de la République, 75000 Paris" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Représenté par</label>
                                <input type="text" id="client_rep" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="M. Dupont (Gérant)" required>
                            </div>
                        </div>
                    </div>

                    <!-- Prestataire (Opticien) -->
                    <div>
                        <h3 class="text-xl font-bold text-oblink-gray mb-6 flex items-center gap-2">
                            <i class="fas fa-user-tie text-oblink-orange"></i> Le Prestataire (Freelance)
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Nom & Prénom</label>
                                <input type="text" id="freelance_name" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="Ex: Julie Martin" required>
                            </div>
                            
                            <!-- Qualification Selector -->
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Niveau de Qualification</label>
                                <select id="freelance_qualif" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" onchange="toggleAdeli()">
                                    <option value="opticien">Opticien Diplômé (BTS)</option>
                                    <option value="monteur">Monteur-Vendeur (Non diplômé)</option>
                                    <option value="expert_refraction">Expert Réfraction / Optométrie</option>
                                    <option value="consultant">Consultant Vente / Business</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">SIRET (Auto-entrepreneur)</label>
                                <input type="text" id="freelance_siret" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="14 chiffres" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Adresse</label>
                                <input type="text" id="freelance_address" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" required>
                            </div>
                            
                            <!-- ADELI : S'affiche seulement si Opticien -->
                            <div id="adeli-field">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Numéro ADELI / RPPS</label>
                                <input type="text" id="freelance_adeli" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-orange outline-none" placeholder="Obligatoire pour les diplômés">
                            </div>
                        </div>
                    </div>

                </div>

                <hr class="border-gray-100 my-8">

                <!-- SECTION 2 : Mission Details with Expertise -->
                <div class="mb-12">
                    <h3 class="text-xl font-bold text-oblink-gray mb-6">Objet de la Mission</h3>
                    
                    <!-- Expertise Type -->
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Nature de l'intervention (Le "Plus" Expert)</label>
                        <select id="mission_expertise" class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none font-bold text-oblink-blue">
                            <option value="standard">Renfort Technique Standard (Vente/Atelier)</option>
                            <option value="examen">Expertise Examens de Vue & Santé Visuelle</option>
                            <option value="business">Coaching Vente & Développement C.A.</option>
                            <option value="atelier">Expertise Montage Complexe & SAV</option>
                            <option value="audit">Audit Organisation & Process Magasin</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i> Préciser une expertise spécifique renforce l'indépendance de la mission vis-à-vis de l'URSSAF.
                        </p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3">Durée</label>
                            <div class="flex gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="mission_type" value="short" class="peer sr-only" checked onchange="toggleMissionDates()">
                                    <div class="px-4 py-3 rounded-lg border-2 border-gray-200 peer-checked:border-oblink-blue peer-checked:bg-white transition text-center">
                                        <span class="block font-bold text-sm">Vacation Ponctuelle</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="mission_type" value="long" class="peer sr-only" onchange="toggleMissionDates()">
                                    <div class="px-4 py-3 rounded-lg border-2 border-gray-200 peer-checked:border-oblink-blue peer-checked:bg-white transition text-center">
                                        <span class="block font-bold text-sm">Mission Longue</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Dynamic Date Inputs -->
                        <div id="date-container-short">
                            <label class="block text-sm font-bold text-gray-700 mb-1">Dates d'intervention</label>
                            <input type="text" id="mission_dates_short" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: Du 12 au 14 Juillet">
                        </div>
                        <div id="date-container-long" class="hidden">
                            <label class="block text-sm font-bold text-gray-700 mb-1">Date de démarrage</label>
                            <input type="date" id="mission_start_long" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none">
                        </div>
                    </div>

                    <div class="mt-6">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Honoraires H.T.</label>
                        <div class="flex gap-4">
                            <input type="number" id="mission_price" class="w-1/3 px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none" placeholder="Ex: 350" required>
                            <select id="mission_unit" class="w-1/4 px-4 py-2 rounded-lg border border-gray-200 focus:border-oblink-blue outline-none">
                                <option value="euros / jour">Euros / Jour</option>
                                <option value="euros / heure">Euros / Heure</option>
                                <option value="euros forfait">Forfait Global</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SECTION 3 : Mandatory Checkboxes -->
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 mb-8">
                    <h4 class="font-bold text-oblink-gray mb-4 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500"></i> Engagements Réciproques
                    </h4>
                    <div class="space-y-2">
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Le Prestataire déclare disposer des <strong>compétences et diplômes</strong> requis pour l'expertise choisie.</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Obligation de moyens : Le Prestataire mettra tout en œuvre pour atteindre les objectifs (ex: CA), sans obligation de résultat garantie.</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-oblink-blue rounded border-gray-300">
                            <span class="text-sm text-gray-600">Respect de la confidentialité, du RGPD et du secret professionnel.</span>
                        </label>
                    </div>
                </div>

                <div class="flex justify-center">
                    <button type="button" onclick="generatePDF()" class="px-8 py-4 bg-gradient-to-r from-oblink-blue to-oblink-violet text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all flex items-center gap-3">
                        <i class="fas fa-file-contract"></i> Générer le Contrat Expert PDF
                    </button>
                </div>

            </form>
        </div>
        
    </div>
</div>

<script>
function toggleMissionDates() {
    const isShort = document.querySelector('input[name="mission_type"]:checked').value === 'short';
    document.getElementById('date-container-short').classList.toggle('hidden', !isShort);
    document.getElementById('date-container-long').classList.toggle('hidden', isShort);
}

function toggleAdeli() {
    const qualif = document.getElementById('freelance_qualif').value;
    const adeliField = document.getElementById('adeli-field');
    const isMedical = (qualif === 'opticien' || qualif === 'expert_refraction');
    
    adeliField.style.display = isMedical ? 'block' : 'none';
}

function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // --- DATA ---
    const client = {
        name: document.getElementById('client_name').value,
        siret: document.getElementById('client_siret').value,
        addr: document.getElementById('client_address').value,
        rep: document.getElementById('client_rep').value
    };
    const qualif = document.getElementById('freelance_qualif').value;
    const freelance = {
        name: document.getElementById('freelance_name').value,
        siret: document.getElementById('freelance_siret').value,
        addr: document.getElementById('freelance_address').value,
        // Get generic label for qualification
        role_label: document.getElementById('freelance_qualif').options[document.getElementById('freelance_qualif').selectedIndex].text
    };
    
    // Safety check
    if(!client.name || !freelance.name) { alert("Merci de remplir l'identité des deux parties."); return; }

    // Mission Details
    const missionType = document.querySelector('input[name="mission_type"]:checked').value;
    const dates = missionType === 'short' 
        ? "Vacation précise : " + document.getElementById('mission_dates_short').value 
        : "Mission longue à compter du : " + document.getElementById('mission_start_long').value;
    
    const expertiseValue = document.getElementById('mission_expertise').value;
    const expertiseLabel = document.getElementById('mission_expertise').options[document.getElementById('mission_expertise').selectedIndex].text;

    // --- PDF BUILD ---
    let y = 20;

    doc.setFontSize(20);
    doc.setFont("helvetica", "bold");
    doc.text("CONTRAT DE PRESTATION DE SERVICE", 105, y, { align: "center" });
    y += 10;
    doc.setFontSize(14);
    doc.setTextColor(100);
    doc.text(expertiseLabel.toUpperCase(), 105, y, { align: "center" }); // Subtitle: Expertise
    doc.setTextColor(0);
    y += 15;
    
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    
    // PARTIES
    const partyBlock = (title, data) => {
        doc.setFont("helvetica", "bold");
        doc.text(title, 20, y);
        y += 5;
        doc.setFont("helvetica", "normal");
        doc.text("Raison Sociale / Nom : " + data.name, 20, y); y+=5;
        doc.text("SIRET : " + data.siret, 20, y); y+=5;
        doc.text("Adresse : " + data.addr, 20, y); y+=5;
        if(data.rep) doc.text("Représenté par : " + data.rep, 20, y);
        if(data.role_label) doc.text("Qualification déclarée : " + data.role_label, 20, y);
        y+=10;
    }

    partyBlock("LE CLIENT (DONNEUR D'ORDRE) :", client);
    partyBlock("LE PRESTATAIRE (FREELANCE) :", freelance);
    
    // CLAUSES HELPER
    const addClause = (title, content) => {
        if(y > 270) { doc.addPage(); y = 20; }
        doc.setFont("helvetica", "bold");
        doc.text(title, 20, y);
        y += 5;
        doc.setFont("helvetica", "normal");
        const lines = doc.splitTextToSize(content, 170);
        doc.text(lines, 20, y);
        y += (lines.length * 5) + 8;
    };

    // 1. OBJET (Spécifique avec expertise)
    let expertClause = "Le Client confie au Prestataire une mission spécifique de : " + expertiseLabel + ".\n";
    expertClause += "Le Prestataire mettra en œuvre son savoir-faire technique et commercial pour atteindre les objectifs fixés (notamment en termes de performance ou de qualité).\n";
    expertClause += "Cette mission ne constitue en aucun cas un remplacement standard de salarié mais un apport d'expertise externe.\n";
    expertClause += dates;

    addClause("ARTICLE 1 - OBJET DE LA MISSION D'EXPERTISE", expertClause);

    // 2. INDEPENDANCE (Bouclier URSSAF)
    addClause("ARTICLE 2 - INDEPENDANCE ET ABSENCE DE LIEN DE SUBORDINATION", 
        "Le Prestataire exerce sa mission en totale autonomie. Il n'est soumis à aucun horaire fixe imposé (sauf contraintes d'ouverture du magasin) ni à aucune directive hiérarchique.\n" +
        "Il organise son travail librement pour atteindre les objectifs de la mission."
    );

    // 3. PRIX
    addClause("ARTICLE 3 - HONORAIRES", 
        "En contrepartie, le Client versera : " + document.getElementById('mission_price').value + " " + document.getElementById('mission_unit').value + " (HT).\n" +
        "Le Prestataire ne garantit pas de chiffre d'affaires minimum (Obligation de moyens)."
    );

    // 4. RGPD
    addClause("ARTICLE 4 - CONFIDENTALITE ET DONNEES", 
        "Si la mission implique l'accès à des données clients, le Prestataire agit comme sous-traitant RGPD et s'engage au secret professionnel absolu."
    );

    // 5. RUPTURE
    if(missionType === 'short') {
        addClause("ARTICLE 5 - ANNULATION", "Toute annulation < 72h par le Client entraîne 50% d'indemnités. < 24h : 100% dû.");
    } else {
        addClause("ARTICLE 5 - PREAVIS DE RUPTURE", "Préavis progressif selon l'ancienneté de la relation commerciale (loi Hamon/Code de commerce).");
    }

    // SIGNATURES
    if(y > 240) { doc.addPage(); y = 20; }
    y += 15;
    doc.text("Fait le " + new Date().toLocaleDateString(), 20, y);
    y += 10;
    doc.text("Le Client (Signature)", 20, y);
    doc.text("Le Prestataire (Signature)", 120, y);

    doc.save("Contrat_" + expertiseValue + "_" + freelance.name + ".pdf");
}

// Init
toggleAdeli();
</script>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-comment-ca-marche.php ---
<?php
/**
 * Template Name: Comment ça marche
 */
include 'header-inc.php';
?>

<div class="pt-32 pb-20 bg-oblink-beige/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 text-oblink-gray" style="font-family: 'Montserrat', sans-serif;">
            Comment ça marche ?
        </h1>
        <p class="text-xl text-oblink-gray/80 mb-8 max-w-3xl mx-auto">
            Une plateforme simple et intuitive pour connecter les professionnels de l'optique.
        </p>
    </div>
</div>

<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Step 1 -->
        <div class="flex flex-col md:flex-row items-center mb-20">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pr-12">
                <div
                    class="w-20 h-20 bg-oblink-orange text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    1</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Inscription & Profil</h3>
                <p class="text-lg text-oblink-gray/70">
                    Créez votre compte en quelques clics.
                    <br><br>
                    <strong>Candidats :</strong> Importez votre CV, diplômes et indiquez vos disponibilités.
                    <br>
                    <strong>Recruteurs :</strong> Créez la fiche de votre magasin et définissez vos besoins.
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-user-plus text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="flex flex-col md:flex-row-reverse items-center mb-20">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pl-12">
                <div
                    class="w-20 h-20 bg-oblink-blue text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    2</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Validation & Matching</h3>
                <p class="text-lg text-oblink-gray/70">
                    Notre algorithme vous propose les meilleures correspondances.
                    <br><br>
                    Nous validons manuellement chaque profil pour garantir la qualité du réseau. Vous recevez des
                    notifications dès qu'une opportunité correspond à vos critères.
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-check-circle text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="flex flex-col md:flex-row items-center">
            <div class="w-full md:w-1/2 mb-10 md:mb-0 md:pr-12">
                <div
                    class="w-20 h-20 bg-oblink-violet text-white rounded-full flex items-center justify-center text-4xl font-bold mb-6 shadow-lg">
                    3</div>
                <h3 class="text-3xl font-bold text-oblink-gray mb-4">Mission & Paiement</h3>
                <p class="text-lg text-oblink-gray/70">
                    Collaborez en toute sérénité.
                    <br><br>
                    Une fois la mission validée, le contrat est généré automatiquement. Le paiement est sécurisé et
                    versé à la fin de la mission (ou fin de mois pour les longues durées).
                </p>
            </div>
            <div class="w-full md:w-1/2">
                <div class="bg-gray-100 rounded-3xl h-64 w-full flex items-center justify-center">
                    <i class="fas fa-handshake text-6xl text-gray-300"></i>
                </div>
            </div>
        </div>

    </div>
</section>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>--- FILE: theme/page-emploi-opticien-v2.php ---
<?php
/*
Template Name: Emploi Opticien V2 (Premium UI)
Description: Matching Dashboard with Job Cards, TJM focus, and Real-time filters.
*/
include 'header-inc.php';
?>

<style>
    /* Gradient Text */
    .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-image: linear-gradient(90deg, #FF6600, #9A48D0);
    }

    /* Glassmorphism Cards */
    .job-card-glass {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .job-card-glass:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        border-color: rgba(255, 102, 0, 0.3);
    }

    /* Soft Badge */
    .badge-soft {
        padding: 4px 12px;
        border-radius: 9999px;
        font-weight: 700;
        font-size: 0.75rem;
        letter-spacing: 0.025em;
    }

    /* Filter Chips */
    .filter-chip {
        transition: all 0.2s;
    }

    .filter-chip:hover {
        transform: translateY(-1px);
    }

    .filter-chip.active {
        background: #303030;
        color: white;
        border-color: #303030;
    }
</style>

<div class="min-h-screen bg-gray-50/50 pt-28 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- HEADER: Matching Dashboard -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
            <div>
                <span
                    class="inline-block py-1 px-3 rounded-full bg-oblink-orange/10 text-oblink-orange font-bold text-xs mb-3 uppercase tracking-wider">
                    <i class="fas fa-bolt mr-1"></i> Live Matching
                </span>
                <h1 class="text-3xl md:text-5xl font-black text-oblink-gray">
                    Missions <span class="text-gradient">Compatibles</span>
                </h1>
                <p class="text-gray-500 mt-2 font-medium">
                    24 missions correspondent à votre profil "Expert Cosium" à <span
                        class="text-oblink-gray font-bold">Paris</span> (30km).
                </p>
            </div>

            <!-- ZONE C: Flash Post Button (Pour les recruteurs en vue inversée, ou CTA général) -->
            <div class="flex gap-3">
                <a href="<?php echo home_url('/publier-offre'); ?>"
                    class="group relative px-6 py-4 bg-oblink-gray text-white rounded-2xl font-bold shadow-lg shadow-gray-200 overflow-hidden transition-all hover:scale-105">
                    <div
                        class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:animate-shimmer">
                    </div>
                    <span class="relative flex items-center gap-2">
                        <i class="fas fa-plus-circle text-oblink-orange"></i>
                        Déposer une mission Flash
                    </span>
                </a>
            </div>
        </div>

        <!-- ZONE A: FILTRES INTELLIGENTS (Métiers) -->
        <div
            class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 mb-10 sticky top-24 z-30 backdrop-blur-md bg-white/90">
            <div class="flex flex-col md:flex-row gap-6 items-center justify-between">

                <!-- Logiciels -->
                <div class="flex flex-wrap gap-2 items-center">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wide mr-2">Logiciels :</span>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue active"
                        data-filter="software" data-value="all">Tous</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="Cosium">Cosium</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="Ivoirnet">Ivoirnet</button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:border-oblink-blue"
                        data-filter="software" data-value="WinOptics">WinOptics</button>
                </div>

                <div class="w-px h-8 bg-gray-200 hidden md:block"></div>

                <!-- Urgence & Type -->
                <div class="flex flex-wrap gap-2 items-center">
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-red-100 text-red-500 font-bold text-sm bg-red-50/50 hover:bg-red-500 hover:text-white transition-colors"
                        data-filter="urgent" data-value="true">
                        <i class="fas fa-fire mr-1"></i> Urgent (24h)
                    </button>
                    <button
                        class="filter-chip px-4 py-2 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm bg-white"
                        data-filter="type" data-value="remplacement">Remplacement</button>
                </div>

            </div>
        </div>

        <!-- ZONE B: LES CARTES D'ANNONCES (Grid) -->
        <div id="jobs-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Jobs injected via JS -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center mt-12 gap-2"></div>

    </div>
</div>

<script>
    // --- 15-20 REALISTIC MOCK MISSIONS ---
    const MISSIONS = [
        { id: 1, title: "Remplacement Opticien Diplômé", company: "Optic 2000", city: "Paris 15", software: "Cosium", tjm: 450, urgent: true, expert_required: true, type: "Remplacement", date: "Demain" },
        { id: 2, title: "Renfort Samedi Vente", company: "Afflelou", city: "Boulogne-Billancourt", software: "Cosium", tjm: 350, urgent: true, expert_required: false, type: "Intérim", date: "Samedi" },
        { id: 3, title: "Responsable Atelier (1 semaine)", company: "Krys", city: "Lyon 2", software: "Ivoirnet", tjm: 500, urgent: false, expert_required: true, type: "Remplacement", date: "22 Jan" },
        { id: 4, title: "Opticien Réfractionniste", company: "Indépendant", city: "Bordeaux", software: "WinOptics", tjm: 550, urgent: false, expert_required: true, type: "Audit", date: "25 Jan" },
        { id: 5, title: "Remplacement Congé Maladie", company: "Grand Optical", city: "Paris 08", software: "Cosium", tjm: 480, urgent: true, expert_required: true, type: "Remplacement", date: "Aujourd'h." },
        { id: 6, title: "Vendeur Lunettier", company: "Jimmy Fairly", city: "Lille", software: "PVO", tjm: 320, urgent: false, expert_required: false, type: "Intérim", date: "01 Fév" },
        { id: 7, title: "Expert Contactologie", company: "Lissac", city: "Strasbourg", software: "Ivoirnet", tjm: 600, urgent: false, expert_required: true, type: "Expertise", date: "10 Fév" },
        { id: 8, title: "Opticien Collaborateur", company: "Optical Center", city: "Toulouse", software: "WinOptics", tjm: 400, urgent: false, expert_required: false, type: "CDD Court", date: "15 Fév" },
        { id: 9, title: "Mission Urgente 3 jours", company: "Indépendant", city: "Marseille", software: "Cosium", tjm: 500, urgent: true, expert_required: true, type: "Remplacement", date: "Ce jeudi" },
        { id: 10, title: "Audit Tiers-Payant", company: "Réseau Santé", city: "Nantes", software: "Ivoirnet", tjm: 450, urgent: false, expert_required: true, type: "Audit", date: "Mars" },
        { id: 11, title: "Remplacement Directeur", company: "Atol", city: "Nice", software: "Cosium", tjm: 650, urgent: false, expert_required: true, type: "Management", date: "Avril" },
        { id: 12, title: "Vente Solaire Renfort", company: "Solaris", city: "Cannes", software: "PVO", tjm: 300, urgent: false, expert_required: false, type: "Saisonnier", date: "Mai" },
        { id: 13, title: "Optométriste Confirmé", company: "Santé Clair", city: "Paris 11", software: "WinOptics", tjm: 580, urgent: false, expert_required: true, type: "Consulting", date: "Juin" },
        { id: 14, title: "Remplacement maternité", company: "Ecouter Voir", city: "Rennes", software: "Cosium", tjm: 420, urgent: false, expert_required: true, type: "Remplacement", date: "Sept" },
        { id: 15, title: "Formateur en Magasin", company: "Zeiss", city: "Toute France", software: "Cosium", tjm: 700, urgent: false, expert_required: true, type: "Formation", date: "Oct" }
    ];

    let activeFilters = {
        software: 'all',
        urgent: false,
        type: 'all'
    };

    function renderJobs() {
        const container = document.getElementById('jobs-container');
        container.innerHTML = '';

        const filtered = MISSIONS.filter(m => {
            if (activeFilters.software !== 'all' && m.software !== activeFilters.software) return false;
            if (activeFilters.urgent && !m.urgent) return false;
            // Type filter logic matches on "string contains" for demo simplicity
            if (activeFilters.type !== 'all' && !m.type.toLowerCase().includes(activeFilters.type.toLowerCase())) return false;
            return true;
        });

        if (filtered.length === 0) {
            container.innerHTML = `<div class="col-span-3 text-center py-20">
                <div class="text-6xl mb-4">🤷‍♂️</div>
                <h3 class="text-xl font-bold text-gray-400">Aucune mission ne correspond.</h3>
                <button onclick="resetFilters()" class="mt-4 text-oblink-blue font-bold hover:underline">Réinitialiser les filtres</button>
            </div>`;
            return;
        }

        filtered.forEach(job => {
            const card = document.createElement('div');
            card.className = 'job-card-glass rounded-3xl p-6 relative flex flex-col h-full group cursor-pointer'; // Added cursor-pointer
            card.onclick = () => { // Add onclick handler
                window.location.href = '<?php echo home_url('/mission-detail'); ?>?id=' + job.id;
            };

            // Badge Software Color
            let softColor = "bg-gray-100 text-gray-600";
            if (job.software === "Cosium") softColor = "bg-blue-50 text-blue-600 border border-blue-100";
            if (job.software === "Ivoirnet") softColor = "bg-purple-50 text-purple-600 border border-purple-100";
            if (job.software === "WinOptics") softColor = "bg-orange-50 text-orange-600 border border-orange-100";

            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <span class="badge-soft ${softColor} flex items-center gap-1">
                        <i class="fas fa-desktop text-xs"></i> ${job.software}
                    </span>
                    ${job.urgent ? `
                    <span class="badge-soft bg-red-500 text-white animate-pulse shadow-red-200 shadow-lg">
                        <i class="fas fa-bolt mr-1"></i> Urgent
                    </span>` : `<span class="text-xs font-bold text-gray-400">${job.date}</span>`}
                </div>

                <div class="mb-auto">
                    <h3 class="font-bold text-xl text-oblink-gray mb-1 group-hover:text-oblink-orange transition-colors">${job.title}</h3>
                    <p class="text-sm text-gray-500 font-medium flex items-center gap-2">
                        <i class="fas fa-map-marker-alt text-gray-300"></i> ${job.city}
                        <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                        ${job.company}
                    </p>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-100 flex items-end justify-between">
                    <div>
                        <div class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">TJM PROPOSÉ</div>
                        <div class="text-3xl font-black text-oblink-gray group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-oblink-orange group-hover:to-oblink-violet transition-all">
                            ${job.tjm}€<span class="text-sm text-gray-400 font-medium ml-1">/j</span>
                        </div>
                    </div>
                    
                    ${job.expert_required ? `
                        <div class="flex flex-col items-end">
                             <div class="w-10 h-10 rounded-full bg-gradient-to-br from-oblink-orange to-oblink-violet flex items-center justify-center text-white shadow-lg tooltip-trigger" title="Certification Expert Requise">
                                <i class="fas fa-certificate"></i>
                             </div>
                             <span class="text-[10px] font-bold text-oblink-gray mt-1">Expert Only</span>
                        </div>
                    ` : `
                        <button class="w-10 h-10 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center group-hover:bg-oblink-blue group-hover:text-white transition-all">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    `}
                </div>
            `;
            container.appendChild(card);
        });
    }

    // Filter Logic
    document.querySelectorAll('.filter-chip').forEach(btn => {
        btn.addEventListener('click', function () {
            const filterType = this.dataset.filter;
            const value = this.dataset.value;

            // Update UI
            if (filterType === 'software') {
                document.querySelectorAll('[data-filter="software"]').forEach(b => b.classList.remove('active', 'bg-oblink-gray', 'text-white', 'border-transparent'));
                // Reset generic style on all
                document.querySelectorAll('[data-filter="software"]').forEach(b => b.classList.add('bg-white', 'text-gray-600', 'border-gray-200'));

                // Active Style
                this.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                this.classList.add('active', 'bg-oblink-gray', 'text-white', 'border-transparent');
                activeFilters.software = value;
            }

            if (filterType === 'urgent') {
                this.classList.toggle('ring-2');
                this.classList.toggle('ring-red-300');
                activeFilters.urgent = !activeFilters.urgent;
            }

            if (filterType === 'type') {
                // Simple toggle for demo
                activeFilters.type = activeFilters.type === 'remplacement' ? 'all' : 'remplacement';
                this.classList.toggle('bg-gray-100');
            }

            renderJobs();
        });
    });

    function resetFilters() {
        activeFilters = { software: 'all', urgent: false, type: 'all' };
        document.querySelectorAll('.filter-chip').forEach(b => {
            // Reset UI styles... simplified for demo
            b.classList.remove('active', 'ring-2', 'ring-red-300', 'bg-oblink-gray', 'text-white');
            if (b.dataset.filter === 'software' && b.dataset.value === 'all') b.classList.add('active', 'bg-oblink-gray', 'text-white');
        });
        renderJobs();
    }

    // Init
    document.addEventListener('DOMContentLoaded', renderJobs);

</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-emploi-opticien.php ---
<?php
/**
 * Template Name: Offres Emploi Opticien
 */

include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- OBSERVATOIRE BANNER -->
        <div class="max-w-5xl mx-auto mb-10">
            <a href="<?php echo home_url('/observatoire'); ?>"
                class="block bg-gradient-to-r from-gray-900 to-oblink-gray rounded-2xl p-6 shadow-lg text-white group hover:shadow-xl transition relative overflow-hidden">
                <div class="absolute right-0 top-0 bottom-0 w-64 bg-oblink-blue/10 skew-x-12 transform translate-x-10">
                </div>
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-2xl">
                            <i class="fas fa-chart-pie text-oblink-orange"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Consultez le Baromètre 2026</h3>
                            <p class="text-gray-400 text-sm">Avant de postuler, vérifiez les salaires du marché.</p>
                        </div>
                    </div>
                    <span
                        class="px-4 py-2 bg-white text-oblink-gray font-bold rounded-lg text-sm group-hover:bg-oblink-orange group-hover:text-white transition">
                        Voir l'étude <i class="fas fa-arrow-right ml-1"></i>
                    </span>
                </div>
            </a>
        </div>

        <!-- HEADER SECTION -->
        <div class="text-center mb-12">
            <div
                class="inline-block px-3 py-1 bg-oblink-orange/10 text-oblink-orange font-bold rounded-full text-xs uppercase tracking-wider mb-3">
                Sélection Hebdomadaire</div>
            <h1 class="text-4xl font-black font-display text-gray-900 mb-4 tracking-tight">
                Les Pépites <span class="text-oblink-blue">Oblink</span>
            </h1>
            <p class="text-xl text-gray-500 max-w-2xl mx-auto">
                Nous sélectionnons à la main les meilleures offres du marché (Salaire, Ambiance, Avantages).
            </p>
        </div>

        <!-- FILTERS SECTION -->
        <div class="max-w-5xl mx-auto mb-8">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-gray-900 flex items-center gap-2">
                        <i class="fas fa-filter text-oblink-blue"></i>
                        Filtrer les offres
                    </h3>
                    <button id="reset-filters"
                        class="text-sm text-oblink-blue hover:text-oblink-blue/80 font-semibold transition hidden">
                        <i class="fas fa-redo mr-1"></i>
                        Réinitialiser
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-4">
                    <!-- Contract Type Filter -->
                    <div>
                        <label for="filter-contract" class="block text-sm font-semibold text-gray-700 mb-2">
                            Type de contrat
                        </label>
                        <select id="filter-contract"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Tous les contrats</option>
                            <option value="cdi">CDI</option>
                            <option value="cdd">CDD / Remplacement</option>
                            <option value="freelance">Freelance</option>
                            <option value="vacation">Vacation</option>
                        </select>
                    </div>

                    <!-- City Filter -->
                    <div>
                        <label for="filter-city" class="block text-sm font-semibold text-gray-700 mb-2">
                            Ville
                        </label>
                        <input type="text" id="filter-city" placeholder="Ex: Paris, Lyon..."
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                    </div>

                    <!-- Region Filter (optional) -->
                    <div>
                        <label for="filter-region" class="block text-sm font-semibold text-gray-700 mb-2">
                            Région
                        </label>
                        <select id="filter-region"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:border-oblink-blue focus:ring-2 focus:ring-oblink-blue/20 transition outline-none">
                            <option value="">Toutes les régions</option>
                            <option value="ile-de-france">Île-de-France</option>
                            <option value="auvergne-rhone-alpes">Auvergne-Rhône-Alpes</option>
                            <option value="provence-alpes-cote-azur">Provence-Alpes-Côte d'Azur</option>
                            <option value="occitanie">Occitanie</option>
                            <option value="nouvelle-aquitaine">Nouvelle-Aquitaine</option>
                            <option value="hauts-de-france">Hauts-de-France</option>
                            <option value="grand-est">Grand Est</option>
                            <option value="pays-de-la-loire">Pays de la Loire</option>
                            <option value="bretagne">Bretagne</option>
                            <option value="normandie">Normandie</option>
                            <option value="bourgogne-franche-comte">Bourgogne-Franche-Comté</option>
                            <option value="centre-val-de-loire">Centre-Val de Loire</option>
                        </select>
                    </div>
                </div>

                <!-- Results Counter -->
                <div id="results-counter"
                    class="mt-4 pt-4 border-t border-gray-100 text-sm text-gray-600 font-medium hidden">
                    <i class="fas fa-search mr-2"></i>
                    <span id="counter-text">0 offre trouvée</span>
                </div>
            </div>
        </div>

        <!-- LOADING STATE -->
        <div id="loading-state" class="text-center py-12">
            <i class="fas fa-circle-notch fa-spin text-4xl text-oblink-blue mb-4"></i>
            <p class="text-gray-500">Recherche des meilleures missions...</p>
        </div>

        <!-- JOBS LIST CONTAINER -->
        <div id="jobs-container" class="grid gap-6 max-w-4xl mx-auto hidden">
            <!-- Jobs will be injected here via JS -->
        </div>

        <!-- EMPTY STATE -->
        <div id="empty-state" class="hidden text-center py-12 max-w-2xl mx-auto">
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
                <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">🧐
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Aucune offre pour le moment</h3>
                <p class="text-gray-500">Revenez plus tard, de nouvelles missions sont ajoutées chaque jour.</p>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loadingState = document.getElementById('loading-state');
        const jobsContainer = document.getElementById('jobs-container');
        const emptyState = document.getElementById('empty-state');

        // Check if we have a job_id parameter (single job view)
        const urlParams = new URLSearchParams(window.location.search);
        const singleJobId = urlParams.get('job_id');

        if (singleJobId) {
            // Redirect to mission detail page
            window.location.href = '<?php echo home_url('/mission-detail'); ?>?id=' + singleJobId;
            return;
        }

        let currentUser = null;

        let allJobs = []; // Store all jobs for filtering
        
        try {
            // Get Current User
            const { data: { session } } = await window.oblinkSupabase.auth.getSession();
            currentUser = session?.user || null;

            // Fetch Offers (Simplified Query)
            const { data: jobs, error } = await window.oblinkSupabase
                .from('offers')
                .select('*')
                .eq('status', 'active')
                .order('created_at', { ascending: false });

            console.log('Jobs fetched:', jobs, 'Error:', error);

            if (error) {
                console.error('Supabase Error:', error.message, error.details, error.hint);
                throw error;
            }

            // Hide loading
            loadingState.classList.add('hidden');

            if (!jobs || jobs.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            // Store all jobs for filtering
            allJobs = jobs;

            // Render all jobs initially
            renderJobs(allJobs);

            // Initialize filters
            setupFilters();

            // Check application status for logged user
            if (currentUser) {
                checkApplications(currentUser.id, jobs);
            }

        } catch (err) {
            console.error('Error loading jobs:', err);
            loadingState.innerHTML = `<p class="text-red-500">Erreur: ${err.message || 'Chargement impossible.'}</p><p class="text-xs text-gray-400 mt-2">Vérifiez la console (F12) pour plus de détails.</p>`;
        }

        // --- Filter Setup ---
        function setupFilters() {
            const filterContract = document.getElementById('filter-contract');
            const filterCity = document.getElementById('filter-city');
            const filterRegion = document.getElementById('filter-region');
            const resetBtn = document.getElementById('reset-filters');

            // Add event listeners
            filterContract.addEventListener('change', applyFilters);
            filterCity.addEventListener('input', applyFilters);
            filterRegion.addEventListener('change', applyFilters);
            resetBtn.addEventListener('click', resetFilters);
        }

        function applyFilters() {
            const contractValue = document.getElementById('filter-contract').value.toLowerCase();
            const cityValue = document.getElementById('filter-city').value.toLowerCase().trim();
            const regionValue = document.getElementById('filter-region').value.toLowerCase();

            // Filter jobs
            const filteredJobs = allJobs.filter(job => {
                let matches = true;

                // Contract filter
                if (contractValue && job.contract_type.toLowerCase() !== contractValue) {
                    matches = false;
                }

                // City filter (partial match)
                if (cityValue && !(job.city || '').toLowerCase().includes(cityValue)) {
                    matches = false;
                }

                // Region filter (you may need to add region field to offers table)
                // For now, we'll skip region filtering as it's not in the schema
                // if (regionValue && job.region?.toLowerCase() !== regionValue) {
                //     matches = false;
                // }

                return matches;
            });

            // Render filtered jobs
            renderJobs(filteredJobs);

            // Update UI
            updateFilterUI(filteredJobs.length);
        }

        function resetFilters() {
            // Clear all filters
            document.getElementById('filter-contract').value = '';
            document.getElementById('filter-city').value = '';
            document.getElementById('filter-region').value = '';

            // Render all jobs
            renderJobs(allJobs);

            // Hide reset button and counter
            document.getElementById('reset-filters').classList.add('hidden');
            document.getElementById('results-counter').classList.add('hidden');
        }

        function renderJobs(jobs) {
            if (jobs.length === 0) {
                jobsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100 inline-block">
                            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">🔍</div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Aucune offre ne correspond</h3>
                            <p class="text-gray-500">Essayez de modifier vos filtres</p>
                        </div>
                    </div>
                `;
                jobsContainer.classList.remove('hidden');
            } else {
                jobsContainer.innerHTML = jobs.map(job => renderJobCard(job)).join('');
                jobsContainer.classList.remove('hidden');
                jobsContainer.classList.add('grid', 'md:grid-cols-2', 'gap-6');

                // Re-check applications if user is logged in
                if (currentUser) {
                    checkApplications(currentUser.id, jobs);
                }
            }
        }

        function updateFilterUI(count) {
            const resetBtn = document.getElementById('reset-filters');
            const counter = document.getElementById('results-counter');
            const counterText = document.getElementById('counter-text');

            // Show/hide reset button
            const hasFilters = 
                document.getElementById('filter-contract').value ||
                document.getElementById('filter-city').value ||
                document.getElementById('filter-region').value;

            if (hasFilters) {
                resetBtn.classList.remove('hidden');
                counter.classList.remove('hidden');
                
                // Update counter text
                if (count === 0) {
                    counterText.textContent = 'Aucune offre trouvée';
                } else if (count === 1) {
                    counterText.textContent = '1 offre trouvée';
                } else {
                    counterText.textContent = `${count} offres trouvées sur ${allJobs.length}`;
                }
            } else {
                resetBtn.classList.add('hidden');
                counter.classList.add('hidden');
            }
        }

        // --- Render Function ---
        function renderJobCard(job) {
            // Format dates
            const startDate = new Date(job.start_date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' });
            const contractLabel = job.contract_type === 'cdd' ? 'CDD / Remplacement' : job.contract_type.toUpperCase();
            const salary = job.daily_rate ? `${job.daily_rate}€ / jour` : 'Salaire non affiché';

            // Random logo letter & color
            const letter = job.company?.company_name?.charAt(0) || 'O';
            const colors = ['bg-blue-100 text-blue-600', 'bg-purple-100 text-purple-600', 'bg-orange-100 text-orange-600'];
            const colorClass = colors[job.title.length % 3];

            return `
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition group relative overflow-hidden job-card cursor-pointer" 
                     data-job-id="${job.id}"
                     onclick="window.location.href='<?php echo home_url('/emploi-opticien'); ?>?job_id=${job.id}'">
                    <div class="flex flex-col gap-4">
                        <!-- LOGO -->
                        <div class="w-12 h-12 rounded-xl flex-shrink-0 flex items-center justify-center text-lg font-bold border border-gray-200 ${colorClass}">
                            ${letter}
                        </div>

                        <!-- CONTENT -->
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <h3 class="text-lg font-bold text-gray-900 group-hover:text-oblink-blue transition flex-1">
                                    ${job.title}
                                </h3>
                            </div>

                            <div class="flex flex-wrap gap-2 text-xs text-gray-600 mb-3">
                                <span class="flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-1 rounded font-semibold">
                                    <i class="fas fa-map-marker-alt"></i> ${job.city || 'Ville inconnue'}
                                </span>
                                <span class="flex items-center gap-1 bg-gray-100 text-gray-700 px-2 py-1 rounded font-medium">
                                    <i class="fas fa-file-contract"></i> ${contractLabel}
                                </span>
                                <span class="flex items-center gap-1 bg-green-50 text-green-700 px-2 py-1 rounded font-bold">
                                    <i class="fas fa-euro-sign"></i> ${salary}
                                </span>
                            </div>

                            <p class="text-sm text-gray-500 line-clamp-2 mb-4">
                                ${job.description || 'Aucune description disponible.'}
                            </p>

                            <!-- ACTION BUTTONS -->
                            <div class="flex items-center gap-3">
                                ${currentUser ?
                    `<button onclick="event.stopPropagation(); applyToJob(this, '${job.id}')"
                                        class="apply-btn flex-1 px-4 py-2.5 bg-oblink-blue text-white font-bold rounded-xl hover:bg-blue-600 transition shadow-md flex items-center justify-center gap-2">
                                        <i class="fas fa-paper-plane"></i> Postuler
                                    </button>` :
                    `<a href="<?php echo home_url('/login'); ?>?redirect=${encodeURIComponent(window.location.pathname)}"
                                        onclick="event.stopPropagation()"
                                        class="flex-1 px-4 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-gray-800 transition shadow-md flex items-center justify-center gap-2">
                                        <i class="fas fa-lock"></i> Connectez-vous pour postuler
                                    </a>`
                }
                                <button onclick="event.stopPropagation(); window.location.href='<?php echo home_url('/emploi-opticien'); ?>?job_id=${job.id}'" 
                                        class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Apply Function ---
        window.applyToJob = async function (btn, jobId) {
            if (btn.disabled) return;

            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi...';
            btn.disabled = true;
            btn.classList.add('opacity-75');

            try {
                const { data: { session } } = await window.oblinkSupabase.auth.getSession();
                if (!session) throw new Error("Non connecté");

                // Check if already applied (double check)
                const { data: existing } = await window.oblinkSupabase
                    .from('applications')
                    .select('id')
                    .eq('offer_id', jobId)
                    .eq('opticien_id', session.user.id)
                    .single();

                if (existing) {
                    throw new Error("Vous avez déjà postulé à cette offre.");
                }

                // Insert Application
                const { error } = await window.oblinkSupabase
                    .from('applications')
                    .insert([{
                        offer_id: jobId,
                        opticien_id: session.user.id,
                        status: 'pending'
                    }]);

                if (error) throw error;

                // Success UI
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Candidature envoyée';
                btn.classList.remove('bg-oblink-blue', 'text-white', 'hover:bg-blue-600', 'shadow-blue-100');
                btn.classList.add('bg-green-100', 'text-green-700', 'cursor-default');

                // Toast
                if (typeof showToast === 'function') {
                    showToast('Candidature envoyée avec succès !', 'success');
                }

            } catch (err) {
                console.error('Apply error:', err);
                
                // Show error in a better way (not alert)
                btn.innerHTML = '<i class="fas fa-exclamation-circle"></i> Erreur';
                btn.classList.add('bg-red-100', 'text-red-700');
                
                // Reset after 3 seconds
                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                    btn.classList.remove('opacity-75', 'bg-red-100', 'text-red-700');
                }, 3000);
            }
        }

        // --- Check Existing Applications ---
        async function checkApplications(userId, jobs) {
            const jobIds = jobs.map(j => j.id);
            if (jobIds.length === 0) return;

            const { data: applications } = await window.oblinkSupabase
                .from('applications')
                .select('offer_id')
                .eq('opticien_id', userId)
                .in('offer_id', jobIds);

            if (applications) {
                applications.forEach(app => {
                    const card = document.querySelector(`.job-card[data-job-id="${app.offer_id}"]`);
                    if (card) {
                        const btn = card.querySelector('.apply-btn');
                        if (btn) {
                            btn.innerHTML = '<i class="fas fa-check-circle"></i> Déjà postulé';
                            btn.classList.remove('bg-oblink-blue', 'text-white', 'hover:bg-blue-600', 'shadow-blue-100');
                            btn.classList.add('bg-gray-100', 'text-gray-500', 'cursor-default');
                            btn.disabled = true;
                        }
                    }
                });
            }
        }
    });
</script>

<?php
include get_template_directory() . "/footer-content.php";
wp_footer();
?>--- FILE: theme/page-facture.php ---
<?php
/*
Template Name: Facture
*/
include 'header-inc.php';
?>

<div class="max-w-5xl mx-auto px-4 pt-32 pb-32">
    <!-- Back Link (Simulating the specific nav's intent) -->
    <div class="mb-6">
        <a href="<?php echo home_url('/dashboard'); ?>"
            class="text-oblink-blue font-semibold hover:underline inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Retour au tableau de bord
        </a>
    </div>

    <div class="glass-card bg-white rounded-2xl shadow-xl p-8 md:p-12">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-oblink-gray mb-3" style="font-family: 'Montserrat', sans-serif;">
                <i class="fas fa-file-invoice text-oblink-orange mr-3"></i>
                Créer une <span class="text-oblink-orange">Facture</span>
            </h1>
            <p class="text-oblink-gray/70">Facture électronique conforme aux normes françaises</p>
            <div
                class="inline-flex items-center px-4 py-2 bg-green-50 border-2 border-green-500 text-green-700 rounded-lg mt-4">
                <i class="fas fa-check-circle mr-2"></i>
                <span class="text-sm font-semibold">Conforme à la facturation électronique obligatoire</span>
            </div>
        </div>

        <form id="invoice-form" data-validate class="space-y-8">
            <!-- Invoice Info -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-info-circle text-oblink-orange mr-3"></i>
                    Informations générales
                </h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Numéro de facture <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="invoiceNumber" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="FACT-2025-001" value="FACT-2025-001">
                        <p class="text-xs text-oblink-gray/60 mt-1">Numérotation chronologique obligatoire</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Date d'émission <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="issueDate" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            value="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Date d'échéance <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="dueDate" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition">
                        <p class="text-xs text-oblink-gray/60 mt-1">Selon conditions de paiement</p>
                    </div>
                </div>
            </div>

            <!-- Emetteur (From) -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-user text-oblink-blue mr-3"></i>
                    Émetteur (Vous)
                </h2>
                <div class="bg-oblink-blue/5 p-6 rounded-xl space-y-4">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Nom complet <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fromName" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="Sarah Dubois" value="Sarah Dubois">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                SIRET <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fromSIRET" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="123 456 789 00012" value="123 456 789 00012">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Adresse complète <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="fromAddress" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="123 rue de la République, 75001 Paris"
                            value="123 rue de la République, 75001 Paris">
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Email
                            </label>
                            <input type="email" name="fromEmail"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="sarah.dubois@email.com" value="sarah.dubois@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Téléphone
                            </label>
                            <input type="tel" name="fromPhone"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="06 12 34 56 78" value="06 12 34 56 78">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            N° TVA Intracommunautaire
                        </label>
                        <input type="text" name="fromVAT"
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="FR12 345 678 901 (si applicable)">
                        <div class="flex items-start mt-3 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-2 mt-1"></i>
                            <p class="text-sm text-yellow-800">
                                <strong>Franchise en base de TVA :</strong> Si vous bénéficiez du régime de franchise en
                                base,
                                laissez ce champ vide et la mention "TVA non applicable, art. 293 B du CGI" sera
                                automatiquement ajoutée.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Destinataire (Client) -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-building text-oblink-violet mr-3"></i>
                    Destinataire (Client)
                </h2>
                <div class="bg-oblink-violet/5 p-6 rounded-xl space-y-4">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Nom de l'entreprise <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="toName" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="Optique Martin">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                SIRET <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="toSIRET" required
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="987 654 321 00012">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Adresse complète <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="toAddress" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="45 avenue de la République, 33000 Bordeaux">
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                Email du contact
                            </label>
                            <input type="email" name="toEmail"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="contact@optiquemartin.fr">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                N° TVA Intracommunautaire
                            </label>
                            <input type="text" name="toVAT"
                                class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                placeholder="FR98 765 432 109">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services/Lines -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-list text-oblink-orange mr-3"></i>
                    Prestations facturées
                </h2>
                <div id="services-container" class="space-y-4">
                    <!-- Service Line 1 -->
                    <div class="service-line border-2 border-oblink-beige rounded-xl p-6">
                        <div class="grid md:grid-cols-12 gap-4 items-start">
                            <div class="md:col-span-5">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Description détaillée <span class="text-red-500">*</span>
                                </label>
                                <textarea name="serviceDesc[]" required rows="3"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                                    placeholder="Mission de remplacement du 15/01/2025 au 17/01/2025 - Examen de vue, adaptation lentilles de contact, conseils clientèle"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Quantité <span class="text-red-500">*</span>
                                </label>
                                <input type="number" name="serviceQty[]" required min="1" value="3"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition service-qty"
                                    placeholder="1">
                                <p class="text-xs text-oblink-gray/60 mt-1">Jours</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Prix unitaire HT (€) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" name="servicePrice[]" required min="0" step="0.01" value="280"
                                    class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition service-price"
                                    placeholder="100.00">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-oblink-gray mb-2">
                                    Total HT (€)
                                </label>
                                <div
                                    class="px-4 py-3 bg-oblink-beige/50 rounded-lg font-bold text-oblink-orange text-lg service-total">
                                    840,00 €
                                </div>
                            </div>
                            <div class="md:col-span-1 flex items-end">
                                <button type="button"
                                    class="remove-service px-3 py-3 text-red-500 hover:bg-red-50 rounded-lg transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" id="add-service"
                    class="mt-4 px-6 py-3 border-2 border-oblink-blue text-oblink-blue rounded-lg hover:bg-oblink-blue hover:text-white transition font-semibold">
                    <i class="fas fa-plus mr-2"></i>Ajouter une ligne
                </button>
            </div>

            <!-- Totals -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-calculator text-oblink-violet mr-3"></i>
                    Totaux
                </h2>
                <div class="bg-oblink-beige/30 p-6 rounded-xl space-y-4">
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-semibold">Total HT</span>
                        <span class="text-2xl font-bold text-oblink-blue" id="total-ht">840,00 €</span>
                    </div>
                    <div class="flex justify-between items-center text-sm text-oblink-gray/70">
                        <span>TVA (Non assujetti - Franchise en base)</span>
                        <span class="font-semibold">0,00 €</span>
                    </div>
                    <div class="border-t-2 border-oblink-gray pt-4 flex justify-between items-center">
                        <span class="text-2xl font-bold">Total TTC</span>
                        <span class="text-4xl font-bold text-oblink-orange" id="total-ttc">840,00 €</span>
                    </div>
                    <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Mention obligatoire :</strong> "TVA non applicable, article 293 B du CGI"
                            sera automatiquement ajoutée à la facture si vous êtes en franchise en base.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Payment Terms & Legal Info -->
            <div class="pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-euro-sign text-oblink-blue mr-3"></i>
                    Conditions de paiement et mentions légales
                </h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Délai de paiement <span class="text-red-500">*</span>
                        </label>
                        <select name="paymentTerms" required
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition">
                            <option value="30">Paiement à 30 jours</option>
                            <option value="0">Paiement comptant</option>
                            <option value="15">Paiement à 15 jours</option>
                            <option value="45">Paiement à 45 jours (dérogation légale requise)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Moyens de paiement acceptés <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-2">
                            <label
                                class="flex items-center p-3 border-2 border-oblink-beige rounded-lg hover:border-oblink-orange cursor-pointer transition">
                                <input type="checkbox" name="paymentMethods" value="virement" checked
                                    class="mr-3 w-5 h-5 text-oblink-orange">
                                <span>Virement bancaire</span>
                            </label>
                            <div class="ml-8 grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-oblink-gray mb-1">
                                        IBAN <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="iban" required
                                        class="w-full px-3 py-2 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition text-sm"
                                        placeholder="FR76 1234 5678 9012 3456 7890 123"
                                        value="FR76 1234 5678 9012 3456 7890 123">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-oblink-gray mb-1">
                                        BIC <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="bic" required
                                        class="w-full px-3 py-2 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition text-sm"
                                        placeholder="BNPAFRPPXXX" value="BNPAFRPPXXX">
                                </div>
                            </div>
                            <label
                                class="flex items-center p-3 border-2 border-oblink-beige rounded-lg hover:border-oblink-orange cursor-pointer transition">
                                <input type="checkbox" name="paymentMethods" value="cheque"
                                    class="mr-3 w-5 h-5 text-oblink-orange">
                                <span>Chèque à l'ordre de : <input type="text" name="chequeName"
                                        placeholder="Sarah Dubois"
                                        class="ml-2 px-2 py-1 border-b-2 border-oblink-beige focus:border-oblink-orange focus:outline-none"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Mentions légales obligatoires -->
                    <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                        <h3 class="font-bold text-red-800 mb-4 flex items-center text-lg">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Mentions obligatoires (automatiquement ajoutées)
                        </h3>
                        <div class="space-y-3 text-sm text-red-700">
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Pénalités de retard :</strong> En cas de retard de paiement, des pénalités de
                                retard calculées
                                au taux de <strong>3 fois le taux d'intérêt légal</strong> seront exigibles de plein
                                droit,
                                conformément à l'article L441-10 du Code de commerce.
                            </div>
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Indemnité forfaitaire :</strong> Une indemnité forfaitaire de <strong>40
                                    euros</strong>
                                pour frais de recouvrement sera due de plein droit en cas de retard de paiement
                                (articles D441-5 et L441-10 du Code de commerce).
                            </div>
                            <div class="bg-white p-3 rounded-lg">
                                <strong>Escompte :</strong> Aucun escompte n'est accordé en cas de paiement anticipé
                                (sauf mention contraire ci-dessous).
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-semibold text-red-800 mb-2">
                                Escompte pour paiement anticipé (optionnel)
                            </label>
                            <input type="text" name="discount"
                                class="w-full px-4 py-3 border-2 border-red-200 rounded-lg focus:border-red-400 focus:outline-none transition"
                                placeholder="Ex: 2% pour paiement sous 8 jours">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-oblink-gray mb-2">
                            Notes / Commentaires
                        </label>
                        <textarea name="notes" rows="4"
                            class="w-full px-4 py-3 border-2 border-oblink-beige rounded-lg focus:border-oblink-orange focus:outline-none transition"
                            placeholder="Merci pour votre confiance. N'hésitez pas à me recontacter pour vos prochains besoins."></textarea>
                    </div>
                </div>
            </div>

            <!-- Signature -->
            <div class="border-b border-oblink-beige pb-6">
                <h2 class="text-2xl font-bold text-oblink-gray mb-6 flex items-center">
                    <i class="fas fa-signature text-oblink-blue mr-3"></i>
                    Signature et Validation
                </h2>
                <div class="bg-gray-50 rounded-xl p-6 border-2 border-dashed border-gray-300">
                    <p class="text-sm font-semibold text-gray-500 mb-2">Signature de l'émetteur (Vous)</p>
                    <canvas id="signature-pad"
                        class="bg-white border border-gray-200 rounded-lg shadow-sm w-full h-40 cursor-crosshair"></canvas>
                    <div class="flex justify-between mt-2">
                        <button type="button" id="clear-signature"
                            class="text-xs text-red-500 hover:text-red-700 underline">
                            Effacer la signature
                        </button>
                        <span class="text-xs text-green-600 hidden" id="sig-status"><i
                                class="fas fa-check mr-1"></i>Signé</span>
                    </div>
                    <input type="hidden" name="signatureData" id="signature-data">
                </div>
                <div class="mt-4 flex items-start p-3 bg-blue-50 text-blue-800 rounded-lg text-sm">
                    <i class="fas fa-lock mt-1 mr-2"></i>
                    <p>En signant, vous certifiez l'exactitude des informations. Un certificat numérique sera apposé au
                        PDF final.</p>
                </div>
            </div>

            <!-- Submit -->
            <div class="flex gap-4">
                <a href="<?php echo home_url('/dashboard/invoices'); ?>"
                    class="flex-1 px-6 py-4 border-2 border-oblink-gray text-oblink-gray text-center rounded-lg hover:bg-oblink-gray/5 transition font-semibold">
                    Annuler
                </a>
                <button type="button"
                    onclick="alert('Fonctionnalité simulée: Facture envoyée à votre email (compta@entreprise.com)')"
                    class="flex-1 px-6 py-4 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition font-semibold">
                    <i class="fas fa-envelope-open-text mr-2"></i>Envoyer au comptable
                </button>
                <button type="submit"
                    class="flex-1 px-6 py-4 bg-oblink-orange text-white rounded-lg hover:bg-oblink-orange/90 transition font-semibold shadow-lg">
                    <i class="fas fa-paper-plane mr-2"></i>Émettre & Envoyer
                </button>
            </div>
        </form>
    </div>

    <!-- Legal Compliance Info -->
    <div class="mt-8 bg-green-50 border-2 border-green-500 rounded-xl p-6">
        <h3 class="font-bold text-green-800 mb-3 flex items-center text-lg">
            <i class="fas fa-check-circle text-green-600 mr-2"></i>
            Facture électronique conforme à la réglementation française
        </h3>
        <div class="text-sm text-green-700 space-y-3">
            <p><strong>Votre facture inclura automatiquement toutes les mentions légales obligatoires :</strong></p>
            <div class="grid md:grid-cols-2 gap-4">
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li>Numéro de facture unique et chronologique</li>
                    <li>Date d'émission et date d'échéance</li>
                    <li>Identité complète émetteur (SIRET, adresse)</li>
                    <li>Identité complète client (SIRET, adresse)</li>
                    <li>Description détaillée des prestations</li>
                    <li>Prix unitaires HT et quantités</li>
                    <li>Total HT, TVA et Total TTC</li>
                </ul>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li>Mention TVA si franchise en base (Art. 293B CGI)</li>
                    <li>Conditions de règlement</li>
                    <li>Coordonnées bancaires (IBAN/BIC)</li>
                    <li>Pénalités de retard (3x taux légal)</li>
                    <li>Indemnité forfaitaire de 40€</li>
                    <li>Escompte si paiement anticipé</li>
                    <li>Format archivable (PDF/A-3 avec XML)</li>
                </ul>
            </div>
            <div class="mt-4 p-4 bg-white rounded-lg border-l-4 border-green-600">
                <p class="font-semibold text-green-800 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>Facturation électronique obligatoire depuis 2024
                </p>
                <p class="text-green-700">
                    Conformément à la réforme de la facturation électronique, toutes les factures entre professionnels
                    (B2B)
                    doivent être émises et transmises au format électronique via une plateforme de dématérialisation
                    certifiée
                    ou via le portail public de facturation (PPF). OBLINK vous aide à rester conforme.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Signature Logic ---
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Resize canvas
    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        ctx.scale(ratio, ratio);
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas(); // Initial call happens fast, might need delay if element not visible yet

    // Draw
    function draw(e) {
        if (!isDrawing) return;

        // precise coordinates
        const rect = canvas.getBoundingClientRect();
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
        const scaleX = canvas.width / rect.width / (window.devicePixelRatio || 1); // Adjust for logical size

        const x = (clientX - rect.left);
        const y = (clientY - rect.top);

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        [lastX, lastY] = [x, y];

        document.getElementById('sig-status').classList.remove('hidden');
    }

    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        lastX = e.clientX - rect.left;
        lastY = e.clientY - rect.top;
    });
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        lastX = e.touches[0].clientX - rect.left;
        lastY = e.touches[0].clientY - rect.top;
    });
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        draw(e);
    });
    canvas.addEventListener('touchend', () => isDrawing = false);

    // Clear
    document.getElementById('clear-signature').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('sig-status').classList.add('hidden');
    });


    // --- Existing Calculator Logic ---

    // Calculate totals
    function calculateTotals() {
        let total = 0;
        document.querySelectorAll('.service-line').forEach(line => {
            const qty = parseFloat(line.querySelector('.service-qty').value) || 0;
            const price = parseFloat(line.querySelector('.service-price').value) || 0;
            const lineTotal = qty * price;
            line.querySelector('.service-total').textContent = lineTotal.toFixed(2).replace('.', ',') + ' €';
            total += lineTotal;
        });
        document.getElementById('total-ht').textContent = total.toFixed(2).replace('.', ',') + ' €';
        document.getElementById('total-ttc').textContent = total.toFixed(2).replace('.', ',') + ' €';
    }

    // Add service line
    document.getElementById('add-service').addEventListener('click', function () {
        const template = document.querySelector('.service-line').cloneNode(true);
        template.querySelectorAll('input, textarea').forEach(input => input.value = '');
        template.querySelector('.service-qty').value = '1';
        template.querySelector('.service-price').value = '';
        template.querySelector('.service-total').textContent = '0,00 €';
        document.getElementById('services-container').appendChild(template);
        attachEventListeners();
    });

    // Remove service line
    function attachEventListeners() {
        document.querySelectorAll('.remove-service').forEach(btn => {
            btn.onclick = function () {
                if (document.querySelectorAll('.service-line').length > 1) {
                    this.closest('.service-line').remove();
                    calculateTotals();
                } else {
                    alert('Vous devez avoir au moins une prestation');
                }
            };
        });

        document.querySelectorAll('.service-qty, .service-price').forEach(input => {
            input.addEventListener('input', calculateTotals);
        });
    }

    // URL Params Pre-fill (V51)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('from') === 'devis') {
        if (urlParams.get('client')) document.querySelector('input[name="toName"]').value = urlParams.get('client');
        if (urlParams.get('address')) document.querySelector('input[name="toAddress"]').value = urlParams.get('address');

        // Add a notification toast (simulated)
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-4 rounded-xl shadow-xl z-50 animate-bounce';
        toast.innerHTML = '<i class="fas fa-magic mr-2"></i>Données du devis importées !';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // Form submission
    document.getElementById('invoice-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // Check if signed
        const hasSignature = !document.getElementById('sig-status').classList.contains('hidden');
        if (!hasSignature) {
            alert('Veuillez signer la facture avant de l\'émettre.');
            return;
        }

        const clientName = document.querySelector('input[name="toName"]').value;
        alert(`Facture émise avec succès !\n\n1. Copie envoyée à ${clientName} (Email)\n2. Copie archivée dans le grimoire numérique.`);

        // Redirect to dashboard after success
        setTimeout(() => {
            window.location.href = '<?php echo home_url("/dashboard-entreprise"); ?>';
        }, 1000);
    });

    attachEventListeners();
    calculateTotals();
    // Re-trigger resize after small delay to ensure container is rendered
    setTimeout(resizeCanvas, 100);
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-debug-auth.php ---
<?php
/*
Template Name: Debug Auth
*/
include 'header-inc.php';
?>

<div class="min-h-screen bg-gray-50 pt-32 pb-20 px-4">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-oblink-gray mb-6">🔍 Diagnostic Authentification</h1>

            <div id="auth-debug-output" class="space-y-4">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-oblink-orange"></div>
                <p class="text-gray-500">Chargement des informations...</p>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200">
                <button onclick="location.reload()"
                    class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold mr-3">
                    🔄 Rafraîchir
                </button>
                <button onclick="clearAndLogout()"
                    class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold">
                    🗑️ Déconnexion Complète
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    async function clearAndLogout() {
        if (confirm('Ceci va te déconnecter et vider toutes les données. Continuer ?')) {
            try {
                await window.oblinkSupabase.auth.signOut();
                localStorage.clear();
                sessionStorage.clear();
                alert('✅ Déconnexion réussie ! Refresh de la page...');
                window.location.href = '<?php echo home_url('/'); ?>';
            } catch (err) {
                alert('Erreur : ' + err.message);
            }
        }
    }

    async function runDiagnostic() {
        const output = document.getElementById('auth-debug-output');

        try {
            // Check if Supabase is loaded
            if (!window.oblinkSupabase) {
                output.innerHTML = `
                <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">❌ Supabase non chargé</h3>
                    <p class="text-red-600">Le client Supabase n'est pas initialisé.</p>
                </div>
            `;
                return;
            }

            // Get session
            const { data: { session }, error } = await window.oblinkSupabase.auth.getSession();

            if (error) {
                output.innerHTML = `
                <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">❌ Erreur Session</h3>
                    <p class="text-red-600">${error.message}</p>
                </div>
            `;
                return;
            }

            if (!session) {
                output.innerHTML = `
                <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                    <h3 class="font-bold text-yellow-800 mb-2">⚠️ Non connecté</h3>
                    <p class="text-yellow-700">Aucune session active détectée.</p>
                    <a href="<?php echo home_url('/login'); ?>" class="inline-block mt-3 px-4 py-2 bg-oblink-orange text-white rounded-lg">
                        Se connecter
                    </a>
                </div>
            `;
                return;
            }

            // Session exists - show details
            const user = session.user;
            const userType = user.user_metadata?.user_type;
            const correctDashboard = userType === 'entreprise' ? '/dashboard-entreprise' : '/dashboard-opticien';

            output.innerHTML = `
            <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4">
                <h3 class="font-bold text-green-800 mb-3">✅ Session Active</h3>
                <dl class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <dt class="font-semibold text-gray-700">Email:</dt>
                        <dd class="text-gray-900">${user.email}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="font-semibold text-gray-700">User ID:</dt>
                        <dd class="text-gray-900 font-mono text-xs">${user.id}</dd>
                    </div>
                    <div class="flex justify-between items-center">
                        <dt class="font-semibold text-gray-700">Type utilisateur:</dt>
                        <dd class="px-3 py-1 rounded-full text-xs font-bold ${userType === 'entreprise' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}">
                            ${userType || 'NON DÉFINI'}
                        </dd>
                    </div>
                </dl>
            </div>

            <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                <h3 class="font-bold text-blue-800 mb-3">📊 Métadonnées Complètes</h3>
                <pre class="bg-white p-3 rounded overflow-auto text-xs">${JSON.stringify(user.user_metadata, null, 2)}</pre>
            </div>

            <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-4">
                <h3 class="font-bold text-purple-800 mb-3">🎯 Dashboard Recommandé</h3>
                <p class="text-purple-700 mb-3">Selon ton type (<strong>${userType}</strong>), tu devrais accéder à :</p>
                <a href="<?php echo home_url(); ?>${correctDashboard}" 
                   class="inline-block px-6 py-3 ${userType === 'entreprise' ? 'bg-oblink-blue' : 'bg-oblink-orange'} text-white rounded-lg font-semibold hover:opacity-90">
                    ${userType === 'entreprise' ? '🏢' : '👤'} Aller au Dashboard ${userType === 'entreprise' ? 'Entreprise' : 'Opticien'}
                </a>
            </div>
        `;

        } catch (err) {
            output.innerHTML = `
            <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                <h3 class="font-bold text-red-800 mb-2">❌ Erreur Diagnostic</h3>
                <p class="text-red-600">${err.message}</p>
            </div>
        `;
        }
    }

    // Run on load
    document.addEventListener('DOMContentLoaded', runDiagnostic);
</script>

<?php include get_template_directory() . "/footer-content.php";
wp_footer(); ?>--- FILE: theme/page-a-propos.php ---
<?php
/*
Template Name: À Propos
*/
include 'header-inc.php';
?>

<div class="max-w-4xl mx-auto px-4 py-32">
    <h1 class="text-5xl font-bold text-oblink-gray mb-6" style="font-family: 'Montserrat', sans-serif;">
        À propos d'<span class="text-oblink-orange">OBLINK</span>
    </h1>

    <div class="prose prose-lg max-w-none">
        <p class="text-xl text-oblink-gray/80 mb-8">
            OBLINK est la première plateforme de mise en relation spécialisée dans le secteur de l'optique en France.
        </p>

        <div class="glass p-8 mb-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-oblink-gray mb-4">Notre Mission</h2>
            <p class="text-oblink-gray/80">
                Connecter instantanément les opticiens et vendeurs indépendants aux magasins et entreprises d'optique.
                Nous croyons en un secteur où la flexibilité, la confiance et la simplicité sont les maîtres mots.
            </p>
        </div>

        <h2 class="text-3xl font-bold text-oblink-gray mb-4">Notre Histoire</h2>
        <p class="text-oblink-gray/80 mb-6">
            L'idée d'OBLINK est née d'une observation simple : la mise en relation entre opticiens et entreprises reste
            archaïque dans un secteur pourtant moderne.
            Après avoir observé les difficultés des opticiens indépendants à trouver des missions et des magasins à
            recruter rapidement,
            nous avons décidé de créer la solution qui manquait au marché.
        </p>

        <div class="grid md:grid-cols-3 gap-6 my-12">
            <div class="glass p-6 text-center border-2 border-oblink-orange rounded-xl">
                <div class="text-4xl font-bold text-oblink-orange mb-2">2025</div>
                <div class="text-oblink-gray/70">Année de création</div>
            </div>
            <div class="glass p-6 text-center border-2 border-oblink-blue rounded-xl">
                <div class="text-4xl font-bold text-oblink-blue mb-2">500+</div>
                <div class="text-oblink-gray/70">Opticiens actifs</div>
            </div>
            <div class="glass p-6 text-center border-2 border-oblink-violet rounded-xl">
                <div class="text-4xl font-bold text-oblink-violet mb-2">200+</div>
                <div class="text-oblink-gray/70">Entreprises partenaires</div>
            </div>
        </div>

        <h2 class="text-3xl font-bold text-oblink-gray mb-4">Nos Valeurs</h2>
        <div class="space-y-6 mb-8">
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-bolt text-oblink-orange text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Rapidité</h3>
                    <p class="text-oblink-gray/80">Une mise en relation instantanée, des réponses en moins de 48h</p>
                </div>
            </div>
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-shield-alt text-oblink-blue text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Confiance</h3>
                    <p class="text-oblink-gray/80">Validation rigoureuse en 4 étapes, profils vérifiés et authentifiés
                    </p>
                </div>
            </div>
            <div class="flex items-start glass p-6 rounded-xl">
                <i class="fas fa-hands-helping text-oblink-violet text-3xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-bold mb-2">Transparence</h3>
                    <p class="text-oblink-gray/80">Tarification claire, pas de frais cachés, rémunération équitable</p>
                </div>
            </div>
        </div>

        <div class="glass p-8 text-center rounded-2xl">
            <h2 class="text-2xl font-bold text-oblink-gray mb-4">Rejoignez l'aventure !</h2>
            <p class="text-oblink-gray/80 mb-6">Que vous soyez opticien ou entreprise, OBLINK vous accompagne</p>
            <div class="flex gap-4 justify-center flex-wrap">
                <a href="<?php echo home_url('/register?type=opticien'); ?>"
                    class="px-6 py-3 bg-oblink-orange text-white rounded-lg font-semibold hover:bg-oblink-orange/90 transition">
                    Je suis opticien
                </a>
                <a href="<?php echo home_url('/register?type=entreprise'); ?>"
                    class="px-6 py-3 bg-oblink-violet text-white rounded-lg font-semibold hover:bg-oblink-violet/90 transition">
                    Je suis une entreprise
                </a>
            </div>
        </div>
    </div>
</div>

<?php include get_template_directory() . "/footer-content.php"; wp_footer(); ?>